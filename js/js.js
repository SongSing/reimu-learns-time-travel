!function(_){if("object"==typeof exports)module.exports=_();else{var T;"undefined"==typeof window?"undefined"==typeof global?"undefined"!=typeof self&&(T=self):T=global:T=window,T.p2=_()}}(function(){return function P(S,A,E){function R(M,O){if(!A[M]){if(!S[M]){var U="function"==typeof require&&require;if(!O&&U)return U(M,!0);if(L)return L(M,!0);throw new Error("Cannot find module '"+M+"'")}var W=A[M]={exports:{}};S[M][0].call(W.exports,function(X){var V=S[M][1][X];return R(V?V:X)},W,W.exports,P,S,A,E)}return A[M].exports}for(var L="function"==typeof require&&require,D=0;D<E.length;D++)R(E[D]);return R}({1:[function(P,S){function E(){}var R=P("./Scalar");S.exports=E;E.lineInt=function(L,D,M){M=M||0;var O=[0,0],U,W,X,V,H,Y,z;return U=L[1][1]-L[0][1],W=L[0][0]-L[1][0],X=U*L[0][0]+W*L[0][1],V=D[1][1]-D[0][1],H=D[0][0]-D[1][0],Y=V*D[0][0]+H*D[0][1],z=U*H-V*W,R.eq(z,0,M)||(O[0]=(H*X-W*Y)/z,O[1]=(U*Y-V*X)/z),O},E.segmentsIntersect=function(L,D,M,O){var U=D[0]-L[0],W=D[1]-L[1],X=O[0]-M[0],V=O[1]-M[1];if(0==X*W-V*U)return!1;var H=(U*(M[1]-L[1])+W*(L[0]-M[0]))/(X*W-V*U),Y=(X*(L[1]-M[1])+V*(M[0]-L[0]))/(V*U-X*W);return 0<=H&&1>=H&&0<=Y&&1>=Y}},{"./Scalar":4}],2:[function(P,S){function E(){}S.exports=E;E.area=function(D,M,O){return(M[0]-D[0])*(O[1]-D[1])-(O[0]-D[0])*(M[1]-D[1])},E.left=function(D,M,O){return 0<E.area(D,M,O)},E.leftOn=function(D,M,O){return 0<=E.area(D,M,O)},E.right=function(D,M,O){return 0>E.area(D,M,O)},E.rightOn=function(D,M,O){return 0>=E.area(D,M,O)};var R=[],L=[];E.collinear=function(D,M,O,U){if(!U)return 0==E.area(D,M,O);var W=R,X=L;W[0]=M[0]-D[0],W[1]=M[1]-D[1],X[0]=O[0]-M[0],X[1]=O[1]-M[1];var V=W[0]*X[0]+W[1]*X[1],H=Math.sqrt(W[0]*W[0]+W[1]*W[1]),Y=Math.sqrt(X[0]*X[0]+X[1]*X[1]),z=Math.acos(V/(H*Y));return z<U},E.sqdist=function(D,M){var O=M[0]-D[0],U=M[1]-D[1];return O*O+U*U}},{}],3:[function(P,S){function E(){this.vertices=[]}function R(W,X,V,H,Y){Y=Y||0;var z=X[1]-W[1],K=W[0]-X[0],J=z*W[0]+K*W[1],Q=H[1]-V[1],Z=V[0]-H[0],$=Q*V[0]+Z*V[1],ee=z*Z-Q*K;return M.eq(ee,0,Y)?[0,0]:[(Z*J-K*$)/ee,(z*$-Q*J)/ee]}var L=P("./Line"),D=P("./Point"),M=P("./Scalar");S.exports=E,E.prototype.at=function(W){var X=this.vertices,V=X.length;return X[0>W?W%V+V:W%V]},E.prototype.first=function(){return this.vertices[0]},E.prototype.last=function(){return this.vertices[this.vertices.length-1]},E.prototype.clear=function(){this.vertices.length=0},E.prototype.append=function(W,X,V){if("undefined"==typeof X)throw new Error("From is not given!");if("undefined"==typeof V)throw new Error("To is not given!");if(V-1<X)throw new Error("lol1");if(V>W.vertices.length)throw new Error("lol2");if(0>X)throw new Error("lol3");for(var H=X;H<V;H++)this.vertices.push(W.vertices[H])},E.prototype.makeCCW=function(){for(var W=0,X=this.vertices,V=1;V<this.vertices.length;++V)(X[V][1]<X[W][1]||X[V][1]==X[W][1]&&X[V][0]>X[W][0])&&(W=V);D.left(this.at(W-1),this.at(W),this.at(W+1))||this.reverse()},E.prototype.reverse=function(){for(var W=[],X=0,V=this.vertices.length;X!==V;X++)W.push(this.vertices.pop());this.vertices=W},E.prototype.isReflex=function(W){return D.right(this.at(W-1),this.at(W),this.at(W+1))};var O=[],U=[];E.prototype.canSee=function(W,X){var Y=O,z=U,V,H;if(D.leftOn(this.at(W+1),this.at(W),this.at(X))&&D.rightOn(this.at(W-1),this.at(W),this.at(X)))return!1;H=D.sqdist(this.at(W),this.at(X));for(var K=0;K!==this.vertices.length;++K)if((K+1)%this.vertices.length!==W&&K!==W&&D.leftOn(this.at(W),this.at(X),this.at(K+1))&&D.rightOn(this.at(W),this.at(X),this.at(K))&&(Y[0]=this.at(W),Y[1]=this.at(X),z[0]=this.at(K),z[1]=this.at(K+1),V=L.lineInt(Y,z),D.sqdist(this.at(W),V)<H))return!1;return!0},E.prototype.copy=function(W,X,V){var H=V||new E;if(H.clear(),W<X)for(var Y=W;Y<=X;Y++)H.vertices.push(this.vertices[Y]);else{for(var Y=0;Y<=X;Y++)H.vertices.push(this.vertices[Y]);for(var Y=W;Y<this.vertices.length;Y++)H.vertices.push(this.vertices[Y])}return H},E.prototype.getCutEdges=function(){for(var W=[],X=[],V=[],H=new E,Y=Number.MAX_VALUE,z=0;z<this.vertices.length;++z)if(this.isReflex(z))for(var K=0;K<this.vertices.length;++K)if(this.canSee(z,K)){X=this.copy(z,K,H).getCutEdges(),V=this.copy(K,z,H).getCutEdges();for(var J=0;J<V.length;J++)X.push(V[J]);X.length<Y&&(W=X,Y=X.length,W.push([this.at(z),this.at(K)]))}return W},E.prototype.decomp=function(){var W=this.getCutEdges();return 0<W.length?this.slice(W):[this]},E.prototype.slice=function(W){if(0==W.length)return[this];if(W instanceof Array&&W.length&&W[0]instanceof Array&&2==W[0].length&&W[0][0]instanceof Array){for(var X=[this],V=0,H;V<W.length;V++){H=W[V];for(var Y=0;Y<X.length;Y++){var z=X[Y],K=z.slice(H);if(K){X.splice(Y,1),X.push(K[0],K[1]);break}}}return X}var H=W,V=this.vertices.indexOf(H[0]),Y=this.vertices.indexOf(H[1]);return-1!=V&&-1!=Y&&[this.copy(V,Y),this.copy(Y,V)]},E.prototype.isSimple=function(){for(var W=this.vertices,X=0;X<W.length-1;X++)for(var V=0;V<X-1;V++)if(L.segmentsIntersect(W[X],W[X+1],W[V],W[V+1]))return!1;for(var X=1;X<W.length-2;X++)if(L.segmentsIntersect(W[0],W[W.length-1],W[X],W[X+1]))return!1;return!0},E.prototype.quickDecomp=function(W,X,V,H,Y,z){Y=Y||100,z=z||0,H=H||25,W="undefined"==typeof W?[]:W,X=X||[],V=V||[];var K=[0,0],J=[0,0],Q=[0,0],Z=0,$=0,ee=0,te=0,ae=0,oe=0,ne=0,ie=new E,se=new E,le=this,de=this.vertices;if(3>de.length)return W;if(z++,z>Y)return console.warn("quickDecomp: max level ("+Y+") reached."),W;for(var pe=0;pe<this.vertices.length;++pe)if(le.isReflex(pe)){X.push(le.vertices[pe]),Z=$=Number.MAX_VALUE;for(var ue=0;ue<this.vertices.length;++ue)D.left(le.at(pe-1),le.at(pe),le.at(ue))&&D.rightOn(le.at(pe-1),le.at(pe),le.at(ue-1))&&(Q=R(le.at(pe-1),le.at(pe),le.at(ue),le.at(ue-1)),D.right(le.at(pe+1),le.at(pe),Q)&&(ee=D.sqdist(le.vertices[pe],Q),ee<$&&($=ee,J=Q,oe=ue))),D.left(le.at(pe+1),le.at(pe),le.at(ue+1))&&D.rightOn(le.at(pe+1),le.at(pe),le.at(ue))&&(Q=R(le.at(pe+1),le.at(pe),le.at(ue),le.at(ue+1)),D.left(le.at(pe-1),le.at(pe),Q)&&(ee=D.sqdist(le.vertices[pe],Q),ee<Z&&(Z=ee,K=Q,ae=ue)));if(oe==(ae+1)%this.vertices.length)Q[0]=(J[0]+K[0])/2,Q[1]=(J[1]+K[1])/2,V.push(Q),pe<ae?(ie.append(le,pe,ae+1),ie.vertices.push(Q),se.vertices.push(Q),0!=oe&&se.append(le,oe,le.vertices.length),se.append(le,0,pe+1)):(0!=pe&&ie.append(le,pe,le.vertices.length),ie.append(le,0,ae+1),ie.vertices.push(Q),se.vertices.push(Q),se.append(le,oe,pe+1));else{if(oe>ae&&(ae+=this.vertices.length),te=Number.MAX_VALUE,ae<oe)return W;for(var ue=oe;ue<=ae;++ue)D.leftOn(le.at(pe-1),le.at(pe),le.at(ue))&&D.rightOn(le.at(pe+1),le.at(pe),le.at(ue))&&(ee=D.sqdist(le.at(pe),le.at(ue)),ee<te&&(te=ee,ne=ue%this.vertices.length));pe<ne?(ie.append(le,pe,ne+1),0!=ne&&se.append(le,ne,de.length),se.append(le,0,pe+1)):(0!=pe&&ie.append(le,pe,de.length),ie.append(le,0,ne+1),se.append(le,ne,pe+1))}return ie.vertices.length<se.vertices.length?(ie.quickDecomp(W,X,V,H,Y,z),se.quickDecomp(W,X,V,H,Y,z)):(se.quickDecomp(W,X,V,H,Y,z),ie.quickDecomp(W,X,V,H,Y,z)),W}return W.push(this),W},E.prototype.removeCollinearPoints=function(W){for(var X=0,V=this.vertices.length-1;3<this.vertices.length&&0<=V;--V)D.collinear(this.at(V-1),this.at(V),this.at(V+1),W)&&(this.vertices.splice(V%this.vertices.length,1),V--,X++);return X}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(P,S){function E(){}S.exports=E,E.eq=function(R,L,D){return D=D||0,Math.abs(R-L)<D}},{}],5:[function(P,S){S.exports={Polygon:P("./Polygon"),Point:P("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(P,S){S.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(P,S){function E(M){this.lowerBound=R.create(),M&&M.lowerBound&&R.copy(this.lowerBound,M.lowerBound),this.upperBound=R.create(),M&&M.upperBound&&R.copy(this.upperBound,M.upperBound)}var R=P("../math/vec2"),L=P("../utils/Utils");S.exports=E;var D=R.create();E.prototype.setFromPoints=function(M,O,U,W){var X=this.lowerBound,V=this.upperBound;"number"!=typeof U&&(U=0),0===U?R.copy(X,M[0]):R.rotate(X,M[0],U),R.copy(V,X);for(var H=Math.cos(U),Y=Math.sin(U),z=1,K;z<M.length;z++){if(K=M[z],0!==U){var J=K[0],Q=K[1];D[0]=H*J-Y*Q,D[1]=Y*J+H*Q,K=D}for(var Z=0;2>Z;Z++)K[Z]>V[Z]&&(V[Z]=K[Z]),K[Z]<X[Z]&&(X[Z]=K[Z])}O&&(R.add(this.lowerBound,this.lowerBound,O),R.add(this.upperBound,this.upperBound,O)),W&&(this.lowerBound[0]-=W,this.lowerBound[1]-=W,this.upperBound[0]+=W,this.upperBound[1]+=W)},E.prototype.copy=function(M){R.copy(this.lowerBound,M.lowerBound),R.copy(this.upperBound,M.upperBound)},E.prototype.extend=function(M){for(var O=2,U;O--;){U=M.lowerBound[O],this.lowerBound[O]>U&&(this.lowerBound[O]=U);var W=M.upperBound[O];this.upperBound[O]<W&&(this.upperBound[O]=W)}},E.prototype.overlaps=function(M){var O=this.lowerBound,U=this.upperBound,W=M.lowerBound,X=M.upperBound;return(W[0]<=U[0]&&U[0]<=X[0]||O[0]<=X[0]&&X[0]<=U[0])&&(W[1]<=U[1]&&U[1]<=X[1]||O[1]<=X[1]&&X[1]<=U[1])},E.prototype.containsPoint=function(M){var O=this.lowerBound,U=this.upperBound;return O[0]<=M[0]&&M[0]<=U[0]&&O[1]<=M[1]&&M[1]<=U[1]},E.prototype.overlapsRay=function(M){var U=1/M.direction[0],W=1/M.direction[1],X=(this.lowerBound[0]-M.from[0])*U,V=(this.upperBound[0]-M.from[0])*U,H=(this.lowerBound[1]-M.from[1])*W,Y=(this.upperBound[1]-M.from[1])*W,z=Math.max(Math.max(Math.min(X,V),Math.min(H,Y))),K=Math.min(Math.min(Math.max(X,V),Math.max(H,Y)));return 0>K?-1:z>K?-1:z}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(P,S){function E(M){this.type=M,this.result=[],this.world=null,this.boundingVolumeType=E.AABB}var R=P("../math/vec2"),L=P("../objects/Body");S.exports=E,E.AABB=1,E.BOUNDING_CIRCLE=2,E.prototype.setWorld=function(M){this.world=M},E.prototype.getCollisionPairs=function(){};var D=R.create();E.boundingRadiusCheck=function(M,O){R.sub(D,M.position,O.position);var U=R.squaredLength(D),W=M.boundingRadius+O.boundingRadius;return U<=W*W},E.aabbCheck=function(M,O){return M.getAABB().overlaps(O.getAABB())},E.prototype.boundingVolumeCheck=function(M,O){var U;switch(this.boundingVolumeType){case E.BOUNDING_CIRCLE:U=E.boundingRadiusCheck(M,O);break;case E.AABB:U=E.aabbCheck(M,O);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return U},E.canCollide=function(M,O){var U=L.KINEMATIC,W=L.STATIC;return M.type===W&&O.type===W?!1:M.type===U&&O.type===W||M.type===W&&O.type===U?!1:M.type===U&&O.type===U?!1:M.sleepState===L.SLEEPING&&O.sleepState===L.SLEEPING?!1:M.sleepState===L.SLEEPING&&O.type===W||O.sleepState===L.SLEEPING&&M.type===W?!1:!0},E.NAIVE=1,E.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(P,S){function E(){O.call(this,O.NAIVE)}var R=P("../shapes/Circle"),L=P("../shapes/Plane"),D=P("../shapes/Shape"),M=P("../shapes/Particle"),O=P("../collision/Broadphase"),U=P("../math/vec2");S.exports=E,E.prototype=new O,E.prototype.constructor=E,E.prototype.getCollisionPairs=function(W){var X=W.bodies,V=this.result;V.length=0;for(var H=0,Y=X.length,z;H!==Y;H++){z=X[H];for(var K=0,J;K<H;K++)J=X[K],O.canCollide(z,J)&&this.boundingVolumeCheck(z,J)&&V.push(z,J)}return V},E.prototype.aabbQuery=function(W,X,V){V=V||[];for(var H=W.bodies,Y=0,z;Y<H.length;Y++)z=H[Y],z.aabbNeedsUpdate&&z.updateAABB(),z.aabb.overlaps(X)&&V.push(z);return V}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(P,S){function E(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=0.3,this.surfaceVelocity=0,this.contactEquationPool=new X({size:32}),this.frictionEquationPool=new V({size:64}),this.restitution=0,this.stiffness=Y.DEFAULT_STIFFNESS,this.relaxation=Y.DEFAULT_RELAXATION,this.frictionStiffness=Y.DEFAULT_STIFFNESS,this.frictionRelaxation=Y.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new H,this.contactSkinSize=0.01}function R(ct,ut){D.set(ct.vertices[0],0.5*-ut.length,-ut.radius),D.set(ct.vertices[1],0.5*ut.length,-ut.radius),D.set(ct.vertices[2],0.5*ut.length,ut.radius),D.set(ct.vertices[3],0.5*-ut.length,ut.radius)}function L(ct,ut,ht,gt){for(var mt=Fe,yt=De,ft=Ie,xt=Me,bt=ct,_t=ut.vertices,vt=null,Tt=0;Tt!==_t.length+1;Tt++){var Ct=_t[Tt%_t.length],Pt=_t[(Tt+1)%_t.length];D.rotate(mt,Ct,gt),D.rotate(yt,Pt,gt),O(mt,mt,ht),O(yt,yt,ht),M(ft,mt,bt),M(xt,yt,bt);var St=D.crossLength(ft,xt);if(null==vt&&(vt=St),0>=St*vt)return!1;vt=St}return!0}var D=P("../math/vec2"),M=D.sub,O=D.add,U=D.dot,W=P("../utils/Utils"),X=P("../utils/ContactEquationPool"),V=P("../utils/FrictionEquationPool"),H=P("../utils/TupleDictionary"),Y=P("../equations/Equation"),z=P("../equations/ContactEquation"),K=P("../equations/FrictionEquation"),J=P("../shapes/Circle"),Q=P("../shapes/Convex"),Z=P("../shapes/Shape"),$=P("../objects/Body"),ee=P("../shapes/Box");S.exports=E;var te=D.fromValues(0,1),ae=D.fromValues(0,0),oe=D.fromValues(0,0),ne=D.fromValues(0,0),ie=D.fromValues(0,0),se=D.fromValues(0,0),le=D.fromValues(0,0),de=D.fromValues(0,0),pe=D.fromValues(0,0),ue=D.fromValues(0,0),he=D.fromValues(0,0),ge=D.fromValues(0,0),me=D.fromValues(0,0),be=D.fromValues(0,0),_e=D.fromValues(0,0),ve=D.fromValues(0,0),Te=D.fromValues(0,0),Ce=D.fromValues(0,0),Pe=D.fromValues(0,0),Se=[],we=D.create(),Ae=D.create();E.prototype.bodiesOverlap=function(ct,ut){for(var ht=we,gt=Ae,mt=0,yt=ct.shapes.length,ft;mt!==yt;mt++){ft=ct.shapes[mt],ct.toWorldFrame(ht,ft.position);for(var xt=0,bt=ut.shapes.length,_t;xt!==bt;xt++)if(_t=ut.shapes[xt],ut.toWorldFrame(gt,_t.position),this[ft.type|_t.type](ct,ft,ht,ft.angle+ct.angle,ut,_t,gt,_t.angle+ut.angle,!0))return!0}return!1},E.prototype.collidedLastStep=function(ct,ut){var ht=0|ct.id,gt=0|ut.id;return!!this.collidingBodiesLastStep.get(ht,gt)},E.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var ct=this.contactEquations,ut=ct.length;ut--;){var ht=ct[ut],gt=ht.bodyA.id,mt=ht.bodyB.id;this.collidingBodiesLastStep.set(gt,mt,!0)}for(var yt=this.contactEquations,ft=this.frictionEquations,xt=0;xt<yt.length;xt++)this.contactEquationPool.release(yt[xt]);for(var xt=0;xt<ft.length;xt++)this.frictionEquationPool.release(ft[xt]);this.contactEquations.length=this.frictionEquations.length=0},E.prototype.createContactEquation=function(ct,ut,ht,gt){var mt=this.contactEquationPool.get();return mt.bodyA=ct,mt.bodyB=ut,mt.shapeA=ht,mt.shapeB=gt,mt.restitution=this.restitution,mt.firstImpact=!this.collidedLastStep(ct,ut),mt.stiffness=this.stiffness,mt.relaxation=this.relaxation,mt.needsUpdate=!0,mt.enabled=this.enabledEquations,mt.offset=this.contactSkinSize,mt},E.prototype.createFrictionEquation=function(ct,ut,ht,gt){var mt=this.frictionEquationPool.get();return mt.bodyA=ct,mt.bodyB=ut,mt.shapeA=ht,mt.shapeB=gt,mt.setSlipForce(this.slipForce),mt.frictionCoefficient=this.frictionCoefficient,mt.relativeVelocity=this.surfaceVelocity,mt.enabled=this.enabledEquations,mt.needsUpdate=!0,mt.stiffness=this.frictionStiffness,mt.relaxation=this.frictionRelaxation,mt.contactEquations.length=0,mt},E.prototype.createFrictionFromContact=function(ct){var ut=this.createFrictionEquation(ct.bodyA,ct.bodyB,ct.shapeA,ct.shapeB);return D.copy(ut.contactPointA,ct.contactPointA),D.copy(ut.contactPointB,ct.contactPointB),D.rotate90cw(ut.t,ct.normalA),ut.contactEquations.push(ct),ut},E.prototype.createFrictionFromAverage=function(ct){var ut=this.contactEquations[this.contactEquations.length-1],ht=this.createFrictionEquation(ut.bodyA,ut.bodyB,ut.shapeA,ut.shapeB),gt=ut.bodyA,mt=ut.bodyB;D.set(ht.contactPointA,0,0),D.set(ht.contactPointB,0,0),D.set(ht.t,0,0);for(var yt=0;yt!==ct;yt++)ut=this.contactEquations[this.contactEquations.length-1-yt],ut.bodyA===gt?(D.add(ht.t,ht.t,ut.normalA),D.add(ht.contactPointA,ht.contactPointA,ut.contactPointA),D.add(ht.contactPointB,ht.contactPointB,ut.contactPointB)):(D.sub(ht.t,ht.t,ut.normalA),D.add(ht.contactPointA,ht.contactPointA,ut.contactPointB),D.add(ht.contactPointB,ht.contactPointB,ut.contactPointA)),ht.contactEquations.push(ut);var ft=1/ct;return D.scale(ht.contactPointA,ht.contactPointA,ft),D.scale(ht.contactPointB,ht.contactPointB,ft),D.normalize(ht.t,ht.t),D.rotate90cw(ht.t,ht.t),ht},E.prototype[Z.LINE|Z.CONVEX]=E.prototype.convexLine=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return!bt&&0},E.prototype[Z.LINE|Z.BOX]=E.prototype.lineBox=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return!bt&&0};var Ee=new ee({width:1,height:1}),Re=D.create();E.prototype[Z.CAPSULE|Z.CONVEX]=E.prototype[Z.CAPSULE|Z.BOX]=E.prototype.convexCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=Re;D.set(_t,yt.length/2,0),D.rotate(_t,_t,xt),D.add(_t,_t,ft);var vt=this.circleConvex(mt,yt,_t,xt,ct,ut,ht,gt,bt,yt.radius);D.set(_t,-yt.length/2,0),D.rotate(_t,_t,xt),D.add(_t,_t,ft);var Tt=this.circleConvex(mt,yt,_t,xt,ct,ut,ht,gt,bt,yt.radius);if(bt&&(vt||Tt))return!0;var Ct=Ee;R(Ct,yt);var Pt=this.convexConvex(ct,ut,ht,gt,mt,Ct,ft,xt,bt);return Pt+vt+Tt},E.prototype[Z.CAPSULE|Z.LINE]=E.prototype.lineCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return!bt&&0};var Le=D.create(),Be=D.create(),ke=new ee({width:1,height:1});E.prototype[Z.CAPSULE|Z.CAPSULE]=E.prototype.capsuleCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){for(var vt=Le,Tt=Be,Ct=0,Pt=0,_t;2>Pt;Pt++){D.set(vt,(0===Pt?-1:1)*ut.length/2,0),D.rotate(vt,vt,gt),D.add(vt,vt,ht);for(var St=0;2>St;St++){D.set(Tt,(0===St?-1:1)*yt.length/2,0),D.rotate(Tt,Tt,xt),D.add(Tt,Tt,ft),this.enableFrictionReduction&&(_t=this.enableFriction,this.enableFriction=!1);var At=this.circleCircle(ct,ut,vt,gt,mt,yt,Tt,xt,bt,ut.radius,yt.radius);if(this.enableFrictionReduction&&(this.enableFriction=_t),bt&&At)return!0;Ct+=At}}this.enableFrictionReduction&&(_t=this.enableFriction,this.enableFriction=!1);var Et=ke;R(Et,ut);var Rt=this.convexCapsule(ct,Et,ht,gt,mt,yt,ft,xt,bt);if(this.enableFrictionReduction&&(this.enableFriction=_t),bt&&Rt)return!0;if(Ct+=Rt,this.enableFrictionReduction){var _t=this.enableFriction;this.enableFriction=!1}R(Et,yt);var Lt=this.convexCapsule(mt,Et,ft,xt,ct,ut,ht,gt,bt);return!(this.enableFrictionReduction&&(this.enableFriction=_t),!(bt&&Lt))||(Ct+=Lt,this.enableFrictionReduction&&Ct&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(Ct)),Ct)},E.prototype[Z.LINE|Z.LINE]=E.prototype.lineLine=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return!bt&&0},E.prototype[Z.PLANE|Z.LINE]=E.prototype.planeLine=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ae,vt=oe,Tt=ne,Ct=ie,Pt=se,St=le,At=de,Et=pe,Lt=Se,Bt=0;D.set(_t,-yt.length/2,0),D.set(vt,yt.length/2,0),D.rotate(Tt,_t,xt),D.rotate(Ct,vt,xt),O(Tt,Tt,ft),O(Ct,Ct,ft),D.copy(_t,Tt),D.copy(vt,Ct),M(Pt,vt,_t),D.normalize(St,Pt),D.rotate90cw(ue,St),D.rotate(Et,te,gt),Lt[0]=_t,Lt[1]=vt;for(var kt=0,Ft;kt<Lt.length;kt++){Ft=Lt[kt],M(At,Ft,ht);var Dt=U(At,Et);if(0>Dt){if(bt)return!0;var It=this.createContactEquation(ct,mt,ut,yt);Bt++,D.copy(It.normalA,Et),D.normalize(It.normalA,It.normalA),D.scale(At,Et,Dt),M(It.contactPointA,Ft,At),M(It.contactPointA,It.contactPointA,ct.position),M(It.contactPointB,Ft,ft),O(It.contactPointB,It.contactPointB,ft),M(It.contactPointB,It.contactPointB,mt.position),this.contactEquations.push(It),!this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(It))}}return!bt&&(!this.enableFrictionReduction&&Bt&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(Bt)),Bt)},E.prototype[Z.PARTICLE|Z.CAPSULE]=E.prototype.particleCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return this.circleLine(ct,ut,ht,gt,mt,yt,ft,xt,bt,yt.radius,0)},E.prototype[Z.CIRCLE|Z.LINE]=E.prototype.circleLine=function(ct,ut,ht,gt,mt,yt,ft,xt,bt,_t,vt){var _t=_t||0,vt="undefined"==typeof vt?ut.radius:vt,Tt=ae,Ct=oe,Pt=ne,At=se,Et=le,Rt=de,Lt=pe,Bt=ue,kt=he,Ft=ge,Dt=me,It=be,Mt=_e,Ot=Se;D.set(Lt,-yt.length/2,0),D.set(Bt,yt.length/2,0),D.rotate(kt,Lt,xt),D.rotate(Ft,Bt,xt),O(kt,kt,ft),O(Ft,Ft,ft),D.copy(Lt,kt),D.copy(Bt,Ft),M(Et,Bt,Lt),D.normalize(Rt,Et),D.rotate90cw(At,Rt),M(Dt,ht,Lt);var Ut=U(Dt,At);M(ie,Lt,ft),M(It,ht,ft);var Gt=vt+_t;if(Math.abs(Ut)<Gt){D.scale(Tt,At,Ut),M(Pt,ht,Tt),D.scale(Ct,At,U(At,It)),D.normalize(Ct,Ct),D.scale(Ct,Ct,_t),O(Pt,Pt,Ct);var Nt=U(Rt,Pt),Wt=U(Rt,Lt),Xt=U(Rt,Bt);if(Nt>Wt&&Nt<Xt){if(bt)return!0;var Vt=this.createContactEquation(ct,mt,ut,yt);return D.scale(Vt.normalA,Tt,-1),D.normalize(Vt.normalA,Vt.normalA),D.scale(Vt.contactPointA,Vt.normalA,vt),O(Vt.contactPointA,Vt.contactPointA,ht),M(Vt.contactPointA,Vt.contactPointA,ct.position),M(Vt.contactPointB,Pt,ft),O(Vt.contactPointB,Vt.contactPointB,ft),M(Vt.contactPointB,Vt.contactPointB,mt.position),this.contactEquations.push(Vt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Vt)),1}}Ot[0]=Lt,Ot[1]=Bt;for(var qt=0,Ht;qt<Ot.length;qt++)if(Ht=Ot[qt],M(Dt,Ht,ht),D.squaredLength(Dt)<Math.pow(Gt,2)){if(bt)return!0;var Vt=this.createContactEquation(ct,mt,ut,yt);return D.copy(Vt.normalA,Dt),D.normalize(Vt.normalA,Vt.normalA),D.scale(Vt.contactPointA,Vt.normalA,vt),O(Vt.contactPointA,Vt.contactPointA,ht),M(Vt.contactPointA,Vt.contactPointA,ct.position),M(Vt.contactPointB,Ht,ft),D.scale(Mt,Vt.normalA,-_t),O(Vt.contactPointB,Vt.contactPointB,Mt),O(Vt.contactPointB,Vt.contactPointB,ft),M(Vt.contactPointB,Vt.contactPointB,mt.position),this.contactEquations.push(Vt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Vt)),1}return 0},E.prototype[Z.CIRCLE|Z.CAPSULE]=E.prototype.circleCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){return this.circleLine(ct,ut,ht,gt,mt,yt,ft,xt,bt,yt.radius)},E.prototype[Z.CIRCLE|Z.CONVEX]=E.prototype[Z.CIRCLE|Z.BOX]=E.prototype.circleConvex=function(ct,ut,ht,gt,mt,yt,ft,xt,bt,_t){for(var _t="number"==typeof _t?_t:ut.radius,vt=ae,Tt=oe,Ct=ne,Pt=ie,St=se,Bt=he,kt=ge,Mt=be,Ot=_e,Ut=ve,Gt=Te,Nt=!1,Wt=Number.MAX_VALUE,Vt=yt.vertices,qt=0;qt!==Vt.length+1;qt++){var Ht=Vt[qt%Vt.length],Yt=Vt[(qt+1)%Vt.length];if(D.rotate(vt,Ht,xt),D.rotate(Tt,Yt,xt),O(vt,vt,ft),O(Tt,Tt,ft),M(Ct,Tt,vt),D.normalize(Pt,Ct),D.rotate90cw(St,Pt),D.scale(Ot,St,-ut.radius),O(Ot,Ot,ht),L(Ot,yt,ft,xt)){D.sub(Ut,vt,Ot);var jt=Math.abs(D.dot(Ut,St));jt<Wt&&(D.copy(Gt,Ot),Wt=jt,D.scale(Mt,St,jt),D.add(Mt,Mt,Ot),Nt=!0)}}if(Nt){if(bt)return!0;var zt=this.createContactEquation(ct,mt,ut,yt);return D.sub(zt.normalA,Gt,ht),D.normalize(zt.normalA,zt.normalA),D.scale(zt.contactPointA,zt.normalA,_t),O(zt.contactPointA,zt.contactPointA,ht),M(zt.contactPointA,zt.contactPointA,ct.position),M(zt.contactPointB,Mt,ft),O(zt.contactPointB,zt.contactPointB,ft),M(zt.contactPointB,zt.contactPointB,mt.position),this.contactEquations.push(zt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(zt)),1}if(0<_t)for(var qt=0,Kt;qt<Vt.length;qt++)if(Kt=Vt[qt],D.rotate(kt,Kt,xt),O(kt,kt,ft),M(Bt,kt,ht),D.squaredLength(Bt)<Math.pow(_t,2)){if(bt)return!0;var zt=this.createContactEquation(ct,mt,ut,yt);return D.copy(zt.normalA,Bt),D.normalize(zt.normalA,zt.normalA),D.scale(zt.contactPointA,zt.normalA,_t),O(zt.contactPointA,zt.contactPointA,ht),M(zt.contactPointA,zt.contactPointA,ct.position),M(zt.contactPointB,kt,ft),O(zt.contactPointB,zt.contactPointB,ft),M(zt.contactPointB,zt.contactPointB,mt.position),this.contactEquations.push(zt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(zt)),1}return 0};var Fe=D.create(),De=D.create(),Ie=D.create(),Me=D.create();E.prototype[Z.PARTICLE|Z.CONVEX]=E.prototype[Z.PARTICLE|Z.BOX]=E.prototype.particleConvex=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ae,vt=oe,Tt=ne,Ct=ie,Pt=se,Lt=he,It=be,Gt=Ce,Nt=Pe,Wt=Number.MAX_VALUE,Vt=!1,qt=yt.vertices;if(!L(ht,yt,ft,xt))return 0;if(bt)return!0;for(var Yt=0;Yt!==qt.length+1;Yt++){var jt=qt[Yt%qt.length],zt=qt[(Yt+1)%qt.length];D.rotate(_t,jt,xt),D.rotate(vt,zt,xt),O(_t,_t,ft),O(vt,vt,ft),M(Tt,vt,_t),D.normalize(Ct,Tt),D.rotate90cw(Pt,Ct),M(Lt,ht,_t);U(Lt,Pt);M(le,_t,ft),M(de,ht,ft),D.sub(Gt,_t,ht);var Jt=Math.abs(D.dot(Gt,Pt));Jt<Wt&&(Wt=Jt,D.scale(It,Pt,Jt),D.add(It,It,ht),D.copy(Nt,Pt),Vt=!0)}if(Vt){var Qt=this.createContactEquation(ct,mt,ut,yt);return D.scale(Qt.normalA,Nt,-1),D.normalize(Qt.normalA,Qt.normalA),D.set(Qt.contactPointA,0,0),O(Qt.contactPointA,Qt.contactPointA,ht),M(Qt.contactPointA,Qt.contactPointA,ct.position),M(Qt.contactPointB,It,ft),O(Qt.contactPointB,Qt.contactPointB,ft),M(Qt.contactPointB,Qt.contactPointB,mt.position),this.contactEquations.push(Qt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Qt)),1}return 0},E.prototype[Z.CIRCLE]=E.prototype.circleCircle=function(ct,ut,ht,gt,mt,yt,ft,xt,bt,_t,vt){var Tt=ae,_t=_t||ut.radius,vt=vt||yt.radius;M(Tt,ht,ft);if(D.squaredLength(Tt)>Math.pow(_t+vt,2))return 0;if(bt)return!0;var Pt=this.createContactEquation(ct,mt,ut,yt);return M(Pt.normalA,ft,ht),D.normalize(Pt.normalA,Pt.normalA),D.scale(Pt.contactPointA,Pt.normalA,_t),D.scale(Pt.contactPointB,Pt.normalA,-vt),O(Pt.contactPointA,Pt.contactPointA,ht),M(Pt.contactPointA,Pt.contactPointA,ct.position),O(Pt.contactPointB,Pt.contactPointB,ft),M(Pt.contactPointB,Pt.contactPointB,mt.position),this.contactEquations.push(Pt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Pt)),1},E.prototype[Z.PLANE|Z.CONVEX]=E.prototype[Z.PLANE|Z.BOX]=E.prototype.planeConvex=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ae,vt=oe,Tt=ne,Ct=0;D.rotate(vt,te,gt);for(var Pt=0,St;Pt!==yt.vertices.length;Pt++)if(St=yt.vertices[Pt],D.rotate(_t,St,xt),O(_t,_t,ft),M(Tt,_t,ht),0>=U(Tt,vt)){if(bt)return!0;Ct++;var At=this.createContactEquation(ct,mt,ut,yt);M(Tt,_t,ht),D.copy(At.normalA,vt);var Et=U(Tt,At.normalA);D.scale(Tt,At.normalA,Et),M(At.contactPointB,_t,mt.position),M(At.contactPointA,_t,Tt),M(At.contactPointA,At.contactPointA,ct.position),this.contactEquations.push(At),!this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(At))}return this.enableFrictionReduction&&this.enableFriction&&Ct&&this.frictionEquations.push(this.createFrictionFromAverage(Ct)),Ct},E.prototype[Z.PARTICLE|Z.PLANE]=E.prototype.particlePlane=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ae,vt=oe;xt=xt||0,M(_t,ht,ft),D.rotate(vt,te,xt);var Tt=U(_t,vt);if(0<Tt)return 0;if(bt)return!0;var Ct=this.createContactEquation(mt,ct,yt,ut);return D.copy(Ct.normalA,vt),D.scale(_t,Ct.normalA,Tt),M(Ct.contactPointA,ht,_t),M(Ct.contactPointA,Ct.contactPointA,mt.position),M(Ct.contactPointB,ht,ct.position),this.contactEquations.push(Ct),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Ct)),1},E.prototype[Z.CIRCLE|Z.PARTICLE]=E.prototype.circleParticle=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ae;if(M(_t,ft,ht),D.squaredLength(_t)>Math.pow(ut.radius,2))return 0;if(bt)return!0;var vt=this.createContactEquation(ct,mt,ut,yt);return D.copy(vt.normalA,_t),D.normalize(vt.normalA,vt.normalA),D.scale(vt.contactPointA,vt.normalA,ut.radius),O(vt.contactPointA,vt.contactPointA,ht),M(vt.contactPointA,vt.contactPointA,ct.position),M(vt.contactPointB,ft,mt.position),this.contactEquations.push(vt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(vt)),1};var Oe=new J({radius:1}),Ue=D.create(),Ge=D.create(),Ne=D.create();E.prototype[Z.PLANE|Z.CAPSULE]=E.prototype.planeCapsule=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=Ue,vt=Ge,Tt=Oe;D.set(_t,-yt.length/2,0),D.rotate(_t,_t,xt),O(_t,_t,ft),D.set(vt,yt.length/2,0),D.rotate(vt,vt,xt),O(vt,vt,ft),Tt.radius=yt.radius;var Pt;this.enableFrictionReduction&&(Pt=this.enableFriction,this.enableFriction=!1);var St=this.circlePlane(mt,Tt,_t,0,ct,ut,ht,gt,bt),At=this.circlePlane(mt,Tt,vt,0,ct,ut,ht,gt,bt);if(this.enableFrictionReduction&&(this.enableFriction=Pt),bt)return St||At;var Et=St+At;return this.enableFrictionReduction&&Et&&this.frictionEquations.push(this.createFrictionFromAverage(Et)),Et},E.prototype[Z.CIRCLE|Z.PLANE]=E.prototype.circlePlane=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=ct,vt=ut,Tt=ht,Ct=mt,St=ft,At=xt;At=At||0;var Et=ae,Rt=oe,Lt=ne;M(Et,Tt,St),D.rotate(Rt,te,At);var Bt=U(Rt,Et);if(Bt>vt.radius)return 0;if(bt)return!0;var kt=this.createContactEquation(Ct,_t,yt,ut);return D.copy(kt.normalA,Rt),D.scale(kt.contactPointB,kt.normalA,-vt.radius),O(kt.contactPointB,kt.contactPointB,Tt),M(kt.contactPointB,kt.contactPointB,_t.position),D.scale(Lt,kt.normalA,Bt),M(kt.contactPointA,Et,Lt),O(kt.contactPointA,kt.contactPointA,St),M(kt.contactPointA,kt.contactPointA,Ct.position),this.contactEquations.push(kt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(kt)),1},E.prototype[Z.CONVEX]=E.prototype[Z.CONVEX|Z.BOX]=E.prototype[Z.BOX]=E.prototype.convexConvex=function(ct,ut,ht,gt,mt,yt,ft,xt,bt,_t){var vt=ae,Tt=oe,Ct=ne,Pt=ie,St=se,Et=de,Rt=pe,Lt=ue,Bt=0,_t="number"==typeof _t?_t:0,kt=E.findSeparatingAxis(ut,ht,gt,yt,ft,xt,vt);if(!kt)return 0;M(Rt,ft,ht),0<U(vt,Rt)&&D.scale(vt,vt,-1);var Ft=E.getClosestEdge(ut,gt,vt,!0),Dt=E.getClosestEdge(yt,xt,vt);if(-1===Ft||-1===Dt)return 0;for(var It=0;2>It;It++){var Mt=Ft,Ot=Dt,Ut=ut,Gt=yt,Nt=ht,Wt=ft,Xt=gt,Vt=xt,qt=ct,Ht=mt;if(0===It){var Yt;Yt=Mt,Mt=Ot,Ot=Yt,Yt=Ut,Ut=Gt,Gt=Yt,Yt=Nt,Nt=Wt,Wt=Yt,Yt=Xt,Xt=Vt,Vt=Yt,Yt=qt,qt=Ht,Ht=Yt}for(var jt=Ot,zt;jt<Ot+2;jt++){zt=Gt.vertices[(jt+Gt.vertices.length)%Gt.vertices.length],D.rotate(Tt,zt,Vt),O(Tt,Tt,Wt);for(var Kt=0,Jt=Mt-1;Jt<Mt+2;Jt++){var Qt=Ut.vertices[(Jt+Ut.vertices.length)%Ut.vertices.length],Zt=Ut.vertices[(Jt+1+Ut.vertices.length)%Ut.vertices.length];D.rotate(Ct,Qt,Xt),D.rotate(Pt,Zt,Xt),O(Ct,Ct,Nt),O(Pt,Pt,Nt),M(St,Pt,Ct),D.rotate90cw(Lt,St),D.normalize(Lt,Lt),M(Rt,Tt,Ct);var $t=U(Lt,Rt);(Jt===Mt&&$t<=_t||Jt!==Mt&&0>=$t)&&Kt++}if(3<=Kt){if(bt)return!0;var ea=this.createContactEquation(qt,Ht,Ut,Gt);Bt++;var Qt=Ut.vertices[Mt%Ut.vertices.length],Zt=Ut.vertices[(Mt+1)%Ut.vertices.length];D.rotate(Ct,Qt,Xt),D.rotate(Pt,Zt,Xt),O(Ct,Ct,Nt),O(Pt,Pt,Nt),M(St,Pt,Ct),D.rotate90cw(ea.normalA,St),D.normalize(ea.normalA,ea.normalA),M(Rt,Tt,Ct);var $t=U(ea.normalA,Rt);D.scale(Et,ea.normalA,$t),M(ea.contactPointA,Tt,Nt),M(ea.contactPointA,ea.contactPointA,Et),O(ea.contactPointA,ea.contactPointA,Nt),M(ea.contactPointA,ea.contactPointA,qt.position),M(ea.contactPointB,Tt,Wt),O(ea.contactPointB,ea.contactPointB,Wt),M(ea.contactPointB,ea.contactPointB,Ht.position),this.contactEquations.push(ea),!this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ea))}}}return this.enableFrictionReduction&&this.enableFriction&&Bt&&this.frictionEquations.push(this.createFrictionFromAverage(Bt)),Bt};var We=D.fromValues(0,0);E.projectConvexOntoAxis=function(ct,ut,ht,gt,mt){var yt=null,ft=null,_t=We,xt,bt;D.rotate(_t,gt,-ht);for(var vt=0;vt<ct.vertices.length;vt++)xt=ct.vertices[vt],bt=U(xt,_t),(null==yt||bt>yt)&&(yt=bt),(null==ft||bt<ft)&&(ft=bt);if(ft>yt){var Tt=ft;ft=yt,yt=Tt}var Ct=U(ut,gt);D.set(mt,ft+Ct,yt+Ct)};var Xe=D.fromValues(0,0),Ve=D.fromValues(0,0),qe=D.fromValues(0,0),He=D.fromValues(0,0),Ye=D.fromValues(0,0),je=D.fromValues(0,0);E.findSeparatingAxis=function(ct,ut,ht,gt,mt,yt,ft){var xt=null,bt=!1,_t=!1,vt=Xe,Tt=Ve,Ct=qe,Pt=He,St=Ye,At=je;if(ct instanceof ee&&gt instanceof ee)for(var Et=0;2!==Et;Et++){var Rt=ct,Lt=ht;1===Et&&(Rt=gt,Lt=yt);for(var Bt=0;2!==Bt;Bt++){0===Bt?D.set(Pt,0,1):1==Bt&&D.set(Pt,1,0),0!==Lt&&D.rotate(Pt,Pt,Lt),E.projectConvexOntoAxis(ct,ut,ht,Pt,St),E.projectConvexOntoAxis(gt,mt,yt,Pt,At);var kt=St,Ft=At,Dt=!1;St[0]>At[0]&&(Ft=St,kt=At,Dt=!0);var It=Ft[0]-kt[1];bt=0>=It,(null==xt||It>xt)&&(D.copy(ft,Pt),xt=It,_t=bt)}}else for(var Et=0;2!==Et;Et++){var Rt=ct,Lt=ht;1===Et&&(Rt=gt,Lt=yt);for(var Bt=0;Bt!==Rt.vertices.length;Bt++){D.rotate(Tt,Rt.vertices[Bt],Lt),D.rotate(Ct,Rt.vertices[(Bt+1)%Rt.vertices.length],Lt),M(vt,Ct,Tt),D.rotate90cw(Pt,vt),D.normalize(Pt,Pt),E.projectConvexOntoAxis(ct,ut,ht,Pt,St),E.projectConvexOntoAxis(gt,mt,yt,Pt,At);var kt=St,Ft=At,Dt=!1;St[0]>At[0]&&(Ft=St,kt=At,Dt=!0);var It=Ft[0]-kt[1];bt=0>=It,(null==xt||It>xt)&&(D.copy(ft,Pt),xt=It,_t=bt)}}return _t};var ze=D.fromValues(0,0),Ke=D.fromValues(0,0),Je=D.fromValues(0,0);E.getClosestEdge=function(ct,ut,ht,gt){var mt=ze,yt=Ke,ft=Je;D.rotate(mt,ht,-ut),gt&&D.scale(mt,mt,-1);for(var xt=-1,bt=ct.vertices.length,_t=-1,vt=0;vt!==bt;vt++){M(yt,ct.vertices[(vt+1)%bt],ct.vertices[vt%bt]),D.rotate90cw(ft,yt),D.normalize(ft,ft);var Tt=U(ft,mt);(-1==xt||Tt>_t)&&(xt=vt%bt,_t=Tt)}return xt};var Qe=D.create(),Ze=D.create(),$e=D.create(),et=D.create(),at=D.create(),ot=D.create(),rt=D.create();E.prototype[Z.CIRCLE|Z.HEIGHTFIELD]=E.prototype.circleHeightfield=function(ct,ut,ht,gt,mt,yt,ft,xt,bt,_t){var vt=yt.heights,_t=_t||ut.radius,Tt=yt.elementWidth,Ct=Ze,Pt=Qe,St=at,At=rt,Et=ot,Rt=$e,Lt=et,Bt=Math.floor((ht[0]-_t-ft[0])/Tt),kt=Math.ceil((ht[0]+_t-ft[0])/Tt);0>Bt&&(Bt=0),kt>=vt.length&&(kt=vt.length-1);for(var Ft=vt[Bt],Dt=vt[kt],It=Bt;It<kt;It++)vt[It]<Dt&&(Dt=vt[It]),vt[It]>Ft&&(Ft=vt[It]);if(!(ht[1]-_t>Ft)){for(var Mt=!1,It=Bt;It<kt;It++){D.set(Rt,It*Tt,vt[It]),D.set(Lt,(It+1)*Tt,vt[It+1]),D.add(Rt,Rt,ft),D.add(Lt,Lt,ft),D.sub(Et,Lt,Rt),D.rotate(Et,Et,Math.PI/2),D.normalize(Et,Et),D.scale(Pt,Et,-_t),D.add(Pt,Pt,ht),D.sub(Ct,Pt,Rt);var Ot=D.dot(Ct,Et);if(Pt[0]>=Rt[0]&&Pt[0]<Lt[0]&&0>=Ot){if(bt)return!0;Mt=!0,D.scale(Ct,Et,-Ot),D.add(St,Pt,Ct),D.copy(At,Et);var Ut=this.createContactEquation(mt,ct,yt,ut);D.copy(Ut.normalA,At),D.scale(Ut.contactPointB,Ut.normalA,-_t),O(Ut.contactPointB,Ut.contactPointB,ht),M(Ut.contactPointB,Ut.contactPointB,ct.position),D.copy(Ut.contactPointA,St),D.sub(Ut.contactPointA,Ut.contactPointA,mt.position),this.contactEquations.push(Ut),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Ut))}}if(Mt=!1,0<_t)for(var It=Bt;It<=kt;It++)if(D.set(Rt,It*Tt,vt[It]),D.add(Rt,Rt,ft),D.sub(Ct,ht,Rt),D.squaredLength(Ct)<Math.pow(_t,2)){if(bt)return!0;Mt=!0;var Ut=this.createContactEquation(mt,ct,yt,ut);D.copy(Ut.normalA,Ct),D.normalize(Ut.normalA,Ut.normalA),D.scale(Ut.contactPointB,Ut.normalA,-_t),O(Ut.contactPointB,Ut.contactPointB,ht),M(Ut.contactPointB,Ut.contactPointB,ct.position),M(Ut.contactPointA,Rt,ft),O(Ut.contactPointA,Ut.contactPointA,ft),M(Ut.contactPointA,Ut.contactPointA,mt.position),this.contactEquations.push(Ut),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Ut))}return Mt?1:0}};var nt=D.create(),it=D.create(),st=D.create(),lt=new Q({vertices:[D.create(),D.create(),D.create(),D.create()]});E.prototype[Z.BOX|Z.HEIGHTFIELD]=E.prototype[Z.CONVEX|Z.HEIGHTFIELD]=E.prototype.convexHeightfield=function(ct,ut,ht,gt,mt,yt,ft,xt,bt){var _t=yt.heights,vt=yt.elementWidth,Tt=nt,Ct=it,Pt=st,St=lt,At=Math.floor((ct.aabb.lowerBound[0]-ft[0])/vt),Et=Math.ceil((ct.aabb.upperBound[0]-ft[0])/vt);0>At&&(At=0),Et>=_t.length&&(Et=_t.length-1);for(var Rt=_t[At],Lt=_t[Et],Bt=At;Bt<Et;Bt++)_t[Bt]<Lt&&(Lt=_t[Bt]),_t[Bt]>Rt&&(Rt=_t[Bt]);if(!(ct.aabb.lowerBound[1]>Rt)){for(var Ft=0,Bt=At;Bt<Et;Bt++){D.set(Tt,Bt*vt,_t[Bt]),D.set(Ct,(Bt+1)*vt,_t[Bt+1]),D.add(Tt,Tt,ft),D.add(Ct,Ct,ft);var Dt=100;D.set(Pt,0.5*(Ct[0]+Tt[0]),0.5*(Ct[1]+Tt[1]-Dt)),D.sub(St.vertices[0],Ct,Pt),D.sub(St.vertices[1],Tt,Pt),D.copy(St.vertices[2],St.vertices[1]),D.copy(St.vertices[3],St.vertices[0]),St.vertices[2][1]-=Dt,St.vertices[3][1]-=Dt,Ft+=this.convexConvex(ct,ut,ht,gt,mt,St,Pt,0,bt)}return Ft}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(P,S){function E(H){H=H||{},this.from=H.from?L.fromValues(H.from[0],H.from[1]):L.create(),this.to=H.to?L.fromValues(H.to[0],H.to[1]):L.create(),this.checkCollisionResponse=!(H.checkCollisionResponse!==void 0)||H.checkCollisionResponse,this.skipBackfaces=!!H.skipBackfaces,this.collisionMask=H.collisionMask===void 0?-1:H.collisionMask,this.collisionGroup=H.collisionGroup===void 0?-1:H.collisionGroup,this.mode=H.mode===void 0?E.ANY:H.mode,this.callback=H.callback||function(){},this.direction=L.create(),this.length=1,this.update()}function R(H,Y,z){L.sub(X,z,H);var K=L.dot(X,Y);return L.scale(V,Y,K),L.add(V,V,H),L.squaredDistance(z,V)}S.exports=E;var L=P("../math/vec2"),D=P("../collision/RaycastResult"),M=P("../shapes/Shape"),O=P("../collision/AABB");E.prototype.constructor=E,E.CLOSEST=1,E.ANY=2,E.ALL=4,E.prototype.update=function(){var H=this.direction;L.sub(H,this.to,this.from),this.length=L.length(H),L.normalize(H,H)},E.prototype.intersectBodies=function(H,Y){for(var z=0,K=Y.length;!H.shouldStop(this)&&z<K;z++){var J=Y[z],Q=J.getAABB();(0<=Q.overlapsRay(this)||Q.containsPoint(this.from))&&this.intersectBody(H,J)}};var U=L.create();E.prototype.intersectBody=function(H,Y){var z=this.checkCollisionResponse;if(!z||Y.collisionResponse)for(var K=U,J=0,Q=Y.shapes.length,Z;J<Q;J++)if((Z=Y.shapes[J],!z||Z.collisionResponse)&&0!=(this.collisionGroup&Z.collisionMask)&&0!=(Z.collisionGroup&this.collisionMask)){L.rotate(K,Z.position,Y.angle),L.add(K,K,Y.position);var $=Z.angle+Y.angle;if(this.intersectShape(H,Z,$,K,Y),H.shouldStop(this))break}},E.prototype.intersectShape=function(H,Y,z,K,J){var Q=this.from,Z=R(Q,this.direction,K);Z>Y.boundingRadius*Y.boundingRadius||(this._currentBody=J,this._currentShape=Y,Y.raycast(H,this,K,z),this._currentBody=this._currentShape=null)},E.prototype.getAABB=function(H){var Y=this.to,z=this.from;L.set(H.lowerBound,Math.min(Y[0],z[0]),Math.min(Y[1],z[1])),L.set(H.upperBound,Math.max(Y[0],z[0]),Math.max(Y[1],z[1]))};L.create();E.prototype.reportIntersection=function(H,Y,z,K){var J=this.from,Q=this.to,Z=this._currentShape,$=this._currentBody;if(!(this.skipBackfaces&&0<L.dot(z,this.direction)))switch(this.mode){case E.ALL:H.set(z,Z,$,Y,K),this.callback(H);break;case E.CLOSEST:(Y<H.fraction||!H.hasHit())&&H.set(z,Z,$,Y,K);break;case E.ANY:H.set(z,Z,$,Y,K);}};var X=L.create(),V=L.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(P,S){function E(){this.normal=R.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var R=P("../math/vec2"),L=P("../collision/Ray");S.exports=E,E.prototype.reset=function(){R.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},E.prototype.getHitDistance=function(D){return R.distance(D.from,D.to)*this.fraction},E.prototype.hasHit=function(){return-1!==this.fraction},E.prototype.getHitPoint=function(D,M){R.lerp(D,M.from,M.to,this.fraction)},E.prototype.stop=function(){this.isStopped=!0},E.prototype.shouldStop=function(D){return this.isStopped||-1!==this.fraction&&D.mode===L.ANY},E.prototype.set=function(D,M,O,U,W){R.copy(this.normal,D),this.shape=M,this.body=O,this.fraction=U,this.faceIndex=W}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(P,S){function E(){L.call(this,L.SAP),this.axisList=[],this.axisIndex=0;var D=this;this._addBodyHandler=function(M){D.axisList.push(M.body)},this._removeBodyHandler=function(M){var O=D.axisList.indexOf(M.body);-1!==O&&D.axisList.splice(O,1)}}var R=P("../utils/Utils"),L=P("../collision/Broadphase");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.setWorld=function(D){this.axisList.length=0,R.appendArray(this.axisList,D.bodies),D.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),D.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=D},E.sortAxisList=function(D,M){M|=0;for(var O=1,U=D.length,W;O<U;O++){W=D[O];for(var X=O-1;0<=X&&!(D[X].aabb.lowerBound[M]<=W.aabb.lowerBound[M]);X--)D[X+1]=D[X];D[X+1]=W}return D},E.prototype.sortList=function(){var D=this.axisList,M=this.axisIndex;E.sortAxisList(D,M)},E.prototype.getCollisionPairs=function(){var M=this.axisList,O=this.result,U=this.axisIndex;O.length=0;for(var W=M.length,X;W--;)X=M[W],X.aabbNeedsUpdate&&X.updateAABB();this.sortList();for(var V=0,H=0|M.length,Y;V!==H;V++){Y=M[V];for(var z=V+1;z<H;z++){var K=M[z],J=K.aabb.lowerBound[U]<=Y.aabb.upperBound[U];if(!J)break;L.canCollide(Y,K)&&this.boundingVolumeCheck(Y,K)&&O.push(Y,K)}}return O},E.prototype.aabbQuery=function(D,M,O){O=O||[],this.sortList();var U=this.axisIndex,W="x";1===U&&(W="y"),2===U&&(W="z");for(var X=this.axisList,V=M.lowerBound[W],H=M.upperBound[W],Y=0,z;Y<X.length;Y++)z=X[Y],z.aabbNeedsUpdate&&z.updateAABB(),z.aabb.overlaps(M)&&O.push(z);return O}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(P,S){function E(L,D,M,O){this.type=M,O=R.defaults(O,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=L,this.bodyB=D,this.collideConnected=O.collideConnected,O.wakeUpBodies&&(L&&L.wakeUp(),D&&D.wakeUp())}S.exports=E;var R=P("../utils/Utils");E.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},E.DISTANCE=1,E.GEAR=2,E.LOCK=3,E.PRISMATIC=4,E.REVOLUTE=5,E.prototype.setStiffness=function(L){for(var D=this.equations,M=0,O;M!==D.length;M++)O=D[M],O.stiffness=L,O.needsUpdate=!0},E.prototype.setRelaxation=function(L){for(var D=this.equations,M=0,O;M!==D.length;M++)O=D[M],O.relaxation=L,O.needsUpdate=!0}},{"../utils/Utils":57}],15:[function(P,S){function E(X,V,H){H=M.defaults(H,{localAnchorA:[0,0],localAnchorB:[0,0]}),R.call(this,X,V,R.DISTANCE,H),this.localAnchorA=D.fromValues(H.localAnchorA[0],H.localAnchorA[1]),this.localAnchorB=D.fromValues(H.localAnchorB[0],H.localAnchorB[1]);var Y=this.localAnchorA,z=this.localAnchorB;if(this.distance=0,"number"==typeof H.distance)this.distance=H.distance;else{var K=D.create(),J=D.create(),Q=D.create();D.rotate(K,Y,X.angle),D.rotate(J,z,V.angle),D.add(Q,V.position,J),D.sub(Q,Q,K),D.sub(Q,Q,X.position),this.distance=D.length(Q)}var Z="undefined"==typeof H.maxForce?Number.MAX_VALUE:H.maxForce;var $=new L(X,V,-Z,Z);this.equations=[$],this.maxForce=Z;var Q=D.create(),ee=D.create(),te=D.create(),ae=this;$.computeGq=function(){var oe=this.bodyA,ne=this.bodyB,ie=oe.position,se=ne.position;return D.rotate(ee,Y,oe.angle),D.rotate(te,z,ne.angle),D.add(Q,se,te),D.sub(Q,Q,ee),D.sub(Q,Q,ie),D.length(Q)-ae.distance},this.setMaxForce(Z),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var R=P("./Constraint"),L=P("../equations/Equation"),D=P("../math/vec2"),M=P("../utils/Utils");S.exports=E,E.prototype=new R,E.prototype.constructor=E;var O=D.create(),U=D.create(),W=D.create();E.prototype.update=function(){var X=this.equations[0],V=this.bodyA,H=this.bodyB,Y=this.distance,z=V.position,K=H.position,J=this.equations[0],Q=X.G;D.rotate(U,this.localAnchorA,V.angle),D.rotate(W,this.localAnchorB,H.angle),D.add(O,K,W),D.sub(O,O,U),D.sub(O,O,z),this.position=D.length(O);var Z=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(J.maxForce=0,J.minForce=-this.maxForce,this.distance=this.upperLimit,Z=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(J.maxForce=this.maxForce,J.minForce=0,this.distance=this.lowerLimit,Z=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!Z)return void(J.enabled=!1);J.enabled=!0,D.normalize(O,O);var $=D.crossLength(U,O),ee=D.crossLength(W,O);Q[0]=-O[0],Q[1]=-O[1],Q[2]=-$,Q[3]=O[0],Q[4]=O[1],Q[5]=ee},E.prototype.setMaxForce=function(X){var V=this.equations[0];V.minForce=-X,V.maxForce=X},E.prototype.getMaxForce=function(){var X=this.equations[0];return X.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(P,S){function E(O,U,W){W=W||{},R.call(this,O,U,R.GEAR,W),this.ratio=W.ratio===void 0?1:W.ratio,this.angle=W.angle===void 0?U.angle-this.ratio*O.angle:W.angle,W.angle=this.angle,W.ratio=this.ratio,this.equations=[new D(O,U,W)],W.maxTorque!==void 0&&this.setMaxTorque(W.maxTorque)}var R=P("./Constraint"),L=P("../equations/Equation"),D=P("../equations/AngleLockEquation"),M=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.update=function(){var O=this.equations[0];O.ratio!==this.ratio&&O.setRatio(this.ratio),O.angle=this.angle},E.prototype.setMaxTorque=function(O){this.equations[0].setMaxTorque(O)},E.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(P,S){function E(V,H,Y){Y=Y||{},R.call(this,V,H,R.LOCK,Y);var z="undefined"==typeof Y.maxForce?Number.MAX_VALUE:Y.maxForce,K=Y.localAngleB||0,J=new D(V,H,-z,z),Q=new D(V,H,-z,z),Z=new D(V,H,-z,z),$=L.create(),ee=L.create(),te=this;J.computeGq=function(){return L.rotate($,te.localOffsetB,V.angle),L.sub(ee,H.position,V.position),L.sub(ee,ee,$),ee[0]},Q.computeGq=function(){return L.rotate($,te.localOffsetB,V.angle),L.sub(ee,H.position,V.position),L.sub(ee,ee,$),ee[1]};var ae=L.create(),oe=L.create();Z.computeGq=function(){return L.rotate(ae,te.localOffsetB,H.angle-te.localAngleB),L.scale(ae,ae,-1),L.sub(ee,V.position,H.position),L.add(ee,ee,ae),L.rotate(oe,ae,-Math.PI/2),L.normalize(oe,oe),L.dot(ee,oe)},this.localOffsetB=L.create(),Y.localOffsetB?L.copy(this.localOffsetB,Y.localOffsetB):(L.sub(this.localOffsetB,H.position,V.position),L.rotate(this.localOffsetB,this.localOffsetB,-V.angle)),this.localAngleB=0,this.localAngleB="number"==typeof Y.localAngleB?Y.localAngleB:H.angle-V.angle,this.equations.push(J,Q,Z),this.setMaxForce(z)}var R=P("./Constraint"),L=P("../math/vec2"),D=P("../equations/Equation");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.setMaxForce=function(V){for(var H=this.equations,Y=0;Y<this.equations.length;Y++)H[Y].maxForce=V,H[Y].minForce=-V},E.prototype.getMaxForce=function(){return this.equations[0].maxForce};var M=L.create(),O=L.create(),U=L.create(),W=L.fromValues(1,0),X=L.fromValues(0,1);E.prototype.update=function(){var V=this.equations[0],H=this.equations[1],Y=this.equations[2],z=this.bodyA,K=this.bodyB;L.rotate(M,this.localOffsetB,z.angle),L.rotate(O,this.localOffsetB,K.angle-this.localAngleB),L.scale(O,O,-1),L.rotate(U,O,Math.PI/2),L.normalize(U,U),V.G[0]=-1,V.G[1]=0,V.G[2]=-L.crossLength(M,W),V.G[3]=1,H.G[0]=0,H.G[1]=-1,H.G[2]=-L.crossLength(M,X),H.G[4]=1,Y.G[0]=-U[0],Y.G[1]=-U[1],Y.G[3]=U[0],Y.G[4]=U[1],Y.G[5]=L.crossLength(O,U)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(P,S){function E(z,K,J){J=J||{},R.call(this,z,K,R.PRISMATIC,J);var Q=M.fromValues(0,0),Z=M.fromValues(1,0),$=M.fromValues(0,0);J.localAnchorA&&M.copy(Q,J.localAnchorA),J.localAxisA&&M.copy(Z,J.localAxisA),J.localAnchorB&&M.copy($,J.localAnchorB),this.localAnchorA=Q,this.localAnchorB=$,this.localAxisA=Z;var ee=this.maxForce="undefined"==typeof J.maxForce?Number.MAX_VALUE:J.maxForce,te=new D(z,K,-ee,ee),ae=new M.create,oe=new M.create,ne=new M.create,ie=new M.create;if(te.computeGq=function(){return M.dot(ne,ie)},te.updateJacobian=function(){var ue=this.G,he=z.position,ge=K.position;M.rotate(ae,Q,z.angle),M.rotate(oe,$,K.angle),M.add(ne,ge,oe),M.sub(ne,ne,he),M.sub(ne,ne,ae),M.rotate(ie,Z,z.angle+Math.PI/2),ue[0]=-ie[0],ue[1]=-ie[1],ue[2]=-M.crossLength(ae,ie)+M.crossLength(ie,ne),ue[3]=ie[0],ue[4]=ie[1],ue[5]=M.crossLength(oe,ie)},this.equations.push(te),!J.disableRotationalLock){var se=new O(z,K,-ee,ee);this.equations.push(se)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof J.lowerLimit,this.upperLimitEnabled="undefined"!=typeof J.upperLimit,this.lowerLimit="undefined"==typeof J.lowerLimit?0:J.lowerLimit,this.upperLimit="undefined"==typeof J.upperLimit?1:J.upperLimit,this.upperLimitEquation=new L(z,K),this.lowerLimitEquation=new L(z,K),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=ee,this.motorEquation=new D(z,K),this.motorEnabled=!1,this.motorSpeed=0;var le=this,de=this.motorEquation,pe=de.computeGW;de.computeGq=function(){return 0},de.computeGW=function(){var ue=this.G,he=this.bodyA,ge=this.bodyB,me=he.velocity,be=ge.velocity,_e=he.angularVelocity,ve=ge.angularVelocity;return this.gmult(ue,me,_e,be,ve)+le.motorSpeed}}var R=P("./Constraint"),L=P("../equations/ContactEquation"),D=P("../equations/Equation"),M=P("../math/vec2"),O=P("../equations/RotationalLockEquation");S.exports=E,E.prototype=new R,E.prototype.constructor=E;var U=M.create(),W=M.create(),X=M.create(),V=M.create(),H=M.create(),Y=M.create();E.prototype.update=function(){var z=this.equations,K=z[0],J=this.upperLimit,Q=this.lowerLimit,Z=this.upperLimitEquation,$=this.lowerLimitEquation,ee=this.bodyA,te=this.bodyB,ae=this.localAxisA,oe=this.localAnchorA,ne=this.localAnchorB;K.updateJacobian(),M.rotate(U,ae,ee.angle),M.rotate(V,oe,ee.angle),M.add(W,V,ee.position),M.rotate(H,ne,te.angle),M.add(X,H,te.position);var ie=this.position=M.dot(X,U)-M.dot(W,U);if(this.motorEnabled){var se=this.motorEquation.G;se[0]=U[0],se[1]=U[1],se[2]=M.crossLength(U,H),se[3]=-U[0],se[4]=-U[1],se[5]=-M.crossLength(U,V)}if(this.upperLimitEnabled&&ie>J)M.scale(Z.normalA,U,-1),M.sub(Z.contactPointA,W,ee.position),M.sub(Z.contactPointB,X,te.position),M.scale(Y,U,J),M.add(Z.contactPointA,Z.contactPointA,Y),-1===z.indexOf(Z)&&z.push(Z);else{var le=z.indexOf(Z);-1!==le&&z.splice(le,1)}if(this.lowerLimitEnabled&&ie<Q)M.scale($.normalA,U,1),M.sub($.contactPointA,W,ee.position),M.sub($.contactPointB,X,te.position),M.scale(Y,U,Q),M.sub($.contactPointB,$.contactPointB,Y),-1===z.indexOf($)&&z.push($);else{var le=z.indexOf($);-1!==le&&z.splice(le,1)}},E.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},E.prototype.disableMotor=function(){if(this.motorEnabled){var z=this.equations.indexOf(this.motorEquation);this.equations.splice(z,1),this.motorEnabled=!1}},E.prototype.setLimits=function(z,K){"number"==typeof z?(this.lowerLimit=z,this.lowerLimitEnabled=!0):(this.lowerLimit=z,this.lowerLimitEnabled=!1),"number"==typeof K?(this.upperLimit=K,this.upperLimitEnabled=!0):(this.upperLimit=K,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(P,S){function E(Y,z,K){K=K||{},R.call(this,Y,z,R.REVOLUTE,K);var J=this.maxForce="undefined"==typeof K.maxForce?Number.MAX_VALUE:K.maxForce;this.pivotA=O.create(),this.pivotB=O.create(),K.worldPivot?(O.sub(this.pivotA,K.worldPivot,Y.position),O.sub(this.pivotB,K.worldPivot,z.position),O.rotate(this.pivotA,this.pivotA,-Y.angle),O.rotate(this.pivotB,this.pivotB,-z.angle)):(O.copy(this.pivotA,K.localPivotA),O.copy(this.pivotB,K.localPivotB));var Q=this.equations=[new L(Y,z,-J,J),new L(Y,z,-J,J)],Z=Q[0],$=Q[1],ee=this;Z.computeGq=function(){return O.rotate(U,ee.pivotA,Y.angle),O.rotate(W,ee.pivotB,z.angle),O.add(H,z.position,W),O.sub(H,H,Y.position),O.sub(H,H,U),O.dot(H,X)},$.computeGq=function(){return O.rotate(U,ee.pivotA,Y.angle),O.rotate(W,ee.pivotB,z.angle),O.add(H,z.position,W),O.sub(H,H,Y.position),O.sub(H,H,U),O.dot(H,V)},$.minForce=Z.minForce=-J,$.maxForce=Z.maxForce=J,this.motorEquation=new D(Y,z),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new M(Y,z),this.lowerLimitEquation=new M(Y,z),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var R=P("./Constraint"),L=P("../equations/Equation"),D=P("../equations/RotationalVelocityEquation"),M=P("../equations/RotationalLockEquation"),O=P("../math/vec2");S.exports=E;var U=O.create(),W=O.create(),X=O.fromValues(1,0),V=O.fromValues(0,1),H=O.create();E.prototype=new R,E.prototype.constructor=E,E.prototype.setLimits=function(Y,z){"number"==typeof Y?(this.lowerLimit=Y,this.lowerLimitEnabled=!0):(this.lowerLimit=Y,this.lowerLimitEnabled=!1),"number"==typeof z?(this.upperLimit=z,this.upperLimitEnabled=!0):(this.upperLimit=z,this.upperLimitEnabled=!1)},E.prototype.update=function(){var Y=this.bodyA,z=this.bodyB,K=this.pivotA,J=this.pivotB,Q=this.equations,Z=Q[0],$=Q[1],ee=Q[0],te=Q[1],ae=this.upperLimit,oe=this.lowerLimit,ne=this.upperLimitEquation,ie=this.lowerLimitEquation,se=this.angle=z.angle-Y.angle;if(this.upperLimitEnabled&&se>ae)ne.angle=ae,-1===Q.indexOf(ne)&&Q.push(ne);else{var le=Q.indexOf(ne);-1!==le&&Q.splice(le,1)}if(this.lowerLimitEnabled&&se<oe)ie.angle=oe,-1===Q.indexOf(ie)&&Q.push(ie);else{var le=Q.indexOf(ie);-1!==le&&Q.splice(le,1)}O.rotate(U,K,Y.angle),O.rotate(W,J,z.angle),ee.G[0]=-1,ee.G[1]=0,ee.G[2]=-O.crossLength(U,X),ee.G[3]=1,ee.G[4]=0,ee.G[5]=O.crossLength(W,X),te.G[0]=0,te.G[1]=-1,te.G[2]=-O.crossLength(U,V),te.G[3]=0,te.G[4]=1,te.G[5]=O.crossLength(W,V)},E.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},E.prototype.disableMotor=function(){if(this.motorEnabled){var Y=this.equations.indexOf(this.motorEquation);this.equations.splice(Y,1),this.motorEnabled=!1}},E.prototype.motorIsEnabled=function(){return!!this.motorEnabled},E.prototype.setMotorSpeed=function(Y){if(this.motorEnabled){var z=this.equations.indexOf(this.motorEquation);this.equations[z].relativeVelocity=Y}},E.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(P,S){function E(D,M,O){O=O||{},R.call(this,D,M,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=O.angle||0,this.ratio="number"==typeof O.ratio?O.ratio:1,this.setRatio(this.ratio)}var R=P("./Equation"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},E.prototype.setRatio=function(D){var M=this.G;M[2]=D,M[5]=-1,this.ratio=D},E.prototype.setMaxTorque=function(D){this.maxForce=D,this.minForce=-D}},{"../math/vec2":30,"./Equation":22}],21:[function(P,S){function E(U,W){R.call(this,U,W,0,Number.MAX_VALUE),this.contactPointA=L.create(),this.penetrationVec=L.create(),this.contactPointB=L.create(),this.normalA=L.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var R=P("./Equation"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeB=function(U,W,X){var V=this.bodyA,H=this.bodyB,Y=this.contactPointA,z=this.contactPointB,K=V.position,J=H.position,Q=this.penetrationVec,Z=this.normalA,$=this.G,ee=L.crossLength(Y,Z),te=L.crossLength(z,Z);$[0]=-Z[0],$[1]=-Z[1],$[2]=-ee,$[3]=Z[0],$[4]=Z[1],$[5]=te,L.add(Q,J,z),L.sub(Q,Q,K),L.sub(Q,Q,Y);var ae,oe;this.firstImpact&&0!==this.restitution?(oe=0,ae=1/W*(1+this.restitution)*this.computeGW()):(oe=L.dot(Z,Q)+this.offset,ae=this.computeGW());var ne=this.computeGiMf(),ie=-oe*U-ae*W-X*ne;return ie};var D=L.create(),M=L.create(),O=L.create();E.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(D,this.contactPointA),this.bodyB.getVelocityAtPoint(M,this.contactPointB),L.subtract(O,D,M),L.dot(this.normalA,O)}},{"../math/vec2":30,"./Equation":22}],22:[function(P,S){function E(J,Q,Z,$){this.minForce="undefined"==typeof Z?-Number.MAX_VALUE:Z,this.maxForce="undefined"==typeof $?Number.MAX_VALUE:$,this.bodyA=J,this.bodyB=Q,this.stiffness=E.DEFAULT_STIFFNESS,this.relaxation=E.DEFAULT_RELAXATION,this.G=new L.ARRAY_TYPE(6);for(var ee=0;6>ee;ee++)this.G[ee]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}S.exports=E;var R=P("../math/vec2"),L=P("../utils/Utils"),D=P("../objects/Body");E.prototype.constructor=E,E.DEFAULT_STIFFNESS=1e6,E.DEFAULT_RELAXATION=4,E.prototype.update=function(){var J=this.stiffness,Q=this.relaxation,Z=this.timeStep;this.a=4/(Z*(1+4*Q)),this.b=4*Q/(1+4*Q),this.epsilon=4/(Z*Z*J*(1+4*Q)),this.needsUpdate=!1},E.prototype.gmult=function(J,Q,Z,$,ee){return J[0]*Q[0]+J[1]*Q[1]+J[2]*Z+J[3]*$[0]+J[4]*$[1]+J[5]*ee},E.prototype.computeB=function(J,Q,Z){var $=this.computeGW(),ee=this.computeGq(),te=this.computeGiMf();return-ee*J-$*Q-te*Z};var M=R.create(),O=R.create();E.prototype.computeGq=function(){var J=this.G,Q=this.bodyA,Z=this.bodyB,$=Q.position,ee=Z.position,te=Q.angle,ae=Z.angle;return this.gmult(J,M,te,O,ae)+this.offset},E.prototype.computeGW=function(){var J=this.G,Q=this.bodyA,Z=this.bodyB,$=Q.velocity,ee=Z.velocity,te=Q.angularVelocity,ae=Z.angularVelocity;return this.gmult(J,$,te,ee,ae)+this.relativeVelocity},E.prototype.computeGWlambda=function(){var J=this.G,Q=this.bodyA,Z=this.bodyB,$=Q.vlambda,ee=Z.vlambda,te=Q.wlambda,ae=Z.wlambda;return this.gmult(J,$,te,ee,ae)};var U=R.create(),W=R.create();E.prototype.computeGiMf=function(){var J=this.bodyA,Q=this.bodyB,Z=J.force,$=J.angularForce,ee=Q.force,te=Q.angularForce,ae=J.invMassSolve,oe=Q.invMassSolve,ne=J.invInertiaSolve,ie=Q.invInertiaSolve,se=this.G;return R.scale(U,Z,ae),R.multiply(U,J.massMultiplier,U),R.scale(W,ee,oe),R.multiply(W,Q.massMultiplier,W),this.gmult(se,U,$*ne,W,te*ie)},E.prototype.computeGiMGt=function(){var J=this.bodyA,Q=this.bodyB,Z=J.invMassSolve,$=Q.invMassSolve,ee=J.invInertiaSolve,te=Q.invInertiaSolve,ae=this.G;return ae[0]*ae[0]*Z*J.massMultiplier[0]+ae[1]*ae[1]*Z*J.massMultiplier[1]+ae[2]*ae[2]*ee+ae[3]*ae[3]*$*Q.massMultiplier[0]+ae[4]*ae[4]*$*Q.massMultiplier[1]+ae[5]*ae[5]*te};var X=R.create(),V=R.create(),H=R.create(),Y=R.create(),z=R.create(),K=R.create();E.prototype.addToWlambda=function(J){var Q=this.bodyA,Z=this.bodyB,$=X,ee=V,te=H,ne=Q.invMassSolve,ie=Z.invMassSolve,se=Q.invInertiaSolve,le=Z.invInertiaSolve,pe=this.G;ee[0]=pe[0],ee[1]=pe[1],te[0]=pe[3],te[1]=pe[4],R.scale($,ee,ne*J),R.multiply($,$,Q.massMultiplier),R.add(Q.vlambda,Q.vlambda,$),Q.wlambda+=se*pe[2]*J,R.scale($,te,ie*J),R.multiply($,$,Z.massMultiplier),R.add(Z.vlambda,Z.vlambda,$),Z.wlambda+=le*pe[5]*J},E.prototype.computeInvC=function(J){return 1/(this.computeGiMGt()+J)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(P,S){function E(M,O,U){L.call(this,M,O,-U,U),this.contactPointA=R.create(),this.contactPointB=R.create(),this.t=R.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=0.3}var R=P("../math/vec2"),L=P("./Equation"),D=P("../utils/Utils");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.setSlipForce=function(M){this.maxForce=M,this.minForce=-M},E.prototype.getSlipForce=function(){return this.maxForce},E.prototype.computeB=function(M,O,U){var W=this.bodyA,X=this.bodyB,V=this.contactPointA,H=this.contactPointB,Y=this.t,z=this.G;z[0]=-Y[0],z[1]=-Y[1],z[2]=-R.crossLength(V,Y),z[3]=Y[0],z[4]=Y[1],z[5]=R.crossLength(H,Y);var K=this.computeGW(),J=this.computeGiMf();return-K*O-U*J}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(P,S){function E(W,X,V){V=V||{},R.call(this,W,X,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=V.angle||0;var H=this.G;H[2]=1,H[5]=-1}var R=P("./Equation"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E;var D=L.create(),M=L.create(),O=L.fromValues(1,0),U=L.fromValues(0,1);E.prototype.computeGq=function(){return L.rotate(D,O,this.bodyA.angle+this.angle),L.rotate(M,U,this.bodyB.angle),L.dot(D,M)}},{"../math/vec2":30,"./Equation":22}],25:[function(P,S){function E(D,M){R.call(this,D,M,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var R=P("./Equation"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeB=function(D,M,O){var U=this.G;U[2]=-1,U[5]=this.ratio;var W=this.computeGiMf(),X=this.computeGW();return-X*M-O*W}},{"../math/vec2":30,"./Equation":22}],26:[function(P,S){var E=function(){};S.exports=E,E.prototype={constructor:E,on:function(R,L,D){L.context=D||this,void 0===this._listeners&&(this._listeners={});var M=this._listeners;return void 0===M[R]&&(M[R]=[]),-1===M[R].indexOf(L)&&M[R].push(L),this},has:function(R,L){if(this._listeners===void 0)return!1;var D=this._listeners;if(L){if(void 0!==D[R]&&-1!==D[R].indexOf(L))return!0;}else if(void 0!==D[R])return!0;return!1},off:function(R,L){if(void 0===this._listeners)return this;var D=this._listeners,M=D[R].indexOf(L);return-1!==M&&D[R].splice(M,1),this},emit:function(R){if(this._listeners===void 0)return this;var L=this._listeners,D=L[R.type];if(D!==void 0){R.target=this;for(var M=0,O=D.length,U;M<O;M++)U=D[M],U.call(U.context,R)}return this}}},{}],27:[function(P,S){function E(D,M,O){if(O=O||{},!(D instanceof R)||!(M instanceof R))throw new Error("First two arguments must be Material instances.");this.id=E.idCounter++,this.materialA=D,this.materialB=M,this.friction="undefined"==typeof O.friction?0.3:+O.friction,this.restitution="undefined"==typeof O.restitution?0:+O.restitution,this.stiffness="undefined"==typeof O.stiffness?L.DEFAULT_STIFFNESS:+O.stiffness,this.relaxation="undefined"==typeof O.relaxation?L.DEFAULT_RELAXATION:+O.relaxation,this.frictionStiffness="undefined"==typeof O.frictionStiffness?L.DEFAULT_STIFFNESS:+O.frictionStiffness,this.frictionRelaxation="undefined"==typeof O.frictionRelaxation?L.DEFAULT_RELAXATION:+O.frictionRelaxation,this.surfaceVelocity="undefined"==typeof O.surfaceVelocity?0:+O.surfaceVelocity,this.contactSkinSize=5e-3}var R=P("./Material"),L=P("../equations/Equation");S.exports=E,E.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(P,S){function E(R){this.id=R||E.idCounter++}S.exports=E,E.idCounter=0},{}],29:[function(P,S){var E={};E.GetArea=function(R){if(6>R.length)return 0;for(var L=R.length-2,D=0,M=0;M<L;M+=2)D+=(R[M+2]-R[M])*(R[M+1]+R[M+3]);return D+=(R[0]-R[L])*(R[L+1]+R[1]),0.5*-D},E.Triangulate=function(R){var L=R.length>>1;if(3>L)return[];for(var D=[],M=[],O=0;O<L;O++)M.push(O);for(var O=0,U=L;3<U;){var W=M[(O+0)%U],X=M[(O+1)%U],V=M[(O+2)%U],H=R[2*W],Y=R[2*W+1],z=R[2*X],K=R[2*X+1],J=R[2*V],Q=R[2*V+1],Z=!1;if(E._convex(H,Y,z,K,J,Q)){Z=!0;for(var $=0,ee;$<U;$++)if(ee=M[$],ee!=W&&ee!=X&&ee!=V&&E._PointInTriangle(R[2*ee],R[2*ee+1],H,Y,z,K,J,Q)){Z=!1;break}}if(Z)D.push(W,X,V),M.splice((O+1)%U,1),U--,O=0;else if(O++>3*U)break}return D.push(M[0],M[1],M[2]),D},E._PointInTriangle=function(R,L,D,M,O,U,W,X){var V=W-D,H=X-M,Y=O-D,z=U-M,K=R-D,J=L-M,Q=V*V+H*H,Z=V*Y+H*z,$=V*K+H*J,ee=Y*Y+z*z,te=Y*K+z*J,ae=1/(Q*ee-Z*Z),oe=(ee*$-Z*te)*ae,ne=(Q*te-Z*$)*ae;return 0<=oe&&0<=ne&&1>oe+ne},E._convex=function(R,L,D,M,O,U){return 0<=(L-M)*(O-D)+(D-R)*(U-M)},S.exports=E},{}],30:[function(P,S){var E=S.exports={},R=P("../utils/Utils");E.crossLength=function(L,D){return L[0]*D[1]-L[1]*D[0]},E.crossVZ=function(L,D,M){return E.rotate(L,D,-Math.PI/2),E.scale(L,L,M),L},E.crossZV=function(L,D,M){return E.rotate(L,M,Math.PI/2),E.scale(L,L,D),L},E.rotate=function(L,D,M){if(0!==M){var O=Math.cos(M),U=Math.sin(M),W=D[0],X=D[1];L[0]=O*W-U*X,L[1]=U*W+O*X}else L[0]=D[0],L[1]=D[1]},E.rotate90cw=function(L,D){var M=D[0],O=D[1];L[0]=O,L[1]=-M},E.toLocalFrame=function(L,D,M,O){E.copy(L,D),E.sub(L,L,M),E.rotate(L,L,-O)},E.toGlobalFrame=function(L,D,M,O){E.copy(L,D),E.rotate(L,L,O),E.add(L,L,M)},E.vectorToLocalFrame=function(L,D,M){E.rotate(L,D,-M)},E.vectorToGlobalFrame=function(L,D,M){E.rotate(L,D,M)},E.centroid=function(L,D,M,O){return E.add(L,D,M),E.add(L,L,O),E.scale(L,L,1/3),L},E.create=function(){var L=new R.ARRAY_TYPE(2);return L[0]=0,L[1]=0,L},E.clone=function(L){var D=new R.ARRAY_TYPE(2);return D[0]=L[0],D[1]=L[1],D},E.fromValues=function(L,D){var M=new R.ARRAY_TYPE(2);return M[0]=L,M[1]=D,M},E.copy=function(L,D){return L[0]=D[0],L[1]=D[1],L},E.set=function(L,D,M){return L[0]=D,L[1]=M,L},E.add=function(L,D,M){return L[0]=D[0]+M[0],L[1]=D[1]+M[1],L},E.subtract=function(L,D,M){return L[0]=D[0]-M[0],L[1]=D[1]-M[1],L},E.sub=E.subtract,E.multiply=function(L,D,M){return L[0]=D[0]*M[0],L[1]=D[1]*M[1],L},E.mul=E.multiply,E.divide=function(L,D,M){return L[0]=D[0]/M[0],L[1]=D[1]/M[1],L},E.div=E.divide,E.scale=function(L,D,M){return L[0]=D[0]*M,L[1]=D[1]*M,L},E.distance=function(L,D){var M=D[0]-L[0],O=D[1]-L[1];return Math.sqrt(M*M+O*O)},E.dist=E.distance,E.squaredDistance=function(L,D){var M=D[0]-L[0],O=D[1]-L[1];return M*M+O*O},E.sqrDist=E.squaredDistance,E.length=function(L){var D=L[0],M=L[1];return Math.sqrt(D*D+M*M)},E.len=E.length,E.squaredLength=function(L){var D=L[0],M=L[1];return D*D+M*M},E.sqrLen=E.squaredLength,E.negate=function(L,D){return L[0]=-D[0],L[1]=-D[1],L},E.normalize=function(L,D){var M=D[0],O=D[1],U=M*M+O*O;return 0<U&&(U=1/Math.sqrt(U),L[0]=D[0]*U,L[1]=D[1]*U),L},E.dot=function(L,D){return L[0]*D[0]+L[1]*D[1]},E.str=function(L){return"vec2("+L[0]+", "+L[1]+")"},E.lerp=function(L,D,M,O){var U=D[0],W=D[1];return L[0]=U+O*(M[0]-U),L[1]=W+O*(M[1]-W),L},E.reflect=function(L,D,M){var O=D[0]*M[0]+D[1]*M[1];L[0]=D[0]-2*M[0]*O,L[1]=D[1]-2*M[1]*O},E.getLineSegmentsIntersection=function(L,D,M,O,U){var W=E.getLineSegmentsIntersectionFraction(D,M,O,U);return!(0>W)&&(L[0]=D[0]+W*(M[0]-D[0]),L[1]=D[1]+W*(M[1]-D[1]),!0)},E.getLineSegmentsIntersectionFraction=function(L,D,M,O){var U=D[0]-L[0],W=D[1]-L[1],X=O[0]-M[0],V=O[1]-M[1],H,Y;return H=(-W*(L[0]-M[0])+U*(L[1]-M[1]))/(-X*W+U*V),Y=(X*(L[1]-M[1])-V*(L[0]-M[0]))/(-X*W+U*V),0<=H&&1>=H&&0<=Y&&1>=Y?Y:-1}},{"../utils/Utils":57}],31:[function(P,S){function E(ge){ge=ge||{},W.call(this),this.id=ge.id||++E._idCounter,this.world=null,this.shapes=[],this.mass=ge.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!ge.fixedRotation,this.fixedX=!!ge.fixedX,this.fixedY=!!ge.fixedY,this.massMultiplier=R.create(),this.position=R.fromValues(0,0),ge.position&&R.copy(this.position,ge.position),this.interpolatedPosition=R.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=R.fromValues(0,0),this.previousAngle=0,this.velocity=R.fromValues(0,0),ge.velocity&&R.copy(this.velocity,ge.velocity),this.vlambda=R.fromValues(0,0),this.wlambda=0,this.angle=ge.angle||0,this.angularVelocity=ge.angularVelocity||0,this.force=R.create(),ge.force&&R.copy(this.force,ge.force),this.angularForce=ge.angularForce||0,this.damping="number"==typeof ge.damping?ge.damping:0.1,this.angularDamping="number"==typeof ge.angularDamping?ge.angularDamping:0.1,this.type=E.STATIC,this.type="undefined"==typeof ge.type?ge.mass?E.DYNAMIC:E.STATIC:ge.type,this.boundingRadius=0,this.aabb=new U,this.aabbNeedsUpdate=!0,this.allowSleep=!(ge.allowSleep!==void 0)||ge.allowSleep,this.wantsToSleep=!1,this.sleepState=E.AWAKE,this.sleepSpeedLimit=ge.sleepSpeedLimit===void 0?0.2:ge.sleepSpeedLimit,this.sleepTimeLimit=ge.sleepTimeLimit===void 0?1:ge.sleepTimeLimit,this.gravityScale=ge.gravityScale===void 0?1:ge.gravityScale,this.collisionResponse=!(ge.collisionResponse!==void 0)||ge.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=ge.ccdSpeedThreshold===void 0?-1:ge.ccdSpeedThreshold,this.ccdIterations=ge.ccdIterations===void 0?10:ge.ccdIterations,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var R=P("../math/vec2"),L=P("poly-decomp"),D=P("../shapes/Convex"),M=P("../collision/RaycastResult"),O=P("../collision/Ray"),U=P("../collision/AABB"),W=P("../events/EventEmitter");S.exports=E,E.prototype=new W,E.prototype.constructor=E,E._idCounter=0,E.prototype.updateSolveMassProperties=function(){this.sleepState===E.SLEEPING||this.type===E.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},E.prototype.setDensity=function(ge){var me=this.getArea();this.mass=me*ge,this.updateMassProperties()},E.prototype.getArea=function(){for(var ge=0,me=0;me<this.shapes.length;me++)ge+=this.shapes[me].area;return ge},E.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var X=new U,V=R.create();E.prototype.updateAABB=function(){for(var ge=this.shapes,me=ge.length,be=V,_e=this.angle,ve=0;ve!==me;ve++){var Te=ge[ve],Ce=Te.angle+_e;R.rotate(be,Te.position,_e),R.add(be,be,this.position),Te.computeAABB(X,be,Ce),0===ve?this.aabb.copy(X):this.aabb.extend(X)}this.aabbNeedsUpdate=!1},E.prototype.updateBoundingRadius=function(){for(var ge=this.shapes,me=ge.length,be=0,_e=0;_e!==me;_e++){var ve=ge[_e],Te=R.length(ve.position),Ce=ve.boundingRadius;Te+Ce>be&&(be=Te+Ce)}this.boundingRadius=be},E.prototype.addShape=function(ge,me,be){if(ge.body)throw new Error("A shape can only be added to one body.");ge.body=this,me?R.copy(ge.position,me):R.set(ge.position,0,0),ge.angle=be||0,this.shapes.push(ge),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},E.prototype.removeShape=function(ge){var me=this.shapes.indexOf(ge);return-1!==me&&(this.shapes.splice(me,1),this.aabbNeedsUpdate=!0,ge.body=null,!0)},E.prototype.updateMassProperties=function(){if(this.type===E.STATIC||this.type===E.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var ge=this.shapes,me=ge.length,be=this.mass/me,_e=0;if(!this.fixedRotation){for(var ve=0;ve<me;ve++){var Te=ge[ve],Ce=R.squaredLength(Te.position),Pe=Te.computeMomentOfInertia(be);_e+=Pe+be*Ce}this.inertia=_e,this.invInertia=0<_e?1/_e:0}else this.inertia=Number.MAX_VALUE,this.invInertia=0;this.invMass=1/this.mass,R.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};R.create();E.prototype.applyForce=function(ge,me){if(R.add(this.force,this.force,ge),me){var be=R.crossLength(me,ge);this.angularForce+=be}};var Y=R.create(),z=R.create(),K=R.create();E.prototype.applyForceLocal=function(ge,me){me=me||K;var be=Y,_e=z;this.vectorToWorldFrame(be,ge),this.vectorToWorldFrame(_e,me),this.applyForce(be,_e)};var J=R.create();E.prototype.applyImpulse=function(ge,me){if(this.type===E.DYNAMIC){var be=J;if(R.scale(be,ge,this.invMass),R.multiply(be,this.massMultiplier,be),R.add(this.velocity,be,this.velocity),me){var _e=R.crossLength(me,ge);_e*=this.invInertia,this.angularVelocity+=_e}}};var Q=R.create(),Z=R.create(),$=R.create();E.prototype.applyImpulseLocal=function(ge,me){me=me||$;var be=Q,_e=Z;this.vectorToWorldFrame(be,ge),this.vectorToWorldFrame(_e,me),this.applyImpulse(be,_e)},E.prototype.toLocalFrame=function(ge,me){R.toLocalFrame(ge,me,this.position,this.angle)},E.prototype.toWorldFrame=function(ge,me){R.toGlobalFrame(ge,me,this.position,this.angle)},E.prototype.vectorToLocalFrame=function(ge,me){R.vectorToLocalFrame(ge,me,this.angle)},E.prototype.vectorToWorldFrame=function(ge,me){R.vectorToGlobalFrame(ge,me,this.angle)},E.prototype.fromPolygon=function(ge,me){me=me||{};for(var be=this.shapes.length;0<=be;--be)this.removeShape(this.shapes[be]);var _e=new L.Polygon;if(_e.vertices=ge,_e.makeCCW(),"number"==typeof me.removeCollinearPoints&&_e.removeCollinearPoints(me.removeCollinearPoints),"undefined"==typeof me.skipSimpleCheck&&!_e.isSimple())return!1;this.concavePath=_e.vertices.slice(0);for(var be=0,ve;be<this.concavePath.length;be++)ve=[0,0],R.copy(ve,this.concavePath[be]),this.concavePath[be]=ve;var Te=me.optimalDecomp?_e.decomp():_e.quickDecomp();for(var Ce=R.create(),be=0,Pe;be!==Te.length;be++){Pe=new D({vertices:Te[be].vertices});for(var Se=0,ve;Se!==Pe.vertices.length;Se++)ve=Pe.vertices[Se],R.sub(ve,ve,Pe.centerOfMass);R.scale(Ce,Pe.centerOfMass,1),Pe.updateTriangles(),Pe.updateCenterOfMass(),Pe.updateBoundingRadius(),this.addShape(Pe,Ce)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var ee=R.fromValues(0,0),te=R.fromValues(0,0),ae=R.fromValues(0,0),oe=R.fromValues(0,0);E.prototype.adjustCenterOfMass=function(){var ge=te,me=ae,be=oe,_e=0;R.set(me,0,0);for(var ve=0,Te;ve!==this.shapes.length;ve++)Te=this.shapes[ve],R.scale(ge,Te.position,Te.area),R.add(me,me,ge),_e+=Te.area;R.scale(be,me,1/_e);for(var ve=0,Te;ve!==this.shapes.length;ve++)Te=this.shapes[ve],R.sub(Te.position,Te.position,be);R.add(this.position,this.position,be);for(var ve=0;this.concavePath&&ve<this.concavePath.length;ve++)R.sub(this.concavePath[ve],this.concavePath[ve],be);this.updateMassProperties(),this.updateBoundingRadius()},E.prototype.setZeroForce=function(){R.set(this.force,0,0),this.angularForce=0},E.prototype.resetConstraintVelocity=function(){var ge=this,me=ge.vlambda;R.set(me,0,0),ge.wlambda=0},E.prototype.addConstraintVelocity=function(){var ge=this,me=ge.velocity;R.add(me,me,ge.vlambda),ge.angularVelocity+=ge.wlambda},E.prototype.applyDamping=function(ge){if(this.type===E.DYNAMIC){var me=this.velocity;R.scale(me,me,Math.pow(1-this.damping,ge)),this.angularVelocity*=Math.pow(1-this.angularDamping,ge)}},E.prototype.wakeUp=function(){var ge=this.sleepState;this.sleepState=E.AWAKE,this.idleTime=0,ge!==E.AWAKE&&this.emit(E.wakeUpEvent)},E.prototype.sleep=function(){this.sleepState=E.SLEEPING,this.angularVelocity=0,this.angularForce=0,R.set(this.velocity,0,0),R.set(this.force,0,0),this.emit(E.sleepEvent)},E.prototype.sleepTick=function(ge,me,be){if(this.allowSleep&&this.type!==E.SLEEPING){this.wantsToSleep=!1;var _e=this.sleepState,ve=R.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),Te=Math.pow(this.sleepSpeedLimit,2);ve>=Te?(this.idleTime=0,this.sleepState=E.AWAKE):(this.idleTime+=be,this.sleepState=E.SLEEPY),this.idleTime>this.sleepTimeLimit&&(me?this.wantsToSleep=!0:this.sleep())}},E.prototype.overlaps=function(ge){return this.world.overlapKeeper.bodiesAreOverlapping(this,ge)};var ne=R.create(),ie=R.create();E.prototype.integrate=function(ge){var me=this.invMass,be=this.force,_e=this.position,ve=this.velocity;R.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*ge),R.scale(ne,be,ge*me),R.multiply(ne,this.massMultiplier,ne),R.add(ve,ne,ve),this.integrateToTimeOfImpact(ge)||(R.scale(ie,ve,ge),R.add(_e,_e,ie),!this.fixedRotation&&(this.angle+=this.angularVelocity*ge)),this.aabbNeedsUpdate=!0};var se=new M,le=new O({mode:O.ALL}),de=R.create(),pe=R.create(),ue=R.create(),he=R.create();E.prototype.integrateToTimeOfImpact=function(ge){if(0>this.ccdSpeedThreshold||R.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;R.normalize(de,this.velocity),R.scale(pe,this.velocity,ge),R.add(pe,pe,this.position),R.sub(ue,pe,this.position);var me=this.angularVelocity*ge,be=R.length(ue),_e=1,Te=this,ve;if(se.reset(),le.callback=function(Re){Re.body===Te||(ve=Re.body,Re.getHitPoint(pe,le),R.sub(ue,pe,Te.position),_e=R.length(ue)/be,Re.stop())},R.copy(le.from,this.position),R.copy(le.to,pe),le.update(),this.world.raycast(se,le),!ve)return!1;var Ce=this.angle;R.copy(he,this.position);for(var Pe=0,Se=0,we=0,Ae=_e;Ae>=Se&&Pe<this.ccdIterations;){Pe++,we=(Ae-Se)/2,R.scale(ie,ue,_e),R.add(this.position,he,ie),this.angle=Ce+me*_e,this.updateAABB();var Ee=this.aabb.overlaps(ve.aabb)&&this.world.narrowphase.bodiesOverlap(this,ve);Ee?Se=we:Ae=we}return _e=we,R.copy(this.position,he),this.angle=Ce,R.scale(ie,ue,_e),R.add(this.position,this.position,ie),this.fixedRotation||(this.angle+=me*_e),!0},E.prototype.getVelocityAtPoint=function(ge,me){return R.crossVZ(ge,me,this.angularVelocity),R.subtract(ge,this.velocity,ge),ge},E.sleepyEvent={type:"sleepy"},E.sleepEvent={type:"sleep"},E.wakeUpEvent={type:"wakeup"},E.DYNAMIC=1,E.STATIC=2,E.KINEMATIC=4,E.AWAKE=0,E.SLEEPY=1,E.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(P,S){function E(K,J,Q){Q=Q||{},L.call(this,K,J,Q),this.localAnchorA=R.fromValues(0,0),this.localAnchorB=R.fromValues(0,0),Q.localAnchorA&&R.copy(this.localAnchorA,Q.localAnchorA),Q.localAnchorB&&R.copy(this.localAnchorB,Q.localAnchorB),Q.worldAnchorA&&this.setWorldAnchorA(Q.worldAnchorA),Q.worldAnchorB&&this.setWorldAnchorB(Q.worldAnchorB);var Z=R.create(),$=R.create();this.getWorldAnchorA(Z),this.getWorldAnchorB($);var ee=R.distance(Z,$);this.restLength="number"==typeof Q.restLength?Q.restLength:ee}var R=P("../math/vec2"),L=P("./Spring"),D=P("../utils/Utils");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.setWorldAnchorA=function(K){this.bodyA.toLocalFrame(this.localAnchorA,K)},E.prototype.setWorldAnchorB=function(K){this.bodyB.toLocalFrame(this.localAnchorB,K)},E.prototype.getWorldAnchorA=function(K){this.bodyA.toWorldFrame(K,this.localAnchorA)},E.prototype.getWorldAnchorB=function(K){this.bodyB.toWorldFrame(K,this.localAnchorB)};var M=R.create(),O=R.create(),U=R.create(),W=R.create(),X=R.create(),V=R.create(),H=R.create(),Y=R.create(),z=R.create();E.prototype.applyForce=function(){var K=this.stiffness,J=this.damping,Q=this.restLength,Z=this.bodyA,$=this.bodyB,ee=M,te=O,ae=U,oe=W,ne=z,ie=X,se=V,le=H,de=Y;this.getWorldAnchorA(ie),this.getWorldAnchorB(se),R.sub(le,ie,Z.position),R.sub(de,se,$.position),R.sub(ee,se,ie);var pe=R.len(ee);R.normalize(te,ee),R.sub(ae,$.velocity,Z.velocity),R.crossZV(ne,$.angularVelocity,de),R.add(ae,ae,ne),R.crossZV(ne,Z.angularVelocity,le),R.sub(ae,ae,ne),R.scale(oe,te,-K*(pe-Q)-J*R.dot(ae,te)),R.sub(Z.force,Z.force,oe),R.add($.force,$.force,oe);var ue=R.crossLength(le,oe),he=R.crossLength(de,oe);Z.angularForce-=ue,$.angularForce+=he}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(P,S){function E(D,M,O){O=O||{},L.call(this,D,M,O),this.restAngle="number"==typeof O.restAngle?O.restAngle:M.angle-D.angle}var R=P("../math/vec2"),L=P("./Spring");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.applyForce=function(){var D=this.stiffness,M=this.damping,O=this.restAngle,U=this.bodyA,W=this.bodyB,X=W.angle-U.angle,V=W.angularVelocity-U.angularVelocity,H=-D*(X-O)-0*(M*V);U.angularForce-=H,W.angularForce+=H}},{"../math/vec2":30,"./Spring":34}],34:[function(P,S){function E(D,M,O){O=L.defaults(O,{stiffness:100,damping:1}),this.stiffness=O.stiffness,this.damping=O.damping,this.bodyA=D,this.bodyB=M}var R=P("../math/vec2"),L=P("../utils/Utils");S.exports=E,E.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(P,S){function E(H,Y){Y=Y||{},this.chassisBody=H,this.wheels=[],this.groundBody=new U({mass:0}),this.world=null;var z=this;this.preStepCallback=function(){z.update()}}function R(H,Y){Y=Y||{},this.vehicle=H,this.forwardEquation=new O(H.chassisBody,H.groundBody),this.sideEquation=new O(H.chassisBody,H.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(Y.sideFriction===void 0?5:Y.sideFriction),this.localForwardVector=L.fromValues(0,1),Y.localForwardVector&&L.copy(this.localForwardVector,Y.localForwardVector),this.localPosition=L.fromValues(0,0),Y.localPosition&&L.copy(this.localPosition,Y.localPosition),M.apply(this,H.chassisBody,H.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var L=P("../math/vec2"),D=P("../utils/Utils"),M=P("../constraints/Constraint"),O=P("../equations/FrictionEquation"),U=P("../objects/Body");S.exports=E,E.prototype.addToWorld=function(H){this.world=H,H.addBody(this.groundBody),H.on("preStep",this.preStepCallback);for(var Y=0,z;Y<this.wheels.length;Y++)z=this.wheels[Y],H.addConstraint(z)},E.prototype.removeFromWorld=function(){var H=this.world;H.removeBody(this.groundBody),H.off("preStep",this.preStepCallback);for(var Y=0,z;Y<this.wheels.length;Y++)z=this.wheels[Y],H.removeConstraint(z);this.world=null},E.prototype.addWheel=function(H){var Y=new R(this,H);return this.wheels.push(Y),Y},E.prototype.update=function(){for(var H=0;H<this.wheels.length;H++)this.wheels[H].update()},R.prototype=new M,R.prototype.setBrakeForce=function(H){this.forwardEquation.setSlipForce(H)},R.prototype.setSideFriction=function(H){this.sideEquation.setSlipForce(H)};var W=L.create(),X=L.create();R.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(X,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(W,X),L.dot(W,X)};var V=L.create();R.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),L.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),L.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),L.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),L.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),L.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),L.normalize(V,this.forwardEquation.t),L.scale(V,V,this.engineForce),this.vehicle.chassisBody.applyForce(V,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(P,S){var E=S.exports={AABB:P("./collision/AABB"),AngleLockEquation:P("./equations/AngleLockEquation"),Body:P("./objects/Body"),Broadphase:P("./collision/Broadphase"),Capsule:P("./shapes/Capsule"),Circle:P("./shapes/Circle"),Constraint:P("./constraints/Constraint"),ContactEquation:P("./equations/ContactEquation"),ContactEquationPool:P("./utils/ContactEquationPool"),ContactMaterial:P("./material/ContactMaterial"),Convex:P("./shapes/Convex"),DistanceConstraint:P("./constraints/DistanceConstraint"),Equation:P("./equations/Equation"),EventEmitter:P("./events/EventEmitter"),FrictionEquation:P("./equations/FrictionEquation"),FrictionEquationPool:P("./utils/FrictionEquationPool"),GearConstraint:P("./constraints/GearConstraint"),GSSolver:P("./solver/GSSolver"),Heightfield:P("./shapes/Heightfield"),Line:P("./shapes/Line"),LockConstraint:P("./constraints/LockConstraint"),Material:P("./material/Material"),Narrowphase:P("./collision/Narrowphase"),NaiveBroadphase:P("./collision/NaiveBroadphase"),Particle:P("./shapes/Particle"),Plane:P("./shapes/Plane"),Pool:P("./utils/Pool"),RevoluteConstraint:P("./constraints/RevoluteConstraint"),PrismaticConstraint:P("./constraints/PrismaticConstraint"),Ray:P("./collision/Ray"),RaycastResult:P("./collision/RaycastResult"),Box:P("./shapes/Box"),RotationalVelocityEquation:P("./equations/RotationalVelocityEquation"),SAPBroadphase:P("./collision/SAPBroadphase"),Shape:P("./shapes/Shape"),Solver:P("./solver/Solver"),Spring:P("./objects/Spring"),TopDownVehicle:P("./objects/TopDownVehicle"),LinearSpring:P("./objects/LinearSpring"),RotationalSpring:P("./objects/RotationalSpring"),Utils:P("./utils/Utils"),World:P("./world/World"),vec2:P("./math/vec2"),version:P("../package.json").version};Object.defineProperty(E,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(P,S){function E(X){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(X={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),X=X||{};var V=this.width=X.width||1,H=this.height=X.height||1,Y=[R.fromValues(-V/2,-H/2),R.fromValues(V/2,-H/2),R.fromValues(V/2,H/2),R.fromValues(-V/2,H/2)],z=[R.fromValues(1,0),R.fromValues(0,1)];X.vertices=Y,X.axes=z,X.type=L.BOX,D.call(this,X)}var R=P("../math/vec2"),L=P("./Shape"),D=P("./Convex");S.exports=E,E.prototype=new D,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(X){var V=this.width,H=this.height;return X*(H*H+V*V)/12},E.prototype.updateBoundingRadius=function(){var X=this.width,V=this.height;this.boundingRadius=Math.sqrt(X*X+V*V)/2};var M=R.create(),O=R.create(),U=R.create(),W=R.create();E.prototype.computeAABB=function(X,V,H){X.setFromPoints(this.vertices,V,H,0)},E.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(P,S){function E(V){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(V={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),V=V||{},this.length=V.length||1,this.radius=V.radius||1,V.type=R.CAPSULE,R.call(this,V)}var R=P("./Shape"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(V){var H=this.radius,Y=this.length+H,z=2*H;return V*(z*z+Y*Y)/12},E.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},E.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var D=L.create();E.prototype.computeAABB=function(V,H,Y){var z=this.radius;L.set(D,this.length/2,0),0!==Y&&L.rotate(D,D,Y),L.set(V.upperBound,Math.max(D[0]+z,-D[0]+z),Math.max(D[1]+z,-D[1]+z)),L.set(V.lowerBound,Math.min(D[0]-z,-D[0]-z),Math.min(D[1]-z,-D[1]-z)),L.add(V.lowerBound,V.lowerBound,H),L.add(V.upperBound,V.upperBound,H)};var M=L.create(),O=L.create(),U=L.create(),W=L.create(),X=L.fromValues(0,1);E.prototype.raycast=function(V,H,Y,z){for(var K=H.from,J=H.to,Q=H.direction,Z=M,$=O,ee=U,te=W,ae=this.length/2,oe=0,ne;2>oe;oe++){ne=this.radius*(2*oe-1),L.set(ee,-ae,ne),L.set(te,ae,ne),L.toGlobalFrame(ee,ee,Y,z),L.toGlobalFrame(te,te,Y,z);var ie=L.getLineSegmentsIntersectionFraction(K,J,ee,te);if(0<=ie&&(L.rotate($,X,z),L.scale($,$,2*oe-1),H.reportIntersection(V,ie,$,-1),V.shouldStop(H)))return}for(var se=Math.pow(this.radius,2)+Math.pow(ae,2),oe=0;2>oe;oe++){L.set(ee,ae*(2*oe-1),0),L.toGlobalFrame(ee,ee,Y,z);var le=Math.pow(J[0]-K[0],2)+Math.pow(J[1]-K[1],2),de=2*((J[0]-K[0])*(K[0]-ee[0])+(J[1]-K[1])*(K[1]-ee[1])),pe=Math.pow(K[0]-ee[0],2)+Math.pow(K[1]-ee[1],2)-Math.pow(this.radius,2),ie=Math.pow(de,2)-4*le*pe;if(0>ie)continue;else if(0!==ie){var ue=Math.sqrt(ie),he=1/(2*le),ge=(-de-ue)*he,me=(-de+ue)*he;if(0<=ge&&1>=ge&&(L.lerp(Z,K,J,ge),L.squaredDistance(Z,Y)>se&&(L.sub($,Z,ee),L.normalize($,$),H.reportIntersection(V,ge,$,-1),V.shouldStop(H))))return;if(0<=me&&1>=me&&(L.lerp(Z,K,J,me),L.squaredDistance(Z,Y)>se&&(L.sub($,Z,ee),L.normalize($,$),H.reportIntersection(V,me,$,-1),V.shouldStop(H))))return}else if(L.lerp(Z,K,J,ie),L.squaredDistance(Z,Y)>se&&(L.sub($,Z,ee),L.normalize($,$),H.reportIntersection(V,ie,$,-1),V.shouldStop(H)))return}}},{"../math/vec2":30,"./Shape":45}],39:[function(P,S){function E(O){"number"==typeof arguments[0]&&(O={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),O=O||{},this.radius=O.radius||1,O.type=R.CIRCLE,R.call(this,O)}var R=P("./Shape"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(O){var U=this.radius;return O*U*U/2},E.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},E.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},E.prototype.computeAABB=function(O,U){var X=this.radius;L.set(O.upperBound,X,X),L.set(O.lowerBound,-X,-X),U&&(L.add(O.lowerBound,O.lowerBound,U),L.add(O.upperBound,O.upperBound,U))};var D=L.create(),M=L.create();E.prototype.raycast=function(O,U,W){var V=U.from,H=U.to,Y=this.radius,z=Math.pow(H[0]-V[0],2)+Math.pow(H[1]-V[1],2),K=2*((H[0]-V[0])*(V[0]-W[0])+(H[1]-V[1])*(V[1]-W[1])),J=Math.pow(V[0]-W[0],2)+Math.pow(V[1]-W[1],2)-Math.pow(Y,2),Q=Math.pow(K,2)-4*z*J,Z=D,$=M;if(!(0>Q))if(0==Q)L.lerp(Z,V,H,Q),L.sub($,Z,W),L.normalize($,$),U.reportIntersection(O,Q,$,-1);else{var ee=Math.sqrt(Q),te=1/(2*z),ae=(-K-ee)*te,oe=(-K+ee)*te;if(0<=ae&&1>=ae&&(L.lerp(Z,V,H,ae),L.sub($,Z,W),L.normalize($,$),U.reportIntersection(O,ae,$,-1),O.shouldStop(U)))return;0<=oe&&1>=oe&&(L.lerp(Z,V,H,oe),L.sub($,Z,W),L.normalize($,$),U.reportIntersection(O,oe,$,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(P,S){function E(te){Array.isArray(arguments[0])&&(te={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),te=te||{},this.vertices=[];for(var ae=void 0===te.vertices?[]:te.vertices,oe=0,ne;oe<ae.length;oe++)ne=L.create(),L.copy(ne,ae[oe]),this.vertices.push(ne);if(this.axes=[],te.axes)for(var oe=0,ie;oe<te.axes.length;oe++)ie=L.create(),L.copy(ie,te.axes[oe]),this.axes.push(ie);else for(var oe=0;oe<this.vertices.length;oe++){var se=this.vertices[oe],le=this.vertices[(oe+1)%this.vertices.length],de=L.create();L.sub(de,le,se),L.rotate90cw(de,de),L.normalize(de,de),this.axes.push(de)}if(this.centerOfMass=L.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,te.type=R.CONVEX,R.call(this,te),this.updateBoundingRadius(),this.updateArea(),0>this.area)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var R=P("./Shape"),L=P("../math/vec2"),D=P("../math/polyk"),M=P("poly-decomp");S.exports=E,E.prototype=new R,E.prototype.constructor=E;var O=L.create(),U=L.create();E.prototype.projectOntoLocalAxis=function(te,ae){for(var oe=null,ne=null,le=0,ie,se;le<this.vertices.length;le++)ie=this.vertices[le],se=L.dot(ie,O),(null==oe||se>oe)&&(oe=se),(null==ne||se<ne)&&(ne=se);if(ne>oe){var de=ne;ne=oe,oe=de}L.set(ae,ne,oe)},E.prototype.projectOntoWorldAxis=function(te,ae,oe,ne){var ie=U;this.projectOntoLocalAxis(te,ne),0===oe?ie=te:L.rotate(ie,te,oe);var se=L.dot(ae,ie);L.set(ne,ne[0]+se,ne[1]+se)},E.prototype.updateTriangles=function(){this.triangles.length=0;for(var te=[],ae=0,oe;ae<this.vertices.length;ae++)oe=this.vertices[ae],te.push(oe[0],oe[1]);for(var ne=D.Triangulate(te),ae=0;ae<ne.length;ae+=3){var ie=ne[ae],se=ne[ae+1],le=ne[ae+2];this.triangles.push([ie,se,le])}};var W=L.create(),X=L.create(),V=L.create(),H=L.create(),Y=L.create(),z=L.create(),K=L.create(),J=L.create(),Q=L.create();E.prototype.updateCenterOfMass=function(){var te=this.triangles,ae=this.vertices,oe=this.centerOfMass,ne=W,se=V,le=H,de=Y,ge=X;L.set(oe,0,0);for(var me=0,be=0;be!==te.length;be++){var _e=te[be],se=ae[_e[0]],le=ae[_e[1]],de=ae[_e[2]];L.centroid(ne,se,le,de);var ve=E.triangleArea(se,le,de);me+=ve,L.scale(ge,ne,ve),L.add(oe,oe,ge)}L.scale(oe,oe,1/me)},E.prototype.computeMomentOfInertia=function(te){for(var ae=0,oe=0,ne=this.vertices.length,ie=ne-1,se=0;se<ne;ie=se,se++){var le=this.vertices[ie],de=this.vertices[se],pe=Math.abs(L.crossLength(le,de)),ue=L.dot(de,de)+L.dot(de,le)+L.dot(le,le);ae+=pe*ue,oe+=pe}return te/6*(ae/oe)},E.prototype.updateBoundingRadius=function(){for(var te=this.vertices,ae=0,oe=0,ne;oe!==te.length;oe++)ne=L.squaredLength(te[oe]),ne>ae&&(ae=ne);this.boundingRadius=Math.sqrt(ae)},E.triangleArea=function(te,ae,oe){return 0.5*((ae[0]-te[0])*(oe[1]-te[1])-(oe[0]-te[0])*(ae[1]-te[1]))},E.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var te=this.triangles,ae=this.vertices,oe=0;oe!==te.length;oe++){var ne=te[oe],ie=ae[ne[0]],se=ae[ne[1]],le=ae[ne[2]],de=E.triangleArea(ie,se,le);this.area+=de}},E.prototype.computeAABB=function(te,ae,oe){te.setFromPoints(this.vertices,ae,oe,0)};var Z=L.create(),$=L.create(),ee=L.create();E.prototype.raycast=function(te,ae,oe,ne){var ie=Z,se=$,le=ee,de=this.vertices;L.toLocalFrame(ie,ae.from,oe,ne),L.toLocalFrame(se,ae.to,oe,ne);for(var pe=de.length,ue=0;ue<pe&&!te.shouldStop(ae);ue++){var he=de[ue],ge=de[(ue+1)%pe],me=L.getLineSegmentsIntersectionFraction(ie,se,he,ge);0<=me&&(L.sub(le,ge,he),L.rotate(le,le,-Math.PI/2+ne),L.normalize(le,le),ae.reportIntersection(te,me,le,ue))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(P,S){function E(K){if(Array.isArray(arguments[0])){if(K={heights:arguments[0]},"object"==typeof arguments[1])for(var J in arguments[1])K[J]=arguments[1][J];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}K=K||{},this.heights=K.heights?K.heights.slice(0):[],this.maxValue=K.maxValue||null,this.minValue=K.minValue||null,this.elementWidth=K.elementWidth||0.1,(K.maxValue===void 0||K.minValue===void 0)&&this.updateMaxMinValues(),K.type=L.HEIGHTFIELD,L.call(this,K)}var L=P("./Shape"),D=P("../math/vec2"),M=P("../utils/Utils");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.updateMaxMinValues=function(){for(var K=this.heights,J=K[0],Q=K[0],Z=0,$;Z!==K.length;Z++)$=K[Z],$>J&&(J=$),$<Q&&(Q=$);this.maxValue=J,this.minValue=Q},E.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},E.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},E.prototype.updateArea=function(){for(var K=this.heights,J=0,Q=0;Q<K.length-1;Q++)J+=(K[Q]+K[Q+1])/2*this.elementWidth;this.area=J};var O=[D.create(),D.create(),D.create(),D.create()];E.prototype.computeAABB=function(K,J,Q){D.set(O[0],0,this.maxValue),D.set(O[1],this.elementWidth*this.heights.length,this.maxValue),D.set(O[2],this.elementWidth*this.heights.length,this.minValue),D.set(O[3],0,this.minValue),K.setFromPoints(O,J,Q)},E.prototype.getLineSegment=function(K,J,Q){var Z=this.heights,$=this.elementWidth;D.set(K,Q*$,Z[Q]),D.set(J,(Q+1)*$,Z[Q+1])},E.prototype.getSegmentIndex=function(K){return Math.floor(K[0]/this.elementWidth)},E.prototype.getClampedSegmentIndex=function(K){var J=this.getSegmentIndex(K);return J=Math.min(this.heights.length,Math.max(J,0)),J};var U=D.create(),W=D.create(),X=D.create(),V=D.create(),H=D.create(),Y=D.create(),z=D.fromValues(0,1);E.prototype.raycast=function(K,J,Q,Z){var $=J.from,ee=J.to,te=J.direction,oe=W,ne=X,ie=V,se=H,le=Y;D.toLocalFrame(se,$,Q,Z),D.toLocalFrame(le,ee,Q,Z);var de=this.getClampedSegmentIndex(se),pe=this.getClampedSegmentIndex(le);if(de>pe){var ue=de;de=pe,pe=ue}for(var he=0;he<this.heights.length-1;he++){this.getLineSegment(ne,ie,he);var ge=D.getLineSegmentsIntersectionFraction(se,le,ne,ie);if(0<=ge&&(D.sub(oe,ie,ne),D.rotate(oe,oe,Z+Math.PI/2),D.normalize(oe,oe),J.reportIntersection(K,ge,oe,-1),K.shouldStop(J)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(P,S){function E(V){"number"==typeof arguments[0]&&(V={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),V=V||{},this.length=V.length||1,V.type=R.LINE,R.call(this,V)}var R=P("./Shape"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(V){return V*Math.pow(this.length,2)/12},E.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var D=[L.create(),L.create()];E.prototype.computeAABB=function(V,H,Y){var z=this.length/2;L.set(D[0],-z,0),L.set(D[1],z,0),V.setFromPoints(D,H,Y,0)};var M=L.create(),O=L.create(),U=L.create(),W=L.create(),X=L.fromValues(0,1);E.prototype.raycast=function(V,H,Y,z){var K=H.from,J=H.to,Q=U,Z=W,$=this.length/2;L.set(Q,-$,0),L.set(Z,$,0),L.toGlobalFrame(Q,Q,Y,z),L.toGlobalFrame(Z,Z,Y,z);var ee=L.getLineSegmentsIntersectionFraction(Q,Z,K,J);if(0<=ee){var te=O;L.rotate(te,X,z),H.reportIntersection(V,ee,te,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(P,S){function E(D){D=D||{},D.type=R.PARTICLE,R.call(this,D)}var R=P("./Shape"),L=P("../math/vec2");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(){return 0},E.prototype.updateBoundingRadius=function(){this.boundingRadius=0},E.prototype.computeAABB=function(D,M){L.copy(D.lowerBound,M),L.copy(D.upperBound,M)}},{"../math/vec2":30,"./Shape":45}],44:[function(P,S){function E(V){V=V||{},V.type=R.PLANE,R.call(this,V)}var R=P("./Shape"),L=P("../math/vec2"),D=P("../utils/Utils");S.exports=E,E.prototype=new R,E.prototype.constructor=E,E.prototype.computeMomentOfInertia=function(){return 0},E.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},E.prototype.computeAABB=function(V,H,Y){var z=Y%(2*Math.PI),K=L.set,J=1e7,Q=V.lowerBound,Z=V.upperBound;K(Q,-J,-J),K(Z,J,J),0==z?Z[1]=0:z==Math.PI/2?Q[0]=0:z===Math.PI?Q[1]=0:z==3*Math.PI/2&&(Z[0]=0)},E.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var M=L.create(),O=L.create(),U=L.create(),W=L.create(),X=L.create();E.prototype.raycast=function(V,H,Y,z){var K=H.from,J=H.to,Q=H.direction,Z=M,te=W,ae=X;L.set(te,0,1),L.rotate(te,te,z),L.sub(ae,K,Y);var oe=L.dot(ae,te);L.sub(ae,J,Y);var ne=L.dot(ae,te);if(!(0<oe*ne)&&!(L.squaredDistance(K,J)<oe*oe)){var ie=L.dot(te,Q);L.sub(Z,K,Y);var se=-L.dot(te,Z)/ie/H.length;H.reportIntersection(V,se,te,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(P,S){function E(L){L=L||{},this.body=null,this.position=R.fromValues(0,0),L.position&&R.copy(this.position,L.position),this.angle=L.angle||0,this.type=L.type||0,this.id=E.idCounter++,this.boundingRadius=0,this.collisionGroup=L.collisionGroup===void 0?1:L.collisionGroup,this.collisionResponse=!(L.collisionResponse!==void 0)||L.collisionResponse,this.collisionMask=L.collisionMask===void 0?1:L.collisionMask,this.material=L.material||null,this.area=0,this.sensor=L.sensor!==void 0&&L.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}S.exports=E;var R=P("../math/vec2");E.idCounter=0,E.CIRCLE=1,E.PARTICLE=2,E.PLANE=4,E.CONVEX=8,E.LINE=16,E.BOX=32,Object.defineProperty(E,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),E.BOX}}),E.CAPSULE=64,E.HEIGHTFIELD=128,E.prototype.computeMomentOfInertia=function(){},E.prototype.updateBoundingRadius=function(){},E.prototype.updateArea=function(){},E.prototype.computeAABB=function(){},E.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(P,S){function E(U){D.call(this,U,D.GS),U=U||{},this.iterations=U.iterations||10,this.tolerance=U.tolerance||1e-7,this.arrayStep=30,this.lambda=new M.ARRAY_TYPE(this.arrayStep),this.Bs=new M.ARRAY_TYPE(this.arrayStep),this.invCs=new M.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=U.frictionIterations===void 0?U.frictionIterations:0,this.usedIterations=0}function R(U){for(var W=U.length;W--;)U[W]=0}var L=P("../math/vec2"),D=P("./Solver"),M=P("../utils/Utils"),O=P("../equations/FrictionEquation");S.exports=E,E.prototype=new D,E.prototype.constructor=E,E.prototype.solve=function(U,W){this.sortEquations();var X=0,V=this.iterations,H=this.frictionIterations,Y=this.equations,z=Y.length,K=Math.pow(this.tolerance*z,2),J=W.bodies,Q=W.bodies.length,Z=L.add,$=L.set,ee=this.useZeroRHS,te=this.lambda;if(this.usedIterations=0,z)for(var ae=0,oe;ae!==Q;ae++)oe=J[ae],oe.updateSolveMassProperties();te.length<z&&(te=this.lambda=new M.ARRAY_TYPE(z+this.arrayStep),this.Bs=new M.ARRAY_TYPE(z+this.arrayStep),this.invCs=new M.ARRAY_TYPE(z+this.arrayStep)),R(te);for(var ne=this.invCs,ie=this.Bs,te=this.lambda,ae=0,se;ae!==Y.length;ae++)se=Y[ae],(se.timeStep!==U||se.needsUpdate)&&(se.timeStep=U,se.update()),ie[ae]=se.computeB(se.a,se.b,U),ne[ae]=se.computeInvC(se.epsilon);var se,pe,ae,ue;if(0!==z){for(ae=0;ae!==Q;ae++){var oe=J[ae];oe.resetConstraintVelocity()}if(H){for(X=0;X!==H;X++){for(pe=0,ue=0;ue!==z;ue++){se=Y[ue];var he=E.iterateEquation(ue,se,se.epsilon,ie,ne,te,ee,U,X);pe+=Math.abs(he)}if(this.usedIterations++,pe*pe<=K)break}for(E.updateMultipliers(Y,te,1/U),ue=0;ue!==z;ue++){var ge=Y[ue];if(ge instanceof O){for(var me=0,be=0;be!==ge.contactEquations.length;be++)me+=ge.contactEquations[be].multiplier;me*=ge.frictionCoefficient/ge.contactEquations.length,ge.maxForce=me,ge.minForce=-me}}}for(X=0;X!==V;X++){for(pe=0,ue=0;ue!==z;ue++){se=Y[ue];var he=E.iterateEquation(ue,se,se.epsilon,ie,ne,te,ee,U,X);pe+=Math.abs(he)}if(this.usedIterations++,pe*pe<=K)break}for(ae=0;ae!==Q;ae++)J[ae].addConstraintVelocity();E.updateMultipliers(Y,te,1/U)}},E.updateMultipliers=function(U,W,X){for(var V=U.length;V--;)U[V].multiplier=W[V]*X},E.iterateEquation=function(U,W,X,V,H,Y,z,K){var Q=V[U],Z=H[U],$=Y[U],ee=W.computeGWlambda(),te=W.maxForce,ae=W.minForce;z&&(Q=0);var oe=Z*(Q-ee-X*$),ne=$+oe;return ne<ae*K?oe=ae*K-$:ne>te*K&&(oe=te*K-$),Y[U]+=oe,W.addToWlambda(oe),oe}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(P,S){function E(M,O){M=M||{},L.call(this),this.type=O,this.equations=[],this.equationSortFunction=M.equationSortFunction||!1}var R=P("../utils/Utils"),L=P("../events/EventEmitter");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var D={bodies:[]};E.prototype.solveIsland=function(M,O){this.removeAllEquations(),O.equations.length&&(this.addEquations(O.equations),D.bodies.length=0,O.getBodies(D.bodies),D.bodies.length&&this.solve(M,D))},E.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},E.prototype.addEquation=function(M){M.enabled&&this.equations.push(M)},E.prototype.addEquations=function(M){for(var O=0,U=M.length,W;O!==U;O++)W=M[O],W.enabled&&this.equations.push(W)},E.prototype.removeEquation=function(M){var O=this.equations.indexOf(M);-1!==O&&this.equations.splice(O,1)},E.prototype.removeAllEquations=function(){this.equations.length=0},E.GS=1,E.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(P,S){function E(){L.apply(this,arguments)}var R=P("../equations/ContactEquation"),L=P("./Pool");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.create=function(){return new R},E.prototype.destroy=function(D){return D.bodyA=D.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(P,S){function E(){L.apply(this,arguments)}var R=P("../equations/FrictionEquation"),L=P("./Pool");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.create=function(){return new R},E.prototype.destroy=function(D){return D.bodyA=D.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(P,S){function E(){L.apply(this,arguments)}var R=P("../world/IslandNode"),L=P("./Pool");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.create=function(){return new R},E.prototype.destroy=function(D){return D.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(P,S){function E(){L.apply(this,arguments)}var R=P("../world/Island"),L=P("./Pool");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.create=function(){return new R},E.prototype.destroy=function(D){return D.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(P,S){function E(){this.overlappingShapesLastState=new R,this.overlappingShapesCurrentState=new R,this.recordPool=new D({size:16}),this.tmpDict=new R,this.tmpArray1=[]}var R=P("./TupleDictionary"),L=P("./OverlapKeeperRecord"),D=P("./OverlapKeeperRecordPool"),M=P("./Utils");S.exports=E,E.prototype.tick=function(){for(var O=this.overlappingShapesLastState,U=this.overlappingShapesCurrentState,W=O.keys.length;W--;){var X=O.keys[W],V=O.getByKey(X),H=U.getByKey(X);V&&this.recordPool.release(V)}O.reset(),O.copy(U),U.reset()},E.prototype.setOverlapping=function(O,U,W,X){var V=this.overlappingShapesLastState,H=this.overlappingShapesCurrentState;if(!H.get(U.id,X.id)){var Y=this.recordPool.get();Y.set(O,U,W,X),H.set(U.id,X.id,Y)}},E.prototype.getNewOverlaps=function(O){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,O)},E.prototype.getEndOverlaps=function(O){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,O)},E.prototype.bodiesAreOverlapping=function(O,U){for(var W=this.overlappingShapesCurrentState,X=W.keys.length;X--;){var V=W.keys[X],H=W.data[V];if(H.bodyA===O&&H.bodyB===U||H.bodyA===U&&H.bodyB===O)return!0}return!1},E.prototype.getDiff=function(O,U,W){var W=W||[],V=U;W.length=0;for(var H=V.keys.length;H--;){var Y=V.keys[H],z=V.data[Y];if(!z)throw new Error("Key "+Y+" had no data!");var K=O.data[Y];K||W.push(z)}return W},E.prototype.isNewOverlap=function(O,U){var W=0|O.id,X=0|U.id,V=this.overlappingShapesLastState,H=this.overlappingShapesCurrentState;return!!!V.get(W,X)&&!!H.get(W,X)},E.prototype.getNewBodyOverlaps=function(O){this.tmpArray1.length=0;var U=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(U,O)},E.prototype.getEndBodyOverlaps=function(O){this.tmpArray1.length=0;var U=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(U,O)},E.prototype.getBodyDiff=function(O,U){U=U||[];for(var W=this.tmpDict,X=O.length,V;X--;)V=O[X],W.set(0|V.bodyA.id,0|V.bodyB.id,V);for(X=W.keys.length;X--;){var V=W.getByKey(W.keys[X]);V&&U.push(V.bodyA,V.bodyB)}return W.reset(),U}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(P,S){function E(R,L,D,M){this.shapeA=L,this.shapeB=M,this.bodyA=R,this.bodyB=D}S.exports=E,E.prototype.set=function(R,L,D,M){E.call(this,R,L,D,M)}},{}],54:[function(P,S){function E(){L.apply(this,arguments)}var R=P("./OverlapKeeperRecord"),L=P("./Pool");S.exports=E,E.prototype=new L,E.prototype.constructor=E,E.prototype.create=function(){return new R},E.prototype.destroy=function(D){return D.bodyA=D.bodyB=D.shapeA=D.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(P,S){function E(R){R=R||{},this.objects=[],R.size!==void 0&&this.resize(R.size)}S.exports=E,E.prototype.resize=function(R){for(var L=this.objects;L.length>R;)L.pop();for(;L.length<R;)L.push(this.create());return this},E.prototype.get=function(){var R=this.objects;return R.length?R.pop():this.create()},E.prototype.release=function(R){return this.destroy(R),this.objects.push(R),this}},{}],56:[function(P,S){function E(){this.data={},this.keys=[]}var R=P("./Utils");S.exports=E,E.prototype.getKey=function(L,D){return L|=0,D|=0,(0|L)==(0|D)?-1:0|((0|L)>(0|D)?L<<16|65535&D:D<<16|65535&L)},E.prototype.getByKey=function(L){return L|=0,this.data[L]},E.prototype.get=function(L,D){return this.data[this.getKey(L,D)]},E.prototype.set=function(L,D,M){if(!M)throw new Error("No data!");var O=this.getKey(L,D);return this.data[O]||this.keys.push(O),this.data[O]=M,O},E.prototype.reset=function(){for(var L=this.data,D=this.keys,M=D.length;M--;)delete L[D[M]];D.length=0},E.prototype.copy=function(L){this.reset(),R.appendArray(this.keys,L.keys);for(var D=L.keys.length,M;D--;)M=L.keys[D],this.data[M]=L.data[M]}},{"./Utils":57}],57:[function(P,S){function E(){}S.exports=E,E.appendArray=function(R,L){if(1.5e5>L.length)R.push.apply(R,L);else for(var D=0,M=L.length;D!==M;++D)R.push(L[D])},E.splice=function(R,L,D){D=D||1;for(var M=L,O=R.length-D;M<O;M++)R[M]=R[M+D];R.length=O},E.ARRAY_TYPE="undefined"==typeof P2_ARRAY_TYPE?"undefined"==typeof Float32Array?Array:Float32Array:P2_ARRAY_TYPE,E.extend=function(R,L){for(var D in L)R[D]=L[D]},E.defaults=function(R,L){for(var D in R=R||{},L)D in R||(R[D]=L[D]);return R}},{}],58:[function(P,S){function E(){this.equations=[],this.bodies=[]}var R=P("../objects/Body");S.exports=E,E.prototype.reset=function(){this.equations.length=this.bodies.length=0};var L=[];E.prototype.getBodies=function(D){var M=D||[],O=this.equations;L.length=0;for(var U=0,W;U!==O.length;U++)W=O[U],-1===L.indexOf(W.bodyA.id)&&(M.push(W.bodyA),L.push(W.bodyA.id)),-1===L.indexOf(W.bodyB.id)&&(M.push(W.bodyB),L.push(W.bodyB.id));return M},E.prototype.wantsToSleep=function(){for(var D=0,M;D<this.bodies.length;D++)if(M=this.bodies[D],M.type===R.DYNAMIC&&!M.wantsToSleep)return!1;return!0},E.prototype.sleep=function(){for(var D=0,M;D<this.bodies.length;D++)M=this.bodies[D],M.sleep();return!0}},{"../objects/Body":31}],59:[function(P,S){function E(){this.nodePool=new M({size:16}),this.islandPool=new O({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var R=P("../math/vec2"),L=P("./Island"),D=P("./IslandNode"),M=P("./../utils/IslandNodePool"),O=P("./../utils/IslandPool"),U=P("../objects/Body");S.exports=E,E.getUnvisitedNode=function(W){for(var X=W.length,V=0,H;V!==X;V++)if(H=W[V],!H.visited&&H.body.type===U.DYNAMIC)return H;return!1},E.prototype.visit=function(W,X,V){X.push(W.body);for(var H=W.equations.length,Y=0,z;Y!==H;Y++)z=W.equations[Y],-1===V.indexOf(z)&&V.push(z)},E.prototype.bfs=function(W,X,V){var H=this.queue;for(H.length=0,H.push(W),W.visited=!0,this.visit(W,X,V);H.length;)for(var Y=H.pop(),z;z=E.getUnvisitedNode(Y.neighbors);)z.visited=!0,this.visit(z,X,V),z.body.type===U.DYNAMIC&&H.push(z)},E.prototype.split=function(W){for(var X=W.bodies,V=this.nodes,H=this.equations;V.length;)this.nodePool.release(V.pop());for(var Y=0,z;Y!==X.length;Y++)z=this.nodePool.get(),z.body=X[Y],V.push(z);for(var K=0;K!==H.length;K++){var J=H[K],Y=X.indexOf(J.bodyA),Q=X.indexOf(J.bodyB),Z=V[Y],$=V[Q];Z.neighbors.push($),$.neighbors.push(Z),Z.equations.push(J),$.equations.push(J)}for(var ee=this.islands,Y=0;Y<ee.length;Y++)this.islandPool.release(ee[Y]);ee.length=0;for(var te,ae;te=E.getUnvisitedNode(V);)ae=this.islandPool.get(),this.bfs(te,ae.bodies,ae.equations),ee.push(ae);return ee}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(P,S){function E(R){this.body=R,this.neighbors=[],this.equations=[],this.visited=!1}S.exports=E,E.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(P,S){function E(Me){Y.apply(this),Me=Me||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=Me.solver||new R,this.narrowphase=new pe(this),this.islandManager=new ge,this.gravity=M.fromValues(0,-9.78),Me.gravity&&M.copy(this.gravity,Me.gravity),this.frictionGravity=M.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=Me.broadphase||new de,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new Q,this.defaultContactMaterial=new Z(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=!("undefined"!=typeof Me.islandSplit)||!!Me.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=E.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new he}var R=P("../solver/GSSolver"),L=P("../solver/Solver"),D=P("../collision/Ray"),M=P("../math/vec2"),O=P("../shapes/Circle"),U=P("../shapes/Convex"),W=P("../shapes/Line"),X=P("../shapes/Plane"),V=P("../shapes/Capsule"),H=P("../shapes/Particle"),Y=P("../events/EventEmitter"),z=P("../objects/Body"),K=P("../shapes/Shape"),J=P("../objects/LinearSpring"),Q=P("../material/Material"),Z=P("../material/ContactMaterial"),$=P("../constraints/DistanceConstraint"),ee=P("../constraints/Constraint"),te=P("../constraints/LockConstraint"),ae=P("../constraints/RevoluteConstraint"),oe=P("../constraints/PrismaticConstraint"),ne=P("../constraints/GearConstraint"),ie=P("../../package.json"),se=P("../collision/Broadphase"),le=P("../collision/AABB"),de=P("../collision/SAPBroadphase"),pe=P("../collision/Narrowphase"),ue=P("../utils/Utils"),he=P("../utils/OverlapKeeper"),ge=P("./IslandManager"),me=P("../objects/RotationalSpring");S.exports=E,E.prototype=Object(Y.prototype),E.prototype.constructor=E,E.NO_SLEEPING=1,E.BODY_SLEEPING=2,E.ISLAND_SLEEPING=4,E.prototype.addConstraint=function(Me){this.constraints.push(Me)},E.prototype.addContactMaterial=function(Me){this.contactMaterials.push(Me)},E.prototype.removeContactMaterial=function(Me){var Oe=this.contactMaterials.indexOf(Me);-1!==Oe&&ue.splice(this.contactMaterials,Oe,1)},E.prototype.getContactMaterial=function(Me,Oe){for(var Ue=this.contactMaterials,Ge=0,Ne=Ue.length,We;Ge!==Ne;Ge++)if(We=Ue[Ge],We.materialA.id===Me.id&&We.materialB.id===Oe.id||We.materialA.id===Oe.id&&We.materialB.id===Me.id)return We;return!1},E.prototype.removeConstraint=function(Me){var Oe=this.constraints.indexOf(Me);-1!==Oe&&ue.splice(this.constraints,Oe,1)};var be=M.create(),_e=M.create(),ve=M.create(),Te=M.create(),Ce=M.create(),Pe=M.create(),Se=M.create(),we=M.fromValues(0,0),Ae=M.fromValues(0,0),Ee=M.fromValues(0,0),Re=M.fromValues(0,0);E.prototype.step=function(Me,Oe,Ue){if(Ue=Ue||10,Oe=Oe||0,0===Oe)this.internalStep(Me),this.time+=Me;else{this.accumulator+=Oe;for(var Ge=0;this.accumulator>=Me&&Ge<Ue;)this.internalStep(Me),this.time+=Me,this.accumulator-=Me,Ge++;for(var Ne=this.accumulator%Me/Me,We=0,Xe;We!==this.bodies.length;We++)Xe=this.bodies[We],M.lerp(Xe.interpolatedPosition,Xe.previousPosition,Xe.position,Ne),Xe.interpolatedAngle=Xe.previousAngle+Ne*(Xe.angle-Xe.previousAngle)}};var Le=[];E.prototype.internalStep=function(Me){this.stepping=!0;var Oe=this,Ue=this.springs.length,Ge=this.springs,Ne=this.bodies,We=this.gravity,Xe=this.solver,Ve=this.bodies.length,qe=this.broadphase,He=this.narrowphase,Ye=this.constraints,Qe=Se,Ze=M.scale,$e=M.add,et=M.rotate,at=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=Me,this.useWorldGravityAsFrictionGravity){var ot=M.length(this.gravity);0===ot&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=ot)}if(this.applyGravity)for(var rt=0;rt!==Ve;rt++){var nt=Ne[rt],it=nt.force;nt.type===z.DYNAMIC&&nt.sleepState!==z.SLEEPING&&(M.scale(Qe,We,nt.mass*nt.gravityScale),$e(it,it,Qe))}if(this.applySpringForces)for(var rt=0,st;rt!==Ue;rt++)st=Ge[rt],st.applyForce();if(this.applyDamping)for(var rt=0,nt;rt!==Ve;rt++)nt=Ne[rt],nt.type===z.DYNAMIC&&nt.applyDamping(Me);for(var lt=qe.getCollisionPairs(this),ct=this.disabledBodyCollisionPairs,rt=ct.length-2;0<=rt;rt-=2)for(var ut=lt.length-2;0<=ut;ut-=2)(ct[rt]===lt[ut]&&ct[rt+1]===lt[ut+1]||ct[rt+1]===lt[ut]&&ct[rt]===lt[ut+1])&&lt.splice(ut,2);var ht=Ye.length;for(rt=0;rt!==ht;rt++){var gt=Ye[rt];if(!gt.collideConnected)for(var ut=lt.length-2;0<=ut;ut-=2)(gt.bodyA===lt[ut]&&gt.bodyB===lt[ut+1]||gt.bodyB===lt[ut]&&gt.bodyA===lt[ut+1])&&lt.splice(ut,2)}this.postBroadphaseEvent.pairs=lt,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,He.reset(this);for(var rt=0,mt=lt.length;rt!==mt;rt+=2)for(var yt=lt[rt],ft=lt[rt+1],xt=0,bt=yt.shapes.length;xt!==bt;xt++)for(var _t=yt.shapes[xt],vt=_t.position,Tt=_t.angle,Ct=0,Pt=ft.shapes.length;Ct!==Pt;Ct++){var St=ft.shapes[Ct],At=St.position,Et=St.angle,Rt=this.defaultContactMaterial;if(_t.material&&St.material){var Lt=this.getContactMaterial(_t.material,St.material);Lt&&(Rt=Lt)}this.runNarrowphase(He,yt,_t,vt,Tt,ft,St,At,Et,Rt,this.frictionGravity)}for(var rt=0,Bt;rt!==Ve;rt++)Bt=Ne[rt],Bt._wakeUpAfterNarrowphase&&(Bt.wakeUp(),Bt._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(Le);for(var kt=this.endContactEvent,Ct=Le.length,Ft;Ct--;)Ft=Le[Ct],kt.shapeA=Ft.shapeA,kt.shapeB=Ft.shapeB,kt.bodyA=Ft.bodyA,kt.bodyB=Ft.bodyB,this.emit(kt);Le.length=0}var Dt=this.preSolveEvent;Dt.contactEquations=He.contactEquations,Dt.frictionEquations=He.frictionEquations,this.emit(Dt),Dt.contactEquations=Dt.frictionEquations=null;var ht=Ye.length;for(rt=0;rt!==ht;rt++)Ye[rt].update();if(He.contactEquations.length||He.frictionEquations.length||ht)if(this.islandSplit){for(at.equations.length=0,ue.appendArray(at.equations,He.contactEquations),ue.appendArray(at.equations,He.frictionEquations),rt=0;rt!==ht;rt++)ue.appendArray(at.equations,Ye[rt].equations);at.split(this);for(var rt=0,It;rt!==at.islands.length;rt++)It=at.islands[rt],It.equations.length&&Xe.solveIsland(Me,It)}else{for(Xe.addEquations(He.contactEquations),Xe.addEquations(He.frictionEquations),rt=0;rt!==ht;rt++)Xe.addEquations(Ye[rt].equations);this.solveConstraints&&Xe.solve(Me,this),Xe.removeAllEquations()}for(var rt=0,Bt;rt!==Ve;rt++)Bt=Ne[rt],Bt.integrate(Me);for(var rt=0;rt!==Ve;rt++)Ne[rt].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var Mt=this.impactEvent,rt=0,Ot;rt!==He.contactEquations.length;rt++)Ot=He.contactEquations[rt],Ot.firstImpact&&(Mt.bodyA=Ot.bodyA,Mt.bodyB=Ot.bodyB,Mt.shapeA=Ot.shapeA,Mt.shapeB=Ot.shapeB,Mt.contactEquation=Ot,this.emit(Mt));if(this.sleepMode===E.BODY_SLEEPING)for(rt=0;rt!==Ve;rt++)Ne[rt].sleepTick(this.time,!1,Me);else if(this.sleepMode===E.ISLAND_SLEEPING&&this.islandSplit){for(rt=0;rt!==Ve;rt++)Ne[rt].sleepTick(this.time,!0,Me);for(var rt=0,It;rt<this.islandManager.islands.length;rt++)It=this.islandManager.islands[rt],It.wantsToSleep()&&It.sleep()}this.stepping=!1;for(var Ut=this.bodiesToBeRemoved,rt=0;rt!==Ut.length;rt++)this.removeBody(Ut[rt]);Ut.length=0,this.emit(this.postStepEvent)},E.prototype.runNarrowphase=function(Me,Oe,Ue,Ge,Ne,We,Xe,Ve,qe,He,Ye){if(0!=(Ue.collisionGroup&Xe.collisionMask)&&0!=(Xe.collisionGroup&Ue.collisionMask)){M.rotate(we,Ge,Oe.angle),M.rotate(Ae,Ve,We.angle),M.add(we,we,Oe.position),M.add(Ae,Ae,We.position);var je=Ne+Oe.angle,ze=qe+We.angle;Me.enableFriction=0<He.friction,Me.frictionCoefficient=He.friction;var Ke;Ke=Oe.type===z.STATIC||Oe.type===z.KINEMATIC?We.mass:We.type===z.STATIC||We.type===z.KINEMATIC?Oe.mass:Oe.mass*We.mass/(Oe.mass+We.mass),Me.slipForce=He.friction*Ye*Ke,Me.restitution=He.restitution,Me.surfaceVelocity=He.surfaceVelocity,Me.frictionStiffness=He.frictionStiffness,Me.frictionRelaxation=He.frictionRelaxation,Me.stiffness=He.stiffness,Me.relaxation=He.relaxation,Me.contactSkinSize=He.contactSkinSize,Me.enabledEquations=Oe.collisionResponse&&We.collisionResponse&&Ue.collisionResponse&&Xe.collisionResponse;var Je=Me[Ue.type|Xe.type],Qe=0;if(Je){var Ze=Ue.sensor||Xe.sensor,$e=Me.frictionEquations.length;Qe=Ue.type<Xe.type?Je.call(Me,Oe,Ue,we,je,We,Xe,Ae,ze,Ze):Je.call(Me,We,Xe,Ae,ze,Oe,Ue,we,je,Ze);var et=Me.frictionEquations.length-$e;if(Qe){if(Oe.allowSleep&&Oe.type===z.DYNAMIC&&Oe.sleepState===z.SLEEPING&&We.sleepState===z.AWAKE&&We.type!==z.STATIC){var at=M.squaredLength(We.velocity)+Math.pow(We.angularVelocity,2),ot=Math.pow(We.sleepSpeedLimit,2);at>=2*ot&&(Oe._wakeUpAfterNarrowphase=!0)}if(We.allowSleep&&We.type===z.DYNAMIC&&We.sleepState===z.SLEEPING&&Oe.sleepState===z.AWAKE&&Oe.type!==z.STATIC){var rt=M.squaredLength(Oe.velocity)+Math.pow(Oe.angularVelocity,2),nt=Math.pow(Oe.sleepSpeedLimit,2);rt>=2*nt&&(We._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(Oe,Ue,We,Xe),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(Ue,Xe)){var it=this.beginContactEvent;if(it.shapeA=Ue,it.shapeB=Xe,it.bodyA=Oe,it.bodyB=We,it.contactEquations.length=0,"number"==typeof Qe)for(var st=Me.contactEquations.length-Qe;st<Me.contactEquations.length;st++)it.contactEquations.push(Me.contactEquations[st]);this.emit(it)}if("number"==typeof Qe&&1<et)for(var st=Me.frictionEquations.length-et,lt;st<Me.frictionEquations.length;st++)lt=Me.frictionEquations[st],lt.setSlipForce(lt.getSlipForce()/et)}}}},E.prototype.addSpring=function(Me){this.springs.push(Me);var Oe=this.addSpringEvent;Oe.spring=Me,this.emit(Oe),Oe.spring=null},E.prototype.removeSpring=function(Me){var Oe=this.springs.indexOf(Me);-1!==Oe&&ue.splice(this.springs,Oe,1)},E.prototype.addBody=function(Me){if(-1===this.bodies.indexOf(Me)){this.bodies.push(Me),Me.world=this;var Oe=this.addBodyEvent;Oe.body=Me,this.emit(Oe),Oe.body=null}},E.prototype.removeBody=function(Me){if(this.stepping)this.bodiesToBeRemoved.push(Me);else{Me.world=null;var Oe=this.bodies.indexOf(Me);-1!==Oe&&(ue.splice(this.bodies,Oe,1),this.removeBodyEvent.body=Me,Me.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},E.prototype.getBodyById=function(Me){for(var Oe=this.bodies,Ue=0,Ge;Ue<Oe.length;Ue++)if(Ge=Oe[Ue],Ge.id===Me)return Ge;return!1},E.prototype.disableBodyCollision=function(Me,Oe){this.disabledBodyCollisionPairs.push(Me,Oe)},E.prototype.enableBodyCollision=function(Me,Oe){for(var Ue=this.disabledBodyCollisionPairs,Ge=0;Ge<Ue.length;Ge+=2)if(Ue[Ge]===Me&&Ue[Ge+1]===Oe||Ue[Ge+1]===Me&&Ue[Ge]===Oe)return void Ue.splice(Ge,2)},E.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var Me=this.constraints,Oe=Me.length-1;0<=Oe;Oe--)this.removeConstraint(Me[Oe]);for(var Ue=this.bodies,Oe=Ue.length-1;0<=Oe;Oe--)this.removeBody(Ue[Oe]);for(var Ge=this.springs,Oe=Ge.length-1;0<=Oe;Oe--)this.removeSpring(Ge[Oe]);for(var Ne=this.contactMaterials,Oe=Ne.length-1;0<=Oe;Oe--)this.removeContactMaterial(Ne[Oe]);E.apply(this)};var Be=M.create(),ke=M.fromValues(0,0),Fe=M.fromValues(0,0);E.prototype.hitTest=function(Me,Oe,Ue){Ue=Ue||0;var Ge=new z({position:Me}),Ne=new H,We=Me,Xe=0,Ve=Be;Ge.addShape(Ne);for(var Ye=this.narrowphase,je=[],ze=0,Ke=Oe.length,Je;ze!==Ke;ze++){Je=Oe[ze];for(var Qe=0,Ze=Je.shapes.length,$e;Qe!==Ze;Qe++){$e=Je.shapes[Qe],M.rotate(Ve,$e.position,Je.angle),M.add(Ve,Ve,Je.position);var et=$e.angle+Je.angle;($e instanceof O&&Ye.circleParticle(Je,$e,Ve,et,Ge,Ne,We,Xe,!0)||$e instanceof U&&Ye.particleConvex(Ge,Ne,We,Xe,Je,$e,Ve,et,!0)||$e instanceof X&&Ye.particlePlane(Ge,Ne,We,Xe,Je,$e,Ve,et,!0)||$e instanceof V&&Ye.particleCapsule(Ge,Ne,We,Xe,Je,$e,Ve,et,!0)||$e instanceof H&&M.squaredLength(M.sub(Fe,Ve,Me))<Ue*Ue)&&je.push(Je)}}return je},E.prototype.setGlobalStiffness=function(Me){for(var Oe=this.constraints,Ue=0,Ge;Ue!==Oe.length;Ue++){Ge=Oe[Ue];for(var Ne=0,We;Ne!==Ge.equations.length;Ne++)We=Ge.equations[Ne],We.stiffness=Me,We.needsUpdate=!0}for(var Xe=this.contactMaterials,Ue=0,Ge;Ue!==Xe.length;Ue++)Ge=Xe[Ue],Ge.stiffness=Ge.frictionStiffness=Me;var Ge=this.defaultContactMaterial;Ge.stiffness=Ge.frictionStiffness=Me},E.prototype.setGlobalRelaxation=function(Me){for(var Oe=0,Ue;Oe!==this.constraints.length;Oe++){Ue=this.constraints[Oe];for(var Ge=0,Ne;Ge!==Ue.equations.length;Ge++)Ne=Ue.equations[Ge],Ne.relaxation=Me,Ne.needsUpdate=!0}for(var Oe=0,Ue;Oe!==this.contactMaterials.length;Oe++)Ue=this.contactMaterials[Oe],Ue.relaxation=Ue.frictionRelaxation=Me;var Ue=this.defaultContactMaterial;Ue.relaxation=Ue.frictionRelaxation=Me};var De=new le,Ie=[];E.prototype.raycast=function(Me,Oe){return Oe.getAABB(De),this.broadphase.aabbQuery(this,De,Ie),Oe.intersectBodies(Me,Ie),Ie.length=0,Me.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)}),function(){function _(A,E,R,L){var D=A.createTexture();return A.bindTexture(A.TEXTURE_2D,D),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,L===P.scaleModes.LINEAR?A.LINEAR:A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,L===P.scaleModes.LINEAR?A.LINEAR:A.NEAREST),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,E,R,0,A.RGBA,A.UNSIGNED_BYTE,null),D}function T(A,E,R,L,D){var M=A.createFramebuffer(),O=A.createRenderbuffer(),U=null,W=0;return A.activeTexture(A.TEXTURE0+D),A.bindFramebuffer(A.FRAMEBUFFER,M),A.bindRenderbuffer(A.RENDERBUFFER,O),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,this.renderBuffer),U=_(A,E,R,L),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,U,0),W=A.checkFramebufferStatus(A.FRAMEBUFFER),W!==A.FRAMEBUFFER_COMPLETE&&console.error("Incomplete GL framebuffer. ",S[W]),M.width=E,M.height=R,M.targetTexture=U,M.renderBuffer=O,M}var C=this,P=P||{};P.DisplayObject=function(){this.position=new P.Point(0,0),this.scale=new P.Point(1,1),this.pivot=new P.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new Phaser.Matrix,this.worldPosition=new P.Point(0,0),this.worldScale=new P.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new P.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},P.DisplayObject.prototype={constructor:P.DisplayObject,destroy:function(){if(this.children){for(var A=this.children.length;A--;)this.children[A].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(A){if(!A&&!this.parent&&!this.game)return this;var E=this.parent;A?E=A:!this.parent&&(E=this.game.world);var R=E.worldTransform,L=this.worldTransform,D,M,O,U,W,X;this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),D=this._cr*this.scale.x,M=this._sr*this.scale.x,O=-this._sr*this.scale.y,U=this._cr*this.scale.y,W=this.position.x,X=this.position.y,(this.pivot.x||this.pivot.y)&&(W-=this.pivot.x*D+this.pivot.y*O,X-=this.pivot.x*M+this.pivot.y*U),L.a=D*R.a+M*R.c,L.b=D*R.b+M*R.d,L.c=O*R.a+U*R.c,L.d=O*R.b+U*R.d,L.tx=W*R.a+X*R.c+R.tx,L.ty=W*R.b+X*R.d+R.ty):(D=this.scale.x,M=0,O=0,U=this.scale.y,W=this.position.x-this.pivot.x*D,X=this.position.y-this.pivot.y*U,L.a=D*R.a,L.b=D*R.b,L.c=U*R.c,L.d=U*R.d,L.tx=W*R.a+X*R.c+R.tx,L.ty=W*R.b+X*R.d+R.ty),D=L.a,M=L.b,O=L.c,U=L.d;var V=D*U-M*O;if(D||M){var H=Math.sqrt(D*D+M*M);this.worldRotation=0<M?Math.acos(D/H):-Math.acos(D/H),this.worldScale.x=H,this.worldScale.y=V/H}else if(O||U){var Y=Math.sqrt(O*O+U*U);this.worldRotation=Phaser.Math.HALF_PI-(0<U?Math.acos(-O/Y):-Math.acos(O/Y)),this.worldScale.x=V/Y,this.worldScale.y=Y}else this.worldScale.x=0,this.worldScale.y=0;return this.worldAlpha=this.alpha*E.worldAlpha,this.worldPosition.x=L.tx,this.worldPosition.y=L.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,L,R),this},preUpdate:function(){},generateTexture:function(A,E,R){var L=this.getLocalBounds(),D=new Phaser.RenderTexture(this.game,0|L.width,0|L.height,R,E,A);return P.DisplayObject._tempMatrix.tx=-L.x,P.DisplayObject._tempMatrix.ty=-L.y,D.render(this,P.DisplayObject._tempMatrix),D},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(A){return this.updateTransform(),this.worldTransform.apply(A)},toLocal:function(A,E){return E&&(A=E.toGlobal(A)),this.updateTransform(),this.worldTransform.applyInverse(A)},_renderCachedSprite:function(A){this._cachedSprite.worldAlpha=this.worldAlpha,A.gl?P.Sprite.prototype._renderWebGL.call(this._cachedSprite,A):P.Sprite.prototype._renderCanvas.call(this._cachedSprite,A)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var A=this.getLocalBounds();if(A.width=Math.max(1,Math.ceil(A.width)),A.height=Math.max(1,Math.ceil(A.height)),this.updateTransform(),!this._cachedSprite){var E=0;this.texture&&this.texture.baseTexture&&P._enableMultiTextureToggle&&(E=this.texture.baseTexture.textureIndex);var R=new Phaser.RenderTexture(this.game,A.width,A.height,void 0,void 0,void 0,void 0,E);this._cachedSprite=new P.Sprite(R),this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.texture.resize(A.width,A.height);var L=this._filters;this._filters=null,this._cachedSprite.filters=L,P.DisplayObject._tempMatrix.tx=-A.x,P.DisplayObject._tempMatrix.ty=-A.y,this._cachedSprite.texture.render(this,P.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(A.x/A.width),this._cachedSprite.anchor.y=-(A.y/A.height),this._filters=L,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},P.DisplayObject.prototype.displayObjectUpdateTransform=P.DisplayObject.prototype.updateTransform,Object.defineProperties(P.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(A){this.position.x=A}},y:{get:function(){return this.position.y},set:function(A){this.position.y=A}},worldVisible:{get:function(){if(!this.visible)return!1;var A=this.parent;if(!A)return this.visible;do{if(!A.visible)return!1;A=A.parent}while(A);return!0}},mask:{get:function(){return this._mask},set:function(A){this._mask&&(this._mask.isMask=!1),this._mask=A,A&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(A){if(Array.isArray(A)){for(var E=[],R=0,L;R<A.length;R++){L=A[R].passes;for(var D=0;D<L.length;D++)E.push(L[D])}this._filterBlock={target:this,filterPasses:E}}this._filters=A,this.blendMode&&this.blendMode===P.blendModes.MULTIPLY&&(this.blendMode=P.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(A){this._cacheAsBitmap===A||(A?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=A)}}}),P.DisplayObjectContainer=function(){P.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},P.DisplayObjectContainer.prototype=Object.create(P.DisplayObject.prototype),P.DisplayObjectContainer.prototype.constructor=P.DisplayObjectContainer,P.DisplayObjectContainer.prototype.addChild=function(A){return this.addChildAt(A,this.children.length)},P.DisplayObjectContainer.prototype.addChildAt=function(A,E){if(0<=E&&E<=this.children.length)return A.parent&&A.parent.removeChild(A),A.parent=this,this.children.splice(E,0,A),A;throw new Error(A+"addChildAt: The index "+E+" supplied is out of bounds "+this.children.length)},P.DisplayObjectContainer.prototype.swapChildren=function(A,E){if(A!==E){var R=this.getChildIndex(A),L=this.getChildIndex(E);if(0>R||0>L)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[R]=E,this.children[L]=A}},P.DisplayObjectContainer.prototype.getChildIndex=function(A){var E=this.children.indexOf(A);if(-1===E)throw new Error("The supplied DisplayObject must be a child of the caller");return E},P.DisplayObjectContainer.prototype.setChildIndex=function(A,E){if(0>E||E>=this.children.length)throw new Error("The supplied index is out of bounds");var R=this.getChildIndex(A);this.children.splice(R,1),this.children.splice(E,0,A)},P.DisplayObjectContainer.prototype.getChildAt=function(A){if(0>A||A>=this.children.length)throw new Error("getChildAt: Supplied index "+A+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[A]},P.DisplayObjectContainer.prototype.removeChild=function(A){var E=this.children.indexOf(A);return-1===E?void 0:this.removeChildAt(E)},P.DisplayObjectContainer.prototype.removeChildAt=function(A){var E=this.getChildAt(A);return E&&(E.parent=void 0,this.children.splice(A,1)),E},P.DisplayObjectContainer.prototype.removeChildren=function(A,E){void 0===A&&(A=0),void 0===E&&(E=this.children.length);var R=E-A;if(0<R&&R<=E){for(var L=this.children.splice(A,R),D=0,M;D<L.length;D++)M=L[D],M.parent=void 0;return L}if(0==R&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},P.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var A=0;A<this.children.length;A++)this.children[A].updateTransform()},P.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=P.DisplayObjectContainer.prototype.updateTransform,P.DisplayObjectContainer.prototype.getBounds=function(A){var E=A&&A instanceof P.DisplayObject,R=!0;E?A instanceof P.DisplayObjectContainer?R=A.contains(this):R=!1:A=this;var L;if(E){var D=A.worldTransform;for(A.worldTransform=Phaser.identityMatrix,L=0;L<A.children.length;L++)A.children[L].updateTransform()}var M=Infinity,O=Infinity,U=-Infinity,W=-Infinity,Y=!1,X,V,H;for(L=0;L<this.children.length;L++){var z=this.children[L];z.visible&&(Y=!0,X=this.children[L].getBounds(),M=M<X.x?M:X.x,O=O<X.y?O:X.y,V=X.width+X.x,H=X.height+X.y,U=U>V?U:V,W=W>H?W:H)}var K=this._bounds;if(!Y){K=new P.Rectangle;var J=K.x,Q=K.width+K.x,Z=K.y,$=K.height+K.y,ee=this.worldTransform,te=ee.a,ae=ee.b,oe=ee.c,ne=ee.d,ie=ee.tx,se=ee.ty,le=te*Q+oe*$+ie,de=ne*$+ae*Q+se,pe=te*J+oe*$+ie,ue=ne*$+ae*J+se,he=te*J+oe*Z+ie,ge=ne*Z+ae*J+se,me=te*Q+oe*Z+ie,be=ne*Z+ae*Q+se;U=le,W=de,M=le,O=de,M=pe<M?pe:M,M=he<M?he:M,M=me<M?me:M,O=ue<O?ue:O,O=ge<O?ge:O,O=be<O?be:O,U=pe>U?pe:U,U=he>U?he:U,U=me>U?me:U,W=ue>W?ue:W,W=ge>W?ge:W,W=be>W?be:W}if(K.x=M,K.y=O,K.width=U-M,K.height=W-O,E)for(A.worldTransform=D,L=0;L<A.children.length;L++)A.children[L].updateTransform();if(!R){var _e=A.getBounds();K.x-=_e.x,K.y-=_e.y}return K},P.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},P.DisplayObjectContainer.prototype.contains=function(A){return!!A&&(A===this||this.contains(A.parent))},P.DisplayObjectContainer.prototype._renderWebGL=function(A){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return void this._renderCachedSprite(A);var E;if(this._mask||this._filters){for(this._filters&&(A.spriteBatch.flush(),A.filterManager.pushFilter(this._filterBlock)),this._mask&&(A.spriteBatch.stop(),A.maskManager.pushMask(this.mask,A),A.spriteBatch.start()),E=0;E<this.children.length;E++)this.children[E]._renderWebGL(A);A.spriteBatch.stop(),this._mask&&A.maskManager.popMask(this._mask,A),this._filters&&A.filterManager.popFilter(),A.spriteBatch.start()}else for(E=0;E<this.children.length;E++)this.children[E]._renderWebGL(A)}},P.DisplayObjectContainer.prototype._renderCanvas=function(A){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(A);this._mask&&A.maskManager.pushMask(this._mask,A);for(var E=0;E<this.children.length;E++)this.children[E]._renderCanvas(A);this._mask&&A.maskManager.popMask(A)}},Object.defineProperty(P.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(A){var E=this.getLocalBounds().width;this.scale.x=0===E?1:A/E,this._width=A}}),Object.defineProperty(P.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(A){var E=this.getLocalBounds().height;this.scale.y=0===E?1:A/E,this._height=A}}),P.Sprite=function(A){P.DisplayObjectContainer.call(this),this.anchor=new P.Point(P.Sprite.defaultAnchor.x,P.Sprite.defaultAnchor.y),this.texture=A||P.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=P.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},P.Sprite.defaultAnchor={x:0,y:0},P.Sprite.prototype=Object.create(P.DisplayObjectContainer.prototype),P.Sprite.prototype.constructor=P.Sprite,Object.defineProperty(P.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(A){this.scale.x=A/this.texture.frame.width,this._width=A}}),Object.defineProperty(P.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(A){this.scale.y=A/this.texture.frame.height,this._height=A}}),P.Sprite.prototype.setTexture=function(A,E){E&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=A,this.texture.valid=!0,this.cachedTint=-1},P.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},P.Sprite.prototype.getBounds=function(A){var E=this.texture.frame.width,R=this.texture.frame.height,L=E*(1-this.anchor.x),D=E*-this.anchor.x,M=R*(1-this.anchor.y),O=R*-this.anchor.y,U=A||this.worldTransform,W=U.a,X=U.b,V=U.c,H=U.d,Y=U.tx,z=U.ty,K=-Infinity,J=-Infinity,Q=Infinity,Z=Infinity;if(0===X&&0===V){if(0>W){W*=-1;var $=L;L=-D,D=-$}if(0>H){H*=-1;var $=M;M=-O,O=-$}Q=W*D+Y,K=W*L+Y,Z=H*O+z,J=H*M+z}else{var ee=W*D+V*O+Y,te=H*O+X*D+z,ae=W*L+V*O+Y,oe=H*O+X*L+z,ne=W*L+V*M+Y,ie=H*M+X*L+z,se=W*D+V*M+Y,le=H*M+X*D+z;Q=ee<Q?ee:Q,Q=ae<Q?ae:Q,Q=ne<Q?ne:Q,Q=se<Q?se:Q,Z=te<Z?te:Z,Z=oe<Z?oe:Z,Z=ie<Z?ie:Z,Z=le<Z?le:Z,K=ee>K?ee:K,K=ae>K?ae:K,K=ne>K?ne:K,K=se>K?se:K,J=te>J?te:J,J=oe>J?oe:J,J=ie>J?ie:J,J=le>J?le:J}var de=this._bounds;return de.x=Q,de.width=K-Q,de.y=Z,de.height=J-Z,this._currentBounds=de,de},P.Sprite.prototype.getLocalBounds=function(){var A=this.worldTransform;this.worldTransform=Phaser.identityMatrix;for(var E=0;E<this.children.length;E++)this.children[E].updateTransform();var R=this.getBounds();for(this.worldTransform=A,E=0;E<this.children.length;E++)this.children[E].updateTransform();return R},P.Sprite.prototype._renderWebGL=function(A,E){if(this.visible&&!(0>=this.alpha)&&this.renderable){var R=this.worldTransform;if(E&&(R=E),this._mask||this._filters){var L=A.spriteBatch;this._filters&&(L.flush(),A.filterManager.pushFilter(this._filterBlock)),this._mask&&(L.stop(),A.maskManager.pushMask(this.mask,A),L.start()),L.render(this);for(var D=0;D<this.children.length;D++)this.children[D]._renderWebGL(A);L.stop(),this._mask&&A.maskManager.popMask(this._mask,A),this._filters&&A.filterManager.popFilter(),L.start()}else{A.spriteBatch.render(this);for(var D=0;D<this.children.length;D++)this.children[D]._renderWebGL(A,R)}}},P.Sprite.prototype._renderCanvas=function(A,E){if(this.visible&&0!==this.alpha&&this.renderable&&!(0>=this.texture.crop.width)&&!(0>=this.texture.crop.height)){var R=this.worldTransform;if(E&&(R=E),this.blendMode!==A.currentBlendMode&&(A.currentBlendMode=this.blendMode,A.context.globalCompositeOperation=P.blendModesCanvas[A.currentBlendMode]),this._mask&&A.maskManager.pushMask(this._mask,A),!this.texture.valid){for(var L=0;L<this.children.length;L++)this.children[L]._renderCanvas(A);return void(this._mask&&A.maskManager.popMask(A))}var D=this.texture.baseTexture.resolution/A.resolution;A.context.globalAlpha=this.worldAlpha,A.smoothProperty&&A.scaleMode!==this.texture.baseTexture.scaleMode&&(A.scaleMode=this.texture.baseTexture.scaleMode,A.context[A.smoothProperty]=A.scaleMode===P.scaleModes.LINEAR);var M=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,O=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,U=R.tx*A.resolution+A.shakeX,W=R.ty*A.resolution+A.shakeY,X=this.texture.crop.width,V=this.texture.crop.height;if(this.texture.rotated){var H=R.a,Y=R.b,z=R.c,K=R.d,J=X;U=R.c*V+U,W=R.d*V+W,R.a=6.123233995736766e-17*H+-z,R.b=6.123233995736766e-17*Y+-K,R.c=H+6.123233995736766e-17*z,R.d=Y+6.123233995736766e-17*K,X=V,V=J}if(A.roundPixels?(A.context.setTransform(R.a,R.b,R.c,R.d,0|U,0|W),M|=0,O|=0):A.context.setTransform(R.a,R.b,R.c,R.d,U,W),M/=D,O/=D,16777215!==this.tint)(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=P.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),A.context.drawImage(this.tintedTexture,0,0,X,V,M,O,X/D,V/D);else{var Q=this.texture.crop.x,Z=this.texture.crop.y;X=Math.floor(X),V=Math.floor(V),A.context.drawImage(this.texture.baseTexture.source,Q,Z,X,V,M,O,X/D,V/D)}for(var L=0;L<this.children.length;L++)this.children[L]._renderCanvas(A);this._mask&&A.maskManager.popMask(A)}},P.initDefaultShaders=function(){},P.CompileVertexShader=function(A,E){return P._CompileShader(A,E,A.VERTEX_SHADER)},P.CompileFragmentShader=function(A,E){return P._CompileShader(A,E,A.FRAGMENT_SHADER)},P._CompileShader=function(A,E,R){var L=E;Array.isArray(E)&&(L=E.join("\n"));var D=A.createShader(R);return A.shaderSource(D,L),A.compileShader(D),A.getShaderParameter(D,A.COMPILE_STATUS)?D:(window.console.log(A.getShaderInfoLog(D)),null)},P.compileProgram=function(A,E,R){var L=P.CompileFragmentShader(A,R),D=P.CompileVertexShader(A,E),M=A.createProgram();return A.attachShader(M,D),A.attachShader(M,L),A.linkProgram(M),A.getProgramParameter(M,A.LINK_STATUS)||(window.console.log(A.getProgramInfoLog(M)),window.console.log("Could not initialise shaders")),M},P.PixiShader=function(A){this._UID=Phaser._UID++,this.gl=A,this.program=null,this.fragmentSrc=null,this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},P.PixiShader.prototype.constructor=P.PixiShader,P.PixiShader.prototype.initMultitexShader=function(){var A=this.gl;this.MAX_TEXTURES=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS);for(var E="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",R=1;R<this.MAX_TEXTURES;++R)E+="\tif (vTextureIndex == "+R+".0) {gl_FragColor = texture2D(uSamplerArray["+R+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",E,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"];var L=P.compileProgram(A,this.vertexSrc||P.PixiShader.defaultVertexSrc,this.fragmentSrc);A.useProgram(L),this.uSamplerArray=A.getUniformLocation(L,"uSamplerArray[0]"),this.projectionVector=A.getUniformLocation(L,"projectionVector"),this.offsetVector=A.getUniformLocation(L,"offsetVector"),this.dimensions=A.getUniformLocation(L,"dimensions"),this.aVertexPosition=A.getAttribLocation(L,"aVertexPosition"),this.aTextureCoord=A.getAttribLocation(L,"aTextureCoord"),this.colorAttribute=A.getAttribLocation(L,"aColor"),this.aTextureIndex=A.getAttribLocation(L,"aTextureIndex");var D=[],M=A.createTexture();A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,M),A.texImage2D(A.TEXTURE_2D,0,A.RGB,1,1,0,A.RGB,A.UNSIGNED_BYTE,null);for(var O=0;O<this.MAX_TEXTURES;++O)A.activeTexture(A.TEXTURE0+O),A.bindTexture(A.TEXTURE_2D,M),D.push(O);for(var U in A.activeTexture(A.TEXTURE0),A.uniform1iv(this.uSamplerArray,D),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[U].uniformLocation=A.getUniformLocation(L,U);this.initUniforms(),this.program=L},P.PixiShader.prototype.initDefaultShader=function(){null===this.fragmentSrc&&(this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]);var A=this.gl,E=P.compileProgram(A,this.vertexSrc||P.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var R in A.useProgram(E),this.uSampler=A.getUniformLocation(E,"uSampler"),this.projectionVector=A.getUniformLocation(E,"projectionVector"),this.offsetVector=A.getUniformLocation(E,"offsetVector"),this.dimensions=A.getUniformLocation(E,"dimensions"),this.aVertexPosition=A.getAttribLocation(E,"aVertexPosition"),this.aTextureCoord=A.getAttribLocation(E,"aTextureCoord"),this.colorAttribute=A.getAttribLocation(E,"aColor"),this.aTextureIndex=A.getAttribLocation(E,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[R].uniformLocation=A.getUniformLocation(E,R);this.initUniforms(),this.program=E},P.PixiShader.prototype.init=function(A){P._enableMultiTextureToggle&&!A?this.initMultitexShader():this.initDefaultShader()},P.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var A=this.gl,E;for(var R in this.uniforms){E=this.uniforms[R];var L=E.type;"sampler2D"===L?(E._init=!1,null!==E.value&&this.initSampler2D(E)):"mat2"===L||"mat3"===L||"mat4"===L?(E.glMatrix=!0,E.glValueLength=1,"mat2"===L?E.glFunc=A.uniformMatrix2fv:"mat3"===L?E.glFunc=A.uniformMatrix3fv:"mat4"===L&&(E.glFunc=A.uniformMatrix4fv)):(E.glFunc=A["uniform"+L],E.glValueLength="2f"===L||"2i"===L?2:"3f"===L||"3i"===L?3:"4f"===L||"4i"===L?4:1)}},P.PixiShader.prototype.initSampler2D=function(A){if(A.value&&A.value.baseTexture&&A.value.baseTexture.hasLoaded){var E=this.gl;if(E.activeTexture(E.TEXTURE0+this.textureCount),E.bindTexture(E.TEXTURE_2D,A.value.baseTexture._glTextures[E.id]),A.textureData){var R=A.textureData,L=R.magFilter?R.magFilter:E.LINEAR,D=R.minFilter?R.minFilter:E.LINEAR,M=R.wrapS?R.wrapS:E.CLAMP_TO_EDGE,O=R.wrapT?R.wrapT:E.CLAMP_TO_EDGE,U=R.luminance?E.LUMINANCE:E.RGBA;if(R.repeat&&(M=E.REPEAT,O=E.REPEAT),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,!!R.flipY),R.width){var W=R.width?R.width:512,X=R.height?R.height:2,V=R.border?R.border:0;E.texImage2D(E.TEXTURE_2D,0,U,W,X,V,U,E.UNSIGNED_BYTE,null)}else E.texImage2D(E.TEXTURE_2D,0,U,E.RGBA,E.UNSIGNED_BYTE,A.value.baseTexture.source);E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,L),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,D),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,M),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,O)}E.uniform1i(A.uniformLocation,this.textureCount),A._init=!0,this.textureCount++}},P.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var E=this.gl,A;for(var R in this.uniforms)A=this.uniforms[R],1===A.glValueLength?!0===A.glMatrix?A.glFunc.call(E,A.uniformLocation,A.transpose,A.value):A.glFunc.call(E,A.uniformLocation,A.value):2===A.glValueLength?A.glFunc.call(E,A.uniformLocation,A.value.x,A.value.y):3===A.glValueLength?A.glFunc.call(E,A.uniformLocation,A.value.x,A.value.y,A.value.z):4===A.glValueLength?A.glFunc.call(E,A.uniformLocation,A.value.x,A.value.y,A.value.z,A.value.w):"sampler2D"===A.type&&(A._init?(E.activeTexture(E["TEXTURE"+this.textureCount]),A.value.baseTexture._dirty[E.id]?P.instances[E.id].updateTexture(A.value.baseTexture):E.bindTexture(E.TEXTURE_2D,A.value.baseTexture._glTextures[E.id]),E.uniform1i(A.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(A))},P.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},P.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vTextureIndex = aTextureIndex;","}"],P.PixiFastShader=function(A){if(this._UID=Phaser._UID++,this.gl=A,this.program=null,P._enableMultiTextureToggle){var A=this.gl;this.MAX_TEXTURES=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS);for(var E="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",R=1;R<this.MAX_TEXTURES;++R)E+="\tif (vTextureIndex == "+R+".0) { gl_FragColor = texture2D(uSamplerArray["+R+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",E,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"],this.textureCount=0,this.init()},P.PixiFastShader.prototype.constructor=P.PixiFastShader,P.PixiFastShader.prototype.init=function(){var A=this.gl,E=P.compileProgram(A,this.vertexSrc,this.fragmentSrc);if(A.useProgram(E),this.uSampler=P._enableMultiTextureToggle?A.getUniformLocation(E,"uSamplerArray[0]"):A.getUniformLocation(E,"uSampler"),P._enableMultiTextureToggle){var R=[],L=A.createTexture();A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L),A.texImage2D(A.TEXTURE_2D,0,A.RGB,1,1,0,A.RGB,A.UNSIGNED_BYTE,null);for(var D=0;D<this.MAX_TEXTURES;++D)A.activeTexture(A.TEXTURE0+D),A.bindTexture(A.TEXTURE_2D,L),R.push(D);A.activeTexture(A.TEXTURE0),A.uniform1iv(this.uSampler,R)}this.projectionVector=A.getUniformLocation(E,"projectionVector"),this.offsetVector=A.getUniformLocation(E,"offsetVector"),this.dimensions=A.getUniformLocation(E,"dimensions"),this.uMatrix=A.getUniformLocation(E,"uMatrix"),this.aVertexPosition=A.getAttribLocation(E,"aVertexPosition"),this.aPositionCoord=A.getAttribLocation(E,"aPositionCoord"),this.aScale=A.getAttribLocation(E,"aScale"),this.aRotation=A.getAttribLocation(E,"aRotation"),this.aTextureCoord=A.getAttribLocation(E,"aTextureCoord"),this.colorAttribute=A.getAttribLocation(E,"aColor"),this.aTextureIndex=A.getAttribLocation(E,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.program=E},P.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},P.StripShader=function(A){if(this._UID=Phaser._UID++,this.gl=A,this.program=null,P._enableMultiTextureToggle){var A=this.gl;this.MAX_TEXTURES=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS);for(var E="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n",R=1;R<this.MAX_TEXTURES;++R)E+="\tif (vTextureIndex == "+R+".0) { gl_FragColor = texture2D(uSamplerArray["+R+"], vTextureCoord) ;return;}\n";this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",E,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","}"],this.init()},P.StripShader.prototype.constructor=P.StripShader,P.StripShader.prototype.init=function(){var A=this.gl,E=P.compileProgram(A,this.vertexSrc,this.fragmentSrc);if(A.useProgram(E),this.uSampler=P._enableMultiTextureToggle?A.getUniformLocation(E,"uSamplerArray[0]"):A.getUniformLocation(E,"uSampler"),P._enableMultiTextureToggle){var R=[],L=A.createTexture();A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L),A.texImage2D(A.TEXTURE_2D,0,A.RGB,1,1,0,A.RGB,A.UNSIGNED_BYTE,null);for(var D=0;D<this.MAX_TEXTURES;++D)A.activeTexture(A.TEXTURE0+D),A.bindTexture(A.TEXTURE_2D,L),R.push(D);A.activeTexture(A.TEXTURE0),A.uniform1iv(this.uSampler,R)}this.projectionVector=A.getUniformLocation(E,"projectionVector"),this.offsetVector=A.getUniformLocation(E,"offsetVector"),this.colorAttribute=A.getAttribLocation(E,"aColor"),this.aTextureIndex=A.getAttribLocation(E,"aTextureIndex"),this.aVertexPosition=A.getAttribLocation(E,"aVertexPosition"),this.aTextureCoord=A.getAttribLocation(E,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex],this.translationMatrix=A.getUniformLocation(E,"translationMatrix"),this.alpha=A.getUniformLocation(E,"alpha"),this.program=E},P.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},P.PrimitiveShader=function(A){this._UID=Phaser._UID++,this.gl=A,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},P.PrimitiveShader.prototype.constructor=P.PrimitiveShader,P.PrimitiveShader.prototype.init=function(){var A=this.gl,E=P.compileProgram(A,this.vertexSrc,this.fragmentSrc);A.useProgram(E),this.projectionVector=A.getUniformLocation(E,"projectionVector"),this.offsetVector=A.getUniformLocation(E,"offsetVector"),this.tintColor=A.getUniformLocation(E,"tint"),this.flipY=A.getUniformLocation(E,"flipY"),this.aVertexPosition=A.getAttribLocation(E,"aVertexPosition"),this.colorAttribute=A.getAttribLocation(E,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=A.getUniformLocation(E,"translationMatrix"),this.alpha=A.getUniformLocation(E,"alpha"),this.program=E},P.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},P.ComplexPrimitiveShader=function(A){this._UID=Phaser._UID++,this.gl=A,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},P.ComplexPrimitiveShader.prototype.constructor=P.ComplexPrimitiveShader,P.ComplexPrimitiveShader.prototype.init=function(){var A=this.gl,E=P.compileProgram(A,this.vertexSrc,this.fragmentSrc);A.useProgram(E),this.projectionVector=A.getUniformLocation(E,"projectionVector"),this.offsetVector=A.getUniformLocation(E,"offsetVector"),this.tintColor=A.getUniformLocation(E,"tint"),this.color=A.getUniformLocation(E,"color"),this.flipY=A.getUniformLocation(E,"flipY"),this.aVertexPosition=A.getAttribLocation(E,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=A.getUniformLocation(E,"translationMatrix"),this.alpha=A.getUniformLocation(E,"alpha"),this.program=E},P.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},P.glContexts=[],P.instances=[],P._enableMultiTextureToggle=!1,P.WebGLRenderer=function(A){this.game=A,P.defaultRenderer||(P.defaultRenderer=this),this.extensions={},this.type=Phaser.WEBGL,this.resolution=A.resolution,this.transparent=A.transparent,this.autoResize=!1,this.preserveDrawingBuffer=A.preserveDrawingBuffer,this.clearBeforeRender=A.clearBeforeRender,this.width=A.width,this.height=A.height,this.view=A.canvas,this._contextOptions={alpha:this.transparent,antialias:A.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new P.Point,this.offset=new P.Point,this.shaderManager=new P.WebGLShaderManager,this.spriteBatch=new P.WebGLSpriteBatch(A),this.maskManager=new P.WebGLMaskManager,this.filterManager=new P.WebGLFilterManager,this.stencilManager=new P.WebGLStencilManager,this.blendModeManager=new P.WebGLBlendModeManager,this.renderSession={},this.currentBatchedTextures=[],this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.renderSession.roundPixels=!1,this.renderSession.maxTextureAvailableSpace=null,this.initContext(),this.mapBlendModes()},P.WebGLRenderer.prototype.constructor=P.WebGLRenderer,P.WebGLRenderer.prototype.initContext=function(){var A=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=A,!A)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.maxTextures=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.gl.getParameter(A.MAX_TEXTURE_SIZE),this.glContextId=A.id=P.WebGLRenderer.glContextId++,P.glContexts[this.glContextId]=A,P.instances[this.glContextId]=this,A.disable(A.DEPTH_TEST),A.disable(A.CULL_FACE),A.enable(A.BLEND),this.shaderManager.setContext(A),this.spriteBatch.setContext(A),this.maskManager.setContext(A),this.filterManager.setContext(A),this.blendModeManager.setContext(A),this.stencilManager.setContext(A),this.renderSession.gl=this.gl,this.resize(this.width,this.height),this.extensions.compression={};var E=A.getExtension("WEBGL_compressed_texture_etc1")||A.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),R=A.getExtension("WEBGL_compressed_texture_pvrtc")||A.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),L=A.getExtension("WEBGL_compressed_texture_s3tc")||A.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");E&&(this.extensions.compression.ETC1=E),R&&(this.extensions.compression.PVRTC=R),L&&(this.extensions.compression.S3TC=L)},P.WebGLRenderer.prototype.setTexturePriority=function(A){if(!P._enableMultiTextureToggle)return void console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.");for(var E=function(H){return--H,H|=H>>1,H|=H>>2,H|=H>>4,H|=H>>8,H|=H>>16,++H},R=this.gl,L=R.getParameter(R.MAX_TEXTURE_IMAGE_UNITS),D=R.getParameter(R.MAX_TEXTURE_SIZE),M=this.game.cache._cache.image,O=null,U=0;U<this.currentBatchedTextures.length;U++){if(O=this.currentBatchedTextures[U],!(O in M)){console.warn("setTexturePriority: There is no image \"%s\" in the image cache.",O);continue}M[O].base.textureIndex=0}var W=D-E(Math.max(this.width,this.height));this.currentBatchedTextures.length=0;for(var X=0;X<A.length;++X){if(O=A[X],!(O in M)){console.warn("setTexturePriority: There is no image \"%s\" in the image cache.",O);continue}var V=M[O].base;W-=E(Math.max(V.width,V.height)),0>=W?(V.textureIndex=0,console.warn("setTexturePriority: Image \"%s\" was given textureIndex=0 because there is no available texture space (%s).",O,W)):V.textureIndex=1+X%(L-1),this.currentBatchedTextures.push(O)}return this.renderSession.maxTextureAvailableSpace=W,this.currentBatchedTextures},P.WebGLRenderer.prototype.render=function(A){if(!this.contextLost){var E=this.gl;E.viewport(0,0,this.width,this.height),E.bindFramebuffer(E.FRAMEBUFFER,null),this.game.clearBeforeRender&&(E.clearColor(A._bgColor.r,A._bgColor.g,A._bgColor.b,A._bgColor.a),E.clear(E.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(A,this.projection)}},P.WebGLRenderer.prototype.renderDisplayObject=function(A,E,R,L){this.renderSession.blendModeManager.setBlendMode(P.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=R?-1:1,this.renderSession.projection=E,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,R),A._renderWebGL(this.renderSession,L),this.spriteBatch.end()},P.WebGLRenderer.prototype.resize=function(A,E){this.width=A*this.resolution,this.height=E*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},P.WebGLRenderer.prototype.updateCompressedTexture=function(A){if(!A.hasLoaded)return!1;var E=this.gl,R=A.source;return A._glTextures[E.id]||(A._glTextures[E.id]=E.createTexture()),E.activeTexture(E.TEXTURE0+A.textureIndex),E.bindTexture(E.TEXTURE_2D,A._glTextures[E.id]),E.compressedTexImage2D(E.TEXTURE_2D,0,R.glExtensionFormat,R.width,R.height,0,R.textureData),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR:E.NEAREST),A.mipmap&&Phaser.Math.isPowerOfTwo(A.width,A.height)?(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR_MIPMAP_LINEAR:E.NEAREST_MIPMAP_NEAREST),E.generateMipmap(E.TEXTURE_2D)):E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR:E.NEAREST),A._powerOf2?(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.REPEAT),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.REPEAT)):(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE)),A._dirty[E.id]=!1,!0},P.WebGLRenderer.prototype.updateTexture=function(A){if(!A.hasLoaded)return!1;if(A.source.compressionAlgorithm)return this.updateCompressedTexture(A);var E=this.gl;return A._glTextures[E.id]||(A._glTextures[E.id]=E.createTexture()),E.activeTexture(E.TEXTURE0+A.textureIndex),E.bindTexture(E.TEXTURE_2D,A._glTextures[E.id]),E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A.premultipliedAlpha),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,A.source),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR:E.NEAREST),A.mipmap&&Phaser.Math.isPowerOfTwo(A.width,A.height)?(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR_MIPMAP_LINEAR:E.NEAREST_MIPMAP_NEAREST),E.generateMipmap(E.TEXTURE_2D)):E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,A.scaleMode===P.scaleModes.LINEAR?E.LINEAR:E.NEAREST),A._powerOf2?(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.REPEAT),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.REPEAT)):(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE)),A._dirty[E.id]=!1,!0},P.WebGLRenderer.prototype.destroy=function(){P.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,Phaser.CanvasPool.remove(this),P.instances[this.glContextId]=null,P.WebGLRenderer.glContextId--},P.WebGLRenderer.prototype.mapBlendModes=function(){var A=this.gl;if(!P.blendModesWebGL){var E=[],R=P.blendModes;E[R.NORMAL]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.ADD]=[A.SRC_ALPHA,A.DST_ALPHA],E[R.MULTIPLY]=[A.DST_COLOR,A.ONE_MINUS_SRC_ALPHA],E[R.SCREEN]=[A.SRC_ALPHA,A.ONE],E[R.OVERLAY]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.DARKEN]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.LIGHTEN]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.COLOR_DODGE]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.COLOR_BURN]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.HARD_LIGHT]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.SOFT_LIGHT]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.DIFFERENCE]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.EXCLUSION]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.HUE]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.SATURATION]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.COLOR]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],E[R.LUMINOSITY]=[A.ONE,A.ONE_MINUS_SRC_ALPHA],P.blendModesWebGL=E}},P.WebGLRenderer.prototype.getMaxTextureUnit=function(){var A=this.gl;return A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS)},P.enableMultiTexture=function(){P._enableMultiTextureToggle=!0},P.WebGLRenderer.glContextId=0,P.WebGLRenderer.textureArray=[],P.WebGLBlendModeManager=function(){this.currentBlendMode=99999},P.WebGLBlendModeManager.prototype.constructor=P.WebGLBlendModeManager,P.WebGLBlendModeManager.prototype.setContext=function(A){this.gl=A},P.WebGLBlendModeManager.prototype.setBlendMode=function(A){if(this.currentBlendMode===A)return!1;this.currentBlendMode=A;var E=P.blendModesWebGL[this.currentBlendMode];return E&&this.gl.blendFunc(E[0],E[1]),!0},P.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},P.WebGLMaskManager=function(){},P.WebGLMaskManager.prototype.constructor=P.WebGLMaskManager,P.WebGLMaskManager.prototype.setContext=function(A){this.gl=A},P.WebGLMaskManager.prototype.pushMask=function(A,E){var R=E.gl;A.dirty&&P.WebGLGraphics.updateGraphics(A,R),void 0===A._webGL[R.id]||void 0===A._webGL[R.id].data||0===A._webGL[R.id].data.length||E.stencilManager.pushStencil(A,A._webGL[R.id].data[0],E)},P.WebGLMaskManager.prototype.popMask=function(A,E){var R=this.gl;void 0===A._webGL[R.id]||void 0===A._webGL[R.id].data||0===A._webGL[R.id].data.length||E.stencilManager.popStencil(A,A._webGL[R.id].data[0],E)},P.WebGLMaskManager.prototype.destroy=function(){this.gl=null},P.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},P.WebGLStencilManager.prototype.setContext=function(A){this.gl=A},P.WebGLStencilManager.prototype.pushStencil=function(A,E,R){var L=this.gl;this.bindGraphics(A,E,R),0===this.stencilStack.length&&(L.enable(L.STENCIL_TEST),L.clear(L.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(E);var D=this.count;L.colorMask(!1,!1,!1,!1),L.stencilFunc(L.ALWAYS,0,255),L.stencilOp(L.KEEP,L.KEEP,L.INVERT),1===E.mode?(L.drawElements(L.TRIANGLE_FAN,E.indices.length-4,L.UNSIGNED_SHORT,0),this.reverse?(L.stencilFunc(L.EQUAL,255-D,255),L.stencilOp(L.KEEP,L.KEEP,L.DECR)):(L.stencilFunc(L.EQUAL,D,255),L.stencilOp(L.KEEP,L.KEEP,L.INCR)),L.drawElements(L.TRIANGLE_FAN,4,L.UNSIGNED_SHORT,2*(E.indices.length-4)),this.reverse?L.stencilFunc(L.EQUAL,255-(D+1),255):L.stencilFunc(L.EQUAL,D+1,255),this.reverse=!this.reverse):(this.reverse?(L.stencilFunc(L.EQUAL,D,255),L.stencilOp(L.KEEP,L.KEEP,L.INCR)):(L.stencilFunc(L.EQUAL,255-D,255),L.stencilOp(L.KEEP,L.KEEP,L.DECR)),L.drawElements(L.TRIANGLE_STRIP,E.indices.length,L.UNSIGNED_SHORT,0),this.reverse?L.stencilFunc(L.EQUAL,D+1,255):L.stencilFunc(L.EQUAL,255-(D+1),255)),L.colorMask(!0,!0,!0,!0),L.stencilOp(L.KEEP,L.KEEP,L.KEEP),this.count++},P.WebGLStencilManager.prototype.bindGraphics=function(A,E,R){this._currentGraphics=A;var L=this.gl,D=R.projection,M=R.offset,O;1===E.mode?(O=R.shaderManager.complexPrimitiveShader,R.shaderManager.setShader(O),L.uniform1f(O.flipY,R.flipY),L.uniformMatrix3fv(O.translationMatrix,!1,A.worldTransform.toArray(!0)),L.uniform2f(O.projectionVector,D.x,-D.y),L.uniform2f(O.offsetVector,-M.x,-M.y),L.uniform3fv(O.tintColor,Phaser.Color.hexToRGBArray(A.tint)),L.uniform3fv(O.color,E.color),L.uniform1f(O.alpha,A.worldAlpha*E.alpha),L.bindBuffer(L.ARRAY_BUFFER,E.buffer),L.vertexAttribPointer(O.aVertexPosition,2,L.FLOAT,!1,8,0),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,E.indexBuffer)):(O=R.shaderManager.primitiveShader,R.shaderManager.setShader(O),L.uniformMatrix3fv(O.translationMatrix,!1,A.worldTransform.toArray(!0)),L.uniform1f(O.flipY,R.flipY),L.uniform2f(O.projectionVector,D.x,-D.y),L.uniform2f(O.offsetVector,-M.x,-M.y),L.uniform3fv(O.tintColor,Phaser.Color.hexToRGBArray(A.tint)),L.uniform1f(O.alpha,A.worldAlpha),L.bindBuffer(L.ARRAY_BUFFER,E.buffer),L.vertexAttribPointer(O.aVertexPosition,2,L.FLOAT,!1,24,0),L.vertexAttribPointer(O.colorAttribute,4,L.FLOAT,!1,24,8),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,E.indexBuffer))},P.WebGLStencilManager.prototype.popStencil=function(A,E,R){var L=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)L.disable(L.STENCIL_TEST);else{var D=this.count;this.bindGraphics(A,E,R),L.colorMask(!1,!1,!1,!1),1===E.mode?(this.reverse=!this.reverse,this.reverse?(L.stencilFunc(L.EQUAL,255-(D+1),255),L.stencilOp(L.KEEP,L.KEEP,L.INCR)):(L.stencilFunc(L.EQUAL,D+1,255),L.stencilOp(L.KEEP,L.KEEP,L.DECR)),L.drawElements(L.TRIANGLE_FAN,4,L.UNSIGNED_SHORT,2*(E.indices.length-4)),L.stencilFunc(L.ALWAYS,0,255),L.stencilOp(L.KEEP,L.KEEP,L.INVERT),L.drawElements(L.TRIANGLE_FAN,E.indices.length-4,L.UNSIGNED_SHORT,0),this.reverse?L.stencilFunc(L.EQUAL,D,255):L.stencilFunc(L.EQUAL,255-D,255)):(this.reverse?(L.stencilFunc(L.EQUAL,D+1,255),L.stencilOp(L.KEEP,L.KEEP,L.DECR)):(L.stencilFunc(L.EQUAL,255-(D+1),255),L.stencilOp(L.KEEP,L.KEEP,L.INCR)),L.drawElements(L.TRIANGLE_STRIP,E.indices.length,L.UNSIGNED_SHORT,0),this.reverse?L.stencilFunc(L.EQUAL,D,255):L.stencilFunc(L.EQUAL,255-D,255)),L.colorMask(!0,!0,!0,!0),L.stencilOp(L.KEEP,L.KEEP,L.KEEP)}},P.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},P.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var A=0;A<this.maxAttibs;A++)this.attribState[A]=!1;this.stack=[]},P.WebGLShaderManager.prototype.constructor=P.WebGLShaderManager,P.WebGLShaderManager.prototype.setContext=function(A){this.gl=A,this.primitiveShader=new P.PrimitiveShader(A),this.complexPrimitiveShader=new P.ComplexPrimitiveShader(A),this.defaultShader=new P.PixiShader(A),this.fastShader=new P.PixiFastShader(A),this.stripShader=new P.StripShader(A),this.creatureShader=P.CreatureShader?new P.CreatureShader(A):null,this.setShader(this.defaultShader)},P.WebGLShaderManager.prototype.setAttribs=function(A){var E;for(E=0;E<this.tempAttribState.length;E++)this.tempAttribState[E]=!1;for(E=0;E<A.length;E++){var R=A[E];this.tempAttribState[R]=!0}var L=this.gl;for(E=0;E<this.attribState.length;E++)this.attribState[E]!==this.tempAttribState[E]&&(this.attribState[E]=this.tempAttribState[E],this.tempAttribState[E]?L.enableVertexAttribArray(E):L.disableVertexAttribArray(E))},P.WebGLShaderManager.prototype.setShader=function(A){return this._currentId!==A._UID&&(this._currentId=A._UID,this.currentShader=A,this.gl.useProgram(A.program),this.setAttribs(A.attributes),!0)},P.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.creatureShader&&this.creatureShader.destroy(),this.gl=null},P.WebGLSpriteBatch=function(A){this.game=A,this.vertSize=5,this.size=2e3,this.vertexSize=24;var E=4*(this.vertexSize*this.size),R=6*this.size;this.vertices=new ArrayBuffer(E),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(R),this.lastIndexCount=0;for(var L=0,D=0;L<R;L+=6,D+=4)this.indices[L+0]=D+0,this.indices[L+1]=D+1,this.indices[L+2]=D+2,this.indices[L+3]=D+0,this.indices[L+4]=D+2,this.indices[L+5]=D+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=null},P.WebGLSpriteBatch.prototype.setContext=function(A){if(this.MAX_TEXTURES=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS),this.gl=A,P._enableMultiTextureToggle){for(var E="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",R=1;R<this.MAX_TEXTURES;++R)E+="\tif (vTextureIndex == "+R+".0) {gl_FragColor = texture2D(uSamplerArray["+R+"], vTextureCoord) * vColor;return;}\n";this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",E,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]);this.vertexBuffer=A.createBuffer(),this.indexBuffer=A.createBuffer(),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,this.indices,A.STATIC_DRAW),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.bufferData(A.ARRAY_BUFFER,this.vertices,A.DYNAMIC_DRAW),this.currentBlendMode=99999;var L=new P.PixiShader(A);L.fragmentSrc=this.defaultShader.fragmentSrc,L.uniforms={},L.init(),this.defaultShader.shaders[A.id]=L},P.WebGLSpriteBatch.prototype.begin=function(A){this.renderSession=A,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},P.WebGLSpriteBatch.prototype.end=function(){this.flush()},P.WebGLSpriteBatch.prototype.render=function(A,E){var R=A.texture,L=R.baseTexture,D=this.gl;P.WebGLRenderer.textureArray[L.textureIndex]!=L&&(this.flush(),D.activeTexture(D.TEXTURE0+L.textureIndex),D.bindTexture(D.TEXTURE_2D,L._glTextures[D.id]),P.WebGLRenderer.textureArray[L.textureIndex]=L);var M=A.worldTransform;E&&(M=E),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=R.baseTexture);var O=R._uvs;if(O){var U=A.anchor.x,W=A.anchor.y,X,V,H,Y;if(R.trim){var z=R.trim;V=z.x-U*z.width,X=V+R.crop.width,Y=z.y-W*z.height,H=Y+R.crop.height}else X=R.frame.width*(1-U),V=R.frame.width*-U,H=R.frame.height*(1-W),Y=R.frame.height*-W;var K=this.currentBatchSize*this.vertexSize,J=4*this.currentBatchSize,Q=R.baseTexture.resolution,Z=R.baseTexture.textureIndex,$=M.a/Q,ee=M.b/Q,te=M.c/Q,ae=M.d/Q,oe=M.tx,ne=M.ty,ie=R.crop.width,se=R.crop.height;if(R.rotated){var le=M.a,de=M.b,pe=M.c,ue=M.d,he=V,ge=X;oe=M.c*se+oe,ne=M.d*se+ne,$=6.123233995736766e-17*le+-pe,ee=6.123233995736766e-17*de+-ue,te=le+6.123233995736766e-17*pe,ae=de+6.123233995736766e-17*ue,R._updateUvsInverted(),X=H,V=Y,H=ge,Y=he}var me=this.colors,be=this.positions,_e=A.tint,ve=(_e>>16)+(65280&_e)+((255&_e)<<16)+(255*A.worldAlpha<<24);this.renderSession.roundPixels?(be[K++]=0|$*V+te*Y+oe,be[K++]=0|ae*Y+ee*V+ne,be[K++]=O.x0,be[K++]=O.y0,me[K++]=ve,be[K++]=Z,be[K++]=0|$*X+te*Y+oe,be[K++]=0|ae*Y+ee*X+ne,be[K++]=O.x1,be[K++]=O.y1,me[K++]=ve,be[K++]=Z,be[K++]=0|$*X+te*H+oe,be[K++]=0|ae*H+ee*X+ne,be[K++]=O.x2,be[K++]=O.y2,me[K++]=ve,be[K++]=Z,be[K++]=0|$*V+te*H+oe,be[K++]=0|ae*H+ee*V+ne,be[K++]=O.x3,be[K++]=O.y3,me[K++]=ve,be[K++]=Z):(be[K++]=$*V+te*Y+oe,be[K++]=ae*Y+ee*V+ne,be[K++]=O.x0,be[K++]=O.y0,me[K++]=ve,be[K++]=Z,be[K++]=$*X+te*Y+oe,be[K++]=ae*Y+ee*X+ne,be[K++]=O.x1,be[K++]=O.y1,me[K++]=ve,be[K++]=Z,be[K++]=$*X+te*H+oe,be[K++]=ae*H+ee*X+ne,be[K++]=O.x2,be[K++]=O.y2,me[K++]=ve,be[K++]=Z,be[K++]=$*V+te*H+oe,be[K++]=ae*H+ee*V+ne,be[K++]=O.x3,be[K++]=O.y3,me[K++]=ve,be[K++]=Z),this.sprites[this.currentBatchSize++]=A}},P.WebGLSpriteBatch.prototype.renderTilingSprite=function(A){var E=A.tilingTexture,R=E.baseTexture,L=this.gl,D=A.texture.baseTexture.textureIndex;P.WebGLRenderer.textureArray[D]!=R&&(this.flush(),L.activeTexture(L.TEXTURE0+D),L.bindTexture(L.TEXTURE_2D,R._glTextures[L.id]),P.WebGLRenderer.textureArray[D]=R),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=E.baseTexture),A._uvs||(A._uvs=new P.TextureUvs);var M=A._uvs,O=E.baseTexture.width,U=E.baseTexture.height;A.tilePosition.x%=O*A.tileScaleOffset.x,A.tilePosition.y%=U*A.tileScaleOffset.y;var W=A.tilePosition.x/(O*A.tileScaleOffset.x),X=A.tilePosition.y/(U*A.tileScaleOffset.y),V=A.width/O/(A.tileScale.x*A.tileScaleOffset.x),H=A.height/U/(A.tileScale.y*A.tileScaleOffset.y);M.x0=0-W,M.y0=0-X,M.x1=1*V-W,M.y1=0-X,M.x2=1*V-W,M.y2=1*H-X,M.x3=0-W,M.y3=1*H-X;var Y=A.tint,z=(Y>>16)+(65280&Y)+((255&Y)<<16)+(255*A.worldAlpha<<24),K=this.positions,J=this.colors,Q=A.width,Z=A.height,$=A.anchor.x,ee=A.anchor.y,te=Q*(1-$),ae=Q*-$,oe=Z*(1-ee),ne=Z*-ee,ie=this.currentBatchSize*this.vertexSize,se=E.baseTexture.resolution,le=A.worldTransform,de=le.a/se,pe=le.b/se,ue=le.c/se,he=le.d/se,ge=le.tx,me=le.ty;K[ie++]=de*ae+ue*ne+ge,K[ie++]=he*ne+pe*ae+me,K[ie++]=M.x0,K[ie++]=M.y0,J[ie++]=z,K[ie++]=D,K[ie++]=de*te+ue*ne+ge,K[ie++]=he*ne+pe*te+me,K[ie++]=M.x1,K[ie++]=M.y1,J[ie++]=z,K[ie++]=D,K[ie++]=de*te+ue*oe+ge,K[ie++]=he*oe+pe*te+me,K[ie++]=M.x2,K[ie++]=M.y2,J[ie++]=z,K[ie++]=D,K[ie++]=de*ae+ue*oe+ge,K[ie++]=he*oe+pe*ae+me,K[ie++]=M.x3,K[ie++]=M.y3,J[ie++]=z,K[ie++]=D,this.sprites[this.currentBatchSize++]=A},P.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var A=this.gl,E;if(this.dirty){this.dirty=!1,E=this.defaultShader.shaders[A.id],A.activeTexture(A.TEXTURE0),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var R=this.vertexSize;A.vertexAttribPointer(E.aVertexPosition,2,A.FLOAT,!1,R,0),A.vertexAttribPointer(E.aTextureCoord,2,A.FLOAT,!1,R,8),A.vertexAttribPointer(E.colorAttribute,4,A.UNSIGNED_BYTE,!0,R,16),A.vertexAttribPointer(E.aTextureIndex,1,A.FLOAT,!1,R,20)}if(this.currentBatchSize>0.5*this.size)A.bufferSubData(A.ARRAY_BUFFER,0,this.vertices);else{A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer);var L=this.positions.subarray(0,this.currentBatchSize*this.vertexSize);A.bufferSubData(A.ARRAY_BUFFER,0,L)}for(var U=0,W=0,X=null,V=this.renderSession.blendModeManager.currentBlendMode,H=null,Y=!1,z=!1,Q=0,Z=this.currentBatchSize,D,M,O,K;Q<Z;Q++){K=this.sprites[Q],D=K.tilingTexture?K.tilingTexture.baseTexture:K.texture.baseTexture,M=K.blendMode,O=K.shader||this.defaultShader,Y=V!==M,z=H!==O;var $=D.skipRender;if($&&0<K.children.length&&($=!1),(Y||z)&&(this.renderBatch(X,U,W),W=Q,U=0,X=D,Y&&(V=M,this.renderSession.blendModeManager.setBlendMode(V)),z)){H=O,E=H.shaders[A.id],E||(E=new P.PixiShader(A),E.fragmentSrc=H.fragmentSrc,E.uniforms=H.uniforms,E.init(),H.shaders[A.id]=E),this.renderSession.shaderManager.setShader(E),E.dirty&&E.syncUniforms();var ee=this.renderSession.projection;A.uniform2f(E.projectionVector,ee.x,ee.y);var te=this.renderSession.offset;A.uniform2f(E.offsetVector,te.x,te.y)}U++}this.renderBatch(X,U,W),this.currentBatchSize=0}},P.WebGLSpriteBatch.prototype.renderBatch=function(A,E,R){if(0!==E){var L=this.gl;if(!A._dirty[L.id])L.bindTexture(L.TEXTURE_2D,A._glTextures[L.id]);else if(!this.renderSession.renderer.updateTexture(A))return;L.drawElements(L.TRIANGLES,6*E,L.UNSIGNED_SHORT,2*(6*R)),this.renderSession.drawCount++}},P.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},P.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},P.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},P.WebGLFastSpriteBatch=function(A){this.vertSize=11,this.maxSize=6e3,this.size=this.maxSize;var E=4*this.size*this.vertSize,R=6*this.maxSize;this.vertices=new Float32Array(E),this.indices=new Uint16Array(R),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var L=0,D=0;L<R;L+=6,D+=4)this.indices[L+0]=D+0,this.indices[L+1]=D+1,this.indices[L+2]=D+2,this.indices[L+3]=D+0,this.indices[L+4]=D+2,this.indices[L+5]=D+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(A)},P.WebGLFastSpriteBatch.prototype.constructor=P.WebGLFastSpriteBatch,P.WebGLFastSpriteBatch.prototype.setContext=function(A){this.gl=A,this.vertexBuffer=A.createBuffer(),this.indexBuffer=A.createBuffer(),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,this.indices,A.STATIC_DRAW),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.bufferData(A.ARRAY_BUFFER,this.vertices,A.DYNAMIC_DRAW)},P.WebGLFastSpriteBatch.prototype.begin=function(A,E){this.renderSession=E,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=A.worldTransform.toArray(!0),this.start()},P.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},P.WebGLFastSpriteBatch.prototype.render=function(A){var E=A.children,R=E[0];if(R.texture._uvs){this.currentBaseTexture=R.texture.baseTexture,R.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(R.blendMode));for(var L=0,D=E.length;L<D;L++)this.renderSprite(E[L]);this.flush()}},P.WebGLFastSpriteBatch.prototype.renderSprite=function(A){var E=A.texture,R=E.baseTexture,L=this.gl,D=A.texture.baseTexture.textureIndex;if(!(P.WebGLRenderer.textureArray[D]!=R&&R._glTextures[L.id]&&!A.texture.baseTexture.skipRender&&(this.flush(),L.activeTexture(L.TEXTURE0+D),L.bindTexture(L.TEXTURE_2D,R._glTextures[L.id]),P.WebGLRenderer.textureArray[D]=R,!A.texture._uvs))&&A.visible){var O=this.vertices,M,U,W,X,V,H,Y,z;if(M=A.texture._uvs,U=A.texture.frame.width,W=A.texture.frame.height,A.texture.trim){var K=A.texture.trim;V=K.x-A.anchor.x*K.width,X=V+A.texture.crop.width,Y=K.y-A.anchor.y*K.height,H=Y+A.texture.crop.height}else X=A.texture.frame.width*(1-A.anchor.x),V=A.texture.frame.width*-A.anchor.x,H=A.texture.frame.height*(1-A.anchor.y),Y=A.texture.frame.height*-A.anchor.y;z=4*this.currentBatchSize*this.vertSize,O[z++]=V,O[z++]=Y,O[z++]=A.position.x,O[z++]=A.position.y,O[z++]=A.scale.x,O[z++]=A.scale.y,O[z++]=A.rotation,O[z++]=M.x0,O[z++]=M.y1,O[z++]=A.alpha,O[z++]=D,O[z++]=X,O[z++]=Y,O[z++]=A.position.x,O[z++]=A.position.y,O[z++]=A.scale.x,O[z++]=A.scale.y,O[z++]=A.rotation,O[z++]=M.x1,O[z++]=M.y1,O[z++]=A.alpha,O[z++]=D,O[z++]=X,O[z++]=H,O[z++]=A.position.x,O[z++]=A.position.y,O[z++]=A.scale.x,O[z++]=A.scale.y,O[z++]=A.rotation,O[z++]=M.x2,O[z++]=M.y2,O[z++]=A.alpha,O[z++]=D,O[z++]=V,O[z++]=H,O[z++]=A.position.x,O[z++]=A.position.y,O[z++]=A.scale.x,O[z++]=A.scale.y,O[z++]=A.rotation,O[z++]=M.x3,O[z++]=M.y3,O[z++]=A.alpha,O[z++]=D,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},P.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var A=this.gl;if(!this.currentBaseTexture._glTextures[A.id])return void this.renderSession.renderer.updateTexture(this.currentBaseTexture,A);if(this.currentBatchSize>0.5*this.size)A.bufferSubData(A.ARRAY_BUFFER,0,this.vertices);else{var E=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);A.bufferSubData(A.ARRAY_BUFFER,0,E)}A.drawElements(A.TRIANGLES,6*this.currentBatchSize,A.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},P.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},P.WebGLFastSpriteBatch.prototype.start=function(){var A=this.gl;A.activeTexture(A.TEXTURE0),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var E=this.renderSession.projection;A.uniform2f(this.shader.projectionVector,E.x,E.y),A.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var R=4*this.vertSize;A.vertexAttribPointer(this.shader.aVertexPosition,2,A.FLOAT,!1,R,0),A.vertexAttribPointer(this.shader.aPositionCoord,2,A.FLOAT,!1,R,8),A.vertexAttribPointer(this.shader.aScale,2,A.FLOAT,!1,R,16),A.vertexAttribPointer(this.shader.aRotation,1,A.FLOAT,!1,R,24),A.vertexAttribPointer(this.shader.aTextureCoord,2,A.FLOAT,!1,R,28),A.vertexAttribPointer(this.shader.colorAttribute,1,A.FLOAT,!1,R,36),A.vertexAttribPointer(this.shader.aTextureIndex,1,A.FLOAT,!1,R,40)},P.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},P.WebGLFilterManager.prototype.constructor=P.WebGLFilterManager,P.WebGLFilterManager.prototype.setContext=function(A){this.gl=A,this.texturePool=[],this.initShaderBuffers()},P.WebGLFilterManager.prototype.begin=function(A,E){this.renderSession=A,this.defaultShader=A.shaderManager.defaultShader;var R=this.renderSession.projection;this.width=2*R.x,this.height=2*-R.y,this.buffer=E},P.WebGLFilterManager.prototype.pushFilter=function(A){var E=this.gl,R=this.renderSession.projection,L=this.renderSession.offset;A._filterArea=A.target.filterArea||A.target.getBounds(),A._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new P.WebGLStencilManager,this.renderSession.stencilManager.setContext(E),E.disable(E.STENCIL_TEST),this.filterStack.push(A);var D=A.filterPasses[0];this.offsetX+=A._filterArea.x,this.offsetY+=A._filterArea.y;var M=this.texturePool.pop();M?M.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):M=new P.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),E.bindTexture(E.TEXTURE_2D,M.texture);var O=A._filterArea,U=D.padding;O.x-=U,O.y-=U,O.width+=2*U,O.height+=2*U,0>O.x&&(O.x=0),O.width>this.width&&(O.width=this.width),0>O.y&&(O.y=0),O.height>this.height&&(O.height=this.height),E.bindFramebuffer(E.FRAMEBUFFER,M.frameBuffer),E.viewport(0,0,O.width*this.renderSession.resolution,O.height*this.renderSession.resolution),R.x=O.width/2,R.y=-O.height/2,L.x=-O.x,L.y=-O.y,E.colorMask(!0,!0,!0,!0),E.clearColor(0,0,0,0),E.clear(E.COLOR_BUFFER_BIT),A._glFilterTexture=M},P.WebGLFilterManager.prototype.popFilter=function(){var A=this.gl,E=this.filterStack.pop(),R=E._filterArea,L=E._glFilterTexture,D=this.renderSession.projection,M=this.renderSession.offset;if(1<E.filterPasses.length){A.viewport(0,0,R.width*this.renderSession.resolution,R.height*this.renderSession.resolution),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=R.height,this.vertexArray[2]=R.width,this.vertexArray[3]=R.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=R.width,this.vertexArray[7]=0,A.bufferSubData(A.ARRAY_BUFFER,0,this.vertexArray),A.bindBuffer(A.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=R.width/this.width,this.uvArray[5]=R.height/this.height,this.uvArray[6]=R.width/this.width,this.uvArray[7]=R.height/this.height,A.bufferSubData(A.ARRAY_BUFFER,0,this.uvArray);var O=L,U=this.texturePool.pop();U||(U=new P.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),U.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),A.bindFramebuffer(A.FRAMEBUFFER,U.frameBuffer),A.clear(A.COLOR_BUFFER_BIT),A.disable(A.BLEND);for(var W=0,X;W<E.filterPasses.length-1;W++){X=E.filterPasses[W],A.bindFramebuffer(A.FRAMEBUFFER,U.frameBuffer),A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.texture),this.applyFilterPass(X,R,R.width,R.height);var V=O;O=U,U=V}A.enable(A.BLEND),L=O,this.texturePool.push(U)}var H=E.filterPasses[E.filterPasses.length-1];this.offsetX-=R.x,this.offsetY-=R.y;var Y=this.width,z=this.height,K=0,J=0,Q=this.buffer;if(0===this.filterStack.length)A.colorMask(!0,!0,!0,!0);else{var Z=this.filterStack[this.filterStack.length-1];R=Z._filterArea,Y=R.width,z=R.height,K=R.x,J=R.y,Q=Z._glFilterTexture.frameBuffer}D.x=Y/2,D.y=-z/2,M.x=K,M.y=J,R=E._filterArea;var $=R.x-K,ee=R.y-J;A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=$,this.vertexArray[1]=ee+R.height,this.vertexArray[2]=$+R.width,this.vertexArray[3]=ee+R.height,this.vertexArray[4]=$,this.vertexArray[5]=ee,this.vertexArray[6]=$+R.width,this.vertexArray[7]=ee,A.bufferSubData(A.ARRAY_BUFFER,0,this.vertexArray),A.bindBuffer(A.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=R.width/this.width,this.uvArray[5]=R.height/this.height,this.uvArray[6]=R.width/this.width,this.uvArray[7]=R.height/this.height,A.bufferSubData(A.ARRAY_BUFFER,0,this.uvArray),A.viewport(0,0,Y*this.renderSession.resolution,z*this.renderSession.resolution),A.bindFramebuffer(A.FRAMEBUFFER,Q),A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=E._previous_stencil_mgr,E._previous_stencil_mgr=null,0<this.renderSession.stencilManager.count?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this.applyFilterPass(H,R,Y,z),this.texturePool.push(L),E._glFilterTexture=null},P.WebGLFilterManager.prototype.applyFilterPass=function(A,E,R,L){var D=this.gl,M=A.shaders[D.id];M||(M=new P.PixiShader(D),M.fragmentSrc=A.fragmentSrc,M.uniforms=A.uniforms,M.init(!0),A.shaders[D.id]=M),this.renderSession.shaderManager.setShader(M),D.uniform2f(M.projectionVector,R/2,-L/2),D.uniform2f(M.offsetVector,0,0),A.uniforms.dimensions&&(A.uniforms.dimensions.value[0]=this.width,A.uniforms.dimensions.value[1]=this.height,A.uniforms.dimensions.value[2]=this.vertexArray[0],A.uniforms.dimensions.value[3]=this.vertexArray[5]),M.syncUniforms(),D.bindBuffer(D.ARRAY_BUFFER,this.vertexBuffer),D.vertexAttribPointer(M.aVertexPosition,2,D.FLOAT,!1,0,0),D.bindBuffer(D.ARRAY_BUFFER,this.uvBuffer),D.vertexAttribPointer(M.aTextureCoord,2,D.FLOAT,!1,0,0),D.bindBuffer(D.ARRAY_BUFFER,this.colorBuffer),D.vertexAttribPointer(M.colorAttribute,2,D.FLOAT,!1,0,0),D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,this.indexBuffer),D.drawElements(D.TRIANGLES,6,D.UNSIGNED_SHORT,0),this.renderSession.drawCount++},P.WebGLFilterManager.prototype.initShaderBuffers=function(){var A=this.gl;this.vertexBuffer=A.createBuffer(),this.uvBuffer=A.createBuffer(),this.colorBuffer=A.createBuffer(),this.indexBuffer=A.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),A.bindBuffer(A.ARRAY_BUFFER,this.vertexBuffer),A.bufferData(A.ARRAY_BUFFER,this.vertexArray,A.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),A.bindBuffer(A.ARRAY_BUFFER,this.uvBuffer),A.bufferData(A.ARRAY_BUFFER,this.uvArray,A.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),A.bindBuffer(A.ARRAY_BUFFER,this.colorBuffer),A.bufferData(A.ARRAY_BUFFER,this.colorArray,A.STATIC_DRAW),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),A.STATIC_DRAW)},P.WebGLFilterManager.prototype.destroy=function(){var A=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var E=0;E<this.texturePool.length;E++)this.texturePool[E].destroy();this.texturePool=null,A.deleteBuffer(this.vertexBuffer),A.deleteBuffer(this.uvBuffer),A.deleteBuffer(this.colorBuffer),A.deleteBuffer(this.indexBuffer)};var S={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"};return P.FilterTexture=function(A,E,R,L,D){D="number"==typeof D?D:0,this.gl=A,this.frameBuffer=T(A,E,R,L||P.scaleModes.DEFAULT,D),this.texture=this.frameBuffer.targetTexture,this.width=E,this.height=R,this.renderBuffer=this.frameBuffer.renderBuffer},P.FilterTexture.prototype.constructor=P.FilterTexture,P.FilterTexture.prototype.clear=function(){var A=this.gl;A.clearColor(0,0,0,0),A.clear(A.COLOR_BUFFER_BIT)},P.FilterTexture.prototype.resize=function(A,E){if(this.width!==A||this.height!==E){this.width=A,this.height=E;var R=this.gl;R.bindTexture(R.TEXTURE_2D,this.texture),R.texImage2D(R.TEXTURE_2D,0,R.RGBA,A,E,0,R.RGBA,R.UNSIGNED_BYTE,null),R.bindRenderbuffer(R.RENDERBUFFER,this.renderBuffer),R.renderbufferStorage(R.RENDERBUFFER,R.DEPTH_STENCIL,A,E)}},P.FilterTexture.prototype.destroy=function(){var A=this.gl;A.deleteFramebuffer(this.frameBuffer),A.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},P.CanvasBuffer=function(A,E){this.width=A,this.height=E,this.canvas=Phaser.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=A,this.canvas.height=E},P.CanvasBuffer.prototype.constructor=P.CanvasBuffer,P.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},P.CanvasBuffer.prototype.resize=function(A,E){this.width=this.canvas.width=A,this.height=this.canvas.height=E},P.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)},P.CanvasMaskManager=function(){},P.CanvasMaskManager.prototype.constructor=P.CanvasMaskManager,P.CanvasMaskManager.prototype.pushMask=function(A,E){var R=E.context;R.save();var L=A.alpha,D=A.worldTransform,M=E.resolution;R.setTransform(D.a*M,D.b*M,D.c*M,D.d*M,D.tx*M,D.ty*M),P.CanvasGraphics.renderGraphicsMask(A,R),R.clip(),A.worldAlpha=L},P.CanvasMaskManager.prototype.popMask=function(A){A.context.restore()},P.CanvasTinter=function(){},P.CanvasTinter.getTintedTexture=function(A,E){var R=A.tintedTexture||Phaser.CanvasPool.create(this);return P.CanvasTinter.tintMethod(A.texture,E,R),R},P.CanvasTinter.tintWithMultiply=function(A,E,R){var L=R.getContext("2d"),D=A.crop,M=D.width,O=D.height;A.rotated&&(M=O,O=D.width),(R.width!==M||R.height!==O)&&(R.width=M,R.height=O),L.clearRect(0,0,M,O),L.fillStyle="#"+("00000"+(0|E).toString(16)).substr(-6),L.fillRect(0,0,M,O),L.globalCompositeOperation="multiply",L.drawImage(A.baseTexture.source,D.x,D.y,M,O,0,0,M,O),L.globalCompositeOperation="destination-atop",L.drawImage(A.baseTexture.source,D.x,D.y,M,O,0,0,M,O)},P.CanvasTinter.tintWithPerPixel=function(A,E,R){var L=R.getContext("2d"),D=A.crop,M=D.width,O=D.height;A.rotated&&(M=O,O=D.width),(R.width!==M||R.height!==O)&&(R.width=M,R.height=O),L.globalCompositeOperation="copy",L.drawImage(A.baseTexture.source,D.x,D.y,M,O,0,0,M,O);for(var U=Phaser.Color.hexToRGBArray(E),W=U[0],X=U[1],V=U[2],H=L.getImageData(0,0,M,O),Y=H.data,z=0;z<Y.length;z+=4)if(Y[z+0]*=W,Y[z+1]*=X,Y[z+2]*=V,!P.CanvasTinter.canHandleAlpha){var K=Y[z+3];Y[z+0]/=255/K,Y[z+1]/=255/K,Y[z+2]/=255/K}L.putImageData(H,0,0)},P.CanvasRenderer=function(A){this.game=A,P.defaultRenderer||(P.defaultRenderer=this),this.type=Phaser.CANVAS,this.resolution=A.resolution,this.clearBeforeRender=A.clearBeforeRender,this.transparent=A.transparent,this.autoResize=!1,this.width=A.width*this.resolution,this.height=A.height*this.resolution,this.view=A.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new P.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},P.CanvasRenderer.prototype.constructor=P.CanvasRenderer,P.CanvasRenderer.prototype.render=function(A){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):A._bgColor&&(this.context.fillStyle=A._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(A)},P.CanvasRenderer.prototype.setTexturePriority=function(){},P.CanvasRenderer.prototype.destroy=function(A){void 0===A&&(A=!0),A&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},P.CanvasRenderer.prototype.resize=function(A,E){this.width=A*this.resolution,this.height=E*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===P.scaleModes.LINEAR)},P.CanvasRenderer.prototype.renderDisplayObject=function(A,E,R){this.renderSession.context=E||this.context,this.renderSession.resolution=this.resolution,A._renderCanvas(this.renderSession,R)},P.CanvasRenderer.prototype.mapBlendModes=function(){if(!P.blendModesCanvas){var A=[],E=P.blendModes,R=this.game.device.canUseMultiply;A[E.NORMAL]="source-over",A[E.ADD]="lighter",A[E.MULTIPLY]=R?"multiply":"source-over",A[E.SCREEN]=R?"screen":"source-over",A[E.OVERLAY]=R?"overlay":"source-over",A[E.DARKEN]=R?"darken":"source-over",A[E.LIGHTEN]=R?"lighten":"source-over",A[E.COLOR_DODGE]=R?"color-dodge":"source-over",A[E.COLOR_BURN]=R?"color-burn":"source-over",A[E.HARD_LIGHT]=R?"hard-light":"source-over",A[E.SOFT_LIGHT]=R?"soft-light":"source-over",A[E.DIFFERENCE]=R?"difference":"source-over",A[E.EXCLUSION]=R?"exclusion":"source-over",A[E.HUE]=R?"hue":"source-over",A[E.SATURATION]=R?"saturation":"source-over",A[E.COLOR]=R?"color":"source-over",A[E.LUMINOSITY]=R?"luminosity":"source-over",P.blendModesCanvas=A}},P.BaseTexture=function(A,E,R){this.resolution=R||1,this.width=100,this.height=100,this.scaleMode=E||P.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=A,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this.textureIndex=0,this._dirty=[!0,!0,!0,!0],A&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},P.BaseTexture.prototype.constructor=P.BaseTexture,P.BaseTexture.prototype.forceLoaded=function(A,E){this.hasLoaded=!0,this.width=A,this.height=E,this.dirty()},P.BaseTexture.prototype.destroy=function(){this.source&&Phaser.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},P.BaseTexture.prototype.updateSourceImage=function(){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")},P.BaseTexture.prototype.dirty=function(){for(var A=0;A<this._glTextures.length;A++)this._dirty[A]=!0},P.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var A=this._glTextures.length-1;0<=A;A--){var E=this._glTextures[A],R=P.glContexts[A];R&&E&&R.deleteTexture(E)}this._glTextures.length=0,this.dirty()},P.BaseTexture.fromCanvas=function(A,E,R){return 0===A.width&&(A.width=1),0===A.height&&(A.height=1),R=R||1,new P.BaseTexture(A,E,R)},P.TextureSilentFail=!1,P.Texture=function(A,E,R,L){this.noFrame=!1,E||(this.noFrame=!0,E=new P.Rectangle(0,0,1,1)),A instanceof P.Texture&&(A=A.baseTexture),this.baseTexture=A,this.frame=E,this.trim=L,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=R||new P.Rectangle(0,0,1,1),this.rotated=!1,A.hasLoaded&&(this.noFrame&&(E=new P.Rectangle(0,0,A.width,A.height)),this.setFrame(E))},P.Texture.prototype.constructor=P.Texture,P.Texture.prototype.onBaseTextureLoaded=function(){var A=this.baseTexture;this.noFrame&&(this.frame=new P.Rectangle(0,0,A.width,A.height)),this.setFrame(this.frame)},P.Texture.prototype.destroy=function(A){A&&this.baseTexture.destroy(),this.valid=!1},P.Texture.prototype.setFrame=function(A){if(this.noFrame=!1,this.frame=A,this.width=A.width,this.height=A.height,this.crop.x=A.x,this.crop.y=A.y,this.crop.width=A.width,this.crop.height=A.height,!this.trim&&(A.x+A.width>this.baseTexture.width||A.y+A.height>this.baseTexture.height)){if(!P.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);return void(this.valid=!1)}this.valid=A&&A.width&&A.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},P.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new P.TextureUvs);var A=this.crop,E=this.baseTexture.width,R=this.baseTexture.height;this._uvs.x0=A.x/E,this._uvs.y0=A.y/R,this._uvs.x1=(A.x+A.width)/E,this._uvs.y1=A.y/R,this._uvs.x2=(A.x+A.width)/E,this._uvs.y2=(A.y+A.height)/R,this._uvs.x3=A.x/E,this._uvs.y3=(A.y+A.height)/R},P.Texture.prototype._updateUvsInverted=function(){this._uvs||(this._uvs=new P.TextureUvs);var A=this.crop,E=this.baseTexture.width,R=this.baseTexture.height;this._uvs.x0=A.x/E,this._uvs.y0=A.y/R,this._uvs.x1=(A.x+A.height)/E,this._uvs.y1=A.y/R,this._uvs.x2=(A.x+A.height)/E,this._uvs.y2=(A.y+A.width)/R,this._uvs.x3=A.x/E,this._uvs.y3=(A.y+A.width)/R},P.Texture.fromCanvas=function(A,E){var R=P.BaseTexture.fromCanvas(A,E);return new P.Texture(R)},P.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},"undefined"==typeof exports?"undefined"!=typeof define&&define.amd?define("PIXI",function(){return C.PIXI=P}()):C.PIXI=P:("undefined"!=typeof module&&module.exports&&(exports=module.exports=P),exports.PIXI=P),P}.call(this),function(){function _(M,O){this._scaleFactor=M,this._deltaMode=O,this.originalEvent=null}var T=this,C=C||{VERSION:"2.8.8",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};if(Math.trunc||(Math.trunc=function(O){return 0>O?Math.ceil(O):Math.floor(O)}),Function.prototype.bind||(Function.prototype.bind=function(){var M=Array.prototype.slice;return function(O){function U(){var V=X.concat(M.call(arguments));W.apply(this instanceof U?this:O,V)}var W=this,X=M.call(arguments,1);if("function"!=typeof W)throw new TypeError;return U.prototype=function V(H){if(H&&(V.prototype=H),!(this instanceof V))return new V}(W.prototype),U}}()),Array.isArray||(Array.isArray=function(M){return"[object Array]"===Object.prototype.toString.call(M)}),Array.prototype.forEach||(Array.prototype.forEach=function(M){"use strict";if(void 0===this||null===this)throw new TypeError;var O=Object(this),U=O.length>>>0;if("function"!=typeof M)throw new TypeError;for(var W=2<=arguments.length?arguments[1]:void 0,X=0;X<U;X++)X in O&&M.call(W,O[X],X,O)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var P=function(M){window[M]=function(U){if("number"==typeof U){Array.call(this,U),this.length=U;for(var W=0;W<this.length;W++)this[W]=0}else{Array.call(this,U.length),this.length=U.length;for(var W=0;W<this.length;W++)this[W]=U[W]}},window[M].prototype=[],window[M].constructor=window[M]};P("Float32Array"),P("Uint32Array"),P("Uint16Array"),P("Int16Array"),P("ArrayBuffer")}for(var S in window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),Object.assign||(Object.assign=function(M){"use strict";if(null==M)throw new TypeError("Cannot convert undefined or null to object");for(var U=Object(M),W=Object.prototype.hasOwnProperty,X=1,V;X<arguments.length;X++)if(V=arguments[X],null!=V)for(var H in V)W.call(V,H)&&(U[H]=V[H]);return U}),C.Utils={reverseString:function(M){return M.split("").reverse().join("")},getProperty:function(M,O){for(var U=O.split("."),W=U.length,X=0,V=M,H;X<W;)if(H=U[X],null!=V)V=V[H],X++;else return;return V},setProperty:function(M,O,U){for(var W=O.split("."),X=W.pop(),V=W.length,H=1,Y=W[0];H<V&&(M=M[Y]);)Y=W[H],H++;return M&&(M[X]=U),M},chanceRoll:function(M){return void 0===M&&(M=50),0<M&&100*Math.random()<=M},randomChoice:function(M,O){return 0.5>Math.random()?M:O},parseDimension:function(M,O){var U=0,W=0;return"string"==typeof M?"%"===M.substr(-1)?(U=parseInt(M,10)/100,W=0===O?window.innerWidth*U:window.innerHeight*U):W=parseInt(M,10):W=M,W},pad:function(M,O,U,W){if(void 0===O)var O=0;if(void 0===U)var U=" ";if(void 0===W)var W=3;M=M.toString();var X=0;if(O+1>=M.length)switch(W){case 1:M=Array(O+1-M.length).join(U)+M;break;case 3:var V=Math.ceil((X=O-M.length)/2),H=X-V;M=Array(H+1).join(U)+M+Array(V+1).join(U);break;default:M+=Array(O+1-M.length).join(U);}return M},isPlainObject:function(M){if("object"!=typeof M||M.nodeType||M===M.window)return!1;try{if(M.constructor&&!{}.hasOwnProperty.call(M.constructor.prototype,"isPrototypeOf"))return!1}catch(O){return!1}return!0},extend:function(){var H=arguments[0]||{},Y=1,z=arguments.length,K=!1,M,O,U,W,X,V;for("boolean"==typeof H&&(K=H,H=arguments[1]||{},Y=2),z===Y&&(H=this,--Y);Y<z;Y++)if(null!=(M=arguments[Y]))for(O in M)(U=H[O],W=M[O],H!==W)&&(K&&W&&(C.Utils.isPlainObject(W)||(X=Array.isArray(W)))?(X?(X=!1,V=U&&Array.isArray(U)?U:[]):V=U&&C.Utils.isPlainObject(U)?U:{},H[O]=C.Utils.extend(K,V,W)):void 0!=W&&(H[O]=W));return H},mixinPrototype:function(M,O,U){void 0===U&&(U=!1);for(var W=Object.keys(O),X=0;X<W.length;X++){var V=W[X],H=O[V];if(!U&&V in M)continue;else H&&("function"==typeof H.get||"function"==typeof H.set)?"function"==typeof H.clone?M[V]=H.clone():Object.defineProperty(M,V,H):M[V]=H}},mixin:function(M,O){if(!M||"object"!=typeof M)return O;for(var U in M){var W=M[U];if(!(W.childNodes||W.cloneNode)){var X=typeof M[U];O[U]=M[U]&&"object"==X?typeof O[U]==X?C.Utils.mixin(M[U],O[U]):C.Utils.mixin(M[U],new W.constructor):M[U]}}return O}},C.Circle=function(M,O,U){M=M||0,O=O||0,U=U||0,this.x=M,this.y=O,this._diameter=U,this._radius=0,0<U&&(this._radius=0.5*U),this.type=C.CIRCLE},C.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(M){void 0===M&&(M=new C.Point);var O=2*Math.PI*Math.random(),U=Math.random()+Math.random(),W=1<U?2-U:U,X=W*Math.cos(O),V=W*Math.sin(O);return M.x=this.x+X*this.radius,M.y=this.y+V*this.radius,M},getBounds:function(){return new C.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(M,O,U){return this.x=M,this.y=O,this._diameter=U,this._radius=0.5*U,this},copyFrom:function(M){return this.setTo(M.x,M.y,M.diameter)},copyTo:function(M){return M.x=this.x,M.y=this.y,M.diameter=this._diameter,M},distance:function(M,O){var U=C.Math.distance(this.x,this.y,M.x,M.y);return O?Math.round(U):U},clone:function(M){return void 0===M||null===M?M=new C.Circle(this.x,this.y,this.diameter):M.setTo(this.x,this.y,this.diameter),M},contains:function(M,O){return C.Circle.contains(this,M,O)},circumferencePoint:function(M,O,U){return C.Circle.circumferencePoint(this,M,O,U)},offset:function(M,O){return this.x+=M,this.y+=O,this},offsetPoint:function(M){return this.offset(M.x,M.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},C.Circle.prototype.constructor=C.Circle,Object.defineProperty(C.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(M){0<M&&(this._diameter=M,this._radius=0.5*M)}}),Object.defineProperty(C.Circle.prototype,"radius",{get:function(){return this._radius},set:function(M){0<M&&(this._radius=M,this._diameter=2*M)}}),Object.defineProperty(C.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(M){M>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-M}}),Object.defineProperty(C.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(M){M<this.x?(this._radius=0,this._diameter=0):this.radius=M-this.x}}),Object.defineProperty(C.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(M){M>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-M}}),Object.defineProperty(C.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(M){M<this.y?(this._radius=0,this._diameter=0):this.radius=M-this.y}}),Object.defineProperty(C.Circle.prototype,"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(C.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(M){!0===M&&this.setTo(0,0,0)}}),C.Circle.contains=function(M,O,U){if(0<M.radius&&O>=M.left&&O<=M.right&&U>=M.top&&U<=M.bottom){var W=(M.x-O)*(M.x-O),X=(M.y-U)*(M.y-U);return W+X<=M.radius*M.radius}return!1},C.Circle.equals=function(M,O){return M.x===O.x&&M.y===O.y&&M.diameter===O.diameter},C.Circle.intersects=function(M,O){return C.Math.distance(M.x,M.y,O.x,O.y)<=M.radius+O.radius},C.Circle.circumferencePoint=function(M,O,U,W){return void 0===U&&(U=!1),void 0===W&&(W=new C.Point),!0===U&&(O=C.Math.degToRad(O)),W.x=M.x+M.radius*Math.cos(O),W.y=M.y+M.radius*Math.sin(O),W},C.Circle.intersectsRectangle=function(M,O){var U=Math.abs(M.x-O.x-O.halfWidth),W=O.halfWidth+M.radius;if(U>W)return!1;var X=Math.abs(M.y-O.y-O.halfHeight),V=O.halfHeight+M.radius;if(X>V)return!1;if(U<=O.halfWidth||X<=O.halfHeight)return!0;var H=U-O.halfWidth,Y=X-O.halfHeight,J=M.radius*M.radius;return H*H+Y*Y<=J},PIXI.Circle=C.Circle,C.Ellipse=function(M,O,U,W){M=M||0,O=O||0,U=U||0,W=W||0,this.x=M,this.y=O,this.width=U,this.height=W,this.type=C.ELLIPSE},C.Ellipse.prototype={setTo:function(M,O,U,W){return this.x=M,this.y=O,this.width=U,this.height=W,this},getBounds:function(){return new C.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(M){return this.setTo(M.x,M.y,M.width,M.height)},copyTo:function(M){return M.x=this.x,M.y=this.y,M.width=this.width,M.height=this.height,M},clone:function(M){return void 0===M||null===M?M=new C.Ellipse(this.x,this.y,this.width,this.height):M.setTo(this.x,this.y,this.width,this.height),M},contains:function(M,O){return C.Ellipse.contains(this,M,O)},random:function(M){void 0===M&&(M=new C.Point);var O=2*(Math.random()*Math.PI),U=Math.random();return M.x=Math.sqrt(U)*Math.cos(O),M.y=Math.sqrt(U)*Math.sin(O),M.x=this.x+M.x*this.width/2,M.y=this.y+M.y*this.height/2,M},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},C.Ellipse.prototype.constructor=C.Ellipse,Object.defineProperty(C.Ellipse.prototype,"left",{get:function(){return this.x},set:function(M){this.x=M}}),Object.defineProperty(C.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(M){this.width=M<this.x?0:M-this.x}}),Object.defineProperty(C.Ellipse.prototype,"top",{get:function(){return this.y},set:function(M){this.y=M}}),Object.defineProperty(C.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(M){this.height=M<this.y?0:M-this.y}}),Object.defineProperty(C.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(M){!0===M&&this.setTo(0,0,0,0)}}),C.Ellipse.contains=function(M,O,U){if(0>=M.width||0>=M.height)return!1;var W=(O-M.x)/M.width-0.5,X=(U-M.y)/M.height-0.5;return W*=W,X*=X,0.25>W+X},PIXI.Ellipse=C.Ellipse,C.Line=function(M,O,U,W){M=M||0,O=O||0,U=U||0,W=W||0,this.start=new C.Point(M,O),this.end=new C.Point(U,W),this.type=C.LINE},C.Line.prototype={setTo:function(M,O,U,W){return this.start.setTo(M,O),this.end.setTo(U,W),this},fromSprite:function(M,O,U){return void 0===U&&(U=!1),U?this.setTo(M.centerX,M.centerY,O.centerX,O.centerY):this.setTo(M.x,M.y,O.x,O.y)},fromAngle:function(M,O,U,W){return this.start.setTo(M,O),this.end.setTo(M+Math.cos(U)*W,O+Math.sin(U)*W),this},rotate:function(M,O){var U=(this.start.x+this.end.x)/2,W=(this.start.y+this.end.y)/2;return this.start.rotate(U,W,M,O),this.end.rotate(U,W,M,O),this},rotateAround:function(M,O,U,W){return this.start.rotate(M,O,U,W),this.end.rotate(M,O,U,W),this},intersects:function(M,O,U){return C.Line.intersectsPoints(this.start,this.end,M.start,M.end,O,U)},reflect:function(M){return C.Line.reflect(this,M)},midPoint:function(M){return void 0===M&&(M=new C.Point),M.x=(this.start.x+this.end.x)/2,M.y=(this.start.y+this.end.y)/2,M},centerOn:function(M,O){var U=(this.start.x+this.end.x)/2,W=(this.start.y+this.end.y)/2,X=M-U,V=O-W;this.start.add(X,V),this.end.add(X,V)},pointOnLine:function(M,O,U){return C.Math.fuzzyEqual((M-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(O-this.start.y),U||0)},pointOnSegment:function(M,O,U){var W=Math.min(this.start.x,this.end.x),X=Math.max(this.start.x,this.end.x),V=Math.min(this.start.y,this.end.y),H=Math.max(this.start.y,this.end.y);return this.pointOnLine(M,O,U)&&M>=W&&M<=X&&O>=V&&O<=H},random:function(M){void 0===M&&(M=new C.Point);var O=Math.random();return M.x=this.start.x+O*(this.end.x-this.start.x),M.y=this.start.y+O*(this.end.y-this.start.y),M},coordinatesOnLine:function(M,O){void 0===M&&(M=1),void 0===O&&(O=[]);var U=Math.round(this.start.x),W=Math.round(this.start.y),X=Math.round(this.end.x),V=Math.round(this.end.y),H=Math.abs(X-U),Y=Math.abs(V-W),z=U<X?1:-1,K=W<V?1:-1,J=H-Y;O.push([U,W]);for(var Q=1,Z;U!==X||W!==V;)Z=J<<1,Z>-Y&&(J-=Y,U+=z),Z<H&&(J+=H,W+=K),0==Q%M&&O.push([U,W]),Q++;return O},clone:function(M){return void 0===M||null===M?M=new C.Line(this.start.x,this.start.y,this.end.x,this.end.y):M.setTo(this.start.x,this.start.y,this.end.x,this.end.y),M}},Object.defineProperty(C.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(C.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(C.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(C.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(C.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(C.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(C.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(C.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(C.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(C.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(C.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(C.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(C.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(C.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(C.Line.prototype,"normalAngle",{get:function(){return C.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),C.Line.intersectsPoints=function(M,O,U,W,X,V){void 0===X&&(X=!0),void 0===V&&(V=new C.Point);var H=O.y-M.y,Y=W.y-U.y,z=M.x-O.x,K=U.x-W.x,J=O.x*M.y-M.x*O.y,Q=W.x*U.y-U.x*W.y,Z=H*K-Y*z;if(0==Z)return null;if(V.x=(z*Q-K*J)/Z,V.y=(Y*J-H*Q)/Z,X){var $=(W.y-U.y)*(O.x-M.x)-(W.x-U.x)*(O.y-M.y),ee=((W.x-U.x)*(M.y-U.y)-(W.y-U.y)*(M.x-U.x))/$,te=((O.x-M.x)*(M.y-U.y)-(O.y-M.y)*(M.x-U.x))/$;return 0<=ee&&1>=ee&&0<=te&&1>=te?V:null}return V},C.Line.intersects=function(M,O,U,W){return C.Line.intersectsPoints(M.start,M.end,O.start,O.end,U,W)},C.Line.intersectsRectangle=function(M,O){if(0===M.length||O.empty)return!1;var U=M.start.x,W=M.start.y,X=M.end.x,V=M.end.y,H=O.x,Y=O.y,z=O.right,K=O.bottom,J=0;if(U>=H&&U<=z&&W>=Y&&W<=K||X>=H&&X<=z&&V>=Y&&V<=K)return!0;if(U<H&&X>=H){if(J=W+(V-W)*(H-U)/(X-U),J>Y&&J<=K)return!0;}else if(U>z&&X<=z&&(J=W+(V-W)*(z-U)/(X-U),J>=Y&&J<=K))return!0;if(W<Y&&V>=Y){if(J=U+(X-U)*(Y-W)/(V-W),J>=H&&J<=z)return!0;}else if(W>K&&V<=K&&(J=U+(X-U)*(K-W)/(V-W),J>=H&&J<=z))return!0;return!1},C.Line.reflect=function(M,O){return 2*O.normalAngle-3.141592653589793-M.angle},C.Matrix=function(M,O,U,W,X,V){(void 0===M||null===M)&&(M=1),(void 0===O||null===O)&&(O=0),(void 0===U||null===U)&&(U=0),(void 0===W||null===W)&&(W=1),(void 0===X||null===X)&&(X=0),(void 0===V||null===V)&&(V=0),this.a=M,this.b=O,this.c=U,this.d=W,this.tx=X,this.ty=V,this.type=C.MATRIX},C.Matrix.prototype={fromArray:function(M){return this.setTo(M[0],M[1],M[3],M[4],M[2],M[5])},setTo:function(M,O,U,W,X,V){return this.a=M,this.b=O,this.c=U,this.d=W,this.tx=X,this.ty=V,this},clone:function(M){return void 0===M||null===M?M=new C.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(M.a=this.a,M.b=this.b,M.c=this.c,M.d=this.d,M.tx=this.tx,M.ty=this.ty),M},copyTo:function(M){return M.copyFrom(this),M},copyFrom:function(M){return this.a=M.a,this.b=M.b,this.c=M.c,this.d=M.d,this.tx=M.tx,this.ty=M.ty,this},toArray:function(M,O){return void 0===O&&(O=new Float32Array(9)),M?(O[0]=this.a,O[1]=this.b,O[2]=0,O[3]=this.c,O[4]=this.d,O[5]=0,O[6]=this.tx,O[7]=this.ty,O[8]=1):(O[0]=this.a,O[1]=this.c,O[2]=this.tx,O[3]=this.b,O[4]=this.d,O[5]=this.ty,O[6]=0,O[7]=0,O[8]=1),O},apply:function(M,O){return void 0===O&&(O=new C.Point),O.x=this.a*M.x+this.c*M.y+this.tx,O.y=this.b*M.x+this.d*M.y+this.ty,O},applyInverse:function(M,O){void 0===O&&(O=new C.Point);var U=1/(this.a*this.d+this.c*-this.b),W=M.x,X=M.y;return O.x=this.d*U*W+-this.c*U*X+(this.ty*this.c-this.tx*this.d)*U,O.y=this.a*U*X+-this.b*U*W+(-this.ty*this.a+this.tx*this.b)*U,O},translate:function(M,O){return this.tx+=M,this.ty+=O,this},scale:function(M,O){return this.a*=M,this.d*=O,this.c*=M,this.b*=O,this.tx*=M,this.ty*=O,this},rotate:function(M){var O=Math.cos(M),U=Math.sin(M),W=this.a,X=this.c,V=this.tx;return this.a=W*O-this.b*U,this.b=W*U+this.b*O,this.c=X*O-this.d*U,this.d=X*U+this.d*O,this.tx=V*O-this.ty*U,this.ty=V*U+this.ty*O,this},append:function(M){var O=this.a,U=this.b,W=this.c,X=this.d;return this.a=M.a*O+M.b*W,this.b=M.a*U+M.b*X,this.c=M.c*O+M.d*W,this.d=M.c*U+M.d*X,this.tx=M.tx*O+M.ty*W+this.tx,this.ty=M.tx*U+M.ty*X+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},C.identityMatrix=new C.Matrix,C.Point=function(M,O){M=M||0,O=O||0,this.x=M,this.y=O,this.type=C.POINT},C.Point.prototype={copyFrom:function(M){return this.setTo(M.x,M.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(M,O){return C.Point.set(this,M,O)},set:function(M,O){return C.Point.set(this,M,O)},setToPolar:function(M,O,U){return null==O&&(O=1),U&&(M=C.Math.degToRad(M)),this.setTo(Math.cos(M)*O,Math.sin(M)*O)},add:function(M,O){return this.x+=M,this.y+=O,this},subtract:function(M,O){return this.x-=M,this.y-=O,this},multiply:function(M,O){return this.x*=M,this.y*=O,this},divide:function(M,O){return this.x/=M,this.y/=O,this},clampX:function(M,O){return this.x=C.Math.clamp(this.x,M,O),this},clampY:function(M,O){return this.y=C.Math.clamp(this.y,M,O),this},clamp:function(M,O){return this.x=C.Math.clamp(this.x,M,O),this.y=C.Math.clamp(this.y,M,O),this},clone:function(M){return void 0===M||null===M?M=new C.Point(this.x,this.y):M.setTo(this.x,this.y),M},copyTo:function(M){return M.x=this.x,M.y=this.y,M},distance:function(M,O){return C.Point.distance(this,M,O)},equals:function(M){return M.x===this.x&&M.y===this.y},angle:function(M,O){return void 0===O&&(O=!1),O?C.Math.radToDeg(Math.atan2(M.y-this.y,M.x-this.x)):Math.atan2(M.y-this.y,M.x-this.x)},rotate:function(M,O,U,W,X){return C.Point.rotate(this,M,O,U,W,X)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(M){return this.normalize().multiply(M,M)},normalize:function(){if(!this.isZero()){var M=this.getMagnitude();this.x/=M,this.y/=M}return this},limit:function(M){return this.getMagnitudeSq()>M*M&&this.setMagnitude(M),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(M){return this.x*M.x+this.y*M.y},cross:function(M){return this.x*M.y-this.y*M.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},C.Point.prototype.constructor=C.Point,C.Point.add=function(M,O,U){return void 0===U&&(U=new C.Point),U.x=M.x+O.x,U.y=M.y+O.y,U},C.Point.subtract=function(M,O,U){return void 0===U&&(U=new C.Point),U.x=M.x-O.x,U.y=M.y-O.y,U},C.Point.multiply=function(M,O,U){return void 0===U&&(U=new C.Point),U.x=M.x*O.x,U.y=M.y*O.y,U},C.Point.divide=function(M,O,U){return void 0===U&&(U=new C.Point),U.x=M.x/O.x,U.y=M.y/O.y,U},C.Point.equals=function(M,O){return M.x===O.x&&M.y===O.y},C.Point.angle=function(M,O){return Math.atan2(M.y-O.y,M.x-O.x)},C.Point.negative=function(M,O){return void 0===O&&(O=new C.Point),O.setTo(-M.x,-M.y)},C.Point.multiplyAdd=function(M,O,U,W){return void 0===W&&(W=new C.Point),W.setTo(M.x+O.x*U,M.y+O.y*U)},C.Point.interpolate=function(M,O,U,W){return void 0===W&&(W=new C.Point),W.setTo(M.x+(O.x-M.x)*U,M.y+(O.y-M.y)*U)},C.Point.perp=function(M,O){return void 0===O&&(O=new C.Point),O.setTo(-M.y,M.x)},C.Point.rperp=function(M,O){return void 0===O&&(O=new C.Point),O.setTo(M.y,-M.x)},C.Point.distance=function(M,O,U){var W=C.Math.distance(M.x,M.y,O.x,O.y);return U?Math.round(W):W},C.Point.project=function(M,O,U){void 0===U&&(U=new C.Point);var W=M.dot(O)/O.getMagnitudeSq();return 0!=W&&U.setTo(W*O.x,W*O.y),U},C.Point.projectUnit=function(M,O,U){void 0===U&&(U=new C.Point);var W=M.dot(O);return 0!==W&&U.setTo(W*O.x,W*O.y),U},C.Point.normalRightHand=function(M,O){return void 0===O&&(O=new C.Point),O.setTo(-1*M.y,M.x)},C.Point.normalize=function(M,O){void 0===O&&(O=new C.Point);var U=M.getMagnitude();return 0!==U&&O.setTo(M.x/U,M.y/U),O},C.Point.rotate=function(M,O,U,W,X,V){if(X&&(W=C.Math.degToRad(W)),void 0===V){M.subtract(O,U);var H=Math.sin(W),Y=Math.cos(W),z=Y*M.x-H*M.y,K=H*M.x+Y*M.y;M.x=z+O,M.y=K+U}else{var J=W+Math.atan2(M.y-U,M.x-O);M.x=O+V*Math.cos(J),M.y=U+V*Math.sin(J)}return M},C.Point.centroid=function(M,O){if(void 0===O&&(O=new C.Point),"[object Array]"!==Object.prototype.toString.call(M))throw new Error("Phaser.Point. Parameter 'points' must be an array");var U=M.length;if(1>U)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===U)return O.copyFrom(M[0]),O;for(var W=0;W<U;W++)C.Point.add(O,M[W],O);return O.divide(U,U),O},C.Point.parse=function(M,O,U){O=O||"x",U=U||"y";var W=new C.Point;return M[O]&&(W.x=parseInt(M[O],10)),M[U]&&(W.y=parseInt(M[U],10)),W},C.Point.isPoint=function(M){return null!=M&&"number"==typeof M.x&&"number"==typeof M.y},C.Point.set=function(M,O,U){return M.x=O||0,M.y=U||(0===U?0:M.x),M},PIXI.Point=C.Point,C.Polygon=function(){this.area=0,this._points=[],0<arguments.length&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=C.POLYGON},C.Polygon.prototype={toNumberArray:function(M){void 0===M&&(M=[]);for(var O=0;O<this._points.length;O++)"number"==typeof this._points[O]?(M.push(this._points[O]),M.push(this._points[O+1]),O++):(M.push(this._points[O].x),M.push(this._points[O].y));return M},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(M){var O=this._points.slice();return void 0===M||null===M?M=new C.Polygon(O):M.setTo(O),M},contains:function(M,O){var U=!1;if(this.flattened)for(var W=-2,X=this._points.length-2;(W+=2)<this._points.length;X=W){var V=this._points[W],H=this._points[W+1],Y=this._points[X],z=this._points[X+1];(H<=O&&O<z||z<=O&&O<H)&&M<(Y-V)*(O-H)/(z-H)+V&&(U=!U)}else for(var W=-1,X=this._points.length-1;++W<this._points.length;X=W){var V=this._points[W].x,H=this._points[W].y,Y=this._points[X].x,z=this._points[X].y;(H<=O&&O<z||z<=O&&O<H)&&M<(Y-V)*(O-H)/(z-H)+V&&(U=!U)}return U},setTo:function(M){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(M)||(M=Array.prototype.slice.call(arguments));for(var O=Number.MAX_VALUE,U=0,W=M.length;U<W;U++){if("number"==typeof M[U]){var X=new PIXI.Point(M[U],M[U+1]);U++}else if(Array.isArray(M[U]))var X=new PIXI.Point(M[U][0],M[U][1]);else var X=new PIXI.Point(M[U].x,M[U].y);this._points.push(X),X.y<O&&(O=X.y)}this.calculateArea(O)}return this},calculateArea:function(M){for(var V=0,H=this._points.length,O,U,W,X;V<H;V++)O=this._points[V],U=V===H-1?this._points[0]:this._points[V+1],W=(O.y-M+(U.y-M))/2,X=O.x-U.x,this.area+=W*X;return this.area}},C.Polygon.prototype.constructor=C.Polygon,Object.defineProperty(C.Polygon.prototype,"points",{get:function(){return this._points},set:function(M){null==M?this.setTo():this.setTo(M)}}),PIXI.Polygon=C.Polygon,C.Rectangle=function(M,O,U,W){M=M||0,O=O||0,U=U||0,W=W||0,this.x=M,this.y=O,this.width=U,this.height=W,this.type=C.RECTANGLE},C.Rectangle.prototype={offset:function(M,O){return this.x+=M,this.y+=O,this},offsetPoint:function(M){return this.offset(M.x,M.y)},setTo:function(M,O,U,W){return this.x=M,this.y=O,this.width=U,this.height=W,this},scale:function(M,O){return void 0===O&&(O=M),this.width*=M,this.height*=O,this},centerOn:function(M,O){return this.centerX=M,this.centerY=O,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(M){return this.setTo(M.x,M.y,M.width,M.height)},copyTo:function(M){return M.x=this.x,M.y=this.y,M.width=this.width,M.height=this.height,M},inflate:function(M,O){return C.Rectangle.inflate(this,M,O)},size:function(M){return C.Rectangle.size(this,M)},resize:function(M,O){return this.width=M,this.height=O,this},clone:function(M){return C.Rectangle.clone(this,M)},contains:function(M,O){return C.Rectangle.contains(this,M,O)},containsRect:function(M){return C.Rectangle.containsRect(M,this)},equals:function(M){return C.Rectangle.equals(this,M)},intersection:function(M,O){return C.Rectangle.intersection(this,M,O)},intersects:function(M){return C.Rectangle.intersects(this,M)},intersectsRaw:function(M,O,U,W,X){return C.Rectangle.intersectsRaw(this,M,O,U,W,X)},union:function(M,O){return C.Rectangle.union(this,M,O)},random:function(M){return void 0===M&&(M=new C.Point),M.x=this.randomX,M.y=this.randomY,M},getPoint:function(M,O){switch(void 0===O&&(O=new C.Point),M){default:case C.TOP_LEFT:return O.set(this.x,this.y);case C.TOP_CENTER:return O.set(this.centerX,this.y);case C.TOP_RIGHT:return O.set(this.right,this.y);case C.LEFT_CENTER:return O.set(this.x,this.centerY);case C.CENTER:return O.set(this.centerX,this.centerY);case C.RIGHT_CENTER:return O.set(this.right,this.centerY);case C.BOTTOM_LEFT:return O.set(this.x,this.bottom);case C.BOTTOM_CENTER:return O.set(this.centerX,this.bottom);case C.BOTTOM_RIGHT:return O.set(this.right,this.bottom);}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(C.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(C.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(C.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(M){this.height=M<=this.y?0:M-this.y}}),Object.defineProperty(C.Rectangle.prototype,"bottomLeft",{get:function(){return new C.Point(this.x,this.bottom)},set:function(M){this.x=M.x,this.bottom=M.y}}),Object.defineProperty(C.Rectangle.prototype,"bottomRight",{get:function(){return new C.Point(this.right,this.bottom)},set:function(M){this.right=M.x,this.bottom=M.y}}),Object.defineProperty(C.Rectangle.prototype,"left",{get:function(){return this.x},set:function(M){this.width=M>=this.right?0:this.right-M,this.x=M}}),Object.defineProperty(C.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(M){this.width=M<=this.x?0:M-this.x}}),Object.defineProperty(C.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(C.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(C.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(M){this.x=M-this.halfWidth}}),Object.defineProperty(C.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(M){this.y=M-this.halfHeight}}),Object.defineProperty(C.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(C.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(C.Rectangle.prototype,"top",{get:function(){return this.y},set:function(M){M>=this.bottom?(this.height=0,this.y=M):this.height=this.bottom-M}}),Object.defineProperty(C.Rectangle.prototype,"topLeft",{get:function(){return new C.Point(this.x,this.y)},set:function(M){this.x=M.x,this.y=M.y}}),Object.defineProperty(C.Rectangle.prototype,"topRight",{get:function(){return new C.Point(this.x+this.width,this.y)},set:function(M){this.right=M.x,this.y=M.y}}),Object.defineProperty(C.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(M){!0===M&&this.setTo(0,0,0,0)}}),C.Rectangle.prototype.constructor=C.Rectangle,C.Rectangle.inflate=function(M,O,U){return M.x-=O,M.width+=2*O,M.y-=U,M.height+=2*U,M},C.Rectangle.inflatePoint=function(M,O){return C.Rectangle.inflate(M,O.x,O.y)},C.Rectangle.size=function(M,O){return void 0===O||null===O?O=new C.Point(M.width,M.height):O.setTo(M.width,M.height),O},C.Rectangle.clone=function(M,O){return void 0===O||null===O?O=new C.Rectangle(M.x,M.y,M.width,M.height):O.setTo(M.x,M.y,M.width,M.height),O},C.Rectangle.contains=function(M,O,U){return 0>=M.width||0>=M.height?!1:O>=M.x&&O<M.right&&U>=M.y&&U<M.bottom},C.Rectangle.containsRaw=function(M,O,U,W,X,V){return X>=M&&X<M+U&&V>=O&&V<O+W},C.Rectangle.containsPoint=function(M,O){return C.Rectangle.contains(M,O.x,O.y)},C.Rectangle.containsRect=function(M,O){return!(M.volume>O.volume)&&M.x>=O.x&&M.y>=O.y&&M.right<O.right&&M.bottom<O.bottom},C.Rectangle.equals=function(M,O){return M.x===O.x&&M.y===O.y&&M.width===O.width&&M.height===O.height},C.Rectangle.sameDimensions=function(M,O){return M.width===O.width&&M.height===O.height},C.Rectangle.intersection=function(M,O,U){return void 0===U&&(U=new C.Rectangle),C.Rectangle.intersects(M,O)&&(U.x=Math.max(M.x,O.x),U.y=Math.max(M.y,O.y),U.width=Math.min(M.right,O.right)-U.x,U.height=Math.min(M.bottom,O.bottom)-U.y),U},C.Rectangle.intersects=function(M,O){return 0>=M.width||0>=M.height||0>=O.width||0>=O.height?!1:!(M.right<O.x||M.bottom<O.y||M.x>O.right||M.y>O.bottom)},C.Rectangle.intersectsRaw=function(M,O,U,W,X,V){return void 0===V&&(V=0),!(O>M.right+V||U<M.left-V||W>M.bottom+V||X<M.top-V)},C.Rectangle.union=function(M,O,U){return void 0===U&&(U=new C.Rectangle),U.setTo(Math.min(M.x,O.x),Math.min(M.y,O.y),Math.max(M.right,O.right)-Math.min(M.left,O.left),Math.max(M.bottom,O.bottom)-Math.min(M.top,O.top))},C.Rectangle.aabb=function(M,O){void 0===O&&(O=new C.Rectangle);var U=Number.NEGATIVE_INFINITY,W=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,V=Number.POSITIVE_INFINITY;return M.forEach(function(H){H.x>U&&(U=H.x),H.x<W&&(W=H.x),H.y>X&&(X=H.y),H.y<V&&(V=H.y)}),O.setTo(W,V,U-W,X-V),O},PIXI.Rectangle=C.Rectangle,PIXI.EmptyRectangle=new C.Rectangle(0,0,0,0),C.RoundedRectangle=function(M,O,U,W,X){void 0===M&&(M=0),void 0===O&&(O=0),void 0===U&&(U=0),void 0===W&&(W=0),void 0===X&&(X=20),this.x=M,this.y=O,this.width=U,this.height=W,this.radius=X||20,this.type=C.ROUNDEDRECTANGLE},C.RoundedRectangle.prototype={clone:function(){return new C.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(M,O){if(0>=this.width||0>=this.height)return!1;var U=this.x;if(M>=U&&M<=U+this.width){var W=this.y;if(O>=W&&O<=W+this.height)return!0}return!1}},C.RoundedRectangle.prototype.constructor=C.RoundedRectangle,PIXI.RoundedRectangle=C.RoundedRectangle,C.Camera=function(M,O,U,W,X,V){this.game=M,this.world=M.world,this.id=0,this.view=new C.Rectangle(U,W,X,V),this.bounds=new C.Rectangle(U,W,X,V),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new C.Point(1,1),this.onShakeComplete=new C.Signal,this.onFlashComplete=new C.Signal,this.onFadeComplete=new C.Signal,this.fx=null,this._targetPosition=new C.Point,this._edge=0,this._position=new C.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0},C.Camera.FOLLOW_LOCKON=0,C.Camera.FOLLOW_PLATFORMER=1,C.Camera.FOLLOW_TOPDOWN=2,C.Camera.FOLLOW_TOPDOWN_TIGHT=3,C.Camera.SHAKE_BOTH=4,C.Camera.SHAKE_HORIZONTAL=5,C.Camera.SHAKE_VERTICAL=6,C.Camera.ENABLE_FX=!0,C.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,C.Graphics&&C.Camera.ENABLE_FX&&(this.fx=new C.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(M,O,U,W){void 0===O&&(O=C.Camera.FOLLOW_LOCKON),void 0===U&&(U=1),void 0===W&&(W=1),this.target=M,this.lerp.set(U,W);var X;switch(O){case C.Camera.FOLLOW_PLATFORMER:var V=this.width/8,H=this.height/3;this.deadzone=new C.Rectangle((this.width-V)/2,(this.height-H)/2-0.25*H,V,H);break;case C.Camera.FOLLOW_TOPDOWN:X=Math.max(this.width,this.height)/4,this.deadzone=new C.Rectangle((this.width-X)/2,(this.height-X)/2,X,X);break;case C.Camera.FOLLOW_TOPDOWN_TIGHT:X=Math.max(this.width,this.height)/8,this.deadzone=new C.Rectangle((this.width-X)/2,(this.height-X)/2,X,X);break;case C.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;}},unfollow:function(){this.target=null},focusOn:function(M){this.setPosition(Math.round(M.x-this.view.halfWidth),Math.round(M.y-this.view.halfHeight))},focusOnXY:function(M,O){this.setPosition(Math.round(M-this.view.halfWidth),Math.round(O-this.view.halfHeight))},shake:function(M,O,U,W,X){return(void 0===M&&(M=0.05),void 0===O&&(O=500),void 0===U&&(U=!0),void 0===W&&(W=C.Camera.SHAKE_BOTH),void 0===X&&(X=!0),U||!(0<this._shake.duration))&&(this._shake.intensity=M,this._shake.duration=O,this._shake.shakeBounds=X,this._shake.x=0,this._shake.y=0,this._shake.horizontal=W===C.Camera.SHAKE_BOTH||W===C.Camera.SHAKE_HORIZONTAL,this._shake.vertical=W===C.Camera.SHAKE_BOTH||W===C.Camera.SHAKE_VERTICAL,!0)},flash:function(M,O,U,W){return(void 0===M&&(M=16777215),void 0===O&&(O=500),void 0===U&&(U=!1),void 0===W&&(W=1),this.fx&&(U||!(0<this._fxDuration)))&&(this.fx.clear(),this.fx.beginFill(M,W),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=O,this._fxType=0,!0)},fade:function(M,O,U,W){return(void 0===M&&(M=0),void 0===O&&(O=500),void 0===U&&(U=!1),void 0===W&&(W=1),this.fx&&(U||!(0<this._fxDuration)))&&(this.fx.clear(),this.fx.beginFill(M,W),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=O,this._fxType=1,!0)},update:function(){0<this._fxDuration&&this.updateFX(),0<this._shake.duration&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,0>=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,0>=this._shake.duration?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=2*(this.game.rnd.frac()*this._shake.intensity*this.view.width)-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=2*(this.game.rnd.frac()*this._shake.intensity*this.view.height)-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var M=this.view.x+this._shake.x,O=this.view.right+this._shake.x,U=this.view.y+this._shake.y,W=this.view.bottom+this._shake.y;M<=this.bounds.x*this.scale.x?(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,!this._shake.shakeBounds&&(this._shake.x=0)):O>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,!this._shake.shakeBounds&&(this._shake.x=0)),U<=this.bounds.top*this.scale.y?(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,!this._shake.shakeBounds&&(this._shake.y=0)):W>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,!this._shake.shakeBounds&&(this._shake.y=0))},setPosition:function(M,O){this.view.x=M,this.view.y=O,this.bounds&&this.checkBounds()},setSize:function(M,O){this.view.width=M,this.view.height=O},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this._shake.x=0,this._shake.y=0,this.resetFX()},resetFX:function(){this.fx&&(this.fx.clear(),this.fx.alpha=0),this._fxDuration=0}},C.Camera.prototype.constructor=C.Camera,Object.defineProperty(C.Camera.prototype,"x",{get:function(){return this.view.x},set:function(M){this.view.x=M,this.bounds&&this.checkBounds()}}),Object.defineProperty(C.Camera.prototype,"y",{get:function(){return this.view.y},set:function(M){this.view.y=M,this.bounds&&this.checkBounds()}}),Object.defineProperty(C.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(M){"undefined"!=typeof M.x&&(this.view.x=M.x),"undefined"!=typeof M.y&&(this.view.y=M.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(C.Camera.prototype,"width",{get:function(){return this.view.width},set:function(M){this.view.width=M}}),Object.defineProperty(C.Camera.prototype,"height",{get:function(){return this.view.height},set:function(M){this.view.height=M}}),Object.defineProperty(C.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(M){this._shake.intensity=M}}),C.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},C.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},C.State.prototype.constructor=C.State,C.StateManager=function(M,O){this.game=M,this.states={},this._pendingState=null,"undefined"!=typeof O&&null!==O&&(this._pendingState=O),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new C.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},C.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(M,O,U){void 0===U&&(U=!1);var W;return O instanceof C.State?W=O:"object"==typeof O?(W=O,W.game=this.game):"function"==typeof O&&(W=new O(this.game)),this.states[M]=W,U&&(this.game.isBooted?this.start(M):this._pendingState=M),W},remove:function(M){this.current===M&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[M]},start:function(M,O,U){void 0===O&&(O=!0),void 0===U&&(U=!1),this.checkState(M)&&(this._pendingState=M,this._clearWorld=O,this._clearCache=U,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(M,O){void 0===M&&(M=!0),void 0===O&&(O=!1),this._pendingState=this.current,this._clearWorld=M,this._clearCache=O,2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var M=this.current;if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,M),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(M){var O=this.states[M];return O?O.preload||O.create||O.update||O.render||(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+M),!1)},link:function(M){this.states[M].game=this.game,this.states[M].add=this.game.add,this.states[M].make=this.game.make,this.states[M].camera=this.game.camera,this.states[M].cache=this.game.cache,this.states[M].input=this.game.input,this.states[M].load=this.game.load,this.states[M].math=this.game.math,this.states[M].sound=this.game.sound,this.states[M].scale=this.game.scale,this.states[M].state=this,this.states[M].stage=this.game.stage,this.states[M].time=this.game.time,this.states[M].tweens=this.game.tweens,this.states[M].world=this.game.world,this.states[M].particles=this.game.particles,this.states[M].rnd=this.game.rnd,this.states[M].physics=this.game.physics,this.states[M].key=M},unlink:function(M){this.states[M]&&(this.states[M].game=null,this.states[M].add=null,this.states[M].make=null,this.states[M].camera=null,this.states[M].cache=null,this.states[M].input=null,this.states[M].load=null,this.states[M].math=null,this.states[M].sound=null,this.states[M].scale=null,this.states[M].state=null,this.states[M].stage=null,this.states[M].time=null,this.states[M].tweens=null,this.states[M].world=null,this.states[M].particles=null,this.states[M].rnd=null,this.states[M].physics=null)},setCurrentState:function(M){this.callbackContext=this.states[M],this.link(M),this.onInitCallback=this.states[M].init||this.dummy,this.onPreloadCallback=this.states[M].preload||null,this.onLoadRenderCallback=this.states[M].loadRender||null,this.onLoadUpdateCallback=this.states[M].loadUpdate||null,this.onCreateCallback=this.states[M].create||null,this.onUpdateCallback=this.states[M].update||null,this.onPreRenderCallback=this.states[M].preRender||null,this.onRenderCallback=this.states[M].render||null,this.onResizeCallback=this.states[M].resize||null,this.onPausedCallback=this.states[M].paused||null,this.onResumedCallback=this.states[M].resumed||null,this.onPauseUpdateCallback=this.states[M].pauseUpdate||null,this.onShutDownCallback=this.states[M].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=M,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),M===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(M){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,M)},resize:function(M,O){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,M,O)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===C.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},C.StateManager.prototype.constructor=C.StateManager,Object.defineProperty(C.StateManager.prototype,"created",{get:function(){return this._created}}),C.Signal=function(){},C.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(M,O){if("function"!=typeof M)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",O))},_registerListener:function(M,O,U,W,X){var V=this._indexOfListener(M,U),H;if(-1===V)H=new C.SignalBinding(this,M,O,U,W,X),this._addBinding(H);else if(H=this._bindings[V],H.isOnce()!==O)throw new Error("You cannot add"+(O?"":"Once")+"() then add"+(O?"Once":"")+"() the same listener without removing the relationship first.");return this.memorize&&this._prevParams&&H.execute(this._prevParams),H},_addBinding:function(M){this._bindings||(this._bindings=[]);var O=this._bindings.length;do O--;while(this._bindings[O]&&M._priority<=this._bindings[O]._priority);this._bindings.splice(O+1,0,M)},_indexOfListener:function(M,O){if(!this._bindings)return-1;void 0===O&&(O=null);for(var U=this._bindings.length,W;U--;)if(W=this._bindings[U],W._listener===M&&W.context===O)return U;return-1},has:function(M,O){return-1!==this._indexOfListener(M,O)},add:function(M,O,U){this.validateListener(M,"add");var W=[];if(3<arguments.length)for(var X=3;X<arguments.length;X++)W.push(arguments[X]);return this._registerListener(M,!1,O,U,W)},addOnce:function(M,O,U){this.validateListener(M,"addOnce");var W=[];if(3<arguments.length)for(var X=3;X<arguments.length;X++)W.push(arguments[X]);return this._registerListener(M,!0,O,U,W)},remove:function(M,O){this.validateListener(M,"remove");var U=this._indexOfListener(M,O);return-1!==U&&(this._bindings[U]._destroy(),this._bindings.splice(U,1)),M},removeAll:function(M){if(void 0===M&&(M=null),!!this._bindings){for(var O=this._bindings.length;O--;)M?this._bindings[O].context===M&&(this._bindings[O]._destroy(),this._bindings.splice(O,1)):this._bindings[O]._destroy();M||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var M=Array.prototype.slice.call(arguments),O=this._bindings.length,U;if(this.memorize&&(this._prevParams=M),!!O){U=this._bindings.slice(),this._shouldPropagate=!0;do O--;while(U[O]&&this._shouldPropagate&&!1!==U[O].execute(M))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(C.Signal.prototype,"boundDispatch",{get:function(){var M=this;return this._boundDispatch||(this._boundDispatch=function(){return M.dispatch.apply(M,arguments)})}}),C.Signal.prototype.constructor=C.Signal,C.SignalBinding=function(M,O,U,W,X,V){this._listener=O,U&&(this._isOnce=!0),null!=W&&(this.context=W),this._signal=M,X&&(this._priority=X),V&&V.length&&(this._args=V)},C.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(M){var O,U;return this.active&&!!this._listener&&(U=this.params?this.params.concat(M):M,this._args&&(U=U.concat(this._args)),O=this._listener.apply(this.context,U),this.callCount++,this._isOnce&&this.detach()),O},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},C.SignalBinding.prototype.constructor=C.SignalBinding,C.Filter=function(M,O,U){this.game=M,this.type=C.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new C.Point;var W=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[W.getFullYear(),W.getMonth(),W.getDate(),60*(60*W.getHours())+60*W.getMinutes()+W.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},O)for(var X in O)this.uniforms[X]=O[X];"string"==typeof U&&(U=U.split("\n")),this.fragmentSrc=U||[]},C.Filter.prototype={init:function(){},setResolution:function(M,O){this.uniforms.resolution.value.x=M,this.uniforms.resolution.value.y=O},update:function(M){if(M){var O=M.x/this.game.width,U=1-M.y/this.game.height;(O!==this.prevPoint.x||U!==this.prevPoint.y)&&(this.uniforms.mouse.value.x=O.toFixed(2),this.uniforms.mouse.value.y=U.toFixed(2),this.prevPoint.set(O,U))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(M,O,U,W,X,V){void 0===X&&(X=0),void 0===V&&(V=0),void 0!==U&&null!==U?this.width=U:U=this.width,void 0!==W&&null!==W?this.height=W:W=this.height;var H=this.game.add.image(M,O,C.Cache.DEFAULT);return H.width=U,H.height=W,H.anchor.set(X,V),H.filters=[this],H},syncUniforms:function(){for(var M=0;M<this.shaders.length;M++)this.shaders[M].dirty=!0},destroy:function(){this.passes.length=0,this.shaders.length=0,this.fragmentSrc.length=0,this.game=null,this.uniforms=null,this.prevPoint=null}},C.Filter.prototype.constructor=C.Filter,Object.defineProperty(C.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(M){this.uniforms.resolution.value.x=M}}),Object.defineProperty(C.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(M){this.uniforms.resolution.value.y=M}}),C.Plugin=function(M,O){void 0===O&&(O=null),this.game=M,this.parent=O,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},C.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},C.Plugin.prototype.constructor=C.Plugin,C.PluginManager=function(M){this.game=M,this.plugins=[],this._len=0,this._i=0},C.PluginManager.prototype={add:function(M){var O=Array.prototype.slice.call(arguments,1),U=!1;return"function"==typeof M?M=new M(this.game,this):(M.game=this.game,M.parent=this),"function"==typeof M.preUpdate&&(M.hasPreUpdate=!0,U=!0),"function"==typeof M.update&&(M.hasUpdate=!0,U=!0),"function"==typeof M.postUpdate&&(M.hasPostUpdate=!0,U=!0),"function"==typeof M.render&&(M.hasRender=!0,U=!0),"function"==typeof M.postRender&&(M.hasPostRender=!0,U=!0),U?((M.hasPreUpdate||M.hasUpdate||M.hasPostUpdate)&&(M.active=!0),(M.hasRender||M.hasPostRender)&&(M.visible=!0),this._len=this.plugins.push(M),"function"==typeof M.init&&M.init.apply(M,O),M):null},remove:function(M,O){for(void 0===O&&(O=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===M)return O&&M.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},C.PluginManager.prototype.constructor=C.PluginManager,C.Stage=function(M){this.game=M,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new C.Matrix,this.stage=this,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),M.config&&this.parseConfig(M.config)},C.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),C.Stage.prototype.constructor=C.Stage,C.Stage.prototype.parseConfig=function(M){M.disableVisibilityChange&&(this.disableVisibilityChange=M.disableVisibilityChange),M.backgroundColor&&this.setBackgroundColor(M.backgroundColor)},C.Stage.prototype.boot=function(){C.DOM.getOffset(this.game.canvas,this.offset),C.Canvas.setUserSelect(this.game.canvas,"none"),C.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},C.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var M=0,O;M<this.children.length;)O=this.children[M],O.preUpdate(),this===O.parent&&M++},C.Stage.prototype.update=function(){for(var M=this.children.length;M--;)this.children[M].update()},C.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var M=0;M<this.children.length;M++)this.children[M].postUpdate();this.updateTransform()},C.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var M=0;M<this.children.length;M++)this.children[M].updateTransform()},C.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0===document.hidden?void 0===document.webkitHidden?void 0===document.mozHidden?void 0===document.msHidden?null:"msvisibilitychange":"mozvisibilitychange":"webkitvisibilitychange":"visibilitychange";var M=this;this._onChange=function(O){return M.visibilityChange(O)},this._onClick=function(O){void 0===document.hasFocus||document.hasFocus()||M.visibilityChange(O)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.addEventListener("click",this._onClick),this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){C.Stage.prototype.visibilityChange.call(M,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){C.Stage.prototype.visibilityChange.call(M,{type:"resume"})}))},C.Stage.prototype.visibilityChange=function(M){switch(M.type){case"blur":case"pagehide":return void this.game.focusLoss(M);case"click":case"focus":case"pageshow":return void this.game.focusGain(M);}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===M.type?this.game.gamePaused(M):this.game.gameResumed(M))},C.Stage.prototype.setBackgroundColor=function(M){this.game.transparent||(C.Color.valueToColor(M,this._bgColor),C.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},C.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null,window.removeEventListener("click",this._onClick)},Object.defineProperty(C.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(M){this.setBackgroundColor(M)}}),Object.defineProperty(C.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(M){PIXI.scaleModes.DEFAULT=M?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),C.Group=function(M,O,U,W,X,V){void 0===W&&(W=!1),void 0===X&&(X=!1),void 0===V&&(V=C.Physics.ARCADE),this.game=M,void 0===O&&(O=M.world),this.name=U||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),W?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):O&&(O.addChild(this),this.z=O.children.length),this.type=C.GROUP,this.physicsType=C.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=C.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.updateOnlyExistingChildren=!0,this.onChildInputDown=new C.Signal,this.onChildInputUp=new C.Signal,this.onChildInputOver=new C.Signal,this.onChildInputOut=new C.Signal,this.enableBody=X,this.enableBodyDebug=!1,this.physicsBodyType=V,this.physicsSortDirection=null,this.onDestroy=new C.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new C.Point,this.hash=[],this._sortProperty="z"},C.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),C.Group.prototype.constructor=C.Group,C.Group.RETURN_NONE=0,C.Group.RETURN_TOTAL=1,C.Group.RETURN_CHILD=2,C.Group.RETURN_ALL=3,C.Group.SORT_ASCENDING=-1,C.Group.SORT_DESCENDING=1,C.Group.prototype.add=function(M,O,U){return(void 0===O&&(O=!1),M.parent===this)?M:(M.body&&M.parent&&M.parent.hash&&M.parent.removeFromHash(M),void 0===U?(M.z=this.children.length,this.addChild(M)):(this.addChildAt(M,U),this.updateZ()),this.enableBody&&M.hasOwnProperty("body")&&null===M.body?this.game.physics.enable(M,this.physicsBodyType):M.body&&this.addToHash(M),this.inputEnableChildren&&(!M.input||M.inputEnabled)&&(M.inputEnabled=!0),!O&&M.events&&M.events.onAddedToGroup$dispatch(M,this),null===this.cursor&&(this.cursor=M),M)},C.Group.prototype.addAt=function(M,O,U){return this.add(M,U,O)},C.Group.prototype.addToHash=function(M){if(M.parent===this){var O=this.hash.indexOf(M);if(-1===O)return this.hash.push(M),!0}return!1},C.Group.prototype.removeFromHash=function(M){if(M){var O=this.hash.indexOf(M);if(-1!==O)return this.hash.splice(O,1),!0}return!1},C.Group.prototype.addMultiple=function(M,O){if(M instanceof C.Group)M.moveAll(this,O);else if(Array.isArray(M))for(var U=0;U<M.length;U++)this.add(M[U],O);return M},C.Group.prototype.getAt=function(M){return 0>M||M>=this.children.length?-1:this.getChildAt(M)},C.Group.prototype.create=function(M,O,U,W,X,V){void 0===X&&(X=!0);var H=new this.classType(this.game,M,O,U,W);return H.exists=X,H.visible=X,H.alive=X,this.add(H,!1,V)},C.Group.prototype.createMultiple=function(M,O,U,W){void 0===U&&(U=0),void 0===W&&(W=!1),Array.isArray(O)||(O=[O]),Array.isArray(U)||(U=[U]);var X=this,V=[];return O.forEach(function(H){U.forEach(function(Y){for(var z=0;z<M;z++)V.push(X.create(0,0,H,Y,W))})}),V},C.Group.prototype.updateZ=function(){for(var M=this.children.length;M--;)this.children[M].z=M},C.Group.prototype.align=function(M,O,U,W,X,V){if(void 0===X&&(X=C.TOP_LEFT),void 0===V&&(V=0),0===this.children.length||V>this.children.length||-1===M&&-1===O)return!1;for(var H=new C.Rectangle(0,0,U,W),Y=M*U,z=O*W,K=V,J;K<this.children.length;K++){if(J=this.children[K],J.alignIn)J.alignIn(H,X);else continue;if(-1===M)H.y+=W,H.y===z&&(H.x+=U,H.y=0);else if(-1===O)H.x+=U,H.x===Y&&(H.x=0,H.y+=W);else if(H.x+=U,H.x===Y&&(H.x=0,H.y+=W,H.y===z))return!0}return!0},C.Group.prototype.resetCursor=function(M){if(void 0===M&&(M=0),M>this.children.length-1&&(M=0),this.cursor)return this.cursorIndex=M,this.cursor=this.children[this.cursorIndex],this.cursor},C.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},C.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},C.Group.prototype.swap=function(M,O){this.swapChildren(M,O),this.updateZ()},C.Group.prototype.bringToTop=function(M){return M.parent===this&&this.getIndex(M)<this.children.length&&(this.remove(M,!1,!0),this.add(M,!0)),M},C.Group.prototype.sendToBack=function(M){return M.parent===this&&0<this.getIndex(M)&&(this.remove(M,!1,!0),this.addAt(M,0,!0)),M},C.Group.prototype.moveUp=function(M){if(M.parent===this&&this.getIndex(M)<this.children.length-1){var O=this.getIndex(M),U=this.getAt(O+1);U&&this.swap(M,U)}return M},C.Group.prototype.moveDown=function(M){if(M.parent===this&&0<this.getIndex(M)){var O=this.getIndex(M),U=this.getAt(O-1);U&&this.swap(M,U)}return M},C.Group.prototype.xy=function(M,O,U){return 0>M||M>this.children.length?-1:void(this.getChildAt(M).x=O,this.getChildAt(M).y=U)},C.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},C.Group.prototype.getIndex=function(M){return this.children.indexOf(M)},C.Group.prototype.getByName=function(M){for(var O=0;O<this.children.length;O++)if(this.children[O].name===M)return this.children[O];return null},C.Group.prototype.replace=function(M,O){var U=this.getIndex(M);if(-1!==U)return O.parent&&(O.parent instanceof C.Group?O.parent.remove(O):O.parent.removeChild(O)),this.remove(M),this.addAt(O,U),M},C.Group.prototype.hasProperty=function(M,O){var U=O.length;return 1===U&&O[0]in M||2===U&&O[0]in M&&O[1]in M[O[0]]||3===U&&O[0]in M&&O[1]in M[O[0]]&&O[2]in M[O[0]][O[1]]||4===U&&O[0]in M&&O[1]in M[O[0]]&&O[2]in M[O[0]][O[1]]&&O[3]in M[O[0]][O[1]][O[2]]},C.Group.prototype.setProperty=function(M,O,U,W,X){if(void 0===X&&(X=!1),W=W||0,!this.hasProperty(M,O)&&(!X||0<W))return!1;var V=O.length;return 1===V?0===W?M[O[0]]=U:1===W?M[O[0]]+=U:2===W?M[O[0]]-=U:3===W?M[O[0]]*=U:4==W&&(M[O[0]]/=U):2===V?0===W?M[O[0]][O[1]]=U:1===W?M[O[0]][O[1]]+=U:2===W?M[O[0]][O[1]]-=U:3===W?M[O[0]][O[1]]*=U:4==W&&(M[O[0]][O[1]]/=U):3===V?0===W?M[O[0]][O[1]][O[2]]=U:1===W?M[O[0]][O[1]][O[2]]+=U:2===W?M[O[0]][O[1]][O[2]]-=U:3===W?M[O[0]][O[1]][O[2]]*=U:4==W&&(M[O[0]][O[1]][O[2]]/=U):4===V&&(0===W?M[O[0]][O[1]][O[2]][O[3]]=U:1===W?M[O[0]][O[1]][O[2]][O[3]]+=U:2===W?M[O[0]][O[1]][O[2]][O[3]]-=U:3===W?M[O[0]][O[1]][O[2]][O[3]]*=U:4==W&&(M[O[0]][O[1]][O[2]][O[3]]/=U)),!0},C.Group.prototype.checkProperty=function(M,O,U,W){if(void 0===W&&(W=!1),this!==M.parent)return!1;var X=C.Utils.getProperty(M,O);return void 0===X&&W||X!==U?!1:!0},C.Group.prototype.set=function(M,O,U,W,X,V,H){if(void 0===H&&(H=!1),O=O.split("."),void 0===W&&(W=!1),void 0===X&&(X=!1),(!1===W||W&&M.alive)&&(!1===X||X&&M.visible))return this.setProperty(M,O,U,V,H)},C.Group.prototype.setAll=function(M,O,U,W,X,V){void 0===U&&(U=!1),void 0===W&&(W=!1),void 0===V&&(V=!1),M=M.split("."),X=X||0;for(var H=0;H<this.children.length;H++)(!U||U&&this.children[H].alive)&&(!W||W&&this.children[H].visible)&&this.setProperty(this.children[H],M,O,X,V)},C.Group.prototype.setAllChildren=function(M,O,U,W,X,V){void 0===U&&(U=!1),void 0===W&&(W=!1),void 0===V&&(V=!1),X=X||0;for(var H=0;H<this.children.length;H++)(!U||U&&this.children[H].alive)&&(!W||W&&this.children[H].visible)&&(this.children[H]instanceof C.Group?this.children[H].setAllChildren(M,O,U,W,X,V):this.setProperty(this.children[H],M.split("."),O,X,V))},C.Group.prototype.checkAll=function(M,O,U,W,X){void 0===U&&(U=!1),void 0===W&&(W=!1),void 0===X&&(X=!1);for(var V=0,H;V<this.children.length;V++)if(H=this.children[V],(!U||U&&H.alive)&&(!W||W&&H.visible)&&!this.checkProperty(H,M,O,X))return!1;return!0},C.Group.prototype.checkAny=function(M,O,U,W){void 0===U&&(U=!1),void 0===W&&(W=!1);for(var X=0,V;X<this.children.length;X++)if(V=this.children[X],(!U||U&&V.alive)&&(!W||W&&V.visible)&&this.checkProperty(V,M,O))return!0;return!1},C.Group.prototype.addAll=function(M,O,U,W){this.setAll(M,O,U,W,1)},C.Group.prototype.subAll=function(M,O,U,W){this.setAll(M,O,U,W,2)},C.Group.prototype.multiplyAll=function(M,O,U,W){this.setAll(M,O,U,W,3)},C.Group.prototype.divideAll=function(M,O,U,W){this.setAll(M,O,U,W,4)},C.Group.prototype.killAll=function(){this.callAllExists("kill",!0)},C.Group.prototype.reviveAll=function(){this.callAllExists("revive",!1)},C.Group.prototype.resetAll=function(M,O,U,W,X){this.forEach(this.resetChild,this,X,M,O,U,W)},C.Group.prototype.callAllExists=function(M,O){var U;if(2<arguments.length){U=[];for(var W=2;W<arguments.length;W++)U.push(arguments[W])}for(var W=0;W<this.children.length;W++)this.children[W].exists===O&&this.children[W][M]&&this.children[W][M].apply(this.children[W],U)},C.Group.prototype.callbackFromArray=function(M,O,U){if(1===U){if(M[O[0]])return M[O[0]];}else if(2===U){if(M[O[0]][O[1]])return M[O[0]][O[1]];}else if(3===U){if(M[O[0]][O[1]][O[2]])return M[O[0]][O[1]][O[2]];}else if(4===U){if(M[O[0]][O[1]][O[2]][O[3]])return M[O[0]][O[1]][O[2]][O[3]];}else if(M[O])return M[O];return!1},C.Group.prototype.callAll=function(M,O){if(void 0!==M){M=M.split(".");var U=M.length;if(void 0===O||null===O||""===O)O=null;else if("string"==typeof O){O=O.split(".");var W=O.length}var X;if(2<arguments.length){X=[];for(var V=2;V<arguments.length;V++)X.push(arguments[V])}for(var H=null,Y=null,V=0;V<this.children.length;V++)H=this.callbackFromArray(this.children[V],M,U),O&&H?(Y=this.callbackFromArray(this.children[V],O,W),H&&H.apply(Y,X)):H&&H.apply(this.children[V],X)}},C.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var M=0,O;M<this.children.length;)O=this.children[M],O.preUpdate(),this===O.parent&&M++;return!0},C.Group.prototype.update=function(){for(var M=this.children.length,O;M--;){O=this.children.length,M>=O&&(M=O-1);var U=this.children[M];(!this.updateOnlyExistingChildren||U.exists)&&U.update()}},C.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var M=0;M<this.children.length;M++)this.children[M].postUpdate()},C.Group.prototype.filter=function(M,O){for(var U=-1,W=this.children.length,X=[],V;++U<W;)V=this.children[U],(!O||O&&V.exists)&&M(V,U,this.children)&&X.push(V);return new C.ArraySet(X)},C.Group.prototype.forEach=function(M,O,U){if(void 0===U&&(U=!1),3>=arguments.length)for(var W=0;W<this.children.length;W++)(!U||U&&this.children[W].exists)&&M.call(O,this.children[W]);else{for(var X=[null],W=3;W<arguments.length;W++)X.push(arguments[W]);for(var W=0;W<this.children.length;W++)(!U||U&&this.children[W].exists)&&(X[0]=this.children[W],M.apply(O,X))}},C.Group.prototype.forEachExists=function(M,O){var U;if(2<arguments.length){U=[null];for(var W=2;W<arguments.length;W++)U.push(arguments[W])}this.iterate("exists",!0,C.Group.RETURN_TOTAL,M,O,U)},C.Group.prototype.forEachAlive=function(M,O){var U;if(2<arguments.length){U=[null];for(var W=2;W<arguments.length;W++)U.push(arguments[W])}this.iterate("alive",!0,C.Group.RETURN_TOTAL,M,O,U)},C.Group.prototype.forEachDead=function(M,O){var U;if(2<arguments.length){U=[null];for(var W=2;W<arguments.length;W++)U.push(arguments[W])}this.iterate("alive",!1,C.Group.RETURN_TOTAL,M,O,U)},C.Group.prototype.sort=function(M,O){2>this.children.length||(void 0===M&&(M="z"),void 0===O&&(O=C.Group.SORT_ASCENDING),this._sortProperty=M,O===C.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},C.Group.prototype.customSort=function(M,O){2>this.children.length||(this.children.sort(M.bind(O)),this.updateZ())},C.Group.prototype.ascendingSortHandler=function(M,O){return M[this._sortProperty]<O[this._sortProperty]?-1:M[this._sortProperty]>O[this._sortProperty]?1:M.z<O.z?-1:1},C.Group.prototype.descendingSortHandler=function(M,O){return M[this._sortProperty]<O[this._sortProperty]?1:M[this._sortProperty]>O[this._sortProperty]?-1:0},C.Group.prototype.iterate=function(M,O,U,W,X,V){if(0===this.children.length){if(U===C.Group.RETURN_TOTAL)return 0;if(U===C.Group.RETURN_ALL)return[]}var H=0;if(U===C.Group.RETURN_ALL)var Y=[];for(var z=0;z<this.children.length;z++)if(this.children[z][M]===O){if(H++,W&&(V?(V[0]=this.children[z],W.apply(X,V)):W.call(X,this.children[z])),U===C.Group.RETURN_CHILD)return this.children[z];U===C.Group.RETURN_ALL&&Y.push(this.children[z])}return U===C.Group.RETURN_TOTAL?H:U===C.Group.RETURN_ALL?Y:null},C.Group.prototype.getFirstExists=function(M,O,U,W,X,V){void 0===O&&(O=!1),"boolean"!=typeof M&&(M=!0);var H=this.iterate("exists",M,C.Group.RETURN_CHILD);return null===H&&O?this.create(U,W,X,V):this.resetChild(H,U,W,X,V)},C.Group.prototype.getFirstAlive=function(M,O,U,W,X){void 0===M&&(M=!1);var V=this.iterate("alive",!0,C.Group.RETURN_CHILD);return null===V&&M?this.create(O,U,W,X):this.resetChild(V,O,U,W,X)},C.Group.prototype.getFirstDead=function(M,O,U,W,X){void 0===M&&(M=!1);var V=this.iterate("alive",!1,C.Group.RETURN_CHILD);return null===V&&M?this.create(O,U,W,X):this.resetChild(V,O,U,W,X)},C.Group.prototype.resetChild=function(M,O,U,W,X){return null===M?null:(void 0===O&&(O=null),void 0===U&&(U=null),null!==O&&null!==U&&M.reset(O,U),void 0!==W&&M.loadTexture(W,X),M)},C.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]},C.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]},C.Group.prototype.getClosestTo=function(M,O,U){for(var W=Number.MAX_VALUE,X=0,V=null,H=0,Y;H<this.children.length;H++)Y=this.children[H],Y.exists&&(X=Math.abs(C.Point.distance(M,Y)),X<W&&(!O||O.call(U,Y,X))&&(W=X,V=Y));return V},C.Group.prototype.getFurthestFrom=function(M,O,U){for(var W=0,X=0,V=null,H=0,Y;H<this.children.length;H++)Y=this.children[H],Y.exists&&(X=Math.abs(C.Point.distance(M,Y)),X>W&&(!O||O.call(U,Y,X))&&(W=X,V=Y));return V},C.Group.prototype.countLiving=function(){return this.iterate("alive",!0,C.Group.RETURN_TOTAL)},C.Group.prototype.countDead=function(){return this.iterate("alive",!1,C.Group.RETURN_TOTAL)},C.Group.prototype.getRandom=function(M,O){return void 0===M&&(M=0),void 0===O&&(O=this.children.length),0===O?null:C.ArrayUtils.getRandomItem(this.children,M,O)},C.Group.prototype.getRandomExists=function(M,O){var U=this.getAll("exists",!0,M,O);return this.game.rnd.pick(U)},C.Group.prototype.getAll=function(M,O,U,W){void 0===U&&(U=0),void 0===W&&(W=this.children.length);for(var X=[],V=U,H;V<W;V++)H=this.children[V],M?H[M]===O&&X.push(H):X.push(H);return X},C.Group.prototype.remove=function(M,O,U){if(void 0===O&&(O=!1),void 0===U&&(U=!1),0===this.children.length||-1===this.children.indexOf(M))return!1;U||!M.events||M.destroyPhase||M.events.onRemovedFromGroup$dispatch(M,this);var W=this.removeChild(M);return this.removeFromHash(M),this.updateZ(),this.cursor===M&&this.next(),O&&W&&W.destroy(!0),!0},C.Group.prototype.moveAll=function(M,O){if(void 0===O&&(O=!1),0<this.children.length&&M instanceof C.Group){do M.add(this.children[0],O);while(0<this.children.length);this.hash=[],this.cursor=null}return M},C.Group.prototype.removeAll=function(M,O,U){if(void 0===M&&(M=!1),void 0===O&&(O=!1),void 0===U&&(U=!1),0!==this.children.length){do{!O&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var W=this.removeChild(this.children[0]);this.removeFromHash(W),M&&W&&W.destroy(!0,U)}while(0<this.children.length);this.hash=[],this.cursor=null}},C.Group.prototype.removeBetween=function(M,O,U,W){if(void 0===O&&(O=this.children.length-1),void 0===U&&(U=!1),void 0===W&&(W=!1),0!==this.children.length){if(M>O||0>M||O>this.children.length)return!1;for(var X=O;X>=M;){!W&&this.children[X].events&&this.children[X].events.onRemovedFromGroup$dispatch(this.children[X],this);var V=this.removeChild(this.children[X]);this.removeFromHash(V),U&&V&&V.destroy(!0),this.cursor===this.children[X]&&(this.cursor=null),X--}this.updateZ()}},C.Group.prototype.scatter=function(M,O){null==M&&(M=this.game.world.bounds),this.forEach(function(U){U.position.set(M.randomX,M.randomY)},null,O)},C.Group.prototype.shuffle=function(){C.ArrayUtils.shuffle(this.children),this.updateZ()},C.Group.prototype.destroy=function(M,O){null===this.game||this.ignoreDestroy||(void 0===M&&(M=!0),void 0===O&&(O=!1),this.onDestroy.dispatch(this,M,O),this.removeAll(M),this.cursor=null,this.filters=null,this.pendingDestroy=!1,!O&&(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(C.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,C.Group.RETURN_TOTAL)}}),Object.defineProperty(C.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(C.Group.prototype,"angle",{get:function(){return C.Math.radToDeg(this.rotation)},set:function(M){this.rotation=C.Math.degToRad(M)}}),Object.defineProperty(C.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(M){var O=this.getBounds(this.parent),U=this.x-O.x;this.x=M+U-O.halfWidth}}),Object.defineProperty(C.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(M){var O=this.getBounds(this.parent),U=this.y-O.y;this.y=M+U-O.halfHeight}}),Object.defineProperty(C.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(M){var O=this.getBounds(this.parent),U=this.x-O.x;this.x=M+U}}),Object.defineProperty(C.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(M){var O=this.getBounds(this.parent),U=this.x-O.x;this.x=M+U-O.width}}),Object.defineProperty(C.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(M){var O=this.getBounds(this.parent),U=this.y-O.y;this.y=M+U}}),Object.defineProperty(C.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(M){var O=this.getBounds(this.parent),U=this.y-O.y;this.y=M+U-O.height}}),C.World=function(M){C.Group.call(this,M,null,"__world",!1),this.bounds=new C.Rectangle(0,0,M.width,M.height),this.camera=null,this._definedSize=!1,this._width=M.width,this._height=M.height,this.game.state.onStateChange.add(this.stateChange,this)},C.World.prototype=Object.create(C.Group.prototype),C.World.prototype.constructor=C.World,C.World.prototype.boot=function(){this.camera=new C.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},C.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},C.World.prototype.setBounds=function(M,O,U,W){this._definedSize=!0,this._width=U,this._height=W,this.bounds.setTo(M,O,U,W),this.x=M,this.y=O,this.camera.bounds&&this.camera.bounds.setTo(M,O,Math.max(U,this.game.width),Math.max(W,this.game.height)),this.game.physics.setBoundsToWorld()},C.World.prototype.resize=function(M,O){this._definedSize&&(M<this._width&&(M=this._width),O<this._height&&(O=this._height)),this.bounds.width=M,this.bounds.height=O,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},C.World.prototype.shutdown=function(){this.destroy(!0,!0)},C.World.prototype.wrap=function(M,O,U,W,X){void 0===O&&(O=0),void 0===U&&(U=!1),void 0===W&&(W=!0),void 0===X&&(X=!0),U?(M.getBounds(),W&&(M.x+M._currentBounds.width<this.bounds.x?M.x=this.bounds.right:M.x>this.bounds.right&&(M.x=this.bounds.left)),X&&(M.y+M._currentBounds.height<this.bounds.top?M.y=this.bounds.bottom:M.y>this.bounds.bottom&&(M.y=this.bounds.top))):(W&&M.x+O<this.bounds.x?M.x=this.bounds.right+O:W&&M.x-O>this.bounds.right&&(M.x=this.bounds.left-O),X&&M.y+O<this.bounds.top?M.y=this.bounds.bottom+O:X&&M.y-O>this.bounds.bottom&&(M.y=this.bounds.top-O))},Object.defineProperty(C.World.prototype,"width",{get:function(){return this.bounds.width},set:function(M){M<this.game.width&&(M=this.game.width),this.bounds.width=M,this._width=M,this._definedSize=!0}}),Object.defineProperty(C.World.prototype,"height",{get:function(){return this.bounds.height},set:function(M){M<this.game.height&&(M=this.game.height),this.bounds.height=M,this._height=M,this._definedSize=!0}}),Object.defineProperty(C.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(C.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(C.World.prototype,"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(C.World.prototype,"randomY",{get:function(){return 0>this.bounds.y?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),C.Game=function(M,O,U,W,X,V,H,Y){return this.id=C.GAMES.push(this)-1,this.config=null,this.physicsConfig=Y,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.multiTexture=!1,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=C.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=C.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new C.Signal,this.forceSingleUpdate=!0,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof M&&(this._width=M),"undefined"!=typeof O&&(this._height=O),"undefined"!=typeof U&&(this.renderType=U),"undefined"!=typeof W&&(this.parent=W),"undefined"!=typeof V&&(this.transparent=V),"undefined"!=typeof H&&(this.antialias=H),this.rnd=new C.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new C.StateManager(this,X)),this.device.whenReady(this.boot,this),this},C.Game.prototype={parseConfig:function(M){this.config=M,void 0===M.enableDebug&&(this.config.enableDebug=!0),M.width&&(this._width=M.width),M.height&&(this._height=M.height),M.renderer&&(this.renderType=M.renderer),M.parent&&(this.parent=M.parent),void 0!==M.transparent&&(this.transparent=M.transparent),void 0!==M.antialias&&(this.antialias=M.antialias),void 0!==M.multiTexture&&(this.multiTexture=M.multiTexture),M.resolution&&(this.resolution=M.resolution),void 0!==M.preserveDrawingBuffer&&(this.preserveDrawingBuffer=M.preserveDrawingBuffer),M.physicsConfig&&(this.physicsConfig=M.physicsConfig);var O=[(Date.now()*Math.random()).toString()];M.seed&&(O=M.seed),this.rnd=new C.RandomDataGenerator(O);var U=null;M.state&&(U=M.state),this.state=new C.StateManager(this,U)},boot:function(){this.isBooted||(this.onPause=new C.Signal,this.onResume=new C.Signal,this.onBlur=new C.Signal,this.onFocus=new C.Signal,this.isBooted=!0,PIXI.game=this,this.math=C.Math,this.scale=new C.ScaleManager(this,this._width,this._height),this.stage=new C.Stage(this),this.setUpRenderer(),this.world=new C.World(this),this.add=new C.GameObjectFactory(this),this.make=new C.GameObjectCreator(this),this.cache=new C.Cache(this),this.load=new C.Loader(this),this.time=new C.Time(this),this.tweens=new C.TweenManager(this),this.input=new C.Input(this),this.sound=new C.SoundManager(this),this.physics=new C.Physics(this,this.physicsConfig),this.particles=new C.Particles(this),this.create=new C.Create(this),this.plugins=new C.PluginManager(this),this.net=new C.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new C.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){},isDisabled:!0},this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new C.RequestAnimationFrame(this,this.config.forceSetTimeOut):new C.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.cache.isReady?this.raf.start():this.cache.onReady.addOnce(function(){this.raf.start()},this))},showDebugHeader:function(){if(!(window.PhaserGlobal&&window.PhaserGlobal.hideBanner)){var M=C.VERSION,O="Canvas",U="HTML Audio",W=1;if(this.renderType===C.WEBGL?(O="WebGL",W++):this.renderType===C.HEADLESS&&(O="Headless"),this.device.webAudio&&(U="WebAudio",W++),!this.device.ie){for(var X=["%c %c %c Phaser CE v"+M+" | Pixi.js | "+O+" | "+U+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"],V=0;3>V;V++)V<W?X.push("color: #ff2424; background: #fff"):X.push("color: #959595; background: #fff");console.log.apply(console,X)}else window.console&&console.log("Phaser v"+M+" | Pixi.js | "+O+" | "+U+" | http://phaser.io")}},setUpRenderer:function(){if(this.canvas=this.config.canvas?this.config.canvas:C.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.renderType!==C.HEADLESS&&this.renderType!==C.CANVAS&&(this.renderType!==C.AUTO||this.device.webGL))(this.multiTexture||this.renderType===C.WEBGL_MULTI)&&(PIXI.enableMultiTexture(),this.multiTexture=!0),this.renderType=C.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);else if(this.device.canvas)this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context,this.renderType===C.AUTO&&(this.renderType=C.CANVAS);else throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===C.CANVAS),this.renderType!==C.HEADLESS&&(this.stage.smoothed=this.antialias,C.Canvas.addToDOM(this.canvas,this.parent,!1),C.Canvas.setTouchAction(this.canvas))},contextLost:function(M){M.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(M){if(this.time.update(M),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var O=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*O,this.time.elapsed),0);var U=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/O),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=O&&(this._deltaTime-=O,this.currentUpdateID=U,this.updateLogic(this.time.desiredFpsMult),U++,!(this.forceSingleUpdate&&1==U));)this.time.refresh();U>this._lastCount?this._spiraling++:U<this._lastCount&&(this._spiraling=0),this._lastCount=U,this.updateRender(this._deltaTime/O)}},updateLogic:function(M){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(M),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(M),this.plugins.preUpdate(M),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(M){this.lockRender||(this.state.preRender(M),this.renderType!==C.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(M),this.state.render(M)),this.plugins.postRender(M))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.debug.destroy&&this.debug.destroy(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.debug=null,this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),C.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,C.GAMES[this.id]=null},gamePaused:function(M){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(M),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(M){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(M),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(M){this.onBlur.dispatch(M),this.stage.disableVisibilityChange||this.gamePaused(M)},focusGain:function(M){this.onFocus.dispatch(M),this.stage.disableVisibilityChange||this.gameResumed(M)}},C.Game.prototype.constructor=C.Game,Object.defineProperty(C.Game.prototype,"paused",{get:function(){return this._paused},set:function(M){!0===M?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),C.Input=function(M){this.game=M,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=C.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.touchLockCallbacks=[],this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new C.ArraySet,this._localPoint=new C.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},C.Input.MOUSE_OVERRIDES_TOUCH=0,C.Input.TOUCH_OVERRIDES_MOUSE=1,C.Input.MOUSE_TOUCH_COMBINE=2,C.Input.MAX_POINTERS=10,C.Input.prototype={boot:function(){this.mousePointer=new C.Pointer(this.game,0,C.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new C.Mouse(this.game),this.touch=new C.Touch(this.game),this.mspointer=new C.MSPointer(this.game),C.Keyboard&&(this.keyboard=new C.Keyboard(this.game)),C.Gamepad&&(this.gamepad=new C.Gamepad(this.game)),this.onDown=new C.Signal,this.onUp=new C.Signal,this.onTap=new C.Signal,this.onHold=new C.Signal,this.scale=new C.Point(1,1),this.speed=new C.Point,this.position=new C.Point,this._oldPosition=new C.Point,this.circle=new C.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=C.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.game.device.mspointer||this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var M=this;this._onClickTrampoline=function(O){M.onClickTrampoline(O)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],C.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(M,O){this.customCandidateHandler=M,this.customCandidateHandlerContext=O},addMoveCallback:function(M,O){this.moveCallbacks.push({callback:M,context:O})},addTouchLockCallback:function(M,O,U){void 0===U&&(U=!1),this.touchLockCallbacks.push({callback:M,context:O,onEnd:U})},removeTouchLockCallback:function(M,O){for(var U=this.touchLockCallbacks.length;U--;)if(this.touchLockCallbacks[U].callback===M&&this.touchLockCallbacks[U].context===O)return this.touchLockCallbacks.splice(U,1),!0;return!1},executeTouchLockCallbacks:function(M,O){for(var U=this.touchLockCallbacks.length,W;U--;)W=this.touchLockCallbacks[U],W.onEnd===M&&W.callback.call(W.context,this,O)&&this.touchLockCallbacks.splice(U,1)},deleteMoveCallback:function(M,O){for(var U=this.moveCallbacks.length;U--;)if(this.moveCallbacks[U].callback===M&&this.moveCallbacks[U].context===O)return void this.moveCallbacks.splice(U,1)},addPointer:function(){if(this.pointers.length>=C.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+C.Input.MAX_POINTERS+" pointers reached."),null;var M=this.pointers.length+1,O=new C.Pointer(this.game,M,C.PointerMode.TOUCH);return this.pointers.push(O),this["pointer"+M]=O,O},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)return void this._pollCounter++;this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var M=0;M<this.pointers.length;M++)this.pointers[M].update();this._pollCounter=0},reset:function(M){if(this.game.isBooted&&!this.resetLocked){void 0===M&&(M=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(M),this.gamepad&&this.gamepad.reset();for(var O=0;O<this.pointers.length;O++)this.pointers[O].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor=""),M&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new C.Signal,this.onUp=new C.Signal,this.onTap=new C.Signal,this.onHold=new C.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(M,O){this._oldPosition.setTo(M,O),this.speed.setTo(0,0)},startPointer:function(M){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(M);if(!this.pointer2.active)return this.pointer2.start(M);for(var O=2,U;O<this.pointers.length;O++)if(U=this.pointers[O],!U.active)return U.start(M);return null},updatePointer:function(M){if(this.pointer1.active&&this.pointer1.identifier===M.identifier)return this.pointer1.move(M);if(this.pointer2.active&&this.pointer2.identifier===M.identifier)return this.pointer2.move(M);for(var O=2,U;O<this.pointers.length;O++)if(U=this.pointers[O],U.active&&U.identifier===M.identifier)return U.move(M);return null},stopPointer:function(M){if(this.pointer1.active&&this.pointer1.identifier===M.identifier)return this.pointer1.stop(M);if(this.pointer2.active&&this.pointer2.identifier===M.identifier)return this.pointer2.stop(M);for(var O=2,U;O<this.pointers.length;O++)if(U=this.pointers[O],U.active&&U.identifier===M.identifier)return U.stop(M);return null},countActivePointers:function(M){void 0===M&&(M=this.pointers.length);for(var O=M,U=0,W;U<this.pointers.length&&0<O;U++)W=this.pointers[U],W.active&&O--;return M-O},getPointer:function(M){void 0===M&&(M=!1);for(var O=0,U;O<this.pointers.length;O++)if(U=this.pointers[O],U.active===M)return U;return null},getPointerFromIdentifier:function(M){for(var O=0,U;O<this.pointers.length;O++)if(U=this.pointers[O],U.identifier===M)return U;return null},getPointerFromId:function(M){for(var O=0,U;O<this.pointers.length;O++)if(U=this.pointers[O],U.pointerId===M)return U;return null},getLocalPosition:function(M,O,U){void 0===U&&(U=new C.Point);var W=M.worldTransform,X=1/(W.a*W.d+W.c*-W.b);return U.setTo(W.d*X*O.x+-W.c*X*O.y+(W.ty*W.c-W.tx*W.d)*X,W.a*X*O.y+-W.b*X*O.x+(-W.ty*W.a+W.tx*W.b)*X)},hitTest:function(M,O,U){if(!M.worldVisible)return!1;if(this.getLocalPosition(M,O,this._localPoint),U.copyFrom(this._localPoint),M.hitArea&&M.hitArea.contains)return M.hitArea.contains(this._localPoint.x,this._localPoint.y);if(C.Creature&&M instanceof C.Creature){var W=Math.abs(M.width),X=Math.abs(M.height),V=M.x-W*M.anchorX;if(this.game.camera.x+O.x>=V&&this.game.camera.x+O.x<V+W){var H=M.y-X*M.anchorY;if(this.game.camera.y+O.y>=H&&this.game.camera.y+O.y<H+X)return!0}}else if(M instanceof C.TileSprite){var W=M.width,X=M.height,V=-W*M.anchor.x;if(this._localPoint.x>=V&&this._localPoint.x<V+W){var H=-X*M.anchor.y;if(this._localPoint.y>=H&&this._localPoint.y<H+X)return!0}}else if(M instanceof PIXI.Sprite){var W=M.texture.frame.width/M.texture.baseTexture.resolution,X=M.texture.frame.height/M.texture.baseTexture.resolution,V=-W*M.anchor.x;if(this._localPoint.x>=V&&this._localPoint.x<V+W){var H=-X*M.anchor.y;if(this._localPoint.y>=H&&this._localPoint.y<H+X)return!0}}else if(M instanceof C.Graphics)for(var Y=0,z;Y<M.graphicsData.length;Y++)if((z=M.graphicsData[Y],!!z.fill)&&z.shape&&z.shape.contains(this._localPoint.x,this._localPoint.y))return!0;for(var Y=0;Y<M.children.length;Y++)if(this.hitTest(M.children[Y],O,U))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},C.Input.prototype.constructor=C.Input,Object.defineProperty(C.Input.prototype,"x",{get:function(){return this._x},set:function(M){this._x=Math.floor(M)}}),Object.defineProperty(C.Input.prototype,"y",{get:function(){return this._y},set:function(M){this._y=Math.floor(M)}}),Object.defineProperty(C.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}}),Object.defineProperty(C.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(C.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(C.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(C.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),C.Mouse=function(M){this.game=M,this.input=M.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new C.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},C.Mouse.NO_BUTTON=-1,C.Mouse.LEFT_BUTTON=0,C.Mouse.MIDDLE_BUTTON=1,C.Mouse.RIGHT_BUTTON=2,C.Mouse.BACK_BUTTON=3,C.Mouse.FORWARD_BUTTON=4,C.Mouse.WHEEL_UP=1,C.Mouse.WHEEL_DOWN=-1,C.Mouse.prototype={start:function(){if(!(this.game.device.android&&!1===this.game.device.chrome)&&null===this._onMouseDown){var M=this;this._onMouseDown=function(W){return M.onMouseDown(W)},this._onMouseMove=function(W){return M.onMouseMove(W)},this._onMouseUp=function(W){return M.onMouseUp(W)},this._onMouseUpGlobal=function(W){return M.onMouseUpGlobal(W)},this._onMouseOutGlobal=function(W){return M.onMouseOutGlobal(W)},this._onMouseOut=function(W){return M.onMouseOut(W)},this._onMouseOver=function(W){return M.onMouseOver(W)},this._onMouseWheel=function(W){return M.onMouseWheel(W)};var O=this.game.canvas;O.addEventListener("mousedown",this._onMouseDown,!0),O.addEventListener("mousemove",this._onMouseMove,!0),O.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),O.addEventListener("mouseover",this._onMouseOver,!0),O.addEventListener("mouseout",this._onMouseOut,!0));var U=this.game.device.wheelEvent;U&&(O.addEventListener(U,this._onMouseWheel,!0),"mousewheel"===U?this._wheelEvent=new _(-1/40,1):"DOMMouseScroll"===U&&(this._wheelEvent=new _(1,1)))}},onMouseDown:function(M){this.event=M,this.capture&&M.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=0,this.input.mousePointer.start(M))},onMouseMove:function(M){this.event=M,this.capture&&M.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=0,this.input.mousePointer.move(M))},onMouseUp:function(M){this.event=M,this.capture&&M.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=0,this.input.mousePointer.stop(M))},onMouseUpGlobal:function(M){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,M),M.identifier=0,this.input.mousePointer.stop(M))},onMouseOutGlobal:function(M){this.event=M,this.capture&&M.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(M),this.input.mousePointer.resetButtons())},onMouseOut:function(M){this.event=M,this.capture&&M.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(!this.stopOnGameOut||(M.identifier=0,this.input.mousePointer.stop(M)))},onMouseOver:function(M){this.event=M,this.capture&&M.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,M)},onMouseWheel:function(M){this._wheelEvent&&(M=this._wheelEvent.bindEvent(M)),this.event=M,this.capture&&M.preventDefault(),this.wheelDelta=C.Math.clamp(-M.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,M)},requestPointerLock:function(){if(this.game.device.pointerLock){var M=this.game.canvas;M.requestPointerLock=M.requestPointerLock||M.mozRequestPointerLock||M.webkitRequestPointerLock,M.requestPointerLock();var O=this;this._pointerLockChange=function(U){return O.pointerLockChange(U)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(M){var O=this.game.canvas;document.pointerLockElement===O||document.mozPointerLockElement===O||document.webkitPointerLockElement===O?(this.locked=!0,this.pointerLock.dispatch(!0,M)):(this.locked=!1,this.pointerLock.dispatch(!1,M))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var M=this.game.canvas;M.removeEventListener("mousedown",this._onMouseDown,!0),M.removeEventListener("mousemove",this._onMouseMove,!0),M.removeEventListener("mouseup",this._onMouseUp,!0),M.removeEventListener("mouseover",this._onMouseOver,!0),M.removeEventListener("mouseout",this._onMouseOut,!0);var O=this.game.device.wheelEvent;O&&M.removeEventListener(O,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},C.Mouse.prototype.constructor=C.Mouse,_.prototype={},_.prototype.constructor=_,_.prototype.bindEvent=function(M){if(!_._stubsGenerated&&M){var O=function(W){return function(){var X=this.originalEvent[W];return"function"==typeof X?X.bind(this.originalEvent):X}};for(var U in M)U in _.prototype||Object.defineProperty(_.prototype,U,{get:O(U)});_._stubsGenerated=!0}return this.originalEvent=M,this},Object.defineProperties(_.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),C.MSPointer=function(M){this.game=M,this.input=M.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},C.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var M=this;if(this.game.device.mspointer){this._onMSPointerDown=function(U){return M.onPointerDown(U)},this._onMSPointerMove=function(U){return M.onPointerMove(U)},this._onMSPointerUp=function(U){return M.onPointerUp(U)},this._onMSPointerUpGlobal=function(U){return M.onPointerUpGlobal(U)},this._onMSPointerOut=function(U){return M.onPointerOut(U)},this._onMSPointerOver=function(U){return M.onPointerOver(U)};var O=this.game.canvas;O.addEventListener("MSPointerDown",this._onMSPointerDown,!1),O.addEventListener("MSPointerMove",this._onMSPointerMove,!1),O.addEventListener("MSPointerUp",this._onMSPointerUp,!1),O.addEventListener("pointerdown",this._onMSPointerDown,!1),O.addEventListener("pointermove",this._onMSPointerMove,!1),O.addEventListener("pointerup",this._onMSPointerUp,!1),O.style["-ms-content-zooming"]="none",O.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),O.addEventListener("MSPointerOver",this._onMSPointerOver,!0),O.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),O.addEventListener("pointerover",this._onMSPointerOver,!0),O.addEventListener("pointerout",this._onMSPointerOut,!0))}}},onPointerDown:function(M){this.game.input.executeTouchLockCallbacks(!1,M),this.event=M,this.capture&&M.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=M.pointerId,"mouse"===M.pointerType||4===M.pointerType?this.input.mousePointer.start(M):this.input.startPointer(M))},onPointerMove:function(M){this.event=M,this.capture&&M.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=M.pointerId,"mouse"===M.pointerType||4===M.pointerType?this.input.mousePointer.move(M):this.input.updatePointer(M))},onPointerUp:function(M){this.game.input.executeTouchLockCallbacks(!0,M),this.event=M,this.capture&&M.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,M),this.input.enabled&&this.enabled&&(M.identifier=M.pointerId,"mouse"===M.pointerType||4===M.pointerType?this.input.mousePointer.stop(M):this.input.stopPointer(M))},onPointerUpGlobal:function(M){if(("mouse"===M.pointerType||4===M.pointerType)&&!this.input.mousePointer.withinGame)this.onPointerUp(M);else{var O=this.input.getPointerFromIdentifier(M.identifier);O&&O.withinGame&&this.onPointerUp(M)}},onPointerOut:function(M){if(this.event=M,this.capture&&M.preventDefault(),"mouse"===M.pointerType||4===M.pointerType)this.input.mousePointer.withinGame=!1;else{var O=this.input.getPointerFromIdentifier(M.identifier);O&&(O.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,M),this.input.enabled&&this.enabled&&(!this.input.mouse.stopOnGameOut||(M.identifier=0,O?O.stop(M):this.input.mousePointer.stop(M)))},onPointerOver:function(M){if(this.event=M,this.capture&&M.preventDefault(),"mouse"===M.pointerType||4===M.pointerType)this.input.mousePointer.withinGame=!0;else{var O=this.input.getPointerFromIdentifier(M.identifier);O&&(O.withinGame=!0)}this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,M)},stop:function(){var M=this.game.canvas;M.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),M.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),M.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),M.removeEventListener("pointerdown",this._onMSPointerDown,!1),M.removeEventListener("pointermove",this._onMSPointerMove,!1),M.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),M.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),M.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),M.removeEventListener("pointerover",this._onMSPointerOver,!0),M.removeEventListener("pointerout",this._onMSPointerOut,!0)}},C.MSPointer.prototype.constructor=C.MSPointer,C.DeviceButton=function(M,O){this.parent=M,this.game=M.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=O,this.onDown=new C.Signal,this.onUp=new C.Signal,this.onFloat=new C.Signal},C.DeviceButton.prototype={start:function(M,O){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=M,this.value=O,M&&(this.altKey=M.altKey,this.shiftKey=M.shiftKey,this.ctrlKey=M.ctrlKey),this.onDown.dispatch(this,O))},stop:function(M,O){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=M,this.value=O,M&&(this.altKey=M.altKey,this.shiftKey=M.shiftKey,this.ctrlKey=M.ctrlKey),this.onUp.dispatch(this,O))},startStop:function(M,O,U){M?this.start(O,U):this.stop(O,U)},padFloat:function(M){this.isDown=!1,this.isUp=!1,this.value=M,this.onFloat.dispatch(this,M)},justPressed:function(M){return M=M||250,this.isDown&&this.timeDown+M>this.game.time.time},justReleased:function(M){return M=M||250,this.isUp&&this.timeUp+M>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},C.DeviceButton.prototype.constructor=C.DeviceButton,Object.defineProperty(C.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),C.Pointer=function(M,O,U){this.game=M,this.id=O,this.type=C.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=U||C.PointerMode.CURSOR|C.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new C.DeviceButton(this,C.Pointer.LEFT_BUTTON),this.middleButton=new C.DeviceButton(this,C.Pointer.MIDDLE_BUTTON),this.rightButton=new C.DeviceButton(this,C.Pointer.RIGHT_BUTTON),this.backButton=new C.DeviceButton(this,C.Pointer.BACK_BUTTON),this.forwardButton=new C.DeviceButton(this,C.Pointer.FORWARD_BUTTON),this.eraserButton=new C.DeviceButton(this,C.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===O,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new C.Point,this.positionDown=new C.Point,this.positionUp=new C.Point,this.circle=new C.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},C.Pointer.NO_BUTTON=0,C.Pointer.LEFT_BUTTON=1,C.Pointer.RIGHT_BUTTON=2,C.Pointer.MIDDLE_BUTTON=4,C.Pointer.BACK_BUTTON=8,C.Pointer.FORWARD_BUTTON=16,C.Pointer.ERASER_BUTTON=32,C.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(M,O){M===C.Mouse.LEFT_BUTTON&&this.leftButton.start(O),M===C.Mouse.RIGHT_BUTTON&&this.rightButton.start(O),M===C.Mouse.MIDDLE_BUTTON&&this.middleButton.start(O),M===C.Mouse.BACK_BUTTON&&this.backButton.start(O),M===C.Mouse.FORWARD_BUTTON&&this.forwardButton.start(O)},processButtonsUp:function(M,O){M===C.Mouse.LEFT_BUTTON&&this.leftButton.stop(O),M===C.Mouse.RIGHT_BUTTON&&this.rightButton.stop(O),M===C.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(O),M===C.Mouse.BACK_BUTTON&&this.backButton.stop(O),M===C.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(O)},processButtonsUpDown:function(M,O){var U="down"===O.type.toLowerCase().substr(-4),W="move"===O.type.toLowerCase().substr(-4);void 0===M?void 0===O.button?U?O.ctrlKey?this.rightButton.start(O):this.leftButton.start(O):(this.leftButton.stop(O),this.rightButton.stop(O)):U&&O.ctrlKey&&0===O.button?this.rightButton.start(O):U?this.processButtonsDown(O.button,O):!W&&this.processButtonsUp(O.button,O):(U&&1===M&&O.ctrlKey&&(M=2),this.leftButton.startStop(C.Pointer.LEFT_BUTTON&M,O),this.rightButton.startStop(C.Pointer.RIGHT_BUTTON&M,O),this.middleButton.startStop(C.Pointer.MIDDLE_BUTTON&M,O),this.backButton.startStop(C.Pointer.BACK_BUTTON&M,O),this.forwardButton.startStop(C.Pointer.FORWARD_BUTTON&M,O),this.eraserButton.startStop(C.Pointer.ERASER_BUTTON&M,O))},updateButtons:function(M){this.button=M.button,this.processButtonsUpDown(M.buttons,M),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(M){var O=this.game.input;return M.pointerId&&(this.pointerId=M.pointerId),this.identifier=M.identifier,this.target=M.target,this.isMouse?this.updateButtons(M):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(M,!0),this.positionDown.setTo(this.x,this.y),(O.multiInputOverride===C.Input.MOUSE_OVERRIDES_TOUCH||O.multiInputOverride===C.Input.MOUSE_TOUCH_COMBINE||O.multiInputOverride===C.Input.TOUCH_OVERRIDES_MOUSE&&0===O.totalActivePointers)&&(O.x=this.x,O.y=this.y,O.position.setTo(this.x,this.y),O.onDown.dispatch(this,M),O.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var M=this.game.input;this.active&&(this.dirty&&(0<M.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=M.holdRate&&((M.multiInputOverride===C.Input.MOUSE_OVERRIDES_TOUCH||M.multiInputOverride===C.Input.MOUSE_TOUCH_COMBINE||M.multiInputOverride===C.Input.TOUCH_OVERRIDES_MOUSE&&0===M.totalActivePointers)&&M.onHold.dispatch(this),this._holdSent=!0),M.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+M.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>M.recordLimit&&this._history.shift()))},move:function(M,O){var U=this.game.input;if(!U.pollLocked){void 0===O&&(O=!1),void 0!==M.button&&(this.button=M.button),this.isMouse&&this.updateButtons(M),this.clientX=M.clientX,this.clientY=M.clientY,this.pageX=M.pageX,this.pageY=M.pageY,this.screenX=M.screenX,this.screenY=M.screenY,this.isMouse&&U.mouse.locked&&!O&&(this.rawMovementX=M.movementX||M.mozMovementX||M.webkitMovementX||0,this.rawMovementY=M.movementY||M.mozMovementY||M.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*U.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*U.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(U.multiInputOverride===C.Input.MOUSE_OVERRIDES_TOUCH||U.multiInputOverride===C.Input.MOUSE_TOUCH_COMBINE||U.multiInputOverride===C.Input.TOUCH_OVERRIDES_MOUSE&&0===U.totalActivePointers)&&(U.activePointer=this,U.x=this.x,U.y=this.y,U.position.setTo(U.x,U.y),U.circle.x=U.x,U.circle.y=U.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);for(var W=U.moveCallbacks.length;W--;)U.moveCallbacks[W].callback.call(U.moveCallbacks[W].context,this,this.x,this.y,O);return null!==this.targetObject&&(!this.game.paused||this.targetObject.noPause)&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):0<U.interactiveItems.total&&this.processInteractiveObjects(O),this}},processInteractiveObjects:function(M){var O=0,U=-1,W=null,X=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];X;)X.checked=!1,X.validForInput(U,O,!1)&&(!this.game.paused||X.sprite.noPause)&&(X.checked=!0,(M&&X.checkPointerDown(this,!0)||!M&&X.checkPointerOver(this,!0))&&(O=X.sprite.renderOrderID,U=X.priorityID,W=X,this.interactiveCandidates.push(X))),X=this.game.input.interactiveItems.next;for(X=this.game.input.interactiveItems.first;X;)!X.checked&&X.validForInput(U,O,!0)&&(M&&X.checkPointerDown(this,!1)||!M&&X.checkPointerOver(this,!1))&&(O=X.sprite.renderOrderID,U=X.priorityID,W=X,this.interactiveCandidates.push(X)),X=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(W=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,W)),this.swapTarget(W,!1),null!==this.targetObject},swapTarget:function(M,O){void 0===O&&(O=!1),null===M?this.targetObject&&(this.targetObject._pointerOutHandler(this,O),this.targetObject=null):null===this.targetObject?(this.targetObject=M,M._pointerOverHandler(this,O)):this.targetObject===M?!1===M.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,O),this.targetObject=M,this.targetObject._pointerOverHandler(this,O))},leave:function(M){this.withinGame=!1,this.move(M,!1)},stop:function(M){var O=this.game.input;return this._stateReset&&this.withinGame?void M.preventDefault():(this.timeUp=this.game.time.time,(O.multiInputOverride===C.Input.MOUSE_OVERRIDES_TOUCH||O.multiInputOverride===C.Input.MOUSE_TOUCH_COMBINE||O.multiInputOverride===C.Input.TOUCH_OVERRIDES_MOUSE&&0===O.totalActivePointers)&&(O.onUp.dispatch(this,M),0<=this.duration&&this.duration<=O.tapRate&&(this.timeUp-this.previousTapTime<O.doubleTapRate?O.onTap.dispatch(this,!0):O.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(M):(this.isDown=!1,this.isUp=!0),0<this.id&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(M.pageX,M.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&O.currentPointers--,O.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(M){return M=M||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+M>this.game.time.time},justReleased:function(M){return M=M||this.game.input.justReleasedRate,this.isUp&&this.timeUp+M>this.game.time.time},addClickTrampoline:function(M,O,U,W){if(this.isDown){for(var X=this._clickTrampolines=this._clickTrampolines||[],V=0;V<X.length;V++)if(X[V].name===M){X.splice(V,1);break}X.push({name:M,targetObject:this.targetObject,callback:O,callbackContext:U,callbackArgs:W})}},processClickTrampolines:function(){var M=this._clickTrampolines;if(M){for(var O=0,U;O<M.length;O++)U=M[O],U.targetObject===this._trampolineTargetObject&&U.callback.apply(U.callbackContext,U.callbackArgs);this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},C.Pointer.prototype.constructor=C.Pointer,Object.defineProperty(C.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(C.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(C.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),C.PointerMode={CURSOR:1,CONTACT:2},C.Touch=function(M){this.game=M,this.enabled=!0,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},C.Touch.prototype={start:function(){if(null===this._onTouchStart){var M=this;this.game.device.touch&&(this._onTouchStart=function(O){return M.onTouchStart(O)},this._onTouchMove=function(O){return M.onTouchMove(O)},this._onTouchEnd=function(O){return M.onTouchEnd(O)},this._onTouchEnter=function(O){return M.onTouchEnter(O)},this._onTouchLeave=function(O){return M.onTouchLeave(O)},this._onTouchCancel=function(O){return M.onTouchCancel(O)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),!this.game.device.cocoonJS&&(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1))),this.addTouchLockCallback=this.game.input.addTouchLockCallback.bind(this.game.input),this.removeTouchLockCallback=this.game.input.removeTouchLockCallback.bind(this.game.input)}},consumeDocumentTouches:function(){this._documentTouchMove=function(M){M.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(M){if(this.game.input.executeTouchLockCallbacks(!1,M),this.event=M,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,M),this.preventDefault&&M.preventDefault();for(var O=0;O<M.changedTouches.length;O++)this.game.input.startPointer(M.changedTouches[O])}},onTouchCancel:function(M){if(this.event=M,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,M),this.game.input.enabled&&this.enabled){this.preventDefault&&M.preventDefault();for(var O=0;O<M.changedTouches.length;O++)this.game.input.stopPointer(M.changedTouches[O])}},onTouchEnter:function(M){this.event=M,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,M),this.game.input.enabled&&this.enabled&&(!this.preventDefault||M.preventDefault())},onTouchLeave:function(M){this.event=M,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,M),this.preventDefault&&M.preventDefault()},onTouchMove:function(M){this.event=M,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,M),this.preventDefault&&M.preventDefault();for(var O=0;O<M.changedTouches.length;O++)this.game.input.updatePointer(M.changedTouches[O])},onTouchEnd:function(M){this.game.input.executeTouchLockCallbacks(!0,M),this.event=M,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,M),this.preventDefault&&M.preventDefault();for(var O=0;O<M.changedTouches.length;O++)this.game.input.stopPointer(M.changedTouches[O])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},C.Touch.prototype.constructor=C.Touch,C.InputHandler=function(M){this.sprite=M,this.game=M.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new C.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new C.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new C.Point,this.snapPoint=new C.Point,this._dragPoint=new C.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new C.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},C.InputHandler.prototype={start:function(M,O){if(M=M||0,void 0===O&&(O=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=O,this.priorityID=M;for(var U=0;10>U;U++)this._pointerData[U]={id:U,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new C.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var M=0;10>M;M++)this._pointerData[M]={id:M,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1===this.enabled||(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(M,O,U){return void 0===U&&(U=!0),!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput?!1:!U&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>M||this.priorityID===M&&this.sprite.renderOrderID>O},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(M){return M=M||0,this._pointerData[M].x},pointerY:function(M){return M=M||0,this._pointerData[M].y},pointerDown:function(M){return M=M||0,this._pointerData[M].isDown},pointerUp:function(M){return M=M||0,this._pointerData[M].isUp},pointerTimeDown:function(M){return M=M||0,this._pointerData[M].timeDown},pointerTimeUp:function(M){return M=M||0,this._pointerData[M].timeUp},pointerOver:function(M){if(!this.enabled)return!1;if(void 0===M){for(var O=0;10>O;O++)if(this._pointerData[O].isOver)return!0;return!1}return this._pointerData[M].isOver},pointerOut:function(M){if(!this.enabled)return!1;if(void 0===M){for(var O=0;10>O;O++)if(this._pointerData[O].isOut)return!0;}else return this._pointerData[M].isOut},pointerTimeOver:function(M){return M=M||0,this._pointerData[M].timeOver},pointerTimeOut:function(M){return M=M||0,this._pointerData[M].timeOut},pointerDragged:function(M){return M=M||0,this._pointerData[M].isDragged},checkPointerDown:function(M,O){return M.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y&&!!this.game.input.hitTest(this.sprite,M,this._tempPoint)&&(void 0===O&&(O=!1),!O&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0)},checkPointerOver:function(M,O){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y&&!!this.game.input.hitTest(this.sprite,M,this._tempPoint)&&(void 0===O&&(O=!1),!O&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0)},checkPixel:function(M,O,U){if(this.sprite.texture.baseTexture.source){if(null===M&&null===O){this.game.input.getLocalPosition(this.sprite,U,this._tempPoint);var M=this._tempPoint.x,O=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(M-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(O-=-this.sprite.texture.frame.height*this.sprite.anchor.y),M+=this.sprite.texture.frame.x,O+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(M-=this.sprite.texture.trim.x,O-=this.sprite.texture.trim.y,M<this.sprite.texture.crop.x||M>this.sprite.texture.crop.right||O<this.sprite.texture.crop.y||O>this.sprite.texture.crop.bottom))return this._dx=M,this._dy=O,!1;this._dx=M,this._dy=O,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,M,O,1,1,0,0,1,1);var W=this.game.input.hitContext.getImageData(0,0,1,1);if(W.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(M){return null===this.sprite||void 0===this.sprite.parent?void 0:this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=C.Math.distance(M.x,M.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(M),!0):this.draggable&&this._draggedPointerID===M.id?this.updateDrag(M,!1):this._pointerData[M.id].isOver?this.checkPointerOver(M)?(this._pointerData[M.id].x=M.x-this.sprite.x,this._pointerData[M.id].y=M.y-this.sprite.y,!0):(this._pointerOutHandler(M),!1):void 0:(this._pointerOutHandler(M),!1)},_pointerOverHandler:function(M,O){if(null!==this.sprite){var U=this._pointerData[M.id];if(!1===U.isOver||M.dirty){var W=!1===U.isOver;U.isOver=!0,U.isOut=!1,U.timeOver=this.game.time.time,U.x=M.x-this.sprite.x,U.y=M.y-this.sprite.y,this.useHandCursor&&!1===U.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!O&&W&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,M),this.sprite.parent&&this.sprite.parent.onChildInputOver&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,M)}}},_pointerOutHandler:function(M,O){if(null!==this.sprite){var U=this._pointerData[M.id];U.isOver=!1,U.isOut=!0,U.timeOut=this.game.time.time,this.useHandCursor&&!1===U.isDragged&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),!O&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,M),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,M))}},_touchedHandler:function(M){if(null!==this.sprite){var O=this._pointerData[M.id];if(!O.isDown&&O.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,M))return;if(O.isDown=!0,O.isUp=!1,O.timeDown=this.game.time.time,this.downPoint.set(M.x,M.y),M.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,M),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,M),null===this.sprite))return;this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(M):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,M)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(M){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(M)},_releasedHandler:function(M){if(null!==this.sprite){var O=this._pointerData[M.id];if(O.isDown&&M.isUp){O.isDown=!1,O.isUp=!0,O.timeUp=this.game.time.time,O.downDuration=O.timeUp-O.timeDown;var U=this.checkPointerOver(M);this.sprite&&this.sprite.events&&((!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===M.id))&&this.sprite.events.onInputUp$dispatch(this.sprite,M,U),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,M,U),U&&(U=this.checkPointerOver(M))),O.isOver=U,!U&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),M.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===M.id&&this.stopDrag(M)}}},updateDrag:function(M,O){if(void 0===O&&(O=!1),M.isUp)return this.stopDrag(M),!1;var U=this.globalToLocal(M),W=U.x+this._dragPoint.x+this.dragOffset.x,X=U.y+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera)this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=W-this.game.camera.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=X-this.game.camera.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y));else{var V=this.game.camera.x-this._pointerData[M.id].camX,H=this.game.camera.y-this._pointerData[M.id].camY;this.allowHorizontalDrag&&(this.sprite.x=W+V),this.allowVerticalDrag&&(this.sprite.y=X+H),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))}return this.sprite.events.onDragUpdate.dispatch(this.sprite,M,W,X,this.snapPoint,O),!0},justOver:function(M,O){return M=M||0,O=O||500,this._pointerData[M].isOver&&this.overDuration(M)<O},justOut:function(M,O){return M=M||0,O=O||500,this._pointerData[M].isOut&&this.game.time.time-this._pointerData[M].timeOut<O},justPressed:function(M,O){return M=M||0,O=O||500,this._pointerData[M].isDown&&this.downDuration(M)<O},justReleased:function(M,O){return M=M||0,O=O||500,this._pointerData[M].isUp&&this.game.time.time-this._pointerData[M].timeUp<O},overDuration:function(M){return M=M||0,this._pointerData[M].isOver?this.game.time.time-this._pointerData[M].timeOver:-1},downDuration:function(M){return M=M||0,this._pointerData[M].isDown?this.game.time.time-this._pointerData[M].timeDown:-1},enableDrag:function(M,O,U,W,X,V){void 0===M&&(M=!1),void 0===O&&(O=!1),void 0===U&&(U=!1),void 0===W&&(W=255),void 0===X&&(X=null),void 0===V&&(V=null),this._dragPoint=new C.Point,this.draggable=!0,this.bringToTop=O,this.dragOffset=new C.Point,this.dragFromCenter=M,this.pixelPerfectClick=U,this.pixelPerfectAlpha=W,X&&(this.boundsRect=X),V&&(this.boundsSprite=V)},disableDrag:function(){if(this._pointerData)for(var M=0;10>M;M++)this._pointerData[M].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(M){var O=this.sprite.x,U=this.sprite.y,W=this.globalToLocal(M);if(this.isDragged=!0,this._draggedPointerID=M.id,this._pointerData[M.id].camX=this.game.camera.x,this._pointerData[M.id].camY=this.game.camera.y,this._pointerData[M.id].isDragged=!0,this.sprite.fixedToCamera){if(this.dragFromCenter){var X=this.sprite.getBounds(),V=this.globalToLocal(new C.Point(X.centerX,X.centerY));this.sprite.cameraOffset.x=W.x+(this.sprite.cameraOffset.x-V.x),this.sprite.cameraOffset.y=W.y+(this.sprite.cameraOffset.y-V.y)}this._dragPoint.setTo(this.sprite.cameraOffset.x-M.x,this.sprite.cameraOffset.y-M.y)}else{if(this.dragFromCenter){var X=this.sprite.getBounds(),V=this.globalToLocal(new C.Point(X.centerX,X.centerY));this.sprite.x=W.x+(this.sprite.x-V.x),this.sprite.y=W.y+(this.sprite.y-V.y)}this._dragPoint.setTo(this.sprite.x-W.x,this.sprite.y-W.y)}this.updateDrag(M,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(O,U),this.sprite.events.onDragStart$dispatch(this.sprite,M,O,U),this._pendingDrag=!1},globalToLocalX:function(M){return this.scaleLayer&&(M-=this.game.scale.grid.boundsFluid.x,M*=this.game.scale.grid.scaleFluidInversed.x),M},globalToLocalY:function(M){return this.scaleLayer&&(M-=this.game.scale.grid.boundsFluid.y,M*=this.game.scale.grid.scaleFluidInversed.y),M},globalToLocal:function(M){return this.sprite.parent?this.game.input.getLocalPosition(this.sprite.parent,{x:M.x,y:M.y}):M},stopDrag:function(M){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[M.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,M),!1===this.checkPointerOver(M)&&this._pointerOutHandler(M)},setDragLock:function(M,O){void 0===M&&(M=!0),void 0===O&&(O=!0),this.allowHorizontalDrag=M,this.allowVerticalDrag=O},enableSnap:function(M,O,U,W,X,V){void 0===U&&(U=!0),void 0===W&&(W=!1),void 0===X&&(X=0),void 0===V&&(V=0),this.snapX=M,this.snapY=O,this.snapOffsetX=X,this.snapOffsetY=V,this.snapOnDrag=U,this.snapOnRelease=W},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},C.InputHandler.prototype.constructor=C.InputHandler,C.Gamepad=function(M){this.game=M,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new C.SinglePad(M,this),new C.SinglePad(M,this),new C.SinglePad(M,this),new C.SinglePad(M,this)]},C.Gamepad.prototype={addCallbacks:function(M,O){"undefined"!=typeof O&&(this.onConnectCallback="function"==typeof O.onConnect?O.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof O.onDisconnect?O.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof O.onDown?O.onDown:this.onDownCallback,this.onUpCallback="function"==typeof O.onUp?O.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof O.onAxis?O.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof O.onFloat?O.onFloat:this.onFloatCallback,this.callbackContext=M)},start:function(){if(!this._active){this._active=!0;var M=this;this._onGamepadConnected=function(O){return M.onGamepadConnected(O)},this._onGamepadDisconnected=function(O){return M.onGamepadDisconnected(O)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(M){var O=M.gamepad;this._rawPads.push(O),this._gamepads[O.index].connect(O)},onGamepadDisconnected:function(M){var O=M.gamepad;for(var U in this._rawPads)this._rawPads[U].index===O.index&&this._rawPads.splice(U,1);this._gamepads[O.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)var M=navigator.getGamepads();else if(navigator.webkitGetGamepads)var M=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var M=navigator.webkitGamepads();if(M){this._rawPads=[];for(var O=!1,U=0;U<M.length&&(typeof M[U]!==this._prevRawGamepadTypes[U]&&(O=!0,this._prevRawGamepadTypes[U]=typeof M[U]),M[U]&&this._rawPads.push(M[U]),3!==U);U++);for(var W=0;W<this._gamepads.length;W++)this._gamepads[W]._rawPad=this._rawPads[W];if(O){for(var X={rawIndices:{},padIndices:{}},H=0,V;H<this._gamepads.length;H++)if(V=this._gamepads[H],V.connected)for(var Y=0;Y<this._rawPads.length;Y++)this._rawPads[Y].index===V.index&&(X.rawIndices[V.index]=!0,X.padIndices[H]=!0);for(var z=0;z<this._gamepads.length;z++)if(V=this._gamepads[z],!X.padIndices[z]){1>this._rawPads.length&&V.disconnect();for(var K=0,J;K<this._rawPads.length&&!X.padIndices[z];K++)if(J=this._rawPads[K],!J)V.disconnect();else if(X.rawIndices[J.index]){V.disconnect();continue}else V.connect(J),X.rawIndices[J.index]=!0,X.padIndices[z]=!0}}}}},setDeadZones:function(M){for(var O=0;O<this._gamepads.length;O++)this._gamepads[O].deadZone=M},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var M=0;M<this._gamepads.length;M++)this._gamepads[M].reset()},justPressed:function(M,O){for(var U=0;U<this._gamepads.length;U++)if(!0===this._gamepads[U].justPressed(M,O))return!0;return!1},justReleased:function(M,O){for(var U=0;U<this._gamepads.length;U++)if(!0===this._gamepads[U].justReleased(M,O))return!0;return!1},isDown:function(M){for(var O=0;O<this._gamepads.length;O++)if(!0===this._gamepads[O].isDown(M))return!0;return!1},destroy:function(){this.stop();for(var M=0;M<this._gamepads.length;M++)this._gamepads[M].destroy()}},C.Gamepad.prototype.constructor=C.Gamepad,Object.defineProperty(C.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(C.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(C.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(C.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(C.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(C.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(C.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),C.Gamepad.BUTTON_0=0,C.Gamepad.BUTTON_1=1,C.Gamepad.BUTTON_2=2,C.Gamepad.BUTTON_3=3,C.Gamepad.BUTTON_4=4,C.Gamepad.BUTTON_5=5,C.Gamepad.BUTTON_6=6,C.Gamepad.BUTTON_7=7,C.Gamepad.BUTTON_8=8,C.Gamepad.BUTTON_9=9,C.Gamepad.BUTTON_10=10,C.Gamepad.BUTTON_11=11,C.Gamepad.BUTTON_12=12,C.Gamepad.BUTTON_13=13,C.Gamepad.BUTTON_14=14,C.Gamepad.BUTTON_15=15,C.Gamepad.AXIS_0=0,C.Gamepad.AXIS_1=1,C.Gamepad.AXIS_2=2,C.Gamepad.AXIS_3=3,C.Gamepad.AXIS_4=4,C.Gamepad.AXIS_5=5,C.Gamepad.AXIS_6=6,C.Gamepad.AXIS_7=7,C.Gamepad.AXIS_8=8,C.Gamepad.AXIS_9=9,C.Gamepad.XBOX360_A=0,C.Gamepad.XBOX360_B=1,C.Gamepad.XBOX360_X=2,C.Gamepad.XBOX360_Y=3,C.Gamepad.XBOX360_LEFT_BUMPER=4,C.Gamepad.XBOX360_RIGHT_BUMPER=5,C.Gamepad.XBOX360_LEFT_TRIGGER=6,C.Gamepad.XBOX360_RIGHT_TRIGGER=7,C.Gamepad.XBOX360_BACK=8,C.Gamepad.XBOX360_START=9,C.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,C.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,C.Gamepad.XBOX360_DPAD_LEFT=14,C.Gamepad.XBOX360_DPAD_RIGHT=15,C.Gamepad.XBOX360_DPAD_UP=12,C.Gamepad.XBOX360_DPAD_DOWN=13,C.Gamepad.XBOX360_STICK_LEFT_X=0,C.Gamepad.XBOX360_STICK_LEFT_Y=1,C.Gamepad.XBOX360_STICK_RIGHT_X=2,C.Gamepad.XBOX360_STICK_RIGHT_Y=3,C.Gamepad.PS3XC_X=0,C.Gamepad.PS3XC_CIRCLE=1,C.Gamepad.PS3XC_SQUARE=2,C.Gamepad.PS3XC_TRIANGLE=3,C.Gamepad.PS3XC_L1=4,C.Gamepad.PS3XC_R1=5,C.Gamepad.PS3XC_L2=6,C.Gamepad.PS3XC_R2=7,C.Gamepad.PS3XC_SELECT=8,C.Gamepad.PS3XC_START=9,C.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,C.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,C.Gamepad.PS3XC_DPAD_UP=12,C.Gamepad.PS3XC_DPAD_DOWN=13,C.Gamepad.PS3XC_DPAD_LEFT=14,C.Gamepad.PS3XC_DPAD_RIGHT=15,C.Gamepad.PS3XC_STICK_LEFT_X=0,C.Gamepad.PS3XC_STICK_LEFT_Y=1,C.Gamepad.PS3XC_STICK_RIGHT_X=2,C.Gamepad.PS3XC_STICK_RIGHT_Y=3,C.SinglePad=function(M,O){this.game=M,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=0.26,this._padParent=O,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},C.SinglePad.prototype={addCallbacks:function(M,O){"undefined"!=typeof O&&(this.onConnectCallback="function"==typeof O.onConnect?O.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof O.onDisconnect?O.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof O.onDown?O.onDown:this.onDownCallback,this.onUpCallback="function"==typeof O.onUp?O.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof O.onAxis?O.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof O.onFloat?O.onFloat:this.onFloatCallback,this.callbackContext=M)},getButton:function(M){return this._buttons[M]?this._buttons[M]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var M=0,O;M<this._buttonsLen;M++)O=isNaN(this._rawPad.buttons[M])?this._rawPad.buttons[M].value:this._rawPad.buttons[M],O!==this._buttons[M].value&&(1===O?this.processButtonDown(M,O):0===O?this.processButtonUp(M,O):this.processButtonFloat(M,O));for(var U=0,W;U<this._axesLen;U++)W=this._rawPad.axes[U],0<W&&W>this.deadZone||0>W&&W<-this.deadZone?this.processAxisChange(U,W):this.processAxisChange(U,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(M){var O=!this.connected;this.connected=!0,this.index=M.index,this._rawPad=M,this._buttons=[],this._buttonsLen=M.buttons.length,this._axes=[],this._axesLen=M.axes.length;for(var U=0;U<this._axesLen;U++)this._axes[U]=M.axes[U];for(var W in M.buttons)W=parseInt(W,10),this._buttons[W]=new C.DeviceButton(this,W);O&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),O&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var M=this.connected,O=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var U=0;U<this._buttonsLen;U++)this._buttons[U].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,M&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,O),M&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var M=0;M<this._buttonsLen;M++)this._buttons[M].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(M,O){this._axes[M]===O||(this._axes[M]=O,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,M,O),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,M,O))},processButtonDown:function(M,O){this._buttons[M]&&this._buttons[M].start(null,O),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,M,O,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,M,O)},processButtonUp:function(M,O){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,M,O,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,M,O),this._buttons[M]&&this._buttons[M].stop(null,O)},processButtonFloat:function(M,O){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,M,O,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,M,O),this._buttons[M]&&this._buttons[M].padFloat(O)},axis:function(M){return!!this._axes[M]&&this._axes[M]},isDown:function(M){return!!this._buttons[M]&&this._buttons[M].isDown},isUp:function(M){return!!this._buttons[M]&&this._buttons[M].isUp},justReleased:function(M,O){if(this._buttons[M])return this._buttons[M].justReleased(O)},justPressed:function(M,O){if(this._buttons[M])return this._buttons[M].justPressed(O)},buttonValue:function(M){return this._buttons[M]?this._buttons[M].value:null},reset:function(){for(var M=0;M<this._axes.length;M++)this._axes[M]=0}},C.SinglePad.prototype.constructor=C.SinglePad,C.Key=function(M,O){this.game=M,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.durationUp=-2500,this.repeats=0,this.keyCode=O,this.onDown=new C.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new C.Signal,this._justDown=!1,this._justUp=!1},C.Key.prototype={update:function(){this._enabled&&(this.isDown?(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this)):this.durationUp=this.game.time.time-this.timeUp)},processKeyDown:function(M){this._enabled&&(this.event=M,this.isDown||(this.altKey=M.altKey,this.ctrlKey=M.ctrlKey,this.shiftKey=M.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.durationUp=this.game.time.time-this.timeUp,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(M){this._enabled&&(this.event=M,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this.durationUp=0,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(M){void 0===M&&(M=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this.durationUp=-2500,this._enabled=!0,this._justDown=!1,this._justUp=!1,M&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(M){return void 0===M&&(M=50),this.isDown&&this.duration<M},upDuration:function(M){return void 0===M&&(M=50),!this.isDown&&this.game.time.time-this.timeUp<M},justPressed:function(){return this.isDown&&0===this.duration},justReleased:function(){return!this.isDown&&0===this.durationUp}},Object.defineProperty(C.Key.prototype,"justDown",{get:function(){var M=this._justDown;return this._justDown=!1,M}}),Object.defineProperty(C.Key.prototype,"justUp",{get:function(){var M=this._justUp;return this._justUp=!1,M}}),Object.defineProperty(C.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(M){M=!!M,M!==this._enabled&&(!M&&this.reset(!1),this._enabled=M)}}),C.Key.prototype.constructor=C.Key,C.Keyboard=function(M){this.game=M,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},C.Keyboard.prototype={addCallbacks:function(M,O,U,W){this.callbackContext=M,void 0!==O&&null!==O&&(this.onDownCallback=O),void 0!==U&&null!==U&&(this.onUpCallback=U),void 0!==W&&null!==W&&(this.onPressCallback=W)},addKey:function(M){return this._keys[M]||(this._keys[M]=new C.Key(this.game,M),this.addKeyCapture(M)),this._keys[M]},addKeys:function(M){var O={};for(var U in M)O[U]=this.addKey(M[U]);return O},removeKey:function(M){this._keys[M]&&(this._keys[M]=null,this.removeKeyCapture(M))},createCursorKeys:function(){return this.addKeys({up:C.KeyCode.UP,down:C.KeyCode.DOWN,left:C.KeyCode.LEFT,right:C.KeyCode.RIGHT})},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var M=this;this._onKeyDown=function(O){return M.processKeyDown(O)},this._onKeyUp=function(O){return M.processKeyUp(O)},this._onKeyPress=function(O){return M.processKeyPress(O)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(M){if("object"==typeof M)for(var O in M)this._capture[M[O]]=!0;else this._capture[M]=!0},removeKeyCapture:function(M){delete this._capture[M]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(M){if(this.event=M,this.game.input.enabled&&this.enabled){var O=M.keyCode;this._capture[O]&&M.preventDefault(),this._keys[O]||(this._keys[O]=new C.Key(this.game,O)),this._keys[O].processKeyDown(M),this._k=O,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,M)}},processKeyPress:function(M){this.pressEvent=M,this.game.input.enabled&&this.enabled&&(!this.onPressCallback||this.onPressCallback.call(this.callbackContext,String.fromCharCode(M.charCode),M))},processKeyUp:function(M){if(this.event=M,this.game.input.enabled&&this.enabled){var O=M.keyCode;this._capture[O]&&M.preventDefault(),this._keys[O]||(this._keys[O]=new C.Key(this.game,O)),this._keys[O].processKeyUp(M),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,M)}},reset:function(M){void 0===M&&(M=!0),this.event=null;for(var O=this._keys.length;O--;)this._keys[O]&&this._keys[O].reset(M)},downDuration:function(M,O){return this._keys[M]?this._keys[M].downDuration(O):null},upDuration:function(M,O){return this._keys[M]?this._keys[M].upDuration(O):null},justPressed:function(M){return this._keys[M]?this._keys[M].justPressed():null},justReleased:function(M){return this._keys[M]?this._keys[M].justReleased():null},isDown:function(M){return this._keys[M]?this._keys[M].isDown:null}},Object.defineProperty(C.Keyboard.prototype,"lastChar",{get:function(){return this.event&&32===this.event.charCode?"":this.pressEvent?String.fromCharCode(this.pressEvent.charCode):null}}),Object.defineProperty(C.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),C.Keyboard.prototype.constructor=C.Keyboard,C.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},C.KeyCode)C.KeyCode.hasOwnProperty(S)&&!S.match(/[a-z]/)&&(C.Keyboard[S]=C.KeyCode[S]);for(var A in C.Component=function(){},C.Component.Angle=function(){},C.Component.Angle.prototype={angle:{get:function(){return C.Math.wrapAngle(C.Math.radToDeg(this.rotation))},set:function(M){this.rotation=C.Math.degToRad(C.Math.wrapAngle(M))}}},C.Component.Animation=function(){},C.Component.Animation.prototype={play:function(M,O,U,W){if(this.animations)return this.animations.play(M,O,U,W)}},C.Component.AutoCull=function(){},C.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},C.Component.Bounds=function(){},C.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+0.5*this.width},set:function(M){this.x=M+this.offsetX-0.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+0.5*this.height},set:function(M){this.y=M+this.offsetY-0.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(M){this.x=M+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(M){this.x=M-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(M){this.y=M+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(M){this.y=M-this.height+this.offsetY}},alignIn:function(M,O,U,W){switch(void 0===U&&(U=0),void 0===W&&(W=0),O){default:case C.TOP_LEFT:this.left=M.left-U,this.top=M.top-W;break;case C.TOP_CENTER:this.centerX=M.centerX+U,this.top=M.top-W;break;case C.TOP_RIGHT:this.right=M.right+U,this.top=M.top-W;break;case C.LEFT_CENTER:this.left=M.left-U,this.centerY=M.centerY+W;break;case C.CENTER:this.centerX=M.centerX+U,this.centerY=M.centerY+W;break;case C.RIGHT_CENTER:this.right=M.right+U,this.centerY=M.centerY+W;break;case C.BOTTOM_LEFT:this.left=M.left-U,this.bottom=M.bottom+W;break;case C.BOTTOM_CENTER:this.centerX=M.centerX+U,this.bottom=M.bottom+W;break;case C.BOTTOM_RIGHT:this.right=M.right+U,this.bottom=M.bottom+W;}return this},alignTo:function(M,O,U,W){switch(void 0===U&&(U=0),void 0===W&&(W=0),O){default:case C.TOP_LEFT:this.left=M.left-U,this.bottom=M.top-W;break;case C.TOP_CENTER:this.centerX=M.centerX+U,this.bottom=M.top-W;break;case C.TOP_RIGHT:this.right=M.right+U,this.bottom=M.top-W;break;case C.LEFT_TOP:this.right=M.left-U,this.top=M.top-W;break;case C.LEFT_CENTER:this.right=M.left-U,this.centerY=M.centerY+W;break;case C.LEFT_BOTTOM:this.right=M.left-U,this.bottom=M.bottom+W;break;case C.RIGHT_TOP:this.left=M.right+U,this.top=M.top-W;break;case C.RIGHT_CENTER:this.left=M.right+U,this.centerY=M.centerY+W;break;case C.RIGHT_BOTTOM:this.left=M.right+U,this.bottom=M.bottom+W;break;case C.BOTTOM_LEFT:this.left=M.left-U,this.top=M.bottom+W;break;case C.BOTTOM_CENTER:this.centerX=M.centerX+U,this.top=M.bottom+W;break;case C.BOTTOM_RIGHT:this.right=M.right+U,this.top=M.bottom+W;}return this}},C.Group.prototype.alignIn=C.Component.Bounds.prototype.alignIn,C.Group.prototype.alignTo=C.Component.Bounds.prototype.alignTo,C.Component.BringToTop=function(){},C.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},C.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},C.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},C.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},C.Component.Core=function(){},C.Component.Core.skipTypeChecks=!1,C.Component.Core.install=function(M){C.Utils.mixinPrototype(this,C.Component.Core.prototype),this.components={};for(var O=0;O<M.length;O++){var U=M[O],W=!1;"Destroy"===U&&(W=!0),C.Utils.mixinPrototype(this,C.Component[U].prototype,W),this.components[U]=!0}},C.Component.Core.init=function(M,O,U,W,X){if(!C.Component.Core.skipTypeChecks){if(!(M instanceof C.Game))throw new Error("The value passed as the `game` argument ("+M+") is not an instance of Phaser.Game.");"number"!=typeof O&&(console.warn("The `x` argument value (%s) should be a number.",O),O=0),"number"!=typeof U&&(console.warn("The `y` argument value (%s) should be a number.",U),U=0)}this.game=M,this.key=W,this.data={},this.position.set(O,U),this.world=new C.Point(O,U),this.previousPosition=new C.Point(O,U),this.events=new C.Events(this),this._bounds=new C.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new C.AnimationManager(this)),this.components.LoadTexture&&null!==W&&this.loadTexture(W,X),this.components.FixedToCamera&&(this.cameraOffset=new C.Point(O,U))},C.Component.Core.preUpdate=function(){return this.pendingDestroy?void this.destroy():(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)?(this.renderOrderID=-1,!1):(this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate(),this.preUpdateChildren(),!0)},C.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(M){M?(this._exists=!0,this.body&&this.body.type===C.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===C.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},preUpdateChildren:function(){for(var M=0,O;M<this.children.length;)O=this.children[M],O.preUpdate(),this===O.parent&&M++},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&C.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&C.Component.FixedToCamera.postUpdate.call(this);for(var M=0;M<this.children.length;M++)this.children[M].postUpdate()}},C.Component.Crop=function(){},C.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(M,O){void 0===O&&(O=!1),M?(O&&null!==this.cropRect?this.cropRect.setTo(M.x,M.y,M.width,M.height):O&&null===this.cropRect?this.cropRect=new C.Rectangle(M.x,M.y,M.width,M.height):this.cropRect=M,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var M=this.texture.crop.x,O=this.texture.crop.y,U=this.texture.crop.width,W=this.texture.crop.height;this._crop=C.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var X=Math.max(this._frame.x,this._crop.x),V=Math.max(this._frame.y,this._crop.y),H=Math.min(this._frame.right,this._crop.right)-X,Y=Math.min(this._frame.bottom,this._crop.bottom)-V;this.texture.crop.x=X,this.texture.crop.y=V,this.texture.crop.width=H,this.texture.crop.height=Y,this.texture.frame.width=Math.min(H,this.cropRect.width),this.texture.frame.height=Math.min(Y,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215!==this.tint&&(M!==X||O!==V||U!==H||W!==Y)&&(this.texture.requiresReTint=!0)}}},C.Component.Delta=function(){},C.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},C.Component.Destroy=function(){},C.Component.Destroy.prototype={destroyPhase:!1,destroy:function(M,O){if(!(null===this.game||this.destroyPhase)){void 0===M&&(M=!0),void 0===O&&(O=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof C.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var U=this.children.length;if(M)for(;U--;)this.children[U].destroy(M);else for(;U--;)this.removeChild(this.children[U]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),C.Video&&this.key instanceof C.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),C.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),O&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},C.Events=function(M){this.parent=M},C.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},C.Events.prototype.constructor=C.Events,C.Events.prototype)C.Events.prototype.hasOwnProperty(A)&&0===A.indexOf("on")&&null===C.Events.prototype[A]&&function(M,O){"use strict";Object.defineProperty(C.Events.prototype,M,{get:function(){return this[O]||(this[O]=new C.Signal)}}),C.Events.prototype[M+"$dispatch"]=function(){return this[O]?this[O].dispatch.apply(this[O],arguments):null}}(A,"_"+A);C.Component.FixedToCamera=function(){},C.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},C.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(M){M?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new C.Point},C.Component.Health=function(){},C.Component.Health.prototype={health:1,maxHealth:100,damage:function(M){return this.alive&&(this.health-=M,0>=this.health&&this.kill()),this},setHealth:function(M){return this.health=M,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(M){return this.alive&&(this.health+=M,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},C.Component.InCamera=function(){},C.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},C.Component.InputEnabled=function(){},C.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(M){M?null===this.input?(this.input=new C.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},C.Component.InWorld=function(){},C.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},C.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},C.Component.LifeSpan=function(){},C.Component.LifeSpan.preUpdate=function(){return 0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,0>=this.lifespan)?(this.kill(),!1):!0},C.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(M){return void 0===M&&(M=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(M),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},C.Component.LoadTexture=function(){},C.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(M,O,U){M===C.PENDING_ATLAS?(M=O,O=0):O=O||0,(U||void 0===U)&&this.animations&&this.animations.stop(),this.key=M,this.customRender=!1;var W=this.game.cache,X=!0,V=!this.texture.baseTexture.scaleMode;if(C.RenderTexture&&M instanceof C.RenderTexture)this.key=M.key,this.setTexture(M);else if(C.BitmapData&&M instanceof C.BitmapData)this.customRender=!0,this.setTexture(M.texture),X=W.hasFrameData(M.key,C.Cache.BITMAPDATA)?!this.animations.loadFrameData(W.getFrameData(M.key,C.Cache.BITMAPDATA),O):!this.animations.loadFrameData(M.frameData,0);else if(C.Video&&M instanceof C.Video){this.customRender=!0;var H=M.texture.valid;this.setTexture(M.texture),this.setFrame(M.texture.frame.clone()),M.onChangeSource.add(this.resizeFrame,this),this.texture.valid=H}else if(C.Tilemap&&M instanceof C.TilemapLayer)this.setTexture(PIXI.Texture.fromCanvas(M.canvas));else if(M instanceof PIXI.Texture)this.setTexture(M);else{var Y=W.getImage(M,!0);this.key=Y.key,this.setTexture(new PIXI.Texture(Y.base)),this.texture.baseTexture.skipRender="__default"===M,X=!this.animations.loadFrameData(Y.frameData,O)}X&&(this._frame=C.Rectangle.clone(this.texture.frame)),V||(this.texture.baseTexture.scaleMode=1)},setFrame:function(M){this._frame=M,this.texture.frame.x=M.x,this.texture.frame.y=M.y,this.texture.frame.width=M.width,this.texture.frame.height=M.height,this.texture.crop.x=M.x,this.texture.crop.y=M.y,this.texture.crop.width=M.width,this.texture.crop.height=M.height,M.trimmed?(this.texture.trim?(this.texture.trim.x=M.spriteSourceSizeX,this.texture.trim.y=M.spriteSourceSizeY,this.texture.trim.width=M.sourceSizeW,this.texture.trim.height=M.sourceSizeH):this.texture.trim={x:M.spriteSourceSizeX,y:M.spriteSourceSizeY,width:M.sourceSizeW,height:M.sourceSizeH},this.texture.width=M.sourceSizeW,this.texture.height=M.sourceSizeH,this.texture.frame.width=M.sourceSizeW,this.texture.frame.height=M.sourceSizeH):!M.trimmed&&this.texture.trim&&(this.texture.trim=null),M.rotated&&(this.texture.rotated=!0),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(M,O,U){this.texture.frame.resize(O,U),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(M){this.animations.frame=M}},frameName:{get:function(){return this.animations.frameName},set:function(M){this.animations.frameName=M}}},C.Component.Overlap=function(){},C.Component.Overlap.prototype={overlap:function(M){return C.Rectangle.intersects(this.getBounds(),M.getBounds())}},C.Component.PhysicsBody=function(){},C.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,this.preUpdateChildren(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this._exists&&this.parent.exists||(this.renderOrderID=-1,!1))},C.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},C.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(M){this.position.x=M,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(M){this.position.y=M,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},C.Component.Reset=function(){},C.Component.Reset.prototype.reset=function(M,O,U){return void 0===U&&(U=1),this.world.set(M,O),this.position.set(M,O),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=U),this.components.PhysicsBody&&this.body&&this.body.reset(M,O,!1,!1),this},C.Component.ScaleMinMax=function(){},C.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(M){this.scaleMin&&(M.a<this.scaleMin.x&&(M.a=this.scaleMin.x),M.d<this.scaleMin.y&&(M.d=this.scaleMin.y)),this.scaleMax&&(M.a>this.scaleMax.x&&(M.a=this.scaleMax.x),M.d>this.scaleMax.y&&(M.d=this.scaleMax.y))},setScaleMinMax:function(M,O,U,W){void 0===O?O=U=W=M:void 0===U&&(U=W=O,O=M),null===M?this.scaleMin=null:this.scaleMin?this.scaleMin.set(M,O):this.scaleMin=new C.Point(M,O),null===U?this.scaleMax=null:this.scaleMax?this.scaleMax.set(U,W):this.scaleMax=new C.Point(U,W),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},C.Component.Smoothed=function(){},C.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(M){M?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},C.GameObjectFactory=function(M){this.game=M,this.world=this.game.world},C.GameObjectFactory.prototype={existing:function(M){return this.world.add(M)},weapon:function(M,O,U,W,X){var V=this.game.plugins.add(C.Weapon);return X&&(V.bulletClass=X),V.createBullets(M,O,U,W),V},image:function(M,O,U,W,X){return void 0===X&&(X=this.world),X.add(new C.Image(this.game,M,O,U,W))},sprite:function(M,O,U,W,X){return void 0===X&&(X=this.world),X.create(M,O,U,W)},creature:function(M,O,U,W,X){void 0===X&&(X=this.world);var V=new C.Creature(this.game,M,O,U,W);return X.add(V),V},tween:function(M){return this.game.tweens.create(M)},group:function(M,O,U,W,X){return new C.Group(this.game,M,O,U,W,X)},physicsGroup:function(M,O,U,W){return new C.Group(this.game,O,U,W,!0,M)},spriteBatch:function(M,O,U){return void 0===M&&(M=null),void 0===O&&(O="group"),void 0===U&&(U=!1),new C.SpriteBatch(this.game,M,O,U)},audio:function(M,O,U,W){return this.game.sound.add(M,O,U,W)},sound:function(M,O,U,W){return this.game.sound.add(M,O,U,W)},audioSprite:function(M){return this.game.sound.addSprite(M)},tileSprite:function(M,O,U,W,X,V,H){return void 0===H&&(H=this.world),H.add(new C.TileSprite(this.game,M,O,U,W,X,V))},rope:function(M,O,U,W,X,V){return void 0===V&&(V=this.world),V.add(new C.Rope(this.game,M,O,U,W,X))},text:function(M,O,U,W,X){return void 0===X&&(X=this.world),X.add(new C.Text(this.game,M,O,U,W))},button:function(M,O,U,W,X,V,H,Y,z,K){return void 0===K&&(K=this.world),K.add(new C.Button(this.game,M,O,U,W,X,V,H,Y,z))},graphics:function(M,O,U){return void 0===U&&(U=this.world),U.add(new C.Graphics(this.game,M,O))},emitter:function(M,O,U){return this.game.particles.add(new C.Particles.Arcade.Emitter(this.game,M,O,U))},retroFont:function(M,O,U,W,X,V,H,Y,z){return new C.RetroFont(this.game,M,O,U,W,X,V,H,Y,z)},bitmapText:function(M,O,U,W,X,V){return void 0===V&&(V=this.world),V.add(new C.BitmapText(this.game,M,O,U,W,X))},tilemap:function(M,O,U,W,X){return new C.Tilemap(this.game,M,O,U,W,X)},renderTexture:function(M,O,U,W){(void 0===U||""===U)&&(U=this.game.rnd.uuid()),void 0===W&&(W=!1);var X=new C.RenderTexture(this.game,M,O,U);return W&&this.game.cache.addRenderTexture(U,X),X},video:function(M,O){return new C.Video(this.game,M,O)},bitmapData:function(M,O,U,W){void 0===W&&(W=!1),(void 0===U||""===U)&&(U=this.game.rnd.uuid());var X=new C.BitmapData(this.game,U,M,O);return W&&this.game.cache.addBitmapData(U,X),X},filter:function(M){var O=Array.prototype.slice.call(arguments,1),M=new C.Filter[M](this.game);return M.init.apply(M,O),M},plugin:function(M){return this.game.plugins.add(M)}},C.GameObjectFactory.prototype.constructor=C.GameObjectFactory,C.GameObjectCreator=function(M){this.game=M,this.world=this.game.world},C.GameObjectCreator.prototype={image:function(M,O,U,W){return new C.Image(this.game,M,O,U,W)},sprite:function(M,O,U,W){return new C.Sprite(this.game,M,O,U,W)},tween:function(M){return new C.Tween(M,this.game,this.game.tweens)},group:function(M,O,U,W,X){return new C.Group(this.game,M,O,U,W,X)},spriteBatch:function(M,O,U){return void 0===O&&(O="group"),void 0===U&&(U=!1),new C.SpriteBatch(this.game,M,O,U)},audio:function(M,O,U,W){return this.game.sound.add(M,O,U,W)},audioSprite:function(M){return this.game.sound.addSprite(M)},sound:function(M,O,U,W){return this.game.sound.add(M,O,U,W)},tileSprite:function(M,O,U,W,X,V){return new C.TileSprite(this.game,M,O,U,W,X,V)},rope:function(M,O,U,W,X){return new C.Rope(this.game,M,O,U,W,X)},text:function(M,O,U,W){return new C.Text(this.game,M,O,U,W)},button:function(M,O,U,W,X,V,H,Y,z){return new C.Button(this.game,M,O,U,W,X,V,H,Y,z)},graphics:function(M,O){return new C.Graphics(this.game,M,O)},emitter:function(M,O,U){return new C.Particles.Arcade.Emitter(this.game,M,O,U)},retroFont:function(M,O,U,W,X,V,H,Y,z){return new C.RetroFont(this.game,M,O,U,W,X,V,H,Y,z)},bitmapText:function(M,O,U,W,X,V){return new C.BitmapText(this.game,M,O,U,W,X,V)},tilemap:function(M,O,U,W,X){return new C.Tilemap(this.game,M,O,U,W,X)},renderTexture:function(M,O,U,W){(void 0===U||""===U)&&(U=this.game.rnd.uuid()),void 0===W&&(W=!1);var X=new C.RenderTexture(this.game,M,O,U);return W&&this.game.cache.addRenderTexture(U,X),X},bitmapData:function(M,O,U,W){void 0===W&&(W=!1),(void 0===U||""===U)&&(U=this.game.rnd.uuid());var X=new C.BitmapData(this.game,U,M,O);return W&&this.game.cache.addBitmapData(U,X),X},filter:function(M){var O=Array.prototype.slice.call(arguments,1),M=new C.Filter[M](this.game);return M.init.apply(M,O),M}},C.GameObjectCreator.prototype.constructor=C.GameObjectCreator,C.Sprite=function(M,O,U,W,X){O=O||0,U=U||0,W=W||null,X=X||null,this.type=C.SPRITE,this.physicsType=C.SPRITE,PIXI.Sprite.call(this,C.Cache.DEFAULT),C.Component.Core.init.call(this,M,O,U,W,X)},C.Sprite.prototype=Object.create(PIXI.Sprite.prototype),C.Sprite.prototype.constructor=C.Sprite,C.Component.Core.install.call(C.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),C.Sprite.prototype.preUpdatePhysics=C.Component.PhysicsBody.preUpdate,C.Sprite.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.Sprite.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.Sprite.prototype.preUpdateCore=C.Component.Core.preUpdate,C.Sprite.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.Image=function(M,O,U,W,X){O=O||0,U=U||0,W=W||null,X=X||null,this.type=C.IMAGE,PIXI.Sprite.call(this,C.Cache.DEFAULT),C.Component.Core.init.call(this,M,O,U,W,X)},C.Image.prototype=Object.create(PIXI.Sprite.prototype),C.Image.prototype.constructor=C.Image,C.Component.Core.install.call(C.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),C.Image.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.Image.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.Image.prototype.preUpdateCore=C.Component.Core.preUpdate,C.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()&&this.preUpdateLifeSpan()&&this.preUpdateCore()},C.Button=function(M,O,U,W,X,V,H,Y,z,K){O=O||0,U=U||0,W=W||null,X=X||null,V=V||this,C.Image.call(this,M,O,U,W,Y),this.type=C.BUTTON,this.physicsType=C.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new C.Signal,this.onInputOut=new C.Signal,this.onInputDown=new C.Signal,this.onInputUp=new C.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=C.PointerMode.TOUCH,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(H,Y,z,K),null!==X&&this.onInputUp.add(X,V),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},C.Button.prototype=Object.create(C.Image.prototype),C.Button.prototype.constructor=C.Button;var E="Over",R="Out",L="Down",D="Up";return C.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},C.Button.prototype.setStateFrame=function(M,O,U){var W="_on"+M+"Frame";null===O?this[W]=null:(this[W]=O,U&&this.changeStateFrame(M))},C.Button.prototype.changeStateFrame=function(M){if(this.freezeFrames)return!1;var U=this["_on"+M+"Frame"];return"string"==typeof U?(this.frameName=U,!0):"number"==typeof U&&(this.frame=U,!0)},C.Button.prototype.setFrames=function(M,O,U,W){this.setStateFrame(E,M,this.input.pointerOver()),this.setStateFrame(R,O,!this.input.pointerOver()),this.setStateFrame(L,U,this.input.pointerDown()),this.setStateFrame(D,W,this.input.pointerUp())},C.Button.prototype.setStateSound=function(M,O,U){var W="on"+M+"Sound",X="on"+M+"SoundMarker";O instanceof C.Sound||O instanceof C.AudioSprite?(this[W]=O,this[X]="string"==typeof U?U:""):(this[W]=null,this[X]="")},C.Button.prototype.playStateSound=function(M){var U=this["on"+M+"Sound"];if(U){var X=this["on"+M+"SoundMarker"];return U.play(X),!0}return!1},C.Button.prototype.setSounds=function(M,O,U,W,X,V,H,Y){this.setStateSound(E,M,O),this.setStateSound(R,X,V),this.setStateSound(L,U,W),this.setStateSound(D,H,Y)},C.Button.prototype.setOverSound=function(M,O){this.setStateSound(E,M,O)},C.Button.prototype.setOutSound=function(M,O){this.setStateSound(R,M,O)},C.Button.prototype.setDownSound=function(M,O){this.setStateSound(L,M,O)},C.Button.prototype.setUpSound=function(M,O){this.setStateSound(D,M,O)},C.Button.prototype.onInputOverHandler=function(M,O){O.justReleased()&&(this.justReleasedPreventsOver&O.pointerMode)===O.pointerMode||(this.changeStateFrame(E),this.onOverMouseOnly&&!O.isMouse||(this.playStateSound(E),this.onInputOver&&this.onInputOver.dispatch(this,O)))},C.Button.prototype.onInputOutHandler=function(M,O){this.changeStateFrame(R),this.playStateSound(R),this.onInputOut&&this.onInputOut.dispatch(this,O)},C.Button.prototype.onInputDownHandler=function(M,O){this.changeStateFrame(L),this.playStateSound(L),this.onInputDown&&this.onInputDown.dispatch(this,O)},C.Button.prototype.onInputUpHandler=function(M,O,U){if(this.playStateSound(D),this.onInputUp&&this.onInputUp.dispatch(this,O,U),!this.freezeFrames)if(!0===this.forceOut||(this.forceOut&O.pointerMode)===O.pointerMode)this.changeStateFrame(R);else{var W=this.changeStateFrame(D);W||(U?this.changeStateFrame(E):this.changeStateFrame(R))}},C.SpriteBatch=function(M,O,U,W){(void 0===O||null===O)&&(O=M.world),C.Group.call(this,M,O,U,W),this.type=C.SPRITEBATCH,this.fastSpriteBatch=null,this.ready=!1},C.SpriteBatch.prototype=Object.create(C.Group.prototype),C.SpriteBatch.prototype.constructor=C.SpriteBatch,C.SpriteBatch.prototype._renderWebGL=function(M){this.visible&&!(0>=this.alpha)&&this.children.length&&(!this.ready&&(this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(M.gl),this.ready=!0),this.fastSpriteBatch.gl!==M.gl&&this.fastSpriteBatch.setContext(M.gl),M.spriteBatch.stop(),M.shaderManager.setShader(M.shaderManager.fastShader),this.fastSpriteBatch.begin(this,M),this.fastSpriteBatch.render(this),M.spriteBatch.start())},C.SpriteBatch.prototype._renderCanvas=function(M){if(this.visible&&!(0>=this.alpha)&&this.children.length){var O=M.context;O.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var U=this.worldTransform,W=!0,X=0,V;X<this.children.length;X++)if(V=this.children[X],!!V.visible){var H=V.texture,Y=H.frame;if(O.globalAlpha=this.worldAlpha*V.alpha,0==V.rotation%(2*Math.PI))W&&(O.setTransform(U.a,U.b,U.c,U.d,U.tx,U.ty),W=!1),O.drawImage(H.baseTexture.source,Y.x,Y.y,Y.width,Y.height,0|V.anchor.x*(-Y.width*V.scale.x)+V.position.x+0.5+M.shakeX,0|V.anchor.y*(-Y.height*V.scale.y)+V.position.y+0.5+M.shakeY,Y.width*V.scale.x,Y.height*V.scale.y);else{W||(W=!0),V.displayObjectUpdateTransform();var z=V.worldTransform,K=z.tx*M.resolution+M.shakeX,J=z.ty*M.resolution+M.shakeY;M.roundPixels?O.setTransform(z.a,z.b,z.c,z.d,0|K,0|J):O.setTransform(z.a,z.b,z.c,z.d,K,J),O.drawImage(H.baseTexture.source,Y.x,Y.y,Y.width,Y.height,0|V.anchor.x*-Y.width+0.5,0|V.anchor.y*-Y.height+0.5,Y.width,Y.height)}}}},C.BitmapData=function(M,O,U,W,X){(void 0===U||0===U)&&(U=256),(void 0===W||0===W)&&(W=256),void 0===X&&(X=!1),this.game=M,this.key=O,this.width=U,this.height=W,this.canvas=C.Canvas.create(this,U,W,null,X),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=M.renderType===C.CANVAS?M.renderer.renderSession.smoothProperty:C.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,U,W),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new C.FrameData,this.textureFrame=this.frameData.addFrame(new C.Frame(0,0,0,U,W,"bitmapData")),this.texture.frame=this.textureFrame,this.type=C.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new C.Point,this._size=new C.Point,this._scale=new C.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new C.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new C.Circle,this._swapCanvas=void 0},C.BitmapData.prototype={move:function(M,O,U){return 0!==M&&this.moveH(M,U),0!==O&&this.moveV(O,U),this},moveH:function(M,O){void 0===O&&(O=!0),void 0===this._swapCanvas&&(this._swapCanvas=C.CanvasPool.create(this,this.width,this.height));var U=this._swapCanvas,W=U.getContext("2d"),X=this.height,V=this.canvas;if(W.clearRect(0,0,this.width,this.height),0>M){M=Math.abs(M);var H=this.width-M;O&&W.drawImage(V,0,0,M,X,H,0,M,X),W.drawImage(V,M,0,H,X,0,0,H,X)}else{var H=this.width-M;O&&W.drawImage(V,H,0,M,X,0,0,M,X),W.drawImage(V,0,0,H,X,M,0,H,X)}return this.clear(),this.copy(this._swapCanvas)},moveV:function(M,O){void 0===O&&(O=!0),void 0===this._swapCanvas&&(this._swapCanvas=C.CanvasPool.create(this,this.width,this.height));var U=this._swapCanvas,W=U.getContext("2d"),X=this.width,V=this.canvas;if(W.clearRect(0,0,this.width,this.height),0>M){M=Math.abs(M);var H=this.height-M;O&&W.drawImage(V,0,0,X,M,0,H,X,M),W.drawImage(V,0,M,X,H,0,0,X,H)}else{var H=this.height-M;O&&W.drawImage(V,0,H,X,M,0,0,X,M),W.drawImage(V,0,0,X,H,0,M,X,H)}return this.clear(),this.copy(this._swapCanvas)},add:function(M){if(Array.isArray(M))for(var O=0;O<M.length;O++)M[O].loadTexture&&M[O].loadTexture(this);else M.loadTexture(this);return this},load:function(M){if("string"==typeof M&&(M=this.game.cache.getImage(M)),M)this.resize(M.width,M.height),this.cls();else return;return this.draw(M),this.update(),this},clear:function(M,O,U,W){return void 0===M&&(M=0),void 0===O&&(O=0),void 0===U&&(U=this.width),void 0===W&&(W=this.height),this.context.clearRect(M,O,U,W),this.dirty=!0,this},fill:function(M,O,U,W){return void 0===W&&(W=1),this.context.fillStyle="rgba("+M+","+O+","+U+","+W+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(M,O,U){var W=this.game.cache,X=new Image;if(O&&(X.onload=function(){var H=W.addImage(M,"",X),Y=new PIXI.Texture(H.base);O.call(U||null,Y),X.onload=null}),X.src=this.canvas.toDataURL("image/png"),!O){var V=W.addImage(M,"",X);return new PIXI.Texture(V.base)}return null},resize:function(M,O){return(M!==this.width||O!==this.height)&&(this.width=M,this.height=O,this.canvas.width=M,this.canvas.height=O,void 0!==this._swapCanvas&&(this._swapCanvas.width=M,this._swapCanvas.height=O),this.baseTexture.width=M,this.baseTexture.height=O,this.textureFrame.width=M,this.textureFrame.height=O,this.texture.width=M,this.texture.height=O,this.texture.crop.width=M,this.texture.crop.height=O,this.update(),this.dirty=!0),this},update:function(M,O,U,W){return void 0===M&&(M=0),void 0===O&&(O=0),void 0===U&&(U=Math.max(1,this.width)),void 0===W&&(W=Math.max(1,this.height)),this.imageData=this.context.getImageData(M,O,U,W),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(M,O,U,W,X,V){void 0===U&&(U=0),void 0===W&&(W=0),void 0===X&&(X=this.width),void 0===V&&(V=this.height);for(var H=U+X,Y=W+V,z=C.Color.createColor(),K={r:0,g:0,b:0,a:0},J=!1,Q=W;Q<Y;Q++)for(var Z=U;Z<H;Z++)C.Color.unpackPixel(this.getPixel32(Z,Q),z),K=M.call(O,z,Z,Q),!1!==K&&null!==K&&void 0!==K&&(this.setPixel32(Z,Q,K.r,K.g,K.b,K.a,!1),J=!0);return J&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(M,O,U,W,X,V){void 0===U&&(U=0),void 0===W&&(W=0),void 0===X&&(X=this.width),void 0===V&&(V=this.height);for(var H=U+X,Y=W+V,z=0,K=0,J=!1,Q=W;Q<Y;Q++)for(var Z=U;Z<H;Z++)z=this.getPixel32(Z,Q),K=M.call(O,z,Z,Q),K!=z&&(this.pixels[Q*this.width+Z]=K,J=!0);return J&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(M,O,U,W,X,V,H,Y,z){var K=0,J=0,Q=this.width,Z=this.height,$=C.Color.packPixel(M,O,U,W);void 0!==z&&z instanceof C.Rectangle&&(K=z.x,J=z.y,Q=z.width,Z=z.height);for(var ee=0;ee<Z;ee++)for(var te=0;te<Q;te++)this.getPixel32(K+te,J+ee)===$&&this.setPixel32(K+te,J+ee,X,V,H,Y,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(M,O,U,W){var X=M||0===M,V=O||0===O,H=U||0===U;if(X||V||H){void 0===W&&(W=new C.Rectangle(0,0,this.width,this.height));for(var Y=C.Color.createColor(),z=W.y;z<W.bottom;z++)for(var K=W.x;K<W.right;K++)C.Color.unpackPixel(this.getPixel32(K,z),Y,!0),X&&(Y.h=M),V&&(Y.s=O),H&&(Y.l=U),C.Color.HSLtoRGB(Y.h,Y.s,Y.l,Y),this.setPixel32(K,z,Y.r,Y.g,Y.b,Y.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(M,O,U,W){if((void 0===M||null===M)&&(M=!1),(void 0===O||null===O)&&(O=!1),(void 0===U||null===U)&&(U=!1),M||O||U){void 0===W&&(W=new C.Rectangle(0,0,this.width,this.height));for(var X=C.Color.createColor(),V=W.y;V<W.bottom;V++)for(var H=W.x;H<W.right;H++)C.Color.unpackPixel(this.getPixel32(H,V),X,!0),M&&(X.h=this.game.math.wrap(X.h+M,0,1)),O&&(X.s=this.game.math.clamp(X.s+O,0,1)),U&&(X.l=this.game.math.clamp(X.l+U,0,1)),C.Color.HSLtoRGB(X.h,X.s,X.l,X),this.setPixel32(H,V,X.r,X.g,X.b,X.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(M,O,U,W,X,V,H){return void 0===H&&(H=!0),0<=M&&M<=this.width&&0<=O&&O<=this.height&&(this.pixels[O*this.width+M]=C.Device.LITTLE_ENDIAN?V<<24|X<<16|W<<8|U:U<<24|W<<16|X<<8|V,H&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(M,O,U,W,X,V){return this.setPixel32(M,O,U,W,X,255,V)},getPixel:function(M,O,U){U||(U=C.Color.createColor());var W=~~(M+O*this.width);return W*=4,U.r=this.data[W],U.g=this.data[++W],U.b=this.data[++W],U.a=this.data[++W],U},getPixel32:function(M,O){if(0<=M&&M<=this.width&&0<=O&&O<=this.height)return this.pixels[O*this.width+M]},getPixelRGB:function(M,O,U,W,X){return C.Color.unpackPixel(this.getPixel32(M,O),U,W,X)},getPixels:function(M){return this.context.getImageData(M.x,M.y,M.width,M.height)},getFirstPixel:function(M){void 0===M&&(M=0);var O=C.Color.createColor(),U=0,W=0,X=1,V=!1;1===M?(X=-1,W=this.height):3==M&&(X=-1,U=this.width);do C.Color.unpackPixel(this.getPixel32(U,W),O),0===M||1===M?(U++,U===this.width&&(U=0,W+=X,(W>=this.height||0>=W)&&(V=!0))):(2==M||3==M)&&(W++,W===this.height&&(W=0,U+=X,(U>=this.width||0>=U)&&(V=!0)));while(0===O.a&&!V);return O.x=U,O.y=W,O},getBounds:function(M){return(void 0===M&&(M=new C.Rectangle),M.x=this.getFirstPixel(2).x,M.x===this.width)?M.setTo(0,0,0,0):(M.y=this.getFirstPixel(0).y,M.width=this.getFirstPixel(3).x-M.x+1,M.height=this.getFirstPixel(1).y-M.y+1,M)},addToWorld:function(M,O,U,W,X,V){X=X||1,V=V||1;var H=this.game.add.image(M,O,this);return H.anchor.set(U,W),H.scale.set(X,V),H},copy:function(M,O,U,W,X,V,H,Y,z,K,J,Q,Z,$,ee,te,ae){if((void 0===M||null===M)&&(M=this),M instanceof C.RenderTexture&&(M=M.getCanvas()),this._image=M,M instanceof C.Sprite||M instanceof C.Image||M instanceof C.Text||M instanceof PIXI.Sprite)this._pos.set(M.texture.crop.x,M.texture.crop.y),this._size.set(M.texture.crop.width,M.texture.crop.height),this._scale.set(M.scale.x,M.scale.y),this._anchor.set(M.anchor.x,M.anchor.y),this._rotate=M.rotation,this._alpha.current=M.alpha,this._image=M.texture instanceof C.RenderTexture?M.texture.getCanvas():M.texture.baseTexture.source,(void 0===V||null===V)&&(V=M.x),(void 0===H||null===H)&&(H=M.y),M.texture.trim&&(V+=M.texture.trim.x-M.anchor.x*M.texture.trim.width,H+=M.texture.trim.y-M.anchor.y*M.texture.trim.height),16777215!==M.tint&&(M.cachedTint!==M.tint&&(M.cachedTint=M.tint,M.tintedTexture=PIXI.CanvasTinter.getTintedTexture(M,M.tint)),this._image=M.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,M instanceof C.BitmapData)this._image=M.canvas;else if("string"==typeof M){if(M=this.game.cache.getImage(M),null===M)return;this._image=M}this._size.set(this._image.width,this._image.height)}if((void 0===O||null===O)&&(O=0),(void 0===U||null===U)&&(U=0),W&&(this._size.x=W),X&&(this._size.y=X),(void 0===V||null===V)&&(V=O),(void 0===H||null===H)&&(H=U),(void 0===Y||null===Y)&&(Y=this._size.x),(void 0===z||null===z)&&(z=this._size.y),"number"==typeof K&&(this._rotate=K),"number"==typeof J&&(this._anchor.x=J),"number"==typeof Q&&(this._anchor.y=Q),"number"==typeof Z&&(this._scale.x=Z),"number"==typeof $&&(this._scale.y=$),"number"==typeof ee&&(this._alpha.current=ee),void 0===te&&(te=null),void 0===ae&&(ae=!1),!(0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){var oe=this.context;return this._alpha.prev=oe.globalAlpha,oe.save(),oe.globalAlpha=this._alpha.current,te&&(this.op=te),ae&&(V|=0,H|=0),oe.translate(V,H),oe.scale(this._scale.x,this._scale.y),oe.rotate(this._rotate),oe.drawImage(this._image,this._pos.x+O,this._pos.y+U,this._size.x,this._size.y,-Y*this._anchor.x,-z*this._anchor.y,Y,z),oe.restore(),oe.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(M,O,U){if(void 0===O&&(O=null),void 0===U&&(U=!1),!M.hasOwnProperty("worldTransform")||!M.worldVisible||0===M.worldAlpha)return this;var W=M.worldTransform;if(this._pos.set(M.texture.crop.x,M.texture.crop.y),this._size.set(M.texture.crop.width,M.texture.crop.height),0===W.a||0===W.d||0===this._size.x||0===this._size.y)return this;this._image=M.texture instanceof C.RenderTexture?M.texture.getCanvas():M.texture.baseTexture.source;var X=W.tx,V=W.ty;M.texture.trim&&(X+=M.texture.trim.x-M.anchor.x*M.texture.trim.width,V+=M.texture.trim.y-M.anchor.y*M.texture.trim.height),16777215!==M.tint&&(M.cachedTint!==M.tint&&(M.cachedTint=M.tint,M.tintedTexture=PIXI.CanvasTinter.getTintedTexture(M,M.tint)),this._image=M.tintedTexture,this._pos.set(0)),U&&(X|=0,V|=0);var H=this.context;return this._alpha.prev=H.globalAlpha,H.save(),H.globalAlpha=this._alpha.current,O&&(this.op=O),H[this.smoothProperty]=M.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,H.setTransform(W.a,W.b,W.c,W.d,X,V),H.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*M.anchor.x,-this._size.y*M.anchor.y,this._size.x,this._size.y),H.restore(),H.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(M,O,U,W,X,V,H){return this.copy(M,O.x,O.y,O.width,O.height,U,W,O.width,O.height,0,0,0,1,1,X,V,H)},draw:function(M,O,U,W,X,V,H){return this.copy(M,null,null,null,null,O,U,W,X,null,null,null,null,null,null,V,H)},drawGroup:function(M,O,U){return 0<M.total&&M.forEachExists(this.drawGroupProxy,this,O,U),this},drawGroupProxy:function(M,O,U){if(M.hasOwnProperty("texture")&&this.copyTransform(M,O,U),M.type===C.GROUP&&M.exists)this.drawGroup(M,O,U);else if(M.hasOwnProperty("children")&&0<M.children.length)for(var W=0;W<M.children.length;W++)M.children[W].exists&&this.copyTransform(M.children[W],O,U)},drawFull:function(M,O,U){if(!1===M.worldVisible||0===M.worldAlpha||M.hasOwnProperty("exists")&&!1===M.exists)return this;if(M.type!==C.GROUP&&M.type!==C.EMITTER&&M.type!==C.BITMAPTEXT)if(M.type===C.GRAPHICS){var W=M.getBounds();this.ctx.save(),this.ctx.translate(W.x,W.y),PIXI.CanvasGraphics.renderGraphics(M,this.ctx),this.ctx.restore()}else this.copy(M,null,null,null,null,M.worldPosition.x,M.worldPosition.y,null,null,M.worldRotation,null,null,M.worldScale.x,M.worldScale.y,M.worldAlpha,O,U);if(M.children)for(var X=0;X<M.children.length;X++)this.drawFull(M.children[X],O,U);return this},shadow:function(M,O,U,W){var X=this.context;return void 0===M||null===M?X.shadowColor="rgba(0,0,0,0)":(X.shadowColor=M,X.shadowBlur=O||5,X.shadowOffsetX=U||10,X.shadowOffsetY=W||10),this},alphaMask:function(M,O,U,W){return void 0===W||null===W?this.draw(O).blendSourceAtop():this.draw(O,W.x,W.y,W.width,W.height).blendSourceAtop(),void 0===U||null===U?this.draw(M).blendReset():this.draw(M,U.x,U.y,U.width,U.height).blendReset(),this},extract:function(M,O,U,W,X,V,H,Y,z){return void 0===X&&(X=255),void 0===V&&(V=!1),void 0===H&&(H=O),void 0===Y&&(Y=U),void 0===z&&(z=W),V&&M.resize(this.width,this.height),this.processPixelRGB(function(K,J,Q){return K.r===O&&K.g===U&&K.b===W&&M.setPixel32(J,Q,H,Y,z,X,!1),!1},this),M.context.putImageData(M.imageData,0,0),M.dirty=!0,M},rect:function(M,O,U,W,X){return"undefined"!=typeof X&&(this.context.fillStyle=X),this.context.fillRect(M,O,U,W),this},text:function(M,O,U,W,X,V){void 0===O&&(O=0),void 0===U&&(U=0),void 0===W&&(W="14px Courier"),void 0===X&&(X="rgb(255,255,255)"),void 0===V&&(V=!0);var H=this.context,Y=H.font;return H.font=W,V&&(H.fillStyle="rgb(0,0,0)",H.fillText(M,O+1,U+1)),H.fillStyle=X,H.fillText(M,O,U),H.font=Y,this},circle:function(M,O,U,W){var X=this.context;return void 0!==W&&(X.fillStyle=W),X.beginPath(),X.arc(M,O,U,0,2*Math.PI,!1),X.closePath(),X.fill(),this},line:function(M,O,U,W,X,V){void 0===X&&(X="#fff"),void 0===V&&(V=1);var H=this.context;return H.beginPath(),H.moveTo(M,O),H.lineTo(U,W),H.lineWidth=V,H.strokeStyle=X,H.stroke(),H.closePath(),this},textureLine:function(M,O,U){if(void 0===U&&(U="repeat-x"),!("string"==typeof O&&(O=this.game.cache.getImage(O),!O))){var W=M.length;"no-repeat"===U&&W>O.width&&(W=O.width);var X=this.context;return X.fillStyle=X.createPattern(O,U),this._circle=new C.Circle(M.start.x,M.start.y,O.height),this._circle.circumferencePoint(M.angle-1.5707963267948966,!1,this._pos),X.save(),X.translate(this._pos.x,this._pos.y),X.rotate(M.angle),X.fillRect(0,0,W,O.height),X.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),C.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this},copyBitmapData:function(M,O,U){M.update();for(var W=0,X;W<M.height;W++){X=(U+W)*this.width+O;for(var V=0;V<M.width;V++)this.pixels[X+V]=M.pixels[W*M.width+V]}return this}},Object.defineProperty(C.BitmapData.prototype,"smoothed",{get:function(){C.Canvas.getSmoothingEnabled(this.context)},set:function(M){C.Canvas.setSmoothingEnabled(this.context,M)}}),Object.defineProperty(C.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(M){this.context.globalCompositeOperation=M}}),C.BitmapData.getTransform=function(M,O,U,W,X,V){return"number"!=typeof M&&(M=0),"number"!=typeof O&&(O=0),"number"!=typeof U&&(U=1),"number"!=typeof W&&(W=1),"number"!=typeof X&&(X=0),"number"!=typeof V&&(V=0),{sx:U,sy:W,scaleX:U,scaleY:W,skewX:X,skewY:V,translateX:M,translateY:O,tx:M,ty:O}},C.BitmapData.prototype.constructor=C.BitmapData,C.EarCut={},C.EarCut.Triangulate=function(M,O,U){U=U||2;var W=O&&O.length,X=W?O[0]*U:M.length,V=C.EarCut.linkedList(M,0,X,U,!0),H=[];if(!V)return H;var Y,z,K,J,Q,Z,$;if(W&&(V=C.EarCut.eliminateHoles(M,O,V,U)),M.length>80*U){Y=K=M[0],z=J=M[1];for(var ee=U;ee<X;ee+=U)Q=M[ee],Z=M[ee+1],Q<Y&&(Y=Q),Z<z&&(z=Z),Q>K&&(K=Q),Z>J&&(J=Z);$=Math.max(K-Y,J-z)}return C.EarCut.earcutLinked(V,H,U,Y,z,$),H},C.EarCut.linkedList=function(M,O,U,W,X){var V=0,H,Y,z;for(H=O,Y=U-W;H<U;H+=W)V+=(M[Y]-M[H])*(M[H+1]+M[Y+1]),Y=H;if(X===0<V)for(H=O;H<U;H+=W)z=C.EarCut.insertNode(H,M[H],M[H+1],z);else for(H=U-W;H>=O;H-=W)z=C.EarCut.insertNode(H,M[H],M[H+1],z);return z},C.EarCut.filterPoints=function(M,O){if(!M)return M;O||(O=M);var U=M,W;do if(W=!1,!U.steiner&&(C.EarCut.equals(U,U.next)||0===C.EarCut.area(U.prev,U,U.next))){if(C.EarCut.removeNode(U),U=O=U.prev,U===U.next)return null;W=!0}else U=U.next;while(W||U!==O);return O},C.EarCut.earcutLinked=function(M,O,U,W,X,V,H){if(M){!H&&V&&C.EarCut.indexCurve(M,W,X,V);for(var Y=M,z,K;M.prev!==M.next;){if(z=M.prev,K=M.next,V?C.EarCut.isEarHashed(M,W,X,V):C.EarCut.isEar(M)){O.push(z.i/U),O.push(M.i/U),O.push(K.i/U),C.EarCut.removeNode(M),M=K.next,Y=K.next;continue}if(M=K,M===Y){H?1===H?(M=C.EarCut.cureLocalIntersections(M,O,U),C.EarCut.earcutLinked(M,O,U,W,X,V,2)):2==H&&C.EarCut.splitEarcut(M,O,U,W,X,V):C.EarCut.earcutLinked(C.EarCut.filterPoints(M),O,U,W,X,V,1);break}}}},C.EarCut.isEar=function(M){var O=M.prev,U=M,W=M.next;if(0<=C.EarCut.area(O,U,W))return!1;for(var X=M.next.next;X!==M.prev;){if(C.EarCut.pointInTriangle(O.x,O.y,U.x,U.y,W.x,W.y,X.x,X.y)&&0<=C.EarCut.area(X.prev,X,X.next))return!1;X=X.next}return!0},C.EarCut.isEarHashed=function(M,O,U,W){var X=M.prev,V=M,H=M.next;if(0<=C.EarCut.area(X,V,H))return!1;for(var Y=X.x<V.x?X.x<H.x?X.x:H.x:V.x<H.x?V.x:H.x,z=X.y<V.y?X.y<H.y?X.y:H.y:V.y<H.y?V.y:H.y,K=X.x>V.x?X.x>H.x?X.x:H.x:V.x>H.x?V.x:H.x,J=X.y>V.y?X.y>H.y?X.y:H.y:V.y>H.y?V.y:H.y,Q=C.EarCut.zOrder(Y,z,O,U,W),Z=C.EarCut.zOrder(K,J,O,U,W),$=M.nextZ;$&&$.z<=Z;){if($!==M.prev&&$!==M.next&&C.EarCut.pointInTriangle(X.x,X.y,V.x,V.y,H.x,H.y,$.x,$.y)&&0<=C.EarCut.area($.prev,$,$.next))return!1;$=$.nextZ}for($=M.prevZ;$&&$.z>=Q;){if($!==M.prev&&$!==M.next&&C.EarCut.pointInTriangle(X.x,X.y,V.x,V.y,H.x,H.y,$.x,$.y)&&0<=C.EarCut.area($.prev,$,$.next))return!1;$=$.prevZ}return!0},C.EarCut.cureLocalIntersections=function(M,O,U){var W=M;do{var X=W.prev,V=W.next.next;C.EarCut.intersects(X,W,W.next,V)&&C.EarCut.locallyInside(X,V)&&C.EarCut.locallyInside(V,X)&&(O.push(X.i/U),O.push(W.i/U),O.push(V.i/U),C.EarCut.removeNode(W),C.EarCut.removeNode(W.next),W=M=V),W=W.next}while(W!==M);return W},C.EarCut.splitEarcut=function(M,O,U,W,X,V){var H=M;do{for(var Y=H.next.next;Y!==H.prev;){if(H.i!==Y.i&&C.EarCut.isValidDiagonal(H,Y)){var z=C.EarCut.splitPolygon(H,Y);return H=C.EarCut.filterPoints(H,H.next),z=C.EarCut.filterPoints(z,z.next),C.EarCut.earcutLinked(H,O,U,W,X,V),void C.EarCut.earcutLinked(z,O,U,W,X,V)}Y=Y.next}H=H.next}while(H!==M)},C.EarCut.eliminateHoles=function(M,O,U,W){var X=[],V,H,Y,z,K;for(V=0,H=O.length;V<H;V++)Y=O[V]*W,z=V<H-1?O[V+1]*W:M.length,K=C.EarCut.linkedList(M,Y,z,W,!1),K===K.next&&(K.steiner=!0),X.push(C.EarCut.getLeftmost(K));for(X.sort(compareX),V=0;V<X.length;V++)C.EarCut.eliminateHole(X[V],U),U=C.EarCut.filterPoints(U,U.next);return U},C.EarCut.compareX=function(M,O){return M.x-O.x},C.EarCut.eliminateHole=function(M,O){if(O=C.EarCut.findHoleBridge(M,O),O){var U=C.EarCut.splitPolygon(O,M);C.EarCut.filterPoints(U,U.next)}},C.EarCut.findHoleBridge=function(M,O){var U=O,W=M.x,X=M.y,V=-Infinity,H;do{if(X<=U.y&&X>=U.next.y){var Y=U.x+(X-U.y)*(U.next.x-U.x)/(U.next.y-U.y);Y<=W&&Y>V&&(V=Y,H=U.x<U.next.x?U:U.next)}U=U.next}while(U!==O);if(!H)return null;if(M.x===H.x)return H.prev;var z=H,K=Infinity,J;for(U=H.next;U!==z;)W>=U.x&&U.x>=H.x&&C.EarCut.pointInTriangle(X<H.y?W:V,X,H.x,H.y,X<H.y?V:W,X,U.x,U.y)&&(J=Math.abs(X-U.y)/(W-U.x),(J<K||J===K&&U.x>H.x)&&C.EarCut.locallyInside(U,M)&&(H=U,K=J)),U=U.next;return H},C.EarCut.indexCurve=function(M,O,U,W){var X=M;do null===X.z&&(X.z=C.EarCut.zOrder(X.x,X.y,O,U,W)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==M);X.prevZ.nextZ=null,X.prevZ=null,C.EarCut.sortLinked(X)},C.EarCut.sortLinked=function(M){var K=1,O,U,W,X,V,H,Y,z;do{for(U=M,M=null,V=null,H=0;U;){for(H++,W=U,Y=0,O=0;O<K&&(Y++,W=W.nextZ,!!W);O++);for(z=K;0<Y||0<z&&W;)0===Y?(X=W,W=W.nextZ,z--):0!==z&&W?U.z<=W.z?(X=U,U=U.nextZ,Y--):(X=W,W=W.nextZ,z--):(X=U,U=U.nextZ,Y--),V?V.nextZ=X:M=X,X.prevZ=V,V=X;U=W}V.nextZ=null,K*=2}while(1<H);return M},C.EarCut.zOrder=function(M,O,U,W,X){return M=32767*(M-U)/X,O=32767*(O-W)/X,M=16711935&(M|M<<8),M=252645135&(M|M<<4),M=858993459&(M|M<<2),M=1431655765&(M|M<<1),O=16711935&(O|O<<8),O=252645135&(O|O<<4),O=858993459&(O|O<<2),O=1431655765&(O|O<<1),M|O<<1},C.EarCut.getLeftmost=function(M){var O=M,U=M;do O.x<U.x&&(U=O),O=O.next;while(O!==M);return U},C.EarCut.pointInTriangle=function(M,O,U,W,X,V,H,Y){return 0<=(X-H)*(O-Y)-(M-H)*(V-Y)&&0<=(M-H)*(W-Y)-(U-H)*(O-Y)&&0<=(U-H)*(V-Y)-(X-H)*(W-Y)},C.EarCut.isValidDiagonal=function(M,O){return C.EarCut.equals(M,O)||M.next.i!==O.i&&M.prev.i!==O.i&&!C.EarCut.intersectsPolygon(M,O)&&C.EarCut.locallyInside(M,O)&&C.EarCut.locallyInside(O,M)&&C.EarCut.middleInside(M,O)},C.EarCut.area=function(M,O,U){return(O.y-M.y)*(U.x-O.x)-(O.x-M.x)*(U.y-O.y)},C.EarCut.equals=function(M,O){return M.x===O.x&&M.y===O.y},C.EarCut.intersects=function(M,O,U,W){return 0<C.EarCut.area(M,O,U)!=0<C.EarCut.area(M,O,W)&&0<C.EarCut.area(U,W,M)!=0<C.EarCut.area(U,W,O)},C.EarCut.intersectsPolygon=function(M,O){var U=M;do{if(U.i!==M.i&&U.next.i!==M.i&&U.i!==O.i&&U.next.i!==O.i&&C.EarCut.intersects(U,U.next,M,O))return!0;U=U.next}while(U!==M);return!1},C.EarCut.locallyInside=function(M,O){return 0>C.EarCut.area(M.prev,M,M.next)?0<=C.EarCut.area(M,O,M.next)&&0<=C.EarCut.area(M,M.prev,O):0>C.EarCut.area(M,O,M.prev)||0>C.EarCut.area(M,M.next,O)},C.EarCut.middleInside=function(M,O){var U=M,W=!1,X=(M.x+O.x)/2,V=(M.y+O.y)/2;do U.y>V!=U.next.y>V&&X<(U.next.x-U.x)*(V-U.y)/(U.next.y-U.y)+U.x&&(W=!W),U=U.next;while(U!==M);return W},C.EarCut.splitPolygon=function(M,O){var U=new C.EarCut.Node(M.i,M.x,M.y),W=new C.EarCut.Node(O.i,O.x,O.y),X=M.next,V=O.prev;return M.next=O,O.prev=M,U.next=X,X.prev=U,W.next=U,U.prev=W,V.next=W,W.prev=V,W},C.EarCut.insertNode=function(M,O,U,W){var X=new C.EarCut.Node(M,O,U);return W?(X.next=W.next,X.prev=W,W.next.prev=X,W.next=X):(X.prev=X,X.next=X),X},C.EarCut.removeNode=function(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)},C.EarCut.Node=function(M,O,U){this.i=M,this.x=O,this.y=U,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(M,O){var U=O.gl,W=O.projection,X=O.offset,V=O.shaderManager.primitiveShader,H;M.dirty&&PIXI.WebGLGraphics.updateGraphics(M,U);var Y=M._webGL[U.id];if(Y)for(var z=0;z<Y.data.length;z++)1===Y.data[z].mode?(H=Y.data[z],O.stencilManager.pushStencil(M,H,O),U.drawElements(U.TRIANGLE_FAN,4,U.UNSIGNED_SHORT,2*(H.indices.length-4)),O.stencilManager.popStencil(M,H,O)):(H=Y.data[z],O.shaderManager.setShader(V),V=O.shaderManager.primitiveShader,U.uniformMatrix3fv(V.translationMatrix,!1,M.worldTransform.toArray(!0)),U.uniform1f(V.flipY,1),U.uniform2f(V.projectionVector,W.x,-W.y),U.uniform2f(V.offsetVector,-X.x,-X.y),U.uniform3fv(V.tintColor,C.Color.hexToRGBArray(M.tint)),U.uniform1f(V.alpha,M.worldAlpha),U.bindBuffer(U.ARRAY_BUFFER,H.buffer),U.vertexAttribPointer(V.aVertexPosition,2,U.FLOAT,!1,24,0),U.vertexAttribPointer(V.colorAttribute,4,U.FLOAT,!1,24,8),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,H.indexBuffer),U.drawElements(U.TRIANGLE_STRIP,H.indices.length,U.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(M,O){var U=M._webGL[O.id];U||(U=M._webGL[O.id]={lastIndex:0,data:[],gl:O}),M.dirty=!1;var W;if(M.clearDirty){for(M.clearDirty=!1,W=0;W<U.data.length;W++){var X=U.data[W];X.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(X)}U.data=[],U.lastIndex=0}var V;for(W=U.lastIndex;W<M.graphicsData.length;W++){var H=M.graphicsData[W];if(H.type===C.POLYGON){if(H.points=H.shape.points.slice(),H.shape.closed&&(H.points[0]!==H.points[H.points.length-2]||H.points[1]!==H.points[H.points.length-1])&&H.points.push(H.points[0],H.points[1]),H.fill&&H.points.length>=PIXI.WebGLGraphics.stencilBufferLimit)if(H.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit){V=PIXI.WebGLGraphics.switchMode(U,0);var Y=PIXI.WebGLGraphics.buildPoly(H,V);Y||(V=PIXI.WebGLGraphics.switchMode(U,1),PIXI.WebGLGraphics.buildComplexPoly(H,V))}else V=PIXI.WebGLGraphics.switchMode(U,1),PIXI.WebGLGraphics.buildComplexPoly(H,V);0<H.lineWidth&&(V=PIXI.WebGLGraphics.switchMode(U,0),PIXI.WebGLGraphics.buildLine(H,V))}else V=PIXI.WebGLGraphics.switchMode(U,0),H.type===C.RECTANGLE?PIXI.WebGLGraphics.buildRectangle(H,V):H.type===C.CIRCLE||H.type===C.ELLIPSE?PIXI.WebGLGraphics.buildCircle(H,V):H.type===C.ROUNDEDRECTANGLE&&PIXI.WebGLGraphics.buildRoundedRectangle(H,V);U.lastIndex++}for(W=0;W<U.data.length;W++)V=U.data[W],V.dirty&&V.upload()},PIXI.WebGLGraphics.switchMode=function(M,O){var U;return M.data.length?(U=M.data[M.data.length-1],(U.mode!==O||1===O)&&(U=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(M.gl),U.mode=O,M.data.push(U))):(U=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(M.gl),U.mode=O,M.data.push(U)),U.dirty=!0,U},PIXI.WebGLGraphics.buildRectangle=function(M,O){var U=M.shape,W=U.x,X=U.y,V=U.width,H=U.height;if(M.fill){var Y=C.Color.hexToRGBArray(M.fillColor),z=M.fillAlpha,K=Y[0]*z,J=Y[1]*z,Q=Y[2]*z,Z=O.points,$=O.indices,ee=Z.length/6;Z.push(W,X),Z.push(K,J,Q,z),Z.push(W+V,X),Z.push(K,J,Q,z),Z.push(W,X+H),Z.push(K,J,Q,z),Z.push(W+V,X+H),Z.push(K,J,Q,z),$.push(ee,ee,ee+1,ee+2,ee+3,ee+3)}if(M.lineWidth){var te=M.points;M.points=[W,X,W+V,X,W+V,X+H,W,X+H,W,X],PIXI.WebGLGraphics.buildLine(M,O),M.points=te}},PIXI.WebGLGraphics.buildRoundedRectangle=function(M,O){var U=M.shape,W=U.x,X=U.y,V=U.width,H=U.height,Y=U.radius,z=[];if(z.push(W,X+Y),z=z.concat(PIXI.WebGLGraphics.quadraticBezierCurve(W,X+H-Y,W,X+H,W+Y,X+H)),z=z.concat(PIXI.WebGLGraphics.quadraticBezierCurve(W+V-Y,X+H,W+V,X+H,W+V,X+H-Y)),z=z.concat(PIXI.WebGLGraphics.quadraticBezierCurve(W+V,X+Y,W+V,X,W+V-Y,X)),z=z.concat(PIXI.WebGLGraphics.quadraticBezierCurve(W+Y,X,W,X,W,X+Y)),M.fill){var K=C.Color.hexToRGBArray(M.fillColor),J=M.fillAlpha,Q=K[0]*J,Z=K[1]*J,$=K[2]*J,ee=O.points,te=O.indices,ae=ee.length/6,oe=C.EarCut.Triangulate(z,null,2),ne=0;for(ne=0;ne<oe.length;ne+=3)te.push(oe[ne]+ae),te.push(oe[ne]+ae),te.push(oe[ne+1]+ae),te.push(oe[ne+2]+ae),te.push(oe[ne+2]+ae);for(ne=0;ne<z.length;ne++)ee.push(z[ne],z[++ne],Q,Z,$,J)}if(M.lineWidth){var ie=M.points;M.points=z,PIXI.WebGLGraphics.buildLine(M,O),M.points=ie}},PIXI.WebGLGraphics.quadraticBezierCurve=function(M,O,U,W,X,V){function H(oe,ne,ie){return oe+(ne-oe)*ie}for(var $=20,ee=[],te=0,ae=0,Y,z,K,J,Q,Z;ae<=$;ae++)te=ae/$,Y=H(M,U,te),z=H(O,W,te),K=H(U,X,te),J=H(W,V,te),Q=H(Y,K,te),Z=H(z,J,te),ee.push(Q,Z);return ee},PIXI.WebGLGraphics.buildCircle=function(M,O){var U=M.shape,W=U.x,X=U.y,V,H;M.type===C.CIRCLE?(V=U.radius,H=U.radius):(V=U.width,H=U.height);var Y=40,z=2*Math.PI/Y,K=0;if(M.fill){var J=C.Color.hexToRGBArray(M.fillColor),Q=M.fillAlpha,Z=J[0]*Q,$=J[1]*Q,ee=J[2]*Q,te=O.points,ae=O.indices,oe=te.length/6;for(ae.push(oe),K=0;K<Y+1;K++)te.push(W,X,Z,$,ee,Q),te.push(W+Math.sin(z*K)*V,X+Math.cos(z*K)*H,Z,$,ee,Q),ae.push(oe++,oe++);ae.push(oe-1)}if(M.lineWidth){var ne=M.points;for(M.points=[],K=0;K<Y+1;K++)M.points.push(W+Math.sin(z*K)*V,X+Math.cos(z*K)*H);PIXI.WebGLGraphics.buildLine(M,O),M.points=ne}},PIXI.WebGLGraphics.buildLine=function(M,O){var U=0,W=M.points;if(0!==W.length){if(M.lineWidth%2)for(U=0;U<W.length;U++)W[U]+=0.5;var X=new PIXI.Point(W[0],W[1]),V=new PIXI.Point(W[W.length-2],W[W.length-1]);if(X.x===V.x&&X.y===V.y){W=W.slice(),W.pop(),W.pop(),V=new PIXI.Point(W[W.length-2],W[W.length-1]);var H=V.x+0.5*(X.x-V.x),Y=V.y+0.5*(X.y-V.y);W.unshift(H,Y),W.push(H,Y)}var z=O.points,K=O.indices,J=W.length/2,Q=W.length,Z=z.length/6,$=M.lineWidth/2,ee=C.Color.hexToRGBArray(M.lineColor),te=M.lineAlpha,ae=ee[0]*te,oe=ee[1]*te,ne=ee[2]*te,ie,se,le,de,pe,ue,he,ge,me,be,_e,ve,Te,Ce,Pe,Se,we,Ae,Ee,Re,Le,Be,ke;for(le=W[0],de=W[1],pe=W[2],ue=W[3],me=-(de-ue),be=le-pe,ke=Math.sqrt(me*me+be*be),me/=ke,be/=ke,me*=$,be*=$,z.push(le-me,de-be,ae,oe,ne,te),z.push(le+me,de+be,ae,oe,ne,te),U=1;U<J-1;U++){if(le=W[2*(U-1)],de=W[2*(U-1)+1],pe=W[2*U],ue=W[2*U+1],he=W[2*(U+1)],ge=W[2*(U+1)+1],me=-(de-ue),be=le-pe,ke=Math.sqrt(me*me+be*be),me/=ke,be/=ke,me*=$,be*=$,_e=-(ue-ge),ve=pe-he,ke=Math.sqrt(_e*_e+ve*ve),_e/=ke,ve/=ke,_e*=$,ve*=$,Pe=-be+de-(-be+ue),Se=-me+pe-(-me+le),we=(-me+le)*(-be+ue)-(-me+pe)*(-be+de),Ae=-ve+ge-(-ve+ue),Ee=-_e+pe-(-_e+he),Re=(-_e+he)*(-ve+ue)-(-_e+pe)*(-ve+ge),Le=Pe*Ee-Ae*Se,0.1>Math.abs(Le)){Le+=10.1,z.push(pe-me,ue-be,ae,oe,ne,te),z.push(pe+me,ue+be,ae,oe,ne,te);continue}ie=(Se*Re-Ee*we)/Le,se=(Ae*we-Pe*Re)/Le,Be=(ie-pe)*(ie-pe)+(se-ue)+(se-ue),19600<Be?(Te=me-_e,Ce=be-ve,ke=Math.sqrt(Te*Te+Ce*Ce),Te/=ke,Ce/=ke,Te*=$,Ce*=$,z.push(pe-Te,ue-Ce),z.push(ae,oe,ne,te),z.push(pe+Te,ue+Ce),z.push(ae,oe,ne,te),z.push(pe-Te,ue-Ce),z.push(ae,oe,ne,te),Q++):(z.push(ie,se),z.push(ae,oe,ne,te),z.push(pe-(ie-pe),ue-(se-ue)),z.push(ae,oe,ne,te))}for(le=W[2*(J-2)],de=W[2*(J-2)+1],pe=W[2*(J-1)],ue=W[2*(J-1)+1],me=-(de-ue),be=le-pe,ke=Math.sqrt(me*me+be*be),me/=ke,be/=ke,me*=$,be*=$,z.push(pe-me,ue-be),z.push(ae,oe,ne,te),z.push(pe+me,ue+be),z.push(ae,oe,ne,te),K.push(Z),U=0;U<Q;U++)K.push(Z++);K.push(Z-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(M,O){var U=M.points.slice();if(!(6>U.length)){var W=O.indices;O.points=U,O.alpha=M.fillAlpha,O.color=C.Color.hexToRGBArray(M.fillColor);for(var X=Infinity,V=-Infinity,H=Infinity,Y=-Infinity,J=0,z,K;J<U.length;J+=2)z=U[J],K=U[J+1],X=z<X?z:X,V=z>V?z:V,H=K<H?K:H,Y=K>Y?K:Y;U.push(X,H,V,H,V,Y,X,Y);var Q=U.length/2;for(J=0;J<Q;J++)W.push(J)}},PIXI.WebGLGraphics.buildPoly=function(M,O){var U=M.points;if(!(6>U.length)){var W=O.points,X=O.indices,V=U.length/2,H=C.Color.hexToRGBArray(M.fillColor),Y=M.fillAlpha,z=H[0]*Y,K=H[1]*Y,J=H[2]*Y,Q=C.EarCut.Triangulate(U,null,2);if(!Q)return!1;var Z=W.length/6,$=0;for($=0;$<Q.length;$+=3)X.push(Q[$]+Z),X.push(Q[$]+Z),X.push(Q[$+1]+Z),X.push(Q[$+2]+Z),X.push(Q[$+2]+Z);for($=0;$<V;$++)W.push(U[2*$],U[2*$+1],z,K,J,Y);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(M){this.gl=M,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=M.createBuffer(),this.indexBuffer=M.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var M=this.gl;this.glPoints=new Float32Array(this.points),M.bindBuffer(M.ARRAY_BUFFER,this.buffer),M.bufferData(M.ARRAY_BUFFER,this.glPoints,M.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,this.indexBuffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,this.glIndicies,M.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(M,O){var U=M.worldAlpha;M.dirty&&(this.updateGraphicsTint(M),M.dirty=!1);for(var W=0;W<M.graphicsData.length;W++){var X=M.graphicsData[W],V=X.shape,H=X._fillTint,Y=X._lineTint;if(O.lineWidth=X.lineWidth,X.type===C.POLYGON){O.beginPath();var z=V.points;O.moveTo(z[0],z[1]);for(var K=1;K<z.length/2;K++)O.lineTo(z[2*K],z[2*K+1]);V.closed&&O.lineTo(z[0],z[1]),z[0]===z[z.length-2]&&z[1]===z[z.length-1]&&O.closePath(),X.fill&&(O.globalAlpha=X.fillAlpha*U,O.fillStyle="#"+("00000"+(0|H).toString(16)).substr(-6),O.fill()),X.lineWidth&&(O.globalAlpha=X.lineAlpha*U,O.strokeStyle="#"+("00000"+(0|Y).toString(16)).substr(-6),O.stroke())}else if(X.type===C.RECTANGLE)(X.fillColor||0===X.fillColor)&&(O.globalAlpha=X.fillAlpha*U,O.fillStyle="#"+("00000"+(0|H).toString(16)).substr(-6),O.fillRect(V.x,V.y,V.width,V.height)),X.lineWidth&&(O.globalAlpha=X.lineAlpha*U,O.strokeStyle="#"+("00000"+(0|Y).toString(16)).substr(-6),O.strokeRect(V.x,V.y,V.width,V.height));else if(X.type===C.CIRCLE)O.beginPath(),O.arc(V.x,V.y,V.radius,0,2*Math.PI),O.closePath(),X.fill&&(O.globalAlpha=X.fillAlpha*U,O.fillStyle="#"+("00000"+(0|H).toString(16)).substr(-6),O.fill()),X.lineWidth&&(O.globalAlpha=X.lineAlpha*U,O.strokeStyle="#"+("00000"+(0|Y).toString(16)).substr(-6),O.stroke());else if(X.type===C.ELLIPSE){var J=2*V.width,Q=2*V.height,Z=V.x-J/2,$=V.y-Q/2;O.beginPath();var ee=0.5522848,te=J/2*ee,ae=Q/2*ee,oe=Z+J,ne=$+Q,ie=Z+J/2,se=$+Q/2;O.moveTo(Z,se),O.bezierCurveTo(Z,se-ae,ie-te,$,ie,$),O.bezierCurveTo(ie+te,$,oe,se-ae,oe,se),O.bezierCurveTo(oe,se+ae,ie+te,ne,ie,ne),O.bezierCurveTo(ie-te,ne,Z,se+ae,Z,se),O.closePath(),X.fill&&(O.globalAlpha=X.fillAlpha*U,O.fillStyle="#"+("00000"+(0|H).toString(16)).substr(-6),O.fill()),X.lineWidth&&(O.globalAlpha=X.lineAlpha*U,O.strokeStyle="#"+("00000"+(0|Y).toString(16)).substr(-6),O.stroke())}else if(X.type===C.ROUNDEDRECTANGLE){var le=V.x,de=V.y,pe=V.width,ue=V.height,he=V.radius,ge=0|Math.min(pe,ue)/2;he=he>ge?ge:he,O.beginPath(),O.moveTo(le,de+he),O.lineTo(le,de+ue-he),O.quadraticCurveTo(le,de+ue,le+he,de+ue),O.lineTo(le+pe-he,de+ue),O.quadraticCurveTo(le+pe,de+ue,le+pe,de+ue-he),O.lineTo(le+pe,de+he),O.quadraticCurveTo(le+pe,de,le+pe-he,de),O.lineTo(le+he,de),O.quadraticCurveTo(le,de,le,de+he),O.closePath(),(X.fillColor||0===X.fillColor)&&(O.globalAlpha=X.fillAlpha*U,O.fillStyle="#"+("00000"+(0|H).toString(16)).substr(-6),O.fill()),X.lineWidth&&(O.globalAlpha=X.lineAlpha*U,O.strokeStyle="#"+("00000"+(0|Y).toString(16)).substr(-6),O.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(M,O){var U=M.graphicsData.length;if(0!==U){O.beginPath();for(var W=0;W<U;W++){var X=M.graphicsData[W],V=X.shape;if(X.type===C.POLYGON){var H=V.points;O.moveTo(H[0],H[1]);for(var Y=1;Y<H.length/2;Y++)O.lineTo(H[2*Y],H[2*Y+1]);H[0]===H[H.length-2]&&H[1]===H[H.length-1]&&O.closePath()}else if(X.type===C.RECTANGLE)O.rect(V.x,V.y,V.width,V.height),O.closePath();else if(X.type===C.CIRCLE)O.arc(V.x,V.y,V.radius,0,2*Math.PI),O.closePath();else if(X.type===C.ELLIPSE){var z=2*V.width,K=2*V.height,J=V.x-z/2,Q=V.y-K/2,Z=0.5522848,$=z/2*Z,ee=K/2*Z,te=J+z,ae=Q+K,oe=J+z/2,ne=Q+K/2;O.moveTo(J,ne),O.bezierCurveTo(J,ne-ee,oe-$,Q,oe,Q),O.bezierCurveTo(oe+$,Q,te,ne-ee,te,ne),O.bezierCurveTo(te,ne+ee,oe+$,ae,oe,ae),O.bezierCurveTo(oe-$,ae,J,ne+ee,J,ne),O.closePath()}else if(X.type===C.ROUNDEDRECTANGLE){var ie=V.x,se=V.y,le=V.width,de=V.height,pe=V.radius,ue=0|Math.min(le,de)/2;pe=pe>ue?ue:pe,O.moveTo(ie,se+pe),O.lineTo(ie,se+de-pe),O.quadraticCurveTo(ie,se+de,ie+pe,se+de),O.lineTo(ie+le-pe,se+de),O.quadraticCurveTo(ie+le,se+de,ie+le,se+de-pe),O.lineTo(ie+le,se+pe),O.quadraticCurveTo(ie+le,se,ie+le-pe,se),O.lineTo(ie+pe,se),O.quadraticCurveTo(ie,se,ie,se+pe),O.closePath()}}}},PIXI.CanvasGraphics.updateGraphicsTint=function(M){if(16777215!==M.tint)for(var O=(255&M.tint>>16)/255,U=(255&M.tint>>8)/255,W=(255&M.tint)/255,X=0;X<M.graphicsData.length;X++){var V=M.graphicsData[X],H=0|V.fillColor,Y=0|V.lineColor;V._fillTint=(255*((255&H>>16)/255*O)<<16)+(255*((255&H>>8)/255*U)<<8)+255*((255&H)/255*W),V._lineTint=(255*((255&Y>>16)/255*O)<<16)+(255*((255&Y>>8)/255*U)<<8)+255*((255&Y)/255*W)}},C.GraphicsData=function(M,O,U,W,X,V,H){this.lineWidth=M,this.lineColor=O,this.lineAlpha=U,this._lineTint=O,this.fillColor=W,this.fillAlpha=X,this._fillTint=W,this.fill=V,this.shape=H,this.type=H.type},C.GraphicsData.prototype.constructor=C.GraphicsData,C.GraphicsData.prototype.clone=function(){return new C.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},C.Graphics=function(M,O,U){void 0===O&&(O=0),void 0===U&&(U=0),this.type=C.GRAPHICS,this.physicsType=C.SPRITE,this.anchor=new C.Point,PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new C.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1,C.Component.Core.init.call(this,M,O,U,"",null)},C.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),C.Graphics.prototype.constructor=C.Graphics,C.Component.Core.install.call(C.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),C.Graphics.prototype.preUpdatePhysics=C.Component.PhysicsBody.preUpdate,C.Graphics.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.Graphics.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.Graphics.prototype.preUpdateCore=C.Component.Core.preUpdate,C.Graphics.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.Graphics.prototype.postUpdate=function(){C.Component.PhysicsBody.postUpdate.call(this),C.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var M=0;M<this.children.length;M++)this.children[M].postUpdate()},C.Graphics.prototype.destroy=function(M){this.clear(),C.Component.Destroy.prototype.destroy.call(this,M)},C.Graphics.prototype.drawTriangle=function(M,O){void 0===O&&(O=!1);var U=new C.Polygon(M);if(O){var W=new C.Point(this.game.camera.x-M[0].x,this.game.camera.y-M[0].y),X=new C.Point(M[1].x-M[0].x,M[1].y-M[0].y),V=new C.Point(M[1].x-M[2].x,M[1].y-M[2].y),H=V.cross(X);0<W.dot(H)&&this.drawPolygon(U)}else this.drawPolygon(U)},C.Graphics.prototype.drawTriangles=function(M,O,U){void 0===U&&(U=!1);var W=new C.Point,X=new C.Point,V=new C.Point,H=[],Y;if(!O){if(M[0]instanceof C.Point)for(Y=0;Y<M.length/3;Y++)this.drawTriangle([M[3*Y],M[3*Y+1],M[3*Y+2]],U);else for(Y=0;Y<M.length/6;Y++)W.x=M[6*Y+0],W.y=M[6*Y+1],X.x=M[6*Y+2],X.y=M[6*Y+3],V.x=M[6*Y+4],V.y=M[6*Y+5],this.drawTriangle([W,X,V],U);}else if(M[0]instanceof C.Point)for(Y=0;Y<O.length/3;Y++)H.push(M[O[3*Y]]),H.push(M[O[3*Y+1]]),H.push(M[O[3*Y+2]]),3===H.length&&(this.drawTriangle(H,U),H=[]);else for(Y=0;Y<O.length;Y++)W.x=M[2*O[Y]],W.y=M[2*O[Y]+1],H.push(W.copyTo({})),3===H.length&&(this.drawTriangle(H,U),H=[])},C.Graphics.prototype.lineStyle=function(M,O,U){return this.lineWidth=M||0,this.lineColor=O||0,this.lineAlpha=void 0===U?1:U,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new C.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},C.Graphics.prototype.moveTo=function(M,O){return this.drawShape(new C.Polygon([M,O])),this},C.Graphics.prototype.lineTo=function(M,O){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(M,O),this.dirty=!0,this._boundsDirty=!0,this},C.Graphics.prototype.quadraticCurveTo=function(M,O,U,W){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var H=20,Y=this.currentPath.shape.points,X,V;0===Y.length&&this.moveTo(0,0);for(var z=Y[Y.length-2],K=Y[Y.length-1],J=0,Q=1;Q<=H;++Q)J=Q/H,X=z+(M-z)*J,V=K+(O-K)*J,Y.push(X+(M+(U-M)*J-X)*J,V+(O+(W-O)*J-V)*J);return this.dirty=!0,this._boundsDirty=!0,this},C.Graphics.prototype.bezierCurveTo=function(M,O,U,W,X,V){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var H=20,Z=this.currentPath.shape.points,$=Z[Z.length-2],ee=Z[Z.length-1],te=0,ae=1,Y,z,K,J,Q;ae<=H;++ae)te=ae/H,Y=1-te,z=Y*Y,K=z*Y,J=te*te,Q=J*te,Z.push(K*$+3*z*te*M+3*Y*J*U+Q*X,K*ee+3*z*te*O+3*Y*J*W+Q*V);return this.dirty=!0,this._boundsDirty=!0,this},C.Graphics.prototype.arcTo=function(M,O,U,W,X){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(M,O):this.moveTo(M,O);var V=this.currentPath.shape.points,H=V[V.length-2],Y=V[V.length-1],z=Y-O,K=H-M,J=W-O,Q=U-M,Z=Math.abs(z*Q-K*J);if(1e-8>Z||0===X)(V[V.length-2]!==M||V[V.length-1]!==O)&&V.push(M,O);else{var $=z*z+K*K,ee=J*J+Q*Q,te=z*J+K*Q,ae=X*Math.sqrt($)/Z,oe=X*Math.sqrt(ee)/Z,ne=ae*te/$,ie=oe*te/ee,se=ae*Q+oe*K,le=ae*J+oe*z,ge=Math.atan2(z*(oe+ne)-le,K*(oe+ne)-se),me=Math.atan2(J*(ae+ie)-le,Q*(ae+ie)-se);this.arc(se+M,le+O,X,ge,me,K*J>Q*z)}return this.dirty=!0,this._boundsDirty=!0,this},C.Graphics.prototype.arc=function(M,O,U,W,X,V,H){if(W===X)return this;void 0===V&&(V=!1),void 0===H&&(H=40),!V&&X<=W?X+=2*Math.PI:V&&W<=X&&(W+=2*Math.PI);var Y=V?-1*(W-X):X-W,z=Math.ceil(Math.abs(Y)/(2*Math.PI))*H;if(0==Y)return this;var K=M+Math.cos(W)*U,J=O+Math.sin(W)*U;V&&this.filling?this.moveTo(M,O):this.moveTo(K,J);for(var Q=this.currentPath.shape.points,Z=Y/(2*z),ee=Math.cos(Z),te=Math.sin(Z),ae=z-1,ne=0;ne<=ae;ne++){var ie=ne+ae%1/ae*ne,se=Z+W+2*Z*ie,le=Math.cos(se),de=-Math.sin(se);Q.push((ee*le+te*de)*U+M,(ee*-de+te*le)*U+O)}return this.dirty=!0,this._boundsDirty=!0,this},C.Graphics.prototype.beginFill=function(M,O){return this.filling=!0,this.fillColor=M||0,this.fillAlpha=void 0===O?1:O,this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},C.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},C.Graphics.prototype.drawRect=function(M,O,U,W){return this.drawShape(new C.Rectangle(M,O,U,W)),this},C.Graphics.prototype.drawRoundedRect=function(M,O,U,W,X){return this.drawShape(new C.RoundedRectangle(M,O,U,W,X)),this},C.Graphics.prototype.drawCircle=function(M,O,U){return this.drawShape(new C.Circle(M,O,U)),this},C.Graphics.prototype.drawEllipse=function(M,O,U,W){return this.drawShape(new C.Ellipse(M,O,U,W)),this},C.Graphics.prototype.drawPolygon=function(M){M instanceof C.Polygon&&(M=M.points);var O=M;if(!Array.isArray(O)){O=Array(arguments.length);for(var U=0;U<O.length;++U)O[U]=arguments[U]}return this.drawShape(new C.Polygon(O)),this},C.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},C.Graphics.prototype.generateTexture=function(M,O,U){void 0===M&&(M=1),void 0===O&&(O=PIXI.scaleModes.DEFAULT),void 0===U&&(U=0);var W=this.getBounds();W.width+=U,W.height+=U;var X=new PIXI.CanvasBuffer(W.width*M,W.height*M),V=PIXI.Texture.fromCanvas(X.canvas,O);return V.baseTexture.resolution=M,X.context.scale(M,M),X.context.translate(-W.x,-W.y),PIXI.CanvasGraphics.renderGraphics(this,X.context),V},C.Graphics.prototype._renderWebGL=function(M){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,M);if(M.spriteBatch.stop(),M.blendModeManager.setBlendMode(this.blendMode),this._mask&&M.maskManager.pushMask(this._mask,M),this._filters&&M.filterManager.pushFilter(this._filterBlock),this.blendMode!==M.spriteBatch.currentBlendMode){M.spriteBatch.currentBlendMode=this.blendMode;var O=PIXI.blendModesWebGL[M.spriteBatch.currentBlendMode];M.spriteBatch.gl.blendFunc(O[0],O[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,M),this.children.length){M.spriteBatch.start();for(var U=0;U<this.children.length;U++)this.children[U]._renderWebGL(M);M.spriteBatch.stop()}this._filters&&M.filterManager.popFilter(),this._mask&&M.maskManager.popMask(this.mask,M),M.drawCount++,M.spriteBatch.start()}},C.Graphics.prototype._renderCanvas=function(M){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,M);var O=M.context,U=this.worldTransform;this.blendMode!==M.currentBlendMode&&(M.currentBlendMode=this.blendMode,O.globalCompositeOperation=PIXI.blendModesCanvas[M.currentBlendMode]),this._mask&&M.maskManager.pushMask(this._mask,M);var W=M.resolution,X=U.tx*M.resolution+M.shakeX,V=U.ty*M.resolution+M.shakeY;O.setTransform(U.a*W,U.b*W,U.c*W,U.d*W,X,V),PIXI.CanvasGraphics.renderGraphics(this,O);for(var H=0;H<this.children.length;H++)this.children[H]._renderCanvas(M);this._mask&&M.maskManager.popMask(M)}},C.Graphics.prototype.getBounds=function(M){if(this._currentBounds)return this._currentBounds;if(!this.renderable)return C.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var O=this._localBounds,U=O.x,W=O.width+O.x,X=O.y,V=O.height+O.y,H=M||this.worldTransform,Y=H.a,z=H.b,K=H.c,J=H.d,Q=H.tx,Z=H.ty,$=Y*W+K*V+Q,ee=J*V+z*W+Z,te=Y*U+K*V+Q,ae=J*V+z*U+Z,oe=Y*U+K*X+Q,ne=J*X+z*U+Z,ie=Y*W+K*X+Q,se=J*X+z*W+Z,le=$,de=ee,pe=$,ue=ee;return pe=te<pe?te:pe,pe=oe<pe?oe:pe,pe=ie<pe?ie:pe,ue=ae<ue?ae:ue,ue=ne<ue?ne:ue,ue=se<ue?se:ue,le=te>le?te:le,le=oe>le?oe:le,le=ie>le?ie:le,de=ae>de?ae:de,de=ne>de?ne:de,de=se>de?se:de,this._bounds.x=pe,this._bounds.width=le-pe,this._bounds.y=ue,this._bounds.height=de-ue,this._currentBounds=this._bounds,this._currentBounds},C.Graphics.prototype.getLocalBounds=function(){var M=this.worldTransform;this.worldTransform=C.identityMatrix;for(var O=0;O<this.children.length;O++)this.children[O].updateTransform();var U=this.getBounds();for(this.worldTransform=M,O=0;O<this.children.length;O++)this.children[O].updateTransform();return U},C.Graphics.prototype.containsPoint=function(M,O){void 0===O&&(O=new C.Point),this.worldTransform.applyInverse(M,O);for(var U=this.graphicsData,W=0,X;W<U.length;W++)if((X=U[W],!!X.fill)&&X.shape&&X.shape.contains(O.x,O.y))return!0;return!1},C.Graphics.prototype.updateLocalBounds=function(){var M=Infinity,O=-Infinity,U=Infinity,W=-Infinity;if(this.graphicsData.length)for(var J=0,X,V,H,Y,z,K;J<this.graphicsData.length;J++){var Q=this.graphicsData[J],Z=Q.type,$=Q.lineWidth;if(X=Q.shape,Z===C.RECTANGLE||Z===C.ROUNDEDRECTANGLE)H=X.x-$/2,Y=X.y-$/2,z=X.width+$,K=X.height+$,M=H<M?H:M,O=H+z>O?H+z:O,U=Y<U?Y:U,W=Y+K>W?Y+K:W;else if(Z===C.CIRCLE)H=X.x,Y=X.y,z=X.radius+$/2,K=X.radius+$/2,M=H-z<M?H-z:M,O=H+z>O?H+z:O,U=Y-K<U?Y-K:U,W=Y+K>W?Y+K:W;else if(Z===C.ELLIPSE)H=X.x,Y=X.y,z=X.width+$/2,K=X.height+$/2,M=H-z<M?H-z:M,O=H+z>O?H+z:O,U=Y-K<U?Y-K:U,W=Y+K>W?Y+K:W;else{V=X.points;for(var ee=0;ee<V.length;ee++)V[ee]instanceof C.Point?(H=V[ee].x,Y=V[ee].y):(H=V[ee],Y=V[ee+1],ee<V.length-1&&ee++),M=H-$<M?H-$:M,O=H+$>O?H+$:O,U=Y-$<U?Y-$:U,W=Y+$>W?Y+$:W}}else M=0,O=0,U=0,W=0;var te=this.boundsPadding;this._localBounds.x=M-te,this._localBounds.width=O-M+2*te,this._localBounds.y=U-te,this._localBounds.height=W-U+2*te},C.Graphics.prototype._generateCachedSprite=function(){var M=this.getLocalBounds();if(!this._cachedSprite){var O=new PIXI.CanvasBuffer(M.width,M.height),U=PIXI.Texture.fromCanvas(O.canvas);this._cachedSprite=new PIXI.Sprite(U),this._cachedSprite.buffer=O,this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.buffer.resize(M.width,M.height);this._cachedSprite.anchor.x=-(M.x/M.width),this._cachedSprite.anchor.y=-(M.y/M.height),this._cachedSprite.buffer.context.translate(-M.x,-M.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},C.Graphics.prototype.updateCachedSpriteTexture=function(){var M=this._cachedSprite,O=M.texture,U=M.buffer.canvas;O.baseTexture.width=U.width,O.baseTexture.height=U.height,O.crop.width=O.frame.width=U.width,O.crop.height=O.frame.height=U.height,M._width=U.width,M._height=U.height,O.baseTexture.dirty()},C.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},C.Graphics.prototype.drawShape=function(M){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop(),this.currentPath=null,M instanceof C.Polygon&&(M=M.clone(),M.flatten());var O=new C.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,M);return this.graphicsData.push(O),O.type===C.POLYGON&&(O.shape.closed=this.filling,this.currentPath=O),this.dirty=!0,this._boundsDirty=!0,O},Object.defineProperty(C.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(M){this._cacheAsBitmap=M,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),C.RenderTexture=function(M,O,U,W,X,V,H,Y){if(void 0===O&&(O=100),void 0===U&&(U=100),void 0===W&&(W=""),void 0===X&&(X=C.scaleModes.DEFAULT),void 0===V&&(V=1),void 0===H&&(H=PIXI.defaultRenderer),void 0===Y&&(Y=0),this.game=M,this.key=W,this.type=C.RENDERTEXTURE,this._tempMatrix=new C.Matrix,this.width=O,this.height=U,this.resolution=V,this.frame=new C.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=this.frame.clone(),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=X,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,this.frame.clone()),this.renderer=H,this.renderer.type===C.WEBGL){var z=this.renderer.gl;this.baseTexture.textureIndex=Y,this.baseTexture._dirty[z.id]=!1,this.textureBuffer=new PIXI.FilterTexture(z,this.width,this.height,this.baseTexture.scaleMode,Y),this.baseTexture._glTextures[z.id]=this.textureBuffer.texture,this.projection=new C.Point(0.5*this.width,0.5*-this.height)}else this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new C.Matrix,this._updateUvs()},C.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),C.RenderTexture.prototype.constructor=C.RenderTexture,C.RenderTexture.prototype.renderXY=function(M,O,U,W){M.updateTransform(),this._tempMatrix.copyFrom(M.worldTransform),this._tempMatrix.tx=O,this._tempMatrix.ty=U,this.renderer.type===C.WEBGL?this._renderWebGL(M,this._tempMatrix,W):this._renderCanvas(M,this._tempMatrix,W)},C.RenderTexture.prototype.renderRawXY=function(M,O,U,W){this._tempMatrix.identity().translate(O,U),this.renderer.type===C.WEBGL?this._renderWebGL(M,this._tempMatrix,W):this._renderCanvas(M,this._tempMatrix,W)},C.RenderTexture.prototype.render=function(M,O,U){void 0===O||null===O?this._tempMatrix.copyFrom(M.worldTransform):this._tempMatrix.copyFrom(O),this.renderer.type===C.WEBGL?this._renderWebGL(M,this._tempMatrix,U):this._renderCanvas(M,this._tempMatrix,U)},C.RenderTexture.prototype.resize=function(M,O,U){(M!==this.width||O!==this.height)&&(this.valid=0<M&&0<O,this.width=M,this.height=O,this.frame.width=this.crop.width=M*this.resolution,this.frame.height=this.crop.height=O*this.resolution,U&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===C.WEBGL&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},C.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===C.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},C.RenderTexture.prototype._renderWebGL=function(M,O,U){if(this.valid&&0!==M.alpha){var W=M.worldTransform;W.identity(),W.translate(0,2*this.projection.y),O&&W.append(O),W.scale(1,-1);for(var X=0;X<M.children.length;X++)M.children[X].updateTransform();var V=this.renderer.gl;V.viewport(0,0,this.width*this.resolution,this.height*this.resolution),V.bindFramebuffer(V.FRAMEBUFFER,this.textureBuffer.frameBuffer),U&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(M,this.projection,this.textureBuffer.frameBuffer,O),this.renderer.spriteBatch.dirty=!0,V.bindFramebuffer(V.FRAMEBUFFER,null)}},C.RenderTexture.prototype._renderCanvas=function(M,O,U){if(this.valid&&0!==M.alpha){var W=M.worldTransform;W.identity(),O&&W.append(O);for(var X=0;X<M.children.length;X++)M.children[X].updateTransform();U&&this.textureBuffer.clear();var V=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(M,this.textureBuffer.context,O),this.renderer.resolution=V}},C.RenderTexture.prototype.getImage=function(){var M=new Image;return M.src=this.getBase64(),M},C.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},C.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===C.WEBGL){var M=this.renderer.gl,O=this.textureBuffer.width,U=this.textureBuffer.height,W=new Uint8Array(4*O*U);M.bindFramebuffer(M.FRAMEBUFFER,this.textureBuffer.frameBuffer),M.readPixels(0,0,O,U,M.RGBA,M.UNSIGNED_BYTE,W),M.bindFramebuffer(M.FRAMEBUFFER,null);var X=new PIXI.CanvasBuffer(O,U),V=X.context.getImageData(0,0,O,U);return V.data.set(W),X.context.putImageData(V,0,0),X.canvas}return this.textureBuffer.canvas},C.Text=function(M,O,U,W,X){O=O||0,U=U||0,W=void 0===W||null===W?"":W.toString(),X=C.Utils.extend({},X),this.type=C.TEXT,this.physicsType=C.SPRITE,this.padding=new C.Point,this.textBounds=null,this.canvas=C.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this.splitRegExp=/(?:\r\n|\r|\n)/,this.characterLimitSize=-1,this.characterLimitSuffix="",this._res=M.renderer.resolution,this._text=W,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,C.Sprite.call(this,M,O,U,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(X),""!==W&&this.updateText()},C.Text.prototype=Object.create(C.Sprite.prototype),C.Text.prototype.constructor=C.Text,C.Text.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.Text.prototype.update=function(){},C.Text.prototype.destroy=function(M){this.texture.destroy(!0),C.Component.Destroy.prototype.destroy.call(this,M)},C.Text.prototype.setShadow=function(M,O,U,W,X,V){return void 0===M&&(M=0),void 0===O&&(O=0),void 0===U&&(U="rgba(0, 0, 0, 1)"),void 0===W&&(W=0),void 0===X&&(X=!0),void 0===V&&(V=!0),this.style.shadowOffsetX=M,this.style.shadowOffsetY=O,this.style.shadowColor=U,this.style.shadowBlur=W,this.style.shadowStroke=X,this.style.shadowFill=V,this.dirty=!0,this},C.Text.prototype.setStyle=function(M,O){void 0===O&&(O=!1);var U=Object.assign({},M);U.font=M.font||"bold 20pt Arial",U.backgroundColor=M.backgroundColor||null,U.fill=M.fill||"black",U.align=(M.align||"left").toLowerCase(),U.boundsAlignH=(M.boundsAlignH||"left").toLowerCase(),U.boundsAlignV=(M.boundsAlignV||"top").toLowerCase(),U.stroke=M.stroke||"black",U.strokeThickness=+M.strokeThickness||0,U.wordWrap=M.wordWrap||!1,U.wordWrapWidth=M.wordWrapWidth||100,U.maxLines=M.maxLines||0,U.shadowOffsetX=M.shadowOffsetX||0,U.shadowOffsetY=M.shadowOffsetY||0,U.shadowColor=M.shadowColor||"rgba(0,0,0,0)",U.shadowBlur=M.shadowBlur||0,U.tabs=M.tabs||0;var W=this.fontToComponents(U.font);return U.fontStyle&&(W.fontStyle=U.fontStyle),U.fontVariant&&(W.fontVariant=U.fontVariant),U.fontWeight&&(W.fontWeight=U.fontWeight),U.fontSize&&("number"==typeof U.fontSize&&(U.fontSize+="px"),W.fontSize=U.fontSize),this._fontComponents=W,U.font=this.componentsToFont(this._fontComponents),this.style=U,this.dirty=!0,O&&this.updateText(),this},C.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var M=this.text;-1<this.characterLimitSize&&this.characterLimitSize<M.length&&(M=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(M=this.runWordWrap(this.text));var O=M.split(this.splitRegExp),U=this.style.tabs,W=[],X=0,V=this.determineFontProperties(this.style.font),H=O.length;0<this.style.maxLines&&this.style.maxLines<O.length&&(H=this.style.maxLines),this._charCount=0;for(var Y=0;Y<H;Y++){if(0===U){var z=this.style.strokeThickness+this.padding.x;z+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(O[Y]):this.context.measureText(O[Y]).width,this.style.wordWrap&&(z-=this.context.measureText(" ").width)}else{var K=O[Y].split(/(?:\t)/),z=this.padding.x+this.style.strokeThickness;if(Array.isArray(U))for(var J=0,Q=0,Z;Q<K.length;Q++)Z=0,Z=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(K[Q]):Math.ceil(this.context.measureText(K[Q]).width),0<Q&&(J+=U[Q-1]),z=J+Z;else for(var Q=0;Q<K.length;Q++){z+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(K[Q]):Math.ceil(this.context.measureText(K[Q]).width);var $=this.game.math.snapToCeil(z,U)-z;z+=$}}W[Y]=Math.ceil(z),X=Math.max(X,W[Y])}this.canvas.width=X*this._res;var ee=V.fontSize+this.style.strokeThickness+this.padding.y,te=ee*H,ae=this._lineSpacing;0>ae&&Math.abs(ae)>ee&&(ae=-ee),0!==ae&&(te+=0<ae?ae*O.length:ae*(O.length-1)),this.canvas.height=te*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var oe,ne;for(this._charCount=0,Y=0;Y<H;Y++)oe=this.style.strokeThickness/2,ne=this.style.strokeThickness/2+Y*ee+V.ascent,0<Y&&(ne+=ae*Y),"right"===this.style.align?oe+=X-W[Y]:"center"===this.style.align&&(oe+=(X-W[Y])/2),this.autoRound&&(oe=Math.round(oe),ne=Math.round(ne)),0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(O[Y],oe,ne):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===U?this.context.strokeText(O[Y],oe,ne):this.renderTabLine(O[Y],oe,ne,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===U?this.context.fillText(O[Y],oe,ne):this.renderTabLine(O[Y],oe,ne,!0)));this.updateTexture(),this.dirty=!1},C.Text.prototype.renderTabLine=function(M,O,U,W){var X=M.split(/(?:\t)/),V=this.style.tabs,H=0;if(Array.isArray(V))for(var Y=0,z=0;z<X.length;z++)0<z&&(Y+=V[z-1]),H=O+Y,W?this.context.fillText(X[z],H,U):this.context.strokeText(X[z],H,U);else for(var z=0,K;z<X.length;z++)K=Math.ceil(this.context.measureText(X[z]).width),H=this.game.math.snapToCeil(O,V),W?this.context.fillText(X[z],H,U):this.context.strokeText(X[z],H,U),O=H+K},C.Text.prototype.updateShadow=function(M){M?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},C.Text.prototype.measureLine=function(M){for(var O=0,U=0,W;U<M.length;U++){if(W=M[U],0<this.fontWeights.length||0<this.fontStyles.length){var X=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(X.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(X.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(X)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),O+=this.context.measureText(W).width,this._charCount++}return Math.ceil(O)},C.Text.prototype.updateLine=function(M,O,U){for(var W=0,X;W<M.length;W++){if(X=M[W],0<this.fontWeights.length||0<this.fontStyles.length){var V=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(V.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(V.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(V)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(X,O,U)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(X,O,U)),O+=this.context.measureText(X).width,this._charCount++}},C.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},C.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},C.Text.prototype.addColor=function(M,O){return this.colors[O]=M,this.dirty=!0,this},C.Text.prototype.addStrokeColor=function(M,O){return this.strokeColors[O]=M,this.dirty=!0,this},C.Text.prototype.addFontStyle=function(M,O){return this.fontStyles[O]=M,this.dirty=!0,this},C.Text.prototype.addFontWeight=function(M,O){return this.fontWeights[O]=M,this.dirty=!0,this},C.Text.prototype.precalculateWordWrap=function(M){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var O=this.runWordWrap(M);return O.split(/(?:\r\n|\r|\n)/)},C.Text.prototype.runWordWrap=function(M){return this.useAdvancedWrap?this.advancedWordWrap(M):this.basicWordWrap(M)},C.Text.prototype.advancedWordWrap=function(M){for(var O=this.context,U=this.style.wordWrapWidth,W="",X=M.replace(/ +/gi," ").split(/\r?\n/gi),V=X.length,H=0;H<V;H++){var Y=X[H],z="";Y=Y.replace(/^ *|\s*$/gi,"");var K=O.measureText(Y).width;if(K<U){W+=Y+"\n";continue}for(var J=U,Q=Y.split(" "),Z=0;Z<Q.length;Z++){var $=Q[Z],ee=$+" ",te=O.measureText(ee).width;if(te>J){if(0===Z){for(var ae=ee;ae.length&&(ae=ae.slice(0,-1),te=O.measureText(ae).width,!(te<=J)););if(!ae.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var oe=$.substr(ae.length);Q[Z]=oe,z+=ae}var ne=Q[Z].length?Z:Z+1,ie=Q.slice(ne).join(" ").replace(/[ \n]*$/gi,"");X[H+1]=ie+" "+(X[H+1]||""),V=X.length;break}else z+=ee,J-=te}W+=z.replace(/[ \n]*$/gi,"")+"\n"}return W=W.replace(/[\s|\n]*$/gi,""),W},C.Text.prototype.basicWordWrap=function(M){for(var O="",U=M.split("\n"),W=0;W<U.length;W++){for(var X=this.style.wordWrapWidth,V=U[W].split(" "),H=0;H<V.length;H++){var Y=this.context.measureText(V[H]).width,z=Y+this.context.measureText(" ").width;z>X?(0<H&&(O+="\n"),O+=V[H]+" ",X=this.style.wordWrapWidth-Y):(X-=z,O+=V[H]+" ")}W<U.length-1&&(O+="\n")}return O},C.Text.prototype.updateFont=function(M){var O=this.componentsToFont(M);this.style.font!==O&&(this.style.font=O,this.dirty=!0,this.parent&&this.updateTransform())},C.Text.prototype.fontToComponents=function(M){var O=M.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(O){var U=O[5].trim();return /^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(U)||/['",]/.exec(U)||(U="'"+U+"'"),{font:M,fontStyle:O[1]||"normal",fontVariant:O[2]||"normal",fontWeight:O[3]||"normal",fontSize:O[4]||"medium",fontFamily:U}}return console.warn("Phaser.Text - unparsable CSS font: "+M),{font:M}},C.Text.prototype.componentsToFont=function(M){var O=[],U;return U=M.fontStyle,U&&"normal"!==U&&O.push(U),U=M.fontVariant,U&&"normal"!==U&&O.push(U),U=M.fontWeight,U&&"normal"!==U&&O.push(U),U=M.fontSize,U&&"medium"!==U&&O.push(U),U=M.fontFamily,U&&O.push(U),O.length||O.push(M.font),O.join(" ")},C.Text.prototype.setText=function(M,O){return void 0===O&&(O=!1),this.text=M.toString()||"",O?this.updateText():this.dirty=!0,this},C.Text.prototype.parseList=function(M){if(!Array.isArray(M))return this;for(var O="",U=0;U<M.length;U++)Array.isArray(M[U])?(O+=M[U].join("\t"),U<M.length-1&&(O+="\n")):(O+=M[U],U<M.length-1&&(O+="\t"));return this.text=O,this.dirty=!0,this},C.Text.prototype.setTextBounds=function(M,O,U,W){return void 0===M?this.textBounds=null:(this.textBounds?this.textBounds.setTo(M,O,U,W):this.textBounds=new C.Rectangle(M,O,U,W),this.style.wordWrapWidth>U&&(this.style.wordWrapWidth=U)),this.updateTexture(),this},C.Text.prototype.updateTexture=function(){var M=this.texture.baseTexture,O=this.texture.crop,U=this.texture.frame,W=this.canvas.width,X=this.canvas.height;if(M.width=W,M.height=X,O.width=W,O.height=X,U.width=W,U.height=X,this.texture.width=W,this.texture.height=X,this._width=W,this._height=X,this.textBounds){var V=this.textBounds.x,H=this.textBounds.y;"right"===this.style.boundsAlignH?V+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(V+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?H+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(H+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-V,this.pivot.y=-H}this.renderable=0!==W&&0!==X,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},C.Text.prototype._renderWebGL=function(M){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,M)},C.Text.prototype._renderCanvas=function(M){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,M)},C.Text.prototype.determineFontProperties=function(M){var O=C.Text.fontPropertiesCache[M];if(!O){O={};var U=C.Text.fontPropertiesCanvas,W=C.Text.fontPropertiesContext;W.font=M;var X=Math.ceil(W.measureText("|M\xC9q").width),V=Math.ceil(W.measureText("|M\xC9q").width),H=2*V;if(V=0|1.4*V,U.width=X,U.height=H,W.fillStyle="#f00",W.fillRect(0,0,X,H),W.font=M,W.textBaseline="alphabetic",W.fillStyle="#000",W.fillText("|M\xC9q",0,V),!W.getImageData(0,0,X,H))return O.ascent=V,O.descent=V+6,O.fontSize=O.ascent+O.descent,C.Text.fontPropertiesCache[M]=O,O;var Y=W.getImageData(0,0,X,H).data,z=Y.length,K=4*X,Z=0,$=!1,J,Q;for(J=0;J<V;J++){for(Q=0;Q<K;Q+=4)if(255!==Y[Z+Q]){$=!0;break}if(!$)Z+=K;else break}for(O.ascent=V-J,Z=z-K,$=!1,J=H;J>V;J--){for(Q=0;Q<K;Q+=4)if(255!==Y[Z+Q]){$=!0;break}if(!$)Z-=K;else break}O.descent=J-V,O.descent+=6,O.fontSize=O.ascent+O.descent,C.Text.fontPropertiesCache[M]=O}return O},C.Text.prototype.getBounds=function(M){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,M)},C.Text.prototype.setCharacterLimit=function(M,O){this.characterLimitSuffix=void 0===O?"":O,this.characterLimitSize=M,this.updateText()},Object.defineProperty(C.Text.prototype,"text",{get:function(){return this._text},set:function(M){M!==this._text&&(this._text=M.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(C.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(M){M=M||"bold 20pt Arial",this._fontComponents=this.fontToComponents(M),this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(M){M=M||"Arial",M=M.trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(M)||/['",]/.exec(M)||(M="'"+M+"'"),this._fontComponents.fontFamily=M,this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"fontSize",{get:function(){var M=this._fontComponents.fontSize;return M&&/(?:^0$|px$)/.exec(M)?parseInt(M,10):M},set:function(M){M=M||"0","number"==typeof M&&(M+="px"),this._fontComponents.fontSize=M,this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(M){M=M||"normal",this._fontComponents.fontWeight=M,this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(M){M=M||"normal",this._fontComponents.fontStyle=M,this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(M){M=M||"normal",this._fontComponents.fontVariant=M,this.updateFont(this._fontComponents)}}),Object.defineProperty(C.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(M){M!==this.style.fill&&(this.style.fill=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"align",{get:function(){return this.style.align},set:function(M){M=M.toLowerCase(),M!==this.style.align&&(this.style.align=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"resolution",{get:function(){return this._res},set:function(M){M!==this._res&&(this._res=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(M){M!==this.style.tabs&&(this.style.tabs=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(M){M=M.toLowerCase(),M!==this.style.boundsAlignH&&(this.style.boundsAlignH=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(M){M=M.toLowerCase(),M!==this.style.boundsAlignV&&(this.style.boundsAlignV=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(M){M!==this.style.stroke&&(this.style.stroke=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(M){M!==this.style.strokeThickness&&(this.style.strokeThickness=+M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(M){M!==this.style.wordWrap&&(this.style.wordWrap=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(M){M!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(M){M!==this._lineSpacing&&(this._lineSpacing=parseFloat(M),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(C.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(M){M!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(M){M!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(M){M!==this.style.shadowColor&&(this.style.shadowColor=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(M){M!==this.style.shadowBlur&&(this.style.shadowBlur=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(M){M!==this.style.shadowStroke&&(this.style.shadowStroke=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(M){M!==this.style.shadowFill&&(this.style.shadowFill=M,this.dirty=!0)}}),Object.defineProperty(C.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*(this.texture.frame.width/this.resolution)},set:function(M){this.scale.x=M/this.texture.frame.width,this._width=M}}),Object.defineProperty(C.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*(this.texture.frame.height/this.resolution)},set:function(M){this.scale.y=M/this.texture.frame.height,this._height=M}}),C.Text.fontPropertiesCache={},C.Text.fontPropertiesCanvas=document.createElement("canvas"),C.Text.fontPropertiesContext=C.Text.fontPropertiesCanvas.getContext("2d"),C.BitmapText=function(M,O,U,W,X,V,H){O=O||0,U=U||0,W=W||"",X=X||"",V=V||32,H=H||"left",PIXI.DisplayObjectContainer.call(this),this.type=C.BITMAPTEXT,this.physicsType=C.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new C.Point,this._prevAnchor=new C.Point,this._glyphs=[],this._maxWidth=0,this._text=X.toString()||"",this._data=M.cache.getBitmapFont(W),this._font=W,this._fontSize=V,this._align=H,this._tint=16777215,this.updateText(),this.dirty=!1,C.Component.Core.init.call(this,M,O,U,"",null)},C.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),C.BitmapText.prototype.constructor=C.BitmapText,C.Component.Core.install.call(C.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),C.BitmapText.prototype.preUpdatePhysics=C.Component.PhysicsBody.preUpdate,C.BitmapText.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.BitmapText.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.BitmapText.prototype.preUpdateCore=C.Component.Core.preUpdate,C.BitmapText.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.BitmapText.prototype.postUpdate=function(){C.Component.PhysicsBody.postUpdate.call(this),C.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===C.Physics.ARCADE&&(this.textWidth!==this.body.sourceWidth||this.textHeight!==this.body.sourceHeight)&&this.body.setSize(this.textWidth,this.textHeight)},C.BitmapText.prototype.setText=function(M){this.text=M},C.BitmapText.prototype.scanLine=function(M,O,U){for(var W=0,X=0,V=-1,H=0,Y=null,z=0<this._maxWidth?this._maxWidth:null,K=[],J=0,Q;J<U.length;J++){if(Q=J===U.length-1,/(?:\r\n|\r|\n)/.test(U.charAt(J)))return{width:X,text:U.substr(0,J),end:Q,chars:K};var Z=U.charCodeAt(J),$=M.chars[Z],ee=0;void 0===$&&(Z=32,$=M.chars[Z]);var te=Y&&$.kerning[Y]?$.kerning[Y]:0;if(/(\s)/.test(U.charAt(J))&&(V=J,H=X),ee=(te+$.texture.width+$.xOffset)*O,z&&X+ee>=z&&-1<V)return{width:H||X,text:U.substr(0,J-(J-V)),end:Q,chars:K};X+=($.xAdvance+te)*O,K.push(W+($.xOffset+te)*O),W+=($.xAdvance+te)*O,Y=Z}return{width:X,text:U,end:Q,chars:K}},C.BitmapText.prototype.cleanText=function(M,O){void 0===O&&(O="");var U=this._data.font;if(!U)return"";for(var W=/\r\n|\n\r|\n|\r/g,X=M.replace(W,"\n").split("\n"),V=0;V<X.length;V++){for(var H="",Y=X[V],z=0;z<Y.length;z++)H=U.chars[Y.charCodeAt(z)]?H.concat(Y[z]):H.concat(O);X[V]=H}return X.join("\n")},C.BitmapText.prototype.updateText=function(){var M=this._data.font;if(M){var O=this.text,U=this._fontSize/M.size,W=[],X=0;this.textWidth=0;do{var V=this.scanLine(M,U,O);V.y=X,W.push(V),V.width>this.textWidth&&(this.textWidth=V.width),X+=M.lineHeight*U,O=O.substr(V.text.length+1)}while(!1===V.end);this.textHeight=X;for(var H=0,Y=0,z=this.textWidth*this.anchor.x,K=this.textHeight*this.anchor.y,J=0,V;J<W.length;J++){V=W[J],"right"===this._align?Y=this.textWidth-V.width:"center"===this._align&&(Y=(this.textWidth-V.width)/2);for(var Q=0;Q<V.text.length;Q++){var Z=V.text.charCodeAt(Q),$=M.chars[Z];void 0===$&&(Z=32,$=M.chars[Z]);var ee=this._glyphs[H];ee?ee.texture=$.texture:(ee=new PIXI.Sprite($.texture),ee.name=V.text[Q],this._glyphs.push(ee)),ee.position.x=V.chars[Q]+Y-z,ee.position.y=V.y+$.yOffset*U-K,ee.scale.set(U),ee.tint=this.tint,ee.texture.requiresReTint=!0,ee.cachedTint=16777215,ee.parent||this.addChild(ee),H++}}for(J=H;J<this._glyphs.length;J++)this.removeChild(this._glyphs[J])}},C.BitmapText.prototype.purgeGlyphs=function(){for(var M=this._glyphs.length,O=[],U=0;U<this._glyphs.length;U++)this._glyphs[U].parent===this?O.push(this._glyphs[U]):this._glyphs[U].destroy();return this._glyphs=[],this._glyphs=O,this.updateText(),M-O.length},C.BitmapText.prototype.updateTransform=function(){(this.dirty||!this.anchor.equals(this._prevAnchor))&&(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(C.BitmapText.prototype,"align",{get:function(){return this._align},set:function(M){M!==this._align&&("left"===M||"center"===M||"right"===M)&&(this._align=M,this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(M){M!==this._tint&&(this._tint=M,this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"font",{get:function(){return this._font},set:function(M){M!==this._font&&(this._font=M.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(M){M=parseInt(M,10),M!==this._fontSize&&0<M&&(this._fontSize=M,this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"text",{get:function(){return this._text},set:function(M){M!==this._text&&(this._text=M.toString()||"",this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(M){M!==this._maxWidth&&(this._maxWidth=M,this.updateText())}}),Object.defineProperty(C.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(M){this._data.base.scaleMode=M?0:1}}),C.RetroFont=function(M,O,U,W,X,V,H,Y,z,K){if(!M.cache.checkImageKey(O))return!1;(void 0===V||null===V)&&(V=M.cache.getImage(O).width/U),this.characterWidth=U,this.characterHeight=W,this.characterSpacingX=H||0,this.characterSpacingY=Y||0,this.characterPerRow=V,this.offsetX=z||0,this.offsetY=K||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=M.cache.getImage(O),this._text="",this.grabData=[],this.frameData=new C.FrameData;for(var J=this.offsetX,Q=this.offsetY,Z=0,$=0,ee;$<X.length;$++)ee=this.frameData.addFrame(new C.Frame($,J,Q,this.characterWidth,this.characterHeight)),this.grabData[X.charCodeAt($)]=ee.index,Z++,Z===this.characterPerRow?(Z=0,J=this.offsetX,Q+=this.characterHeight+this.characterSpacingY):J+=this.characterWidth+this.characterSpacingX;M.cache.updateFrameData(O,this.frameData),this.stamp=new C.Image(M,0,0,O,0),C.RenderTexture.call(this,M,100,100,"",C.scaleModes.NEAREST),this.type=C.RETROFONT},C.RetroFont.prototype=Object.create(C.RenderTexture.prototype),C.RetroFont.prototype.constructor=C.RetroFont,C.RetroFont.ALIGN_LEFT="left",C.RetroFont.ALIGN_RIGHT="right",C.RetroFont.ALIGN_CENTER="center",C.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",C.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",C.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",C.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",C.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",C.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",C.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",C.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",C.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",C.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",C.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",C.RetroFont.prototype.setFixedWidth=function(M,O){void 0===O&&(O="left"),this.fixedWidth=M,this.align=O},C.RetroFont.prototype.setText=function(M,O,U,W,X,V){this.multiLine=O||!1,this.customSpacingX=U||0,this.customSpacingY=W||0,this.align=X||"left",this.autoUpperCase=!V,0<M.length&&(this.text=M)},C.RetroFont.prototype.buildRetroFontText=function(){var M=0,O=0;if(this.clear(),this.multiLine){var U=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,U.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),U.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var W=0;W<U.length;W++)M=0,this.align===C.RetroFont.ALIGN_RIGHT?M=this.width-U[W].length*(this.characterWidth+this.customSpacingX):this.align===C.RetroFont.ALIGN_CENTER&&(M=this.width/2-U[W].length*(this.characterWidth+this.customSpacingX)/2,M+=this.customSpacingX/2),0>M&&(M=0),this.pasteLine(U[W],M,O,this.customSpacingX),O+=this.characterHeight+this.customSpacingY}else 0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),M=0,this.align===C.RetroFont.ALIGN_RIGHT?M=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===C.RetroFont.ALIGN_CENTER&&(M=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,M+=this.customSpacingX/2),0>M&&(M=0),this.pasteLine(this._text,M,0,this.customSpacingX);this.requiresReTint=!0},C.RetroFont.prototype.pasteLine=function(M,O,U,W){for(var X=0;X<M.length;X++)if(" "===M.charAt(X))O+=this.characterWidth+W;else if(0<=this.grabData[M.charCodeAt(X)]&&(this.stamp.frame=this.grabData[M.charCodeAt(X)],this.renderXY(this.stamp,O,U,!1),O+=this.characterWidth+W,O>this.width))break},C.RetroFont.prototype.getLongestLine=function(){var M=0;if(0<this._text.length)for(var O=this._text.split("\n"),U=0;U<O.length;U++)O[U].length>M&&(M=O[U].length);return M},C.RetroFont.prototype.removeUnsupportedCharacters=function(M){for(var O="",U=0;U<this._text.length;U++){var W=this._text[U],X=W.charCodeAt(0);(0<=this.grabData[X]||!M&&"\n"===W)&&(O=O.concat(W))}return O},C.RetroFont.prototype.updateOffset=function(M,O){if(this.offsetX!==M||this.offsetY!==O){for(var U=M-this.offsetX,W=O-this.offsetY,X=this.game.cache.getFrameData(this.stamp.key).getFrames(),V=X.length;V--;)X[V].x+=U,X[V].y+=W;this.buildRetroFontText()}},Object.defineProperty(C.RetroFont.prototype,"text",{get:function(){return this._text},set:function(M){var O;O=this.autoUpperCase?M.toUpperCase():M,O!==this._text&&(this._text=O,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(C.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(M){this.stamp.smoothed=M,this.buildRetroFontText()}}),C.Rope=function(M,O,U,W,X,V){this.points=[],this.points=V,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,O=O||0,U=U||0,W=W||null,X=X||null,this.type=C.ROPE,this.points=V,PIXI.DisplayObjectContainer.call(this),this.texture=C.Cache.DEFAULT,this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new Float32Array([0,0,100,0,100,100,0,100]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3]),V&&(this.vertices=new Float32Array(4*V.length),this.uvs=new Float32Array(4*V.length),this.colors=new Float32Array(2*V.length),this.indices=new Uint16Array(2*V.length)),this.dirty=!0,this.canvasPadding=0,this.drawMode=C.Rope.TRIANGLE_STRIP,C.Component.Core.init.call(this,M,O,U,W,X),this.refresh()},C.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),C.Rope.prototype.constructor=C.Rope,C.Component.Core.install.call(C.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),C.Rope.prototype.preUpdatePhysics=C.Component.PhysicsBody.preUpdate,C.Rope.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.Rope.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.Rope.prototype.preUpdateCore=C.Component.Core.preUpdate,C.Rope.TRIANGLE_STRIP=0,C.Rope.TRIANGLES=1,C.Rope.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},C.Rope.prototype.reset=function(M,O){return C.Component.Reset.prototype.reset.call(this,M,O),this},C.Rope.prototype.refresh=function(){var M=this.points;if(!(1>M.length)){var O=this.uvs,U=this.indices,W=this.colors;this.count-=0.2,O[0]=0,O[1]=0,O[2]=0,O[3]=1,W[0]=1,W[1]=1,U[0]=0,U[1]=1;for(var X=M.length,Y=1,V,H;Y<X;Y++)V=4*Y,H=Y/(X-1),Y%2?(O[V]=H,O[V+1]=0,O[V+2]=H,O[V+3]=1):(O[V]=H,O[V+1]=0,O[V+2]=H,O[V+3]=1),V=2*Y,W[V]=1,W[V+1]=1,V=2*Y,U[V]=V,U[V+1]=V+1}},C.Rope.prototype.updateTransform=function(){var M=this.points;if(!(1>M.length)){var O=M[0],W={x:0,y:0},U;this.count-=0.2;for(var X=this.vertices,V=M.length,Q=0,H,Y,z,K,J;Q<V;Q++)H=M[Q],Y=4*Q,U=Q<M.length-1?M[Q+1]:H,W.y=-(U.x-O.x),W.x=U.y-O.y,z=10*(1-Q/(V-1)),1<z&&(z=1),K=Math.sqrt(W.x*W.x+W.y*W.y),J=this.texture.height/2,W.x/=K,W.y/=K,W.x*=J,W.y*=J,X[Y]=H.x+W.x,X[Y+1]=H.y+W.y,X[Y+2]=H.x-W.x,X[Y+3]=H.y-W.y,O=H;PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},C.Rope.prototype.setTexture=function(M){this.texture=M},C.Rope.prototype._renderWebGL=function(M){!this.visible||0>=this.alpha||(M.spriteBatch.stop(),!this._vertexBuffer&&this._initWebGL(M),M.shaderManager.setShader(M.shaderManager.stripShader),this._renderStrip(M),M.spriteBatch.start())},C.Rope.prototype._initWebGL=function(M){var O=M.gl;this._vertexBuffer=O.createBuffer(),this._indexBuffer=O.createBuffer(),this._uvBuffer=O.createBuffer(),this._colorBuffer=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,this._vertexBuffer),O.bufferData(O.ARRAY_BUFFER,this.vertices,O.DYNAMIC_DRAW),O.bindBuffer(O.ARRAY_BUFFER,this._uvBuffer),O.bufferData(O.ARRAY_BUFFER,this.uvs,O.STATIC_DRAW),O.bindBuffer(O.ARRAY_BUFFER,this._colorBuffer),O.bufferData(O.ARRAY_BUFFER,this.colors,O.STATIC_DRAW),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,this._indexBuffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,this.indices,O.STATIC_DRAW)},C.Rope.prototype._renderStrip=function(M){var O=M.gl,U=M.projection,W=M.offset,X=M.shaderManager.stripShader,V=this.drawMode===C.Rope.TRIANGLE_STRIP?O.TRIANGLE_STRIP:O.TRIANGLES;M.blendModeManager.setBlendMode(this.blendMode),O.uniformMatrix3fv(X.translationMatrix,!1,this.worldTransform.toArray(!0)),O.uniform2f(X.projectionVector,U.x,-U.y),O.uniform2f(X.offsetVector,-W.x,-W.y),O.uniform1f(X.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,O.bindBuffer(O.ARRAY_BUFFER,this._vertexBuffer),O.bufferData(O.ARRAY_BUFFER,this.vertices,O.STATIC_DRAW),O.vertexAttribPointer(X.aVertexPosition,2,O.FLOAT,!1,0,0),O.bindBuffer(O.ARRAY_BUFFER,this._uvBuffer),O.bufferData(O.ARRAY_BUFFER,this.uvs,O.STATIC_DRAW),O.vertexAttribPointer(X.aTextureCoord,2,O.FLOAT,!1,0,0),O.activeTexture(O.TEXTURE0),this.texture.baseTexture._dirty[O.id]?M.renderer.updateTexture(this.texture.baseTexture):O.bindTexture(O.TEXTURE_2D,this.texture.baseTexture._glTextures[O.id]),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,this._indexBuffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,this.indices,O.STATIC_DRAW)):(O.bindBuffer(O.ARRAY_BUFFER,this._vertexBuffer),O.bufferSubData(O.ARRAY_BUFFER,0,this.vertices),O.vertexAttribPointer(X.aVertexPosition,2,O.FLOAT,!1,0,0),O.bindBuffer(O.ARRAY_BUFFER,this._uvBuffer),O.vertexAttribPointer(X.aTextureCoord,2,O.FLOAT,!1,0,0),O.activeTexture(O.TEXTURE0),this.texture.baseTexture._dirty[O.id]?M.renderer.updateTexture(this.texture.baseTexture):O.bindTexture(O.TEXTURE_2D,this.texture.baseTexture._glTextures[O.id]),O.bindBuffer(O.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),O.drawElements(V,this.indices.length,O.UNSIGNED_SHORT,0)},C.Rope.prototype._renderCanvas=function(M){var O=M.context,U=this.worldTransform,W=U.tx*M.resolution+M.shakeX,X=U.ty*M.resolution+M.shakeY;M.roundPixels?O.setTransform(U.a,U.b,U.c,U.d,0|W,0|X):O.setTransform(U.a,U.b,U.c,U.d,W,X),this.drawMode===C.Rope.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(O):this._renderCanvasTriangles(O)},C.Rope.prototype._renderCanvasTriangleStrip=function(M){var O=this.vertices,U=this.uvs,W=O.length/2;this.count++;for(var X=0,V;X<W-2;X++)V=2*X,this._renderCanvasDrawTriangle(M,O,U,V,V+2,V+4)},C.Rope.prototype._renderCanvasTriangles=function(M){var O=this.vertices,U=this.uvs,W=this.indices,X=W.length;this.count++;for(var V=0;V<X;V+=3){var H=2*W[V],Y=2*W[V+1],z=2*W[V+2];this._renderCanvasDrawTriangle(M,O,U,H,Y,z)}},C.Rope.prototype._renderCanvasDrawTriangle=function(M,O,U,W,X,V){var H=this.texture.baseTexture.source,Y=this.texture.width,z=this.texture.height,K=O[W],J=O[X],Q=O[V],Z=O[W+1],$=O[X+1],ee=O[V+1],te=U[W]*Y,ae=U[X]*Y,oe=U[V]*Y,ne=U[W+1]*z,ie=U[X+1]*z,se=U[V+1]*z;if(0<this.canvasPadding){var le=this.canvasPadding/this.worldTransform.a,de=this.canvasPadding/this.worldTransform.d,pe=(K+J+Q)/3,ue=(Z+$+ee)/3,he=K-pe,ge=Z-ue,me=Math.sqrt(he*he+ge*ge);K=pe+he/me*(me+le),Z=ue+ge/me*(me+de),he=J-pe,ge=$-ue,me=Math.sqrt(he*he+ge*ge),J=pe+he/me*(me+le),$=ue+ge/me*(me+de),he=Q-pe,ge=ee-ue,me=Math.sqrt(he*he+ge*ge),Q=pe+he/me*(me+le),ee=ue+ge/me*(me+de)}M.save(),M.beginPath(),M.moveTo(K,Z),M.lineTo(J,$),M.lineTo(Q,ee),M.closePath(),M.clip();var be=te*ie+ne*oe+ae*se-ie*oe-ne*ae-te*se,_e=K*ie+ne*Q+J*se-ie*Q-ne*J-K*se,ve=te*J+K*oe+ae*Q-J*oe-K*ae-te*Q,Te=te*ie*Q+ne*J*oe+K*ae*se-K*ie*oe-ne*ae*Q-te*J*se,Ce=Z*ie+ne*ee+$*se-ie*ee-ne*$-Z*se,Pe=te*$+Z*oe+ae*ee-$*oe-Z*ae-te*ee,Se=te*ie*ee+ne*$*oe+Z*ae*se-Z*ie*oe-ne*ae*ee-te*$*se;M.transform(_e/be,Ce/be,ve/be,Pe/be,Te/be,Se/be),M.drawImage(H,0,0),M.restore()},C.Rope.prototype.renderStripFlat=function(M){var O=this.context,U=M.vertices,W=U.length/2;this.count++,O.beginPath();for(var X=1;X<W-2;X++){var V=2*X,H=U[V],Y=U[V+2],z=U[V+4],K=U[V+1],J=U[V+3],Q=U[V+5];O.moveTo(H,K),O.lineTo(Y,J),O.lineTo(z,Q)}O.fillStyle="#FF0000",O.fill(),O.closePath()},C.Rope.prototype.getBounds=function(M){for(var O=M||this.worldTransform,U=O.a,W=O.b,X=O.c,V=O.d,H=O.tx,Y=O.ty,z=-Infinity,K=-Infinity,J=Infinity,Q=Infinity,Z=this.vertices,$=0;$<Z.length;$+=2){var ee=Z[$],te=Z[$+1],ae=U*ee+X*te+H,oe=V*te+W*ee+Y;J=ae<J?ae:J,Q=oe<Q?oe:Q,z=ae>z?ae:z,K=oe>K?oe:K}if(J===-Infinity||K===Infinity)return PIXI.EmptyRectangle;var ne=this._bounds;return ne.x=J,ne.width=z-J,ne.y=Q,ne.height=K-Q,this._currentBounds=ne,ne},Object.defineProperty(C.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(M){M&&"function"==typeof M?(this._hasUpdateAnimation=!0,this._updateAnimation=M):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(C.Rope.prototype,"segments",{get:function(){for(var M=[],K=0,O,U,W,X,V,H,Y,z;K<this.points.length;K++)O=4*K,U=this.vertices[O]*this.scale.x,W=this.vertices[O+1]*this.scale.y,X=this.vertices[O+4]*this.scale.x,V=this.vertices[O+3]*this.scale.y,H=C.Math.difference(U,X),Y=C.Math.difference(W,V),U+=this.world.x,W+=this.world.y,z=new C.Rectangle(U,W,H,Y),M.push(z);return M}}),C.TileSprite=function(M,O,U,W,X,V,H){O=O||0,U=U||0,W=W||256,X=X||256,V=V||null,H=H||null,PIXI.Sprite.call(this,new PIXI.Texture(C.Cache.DEFAULT.baseTexture),W,X),this.type=C.TILESPRITE,this.physicsType=C.SPRITE,this._scroll=new C.Point,this.tileScale=new C.Point(1,1),this.tileScaleOffset=new C.Point(1,1),this.tilePosition=new C.Point,this.textureDebug=!1,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0,this._width=W,this._height=X,C.Component.Core.init.call(this,M,O,U,V,H)},C.TileSprite.prototype=Object.create(PIXI.Sprite.prototype),C.TileSprite.prototype.constructor=C.TileSprite,C.Component.Core.install.call(C.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),C.TileSprite.prototype.preUpdatePhysics=C.Component.PhysicsBody.preUpdate,C.TileSprite.prototype.preUpdateLifeSpan=C.Component.LifeSpan.preUpdate,C.TileSprite.prototype.preUpdateInWorld=C.Component.InWorld.preUpdate,C.TileSprite.prototype.preUpdateCore=C.Component.Core.preUpdate,C.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()&&this.preUpdateCore()},C.TileSprite.prototype.autoScroll=function(M,O){return this._scroll.set(M,O),this},C.TileSprite.prototype.stopScroll=function(){return this._scroll.set(0,0),this},C.TileSprite.prototype.destroy=function(M){C.Component.Destroy.prototype.destroy.call(this,M),PIXI.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},C.TileSprite.prototype.reset=function(M,O){return C.Component.Reset.prototype.reset.call(this,M,O),this.tilePosition.x=0,this.tilePosition.y=0,this},C.TileSprite.prototype.setTexture=function(M){return this.texture!==M&&(this.texture=M,this.refreshTexture=!0,this.cachedTint=16777215),this},C.TileSprite.prototype._renderWebGL=function(M){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(M.spriteBatch.stop(),M.maskManager.pushMask(this.mask,M),M.spriteBatch.start()),this._filters&&(M.spriteBatch.flush(),M.filterManager.pushFilter(this._filterBlock)),this.refreshTexture)if(this.generateTilingTexture(!0,M),this.tilingTexture)this.tilingTexture.needsUpdate&&(this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex,M.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1);else return;M.spriteBatch.renderTilingSprite(this);for(var O=0;O<this.children.length;O++)this.children[O]._renderWebGL(M);var U=!1;this._filters&&(U=!0,M.spriteBatch.stop(),M.filterManager.popFilter()),this._mask&&(!U&&M.spriteBatch.stop(),M.maskManager.popMask(this._mask,M)),U&&M.spriteBatch.start()}},C.TileSprite.prototype._renderCanvas=function(M){if(this.visible&&this.renderable&&0!==this.alpha){var O=M.context;this._mask&&M.maskManager.pushMask(this._mask,M),O.globalAlpha=this.worldAlpha;var U=this.worldTransform,W=M.resolution,X=U.tx*W+M.shakeX,V=U.ty*W+M.shakeY;if(O.setTransform(U.a*W,U.b*W,U.c*W,U.d*W,X,V),16777215!==this.tint&&(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1,this.refreshTexture=!0),this.refreshTexture)if(this.generateTilingTexture(!1,M),this.tilingTexture)this.tilePattern=O.createPattern(this.tilingTexture.baseTexture.source,"repeat");else return;var H=M.currentBlendMode;this.blendMode!==M.currentBlendMode&&(M.currentBlendMode=this.blendMode,O.globalCompositeOperation=PIXI.blendModesCanvas[M.currentBlendMode]);var Y=this.tilePosition,z=this.tileScale;Y.x%=this.tilingTexture.baseTexture.width,Y.y%=this.tilingTexture.baseTexture.height,O.scale(z.x,z.y),O.translate(Y.x+this.anchor.x*-this._width,Y.y+this.anchor.y*-this._height),O.fillStyle=this.tilePattern,X=-Y.x,V=-Y.y;var K=this._width/z.x,J=this._height/z.y;M.roundPixels&&(X|=0,V|=0,K|=0,J|=0),O.fillRect(X,V,K,J),O.scale(1/z.x,1/z.y),O.translate(-Y.x+this.anchor.x*this._width,-Y.y+this.anchor.y*this._height),this._mask&&M.maskManager.popMask(M);for(var Q=0;Q<this.children.length;Q++)this.children[Q]._renderCanvas(M);H!==this.blendMode&&(M.currentBlendMode=H,O.globalCompositeOperation=PIXI.blendModesCanvas[H])}},C.TileSprite.prototype.onTextureUpdate=function(){},C.TileSprite.prototype.generateTilingTexture=function(M){if(this.texture.baseTexture.hasLoaded){var O=this.texture,U=O.frame,W=this._frame.sourceSizeW||this._frame.width,X=this._frame.sourceSizeH||this._frame.height,V=0,H=0;this._frame.trimmed&&(V=this._frame.spriteSourceSizeX,H=this._frame.spriteSourceSizeY),M&&(W=C.Math.getNextPowerOfTwo(W),X=C.Math.getNextPowerOfTwo(X)),this.canvasBuffer?(this.canvasBuffer.resize(W,X),this.tilingTexture.baseTexture.width=W,this.tilingTexture.baseTexture.height=X,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new PIXI.CanvasBuffer(W,X),this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,W,X));var Y=O.crop.width,z=O.crop.height;(Y!==W||z!==X)&&(Y=W,z=X);var K=this.tintedTexture?this.tintedTexture:O.baseTexture.source;this.canvasBuffer.context.drawImage(K,O.crop.x,O.crop.y,O.crop.width,O.crop.height,V,H,Y,z),this.tileScaleOffset.x=U.width/W,this.tileScaleOffset.y=U.height/X,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},C.TileSprite.prototype.getBounds=function(){var M=this._width,O=this._height,U=M*(1-this.anchor.x),W=M*-this.anchor.x,X=O*(1-this.anchor.y),V=O*-this.anchor.y,H=this.worldTransform,Y=H.a,z=H.b,K=H.c,J=H.d,Q=H.tx,Z=H.ty,$=Y*W+K*V+Q,ee=J*V+z*W+Z,te=Y*U+K*V+Q,ae=J*V+z*U+Z,oe=Y*U+K*X+Q,ne=J*X+z*U+Z,ie=Y*W+K*X+Q,se=J*X+z*W+Z,le=-Infinity,de=-Infinity,pe=Infinity,ue=Infinity;pe=$<pe?$:pe,pe=te<pe?te:pe,pe=oe<pe?oe:pe,pe=ie<pe?ie:pe,ue=ee<ue?ee:ue,ue=ae<ue?ae:ue,ue=ne<ue?ne:ue,ue=se<ue?se:ue,le=$>le?$:le,le=te>le?te:le,le=oe>le?oe:le,le=ie>le?ie:le,de=ee>de?ee:de,de=ae>de?ae:de,de=ne>de?ne:de,de=se>de?se:de;var he=this._bounds;return he.x=pe,he.width=le-pe,he.y=ue,he.height=de-ue,this._currentBounds=he,he},Object.defineProperty(C.TileSprite.prototype,"width",{get:function(){return this._width},set:function(M){this._width=M}}),Object.defineProperty(C.TileSprite.prototype,"height",{get:function(){return this._height},set:function(M){this._height=M}}),C.CanvasPool={create:function(M,O,U){var W=C.CanvasPool.getFirst(),X;if(-1===W){var V={parent:M,canvas:document.createElement("canvas")};C.CanvasPool.pool.push(V),X=V.canvas}else C.CanvasPool.pool[W].parent=M,X=C.CanvasPool.pool[W].canvas;return void 0!==O&&(X.width=O,X.height=U),X},getFirst:function(){for(var M=C.CanvasPool.pool,O=0;O<M.length;O++)if(!M[O].parent)return O;return-1},remove:function(M){for(var O=C.CanvasPool.pool,U=0;U<O.length;U++)O[U].parent===M&&(O[U].parent=null,O[U].canvas.width=1,O[U].canvas.height=1)},removeByCanvas:function(M){for(var O=C.CanvasPool.pool,U=0;U<O.length;U++)O[U].canvas===M&&(O[U].parent=null,O[U].canvas.width=1,O[U].canvas.height=1)},getTotal:function(){for(var M=C.CanvasPool.pool,O=0,U=0;U<M.length;U++)M[U].parent&&O++;return O},getFree:function(){for(var M=C.CanvasPool.pool,O=0,U=0;U<M.length;U++)M[U].parent||O++;return O}},C.CanvasPool.pool=[],C.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.canHandleAlpha=!1,this.canUseMultiply=!1,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},C.Device=new C.Device,C.Device.onInitialized=new C.Signal,C.Device.whenReady=function(M,O,U){var W=this._readyCheck;if(this.deviceReadyAt||!W)M.call(O,this);else if(W._monitor||U)W._queue=W._queue||[],W._queue.push([M,O]);else{W._monitor=W.bind(this),W._queue=W._queue||[],W._queue.push([M,O]);var X="undefined"!=typeof window.cordova,V=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(W._monitor,0):X&&!V?document.addEventListener("deviceready",W._monitor,!1):(document.addEventListener("DOMContentLoaded",W._monitor,!1),window.addEventListener("load",W._monitor,!1))}},C.Device._readyCheck=function(){var M=this._readyCheck;if(!document.body)window.setTimeout(M._monitor,20);else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",M._monitor),document.removeEventListener("DOMContentLoaded",M._monitor),window.removeEventListener("load",M._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var O;O=M._queue.shift();){var U=O[0],W=O[1];U.call(W,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}},C.Device._initialize=function(){function z(){var $=new ArrayBuffer(4),ee=new Uint8Array($),te=new Uint32Array($);return ee[0]=161,ee[1]=178,ee[2]=195,ee[3]=212,3569595041===te[0]||2712847316!==te[0]&&null}function K(){if(void 0===Uint8ClampedArray)return!1;var $=C.CanvasPool.create(this,1,1),ee=$.getContext("2d");if(!ee)return!1;var te=ee.createImageData(1,1);return C.CanvasPool.remove(this),te.data instanceof Uint8ClampedArray}var Z=this;(function(){var $=navigator.userAgent;/Playstation Vita/.test($)?Z.vita=!0:/Kindle/.test($)||/\bKF[A-Z][A-Z]+/.test($)||/Silk.*Mobile Safari/.test($)?Z.kindle=!0:/Android/.test($)?Z.android=!0:/CrOS/.test($)?Z.chromeOS=!0:/iP[ao]d|iPhone/i.test($)?(Z.iOS=!0,navigator.appVersion.match(/OS (\d+)/),Z.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test($)?Z.linux=!0:/Mac OS/.test($)?Z.macOS=!0:/Windows/.test($)&&(Z.windows=!0),(/Windows Phone/i.test($)||/IEMobile/i.test($))&&(Z.android=!1,Z.iOS=!1,Z.macOS=!1,Z.windows=!0,Z.windowsPhone=!0);var ee=/Silk/.test($);(Z.windows||Z.macOS||Z.linux&&!ee||Z.chromeOS)&&(Z.desktop=!0),(Z.windowsPhone||/Windows NT/i.test($)&&/Touch/i.test($))&&(Z.desktop=!1)})(),function(){var $=navigator.userAgent;if(/Arora/.test($)?Z.arora=!0:/Edge\/\d+/.test($)?Z.edge=!0:/Chrome\/(\d+)/.test($)&&!Z.windowsPhone?(Z.chrome=!0,Z.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test($)?Z.epiphany=!0:/Firefox\D+(\d+)/.test($)?(Z.firefox=!0,Z.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test($)&&Z.iOS?Z.mobileSafari=!0:/MSIE (\d+\.\d+);/.test($)?(Z.ie=!0,Z.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test($)?Z.midori=!0:/Opera/.test($)?Z.opera=!0:/Safari\/(\d+)/.test($)&&!Z.windowsPhone?(Z.safari=!0,/Version\/(\d+)\./.test($)&&(Z.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test($)&&(Z.ie=!0,Z.trident=!0,Z.tridentVersion=parseInt(RegExp.$1,10),Z.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test($)&&(Z.silk=!0),navigator.standalone&&(Z.webApp=!0),"undefined"!=typeof window.cordova&&(Z.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(Z.node=!0),Z.node&&"object"==typeof process.versions&&(Z.nodeWebkit=!!process.versions["node-webkit"],Z.electron=!!process.versions.electron),navigator.isCocoonJS&&(Z.cocoonJS=!0),Z.cocoonJS)try{Z.cocoonJSApp="undefined"!=typeof CocoonJS}catch(ee){Z.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(Z.ejecta=!0),/Crosswalk/.test($)&&(Z.crosswalk=!0)}(),function(){Z.audioData=!!window.Audio,Z.webAudio=!!(window.AudioContext||window.webkitAudioContext);var $=document.createElement("audio"),ee=!1;try{if((ee=!!$.canPlayType)&&($.canPlayType("audio/ogg; codecs=\"vorbis\"").replace(/^no$/,"")&&(Z.ogg=!0),($.canPlayType("audio/ogg; codecs=\"opus\"").replace(/^no$/,"")||$.canPlayType("audio/opus;").replace(/^no$/,""))&&(Z.opus=!0),$.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(Z.mp3=!0),$.canPlayType("audio/wav; codecs=\"1\"").replace(/^no$/,"")&&(Z.wav=!0),($.canPlayType("audio/x-m4a;")||$.canPlayType("audio/aac;").replace(/^no$/,""))&&(Z.m4a=!0),$.canPlayType("audio/webm; codecs=\"vorbis\"").replace(/^no$/,"")&&(Z.webm=!0),""!==$.canPlayType("audio/mp4;codecs=\"ec-3\"")))if(Z.edge)Z.dolby=!0;else if(Z.safari&&9<=Z.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var te=parseInt(RegExp.$1,10),ae=parseInt(RegExp.$2,10);(10===te&&11<=ae||10<te)&&(Z.dolby=!0)}}catch(oe){}}(),function(){var $=document.createElement("video"),ee=!1;try{(ee=!!$.canPlayType)&&($.canPlayType("video/ogg; codecs=\"theora\"").replace(/^no$/,"")&&(Z.oggVideo=!0),$.canPlayType("video/mp4; codecs=\"avc1.42E01E\"").replace(/^no$/,"")&&(Z.h264Video=!0,Z.mp4Video=!0),$.canPlayType("video/webm; codecs=\"vp8, vorbis\"").replace(/^no$/,"")&&(Z.webmVideo=!0),$.canPlayType("video/webm; codecs=\"vp9\"").replace(/^no$/,"")&&(Z.vp9Video=!0),$.canPlayType("application/x-mpegURL; codecs=\"avc1.42E01E\"").replace(/^no$/,"")&&(Z.hlsVideo=!0))}catch(te){}}(),function(){var $=document.createElement("p"),te={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},ee;for(var ae in document.body.insertBefore($,null),te)void 0!==$.style[ae]&&($.style[ae]="translate3d(1px,1px,1px)",ee=window.getComputedStyle($).getPropertyValue(te[ae]));document.body.removeChild($),Z.css3D=void 0!==ee&&0<ee.length&&"none"!==ee}(),function(){Z.pixelRatio=window.devicePixelRatio||1,Z.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),Z.iPhone4=2===Z.pixelRatio&&Z.iPhone,Z.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),Z.typedArray="undefined"!=typeof Int8Array,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(Z.littleEndian=z(),Z.LITTLE_ENDIAN=Z.littleEndian),Z.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==Z.littleEndian&&K(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(Z.vibration=!0)}(),function(){Z.canvas=!!window.CanvasRenderingContext2D||Z.cocoonJS;try{Z.localStorage=!!localStorage.getItem}catch($){Z.localStorage=!1}Z.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob,Z.fileSystem=!!window.requestFileSystem,Z.webGL=function(){try{var $=document.createElement("canvas");return $.screencanvas=!1,!!window.WebGLRenderingContext&&($.getContext("webgl")||$.getContext("experimental-webgl"))}catch(ee){return!1}}(),Z.webGL=!!Z.webGL,Z.worker=!!window.Worker,Z.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Z.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,Z.getUserMedia=Z.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,Z.firefox&&21>Z.firefoxVersion&&(Z.getUserMedia=!1),!Z.iOS&&(Z.ie||Z.firefox||Z.chrome)&&(Z.canvasBitBltShift=!0),(Z.safari||Z.mobileSafari)&&(Z.canvasBitBltShift=!1)}(),function(){var $=C.CanvasPool.create(this,6,1),ee=$.getContext("2d");ee.fillStyle="rgba(10, 20, 30, 0.5)",ee.fillRect(0,0,1,1);var te=ee.getImageData(0,0,1,1);if(te){ee.putImageData(te,1,0);var ae=ee.getImageData(1,0,1,1);Z.canHandleAlpha=ae.data[0]===te.data[0]&&ae.data[1]===te.data[1]&&ae.data[2]===te.data[2]&&ae.data[3]===te.data[3]}ee.globalCompositeOperation="multiply",Z.canUseMultiply="multiply"===ee.globalCompositeOperation,C.CanvasPool.removeByCanvas($),PIXI.CanvasTinter.tintMethod=Z.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}(),function(){for(var $=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],ee=document.createElement("div"),te=0;te<$.length;te++)if(ee[$[te]]){Z.fullscreen=!0,Z.requestFullscreen=$[te];break}var ae=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(Z.fullscreen)for(var te=0;te<ae.length;te++)if(document[ae[te]]){Z.cancelFullscreen=ae[te];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(Z.fullscreenKeyboard=!0)}(),function(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(Z.touch=!0),(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(Z.mspointer=!0),Z.cocoonJS||("onwheel"in window||Z.ie&&"WheelEvent"in window?Z.wheelEvent="wheel":"onmousewheel"in window?Z.wheelEvent="mousewheel":Z.firefox&&"MouseScrollEvent"in window&&(Z.wheelEvent="DOMMouseScroll"))}()},C.Device.canPlayAudio=function(M){return"mp3"===M&&this.mp3||"ogg"===M&&(this.ogg||this.opus)||"m4a"===M&&this.m4a||"opus"===M&&this.opus||"wav"===M&&this.wav||"webm"===M&&this.webm||"mp4"===M&&this.dolby},C.Device.canPlayVideo=function(M){return"webm"===M&&(this.webmVideo||this.vp9Video)||"mp4"===M&&(this.mp4Video||this.h264Video)||("ogg"===M||"ogv"===M)&&this.oggVideo||"mpeg"===M&&this.hlsVideo},C.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)},C.Device.isConsoleOpen=function(){return console.warn("Phaser.Device.isConsoleOpen is deprecated and will be removed."),!1},C.Device.isAndroidStockBrowser=function(){var M=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return M&&537>M[1]},C.Canvas={create:function(M,O,U,W,X){O=O||256,U=U||256;var V=X?document.createElement("canvas"):C.CanvasPool.create(M,O,U);return"string"==typeof W&&""!==W&&(V.id=W),V.width=O,V.height=U,V.style.display="block",V},setBackgroundColor:function(M,O){return O=O||"rgb(0,0,0)",M.style.backgroundColor=O,M},setTouchAction:function(M,O){return O=O||"none",M.style.msTouchAction=O,M.style["ms-touch-action"]=O,M.style["touch-action"]=O,M},setUserSelect:function(M,O){return O=O||"none",M.style["-webkit-touch-callout"]=O,M.style["-webkit-user-select"]=O,M.style["-khtml-user-select"]=O,M.style["-moz-user-select"]=O,M.style["-ms-user-select"]=O,M.style["user-select"]=O,M.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",M},addToDOM:function(M,O,U){var W;return void 0===U&&(U=!0),O&&("string"==typeof O?W=document.getElementById(O):"object"==typeof O&&1===O.nodeType&&(W=O)),W||(W=document.body),U&&W.style&&(W.style.overflow="hidden"),W.appendChild(M),M},removeFromDOM:function(M){M.parentNode&&M.parentNode.removeChild(M)},setTransform:function(M,O,U,W,X,V,H){return M.setTransform(W,V,H,X,O,U),M},setSmoothingEnabled:function(M,O){var U=C.Canvas.getSmoothingPrefix(M);return U&&(M[U]=O),M},getSmoothingPrefix:function(M){var O=["i","webkitI","msI","mozI","oI"];for(var U in O){var W=O[U]+"mageSmoothingEnabled";if(W in M)return W}return null},getSmoothingEnabled:function(M){var O=C.Canvas.getSmoothingPrefix(M);if(O)return M[O]},setImageRenderingCrisp:function(M){for(var O=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"],U=0;U<O.length;U++)M.style["image-rendering"]=O[U];return M.style.msInterpolationMode="nearest-neighbor",M},setImageRenderingBicubic:function(M){return M.style["image-rendering"]="auto",M.style.msInterpolationMode="bicubic",M}},C.RequestAnimationFrame=function(M,O){void 0===O&&(O=!1),this.game=M,this.isRunning=!1,this.forceSetTimeOut=O;for(var U=["ms","moz","webkit","o"],W=0;W<U.length&&!window.requestAnimationFrame;W++)window.requestAnimationFrame=window[U[W]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[U[W]+"CancelAnimationFrame"]||window[U[W]+"CancelRequestAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},C.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var M=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return M.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(O){return M.updateRAF(O)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(M){this.isRunning&&(this.game.update(Math.floor(M)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},C.RequestAnimationFrame.prototype.constructor=C.RequestAnimationFrame,C.Math={PI2:2*Math.PI,HALF_PI:0.5*Math.PI,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(M){return M*C.Math.DEG_TO_RAD},radToDeg:function(M){return M*C.Math.RAD_TO_DEG},getNextPowerOfTwo:function(M){if(0<M&&0==(M&M-1))return M;for(var O=1;O<M;)O<<=1;return O},isPowerOfTwo:function(M,O){return 0<M&&0==(M&M-1)&&0<O&&0==(O&O-1)},random:function(M,O){if(void 0===M&&(M=0),void 0===O&&(O=1),M===O)return M;if(M>O){var U=M;M=O,O=U}return Math.random()*(O-M)+M},between:function(M,O){if(void 0===M&&(M=0),void 0===O&&(O=1),M===O)return M;if(M>O){var U=M;M=O,O=U}return M=Math.ceil(M),O=Math.floor(O),Math.floor(Math.random()*(O-M+1))+M},fuzzyEqual:function(M,O,U){return void 0===U&&(U=1e-4),Math.abs(M-O)<U},fuzzyLessThan:function(M,O,U){return void 0===U&&(U=1e-4),M<O+U},fuzzyGreaterThan:function(M,O,U){return void 0===U&&(U=1e-4),M>O-U},fuzzyCeil:function(M,O){return void 0===O&&(O=1e-4),Math.ceil(M-O)},fuzzyFloor:function(M,O){return void 0===O&&(O=1e-4),Math.floor(M+O)},average:function(){for(var M=0,O=arguments.length,U=0;U<O;U++)M+=+arguments[U];return M/O},shear:function(M){return M%1},snapTo:function(M,O,U){return(void 0===U&&(U=0),0===O)?M:(M-=U,M=O*Math.round(M/O),U+M)},snapToFloor:function(M,O,U){return(void 0===U&&(U=0),0===O)?M:(M-=U,M=O*Math.floor(M/O),U+M)},snapToCeil:function(M,O,U){return(void 0===U&&(U=0),0===O)?M:(M-=U,M=O*Math.ceil(M/O),U+M)},roundTo:function(M,O,U){void 0===O&&(O=0),void 0===U&&(U=10);var W=Math.pow(U,-O);return Math.round(M*W)/W},floorTo:function(M,O,U){void 0===O&&(O=0),void 0===U&&(U=10);var W=Math.pow(U,-O);return Math.floor(M*W)/W},ceilTo:function(M,O,U){void 0===O&&(O=0),void 0===U&&(U=10);var W=Math.pow(U,-O);return Math.ceil(M*W)/W},rotateToAngle:function(M,O,U){return(void 0===U&&(U=0.05),M===O)?M:(Math.abs(O-M)<=U||Math.abs(O-M)>=C.Math.PI2-U?M=O:(Math.abs(O-M)>Math.PI&&(O<M?O+=C.Math.PI2:O-=C.Math.PI2),O>M?M+=U:O<M&&(M-=U)),M)},getShortestAngle:function(M,O){var U=O-M;if(0==U)return 0;var W=Math.floor((U- -180)/360);return U-360*W},angleBetween:function(M,O,U,W){return Math.atan2(W-O,U-M)},angleBetweenY:function(M,O,U,W){return Math.atan2(U-M,W-O)},angleBetweenPoints:function(M,O){return Math.atan2(O.y-M.y,O.x-M.x)},angleBetweenPointsY:function(M,O){return Math.atan2(O.x-M.x,O.y-M.y)},reverseAngle:function(M){return this.normalizeAngle(M+Math.PI,!0)},normalizeAngle:function(M){return M%=2*Math.PI,0<=M?M:M+2*Math.PI},maxAdd:function(M,O,U){return Math.min(M+O,U)},minSub:function(M,O,U){return Math.max(M-O,U)},wrap:function(M,O,U){var W=U-O;if(0>=W)return 0;var X=(M-O)%W;return 0>X&&(X+=W),X+O},wrapValue:function(M,O,U){var W;return M=Math.abs(M),O=Math.abs(O),U=Math.abs(U),W=(M+O)%U,W},isOdd:function(M){return!!(1&M)},isEven:function(M){return!(1&M)},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var M=arguments[0];else var M=arguments;for(var O=1,U=0,W=M.length;O<W;O++)M[O]<M[U]&&(U=O);return M[U]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var M=arguments[0];else var M=arguments;for(var O=1,U=0,W=M.length;O<W;O++)M[O]>M[U]&&(U=O);return M[U]},minProperty:function(M){if(2===arguments.length&&"object"==typeof arguments[1])var O=arguments[1];else var O=arguments.slice(1);for(var U=1,W=0,X=O.length;U<X;U++)O[U][M]<O[W][M]&&(W=U);return O[W][M]},maxProperty:function(M){if(2===arguments.length&&"object"==typeof arguments[1])var O=arguments[1];else var O=arguments.slice(1);for(var U=1,W=0,X=O.length;U<X;U++)O[U][M]>O[W][M]&&(W=U);return O[W][M]},wrapAngle:function(M,O){return O?this.wrap(M,-Math.PI,Math.PI):this.wrap(M,-180,180)},linearInterpolation:function(M,O){var U=M.length-1,W=U*O,X=Math.floor(W);return 0>O?this.linear(M[0],M[1],W):1<O?this.linear(M[U],M[U-1],U-W):this.linear(M[X],M[X+1>U?U:X+1],W-X)},bezierInterpolation:function(M,O){for(var U=0,W=M.length-1,X=0;X<=W;X++)U+=Math.pow(1-O,W-X)*Math.pow(O,X)*M[X]*this.bernstein(W,X);return U},catmullRomInterpolation:function(M,O){var U=M.length-1,W=U*O,X=Math.floor(W);return M[0]===M[U]?(0>O&&(X=Math.floor(W=U*(1+O))),this.catmullRom(M[(X-1+U)%U],M[X],M[(X+1)%U],M[(X+2)%U],W-X)):0>O?M[0]-(this.catmullRom(M[0],M[0],M[1],M[1],-W)-M[0]):1<O?M[U]-(this.catmullRom(M[U],M[U],M[U-1],M[U-1],W-U)-M[U]):this.catmullRom(M[X?X-1:0],M[X],M[U<X+1?U:X+1],M[U<X+2?U:X+2],W-X)},linear:function(M,O,U){return(O-M)*U+M},bernstein:function(M,O){return this.factorial(M)/this.factorial(O)/this.factorial(M-O)},factorial:function(M){if(0===M)return 1;for(var O=M;--M;)O*=M;return O},catmullRom:function(M,O,U,W,X){var V=0.5*(U-M),H=0.5*(W-O),Y=X*X;return(2*O-2*U+V+H)*(X*Y)+(-3*O+3*U-2*V-H)*Y+V*X+O},difference:function(M,O){return Math.abs(M-O)},roundAwayFromZero:function(M){return 0<M?Math.ceil(M):Math.floor(M)},sinCosGenerator:function(M,O,U,W){void 0===O&&(O=1),void 0===U&&(U=1),void 0===W&&(W=1);for(var X=O,V=U,H=W*Math.PI/M,Y=[],z=[],K=0;K<M;K++)V-=X*H,X+=V*H,Y[K]=V,z[K]=X;return{sin:z,cos:Y,length:M}},hypot:function(M,O){return Math.sqrt(M*M+O*O)},distance:function(M,O,U,W){var X=M-U,V=O-W;return Math.sqrt(X*X+V*V)},distanceSq:function(M,O,U,W){var X=M-U,V=O-W;return X*X+V*V},distancePow:function(M,O,U,W,X){return void 0===X&&(X=2),Math.sqrt(Math.pow(U-M,X)+Math.pow(W-O,X))},clamp:function(M,O,U){return M<O?O:U<M?U:M},clampBottom:function(M,O){return M<O?O:M},within:function(M,O,U){return Math.abs(M-O)<=U},mapLinear:function(M,O,U,W,X){return W+(M-O)*(X-W)/(U-O)},smoothstep:function(M,O,U){return M=Math.max(0,Math.min(1,(M-O)/(U-O))),M*M*(3-2*M)},smootherstep:function(M,O,U){return M=Math.max(0,Math.min(1,(M-O)/(U-O))),M*M*M*(M*(6*M-15)+10)},sign:function(M){return 0>M?-1:0<M?1:0},percent:function(M,O,U){return void 0===U&&(U=0),M>O||U>O?1:M<U||U>M?0:(M-U)/O}},C.RandomDataGenerator=function(M){void 0===M&&(M=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof M?this.state(M):this.sow(M)},C.RandomDataGenerator.prototype={rnd:function(){var M=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|M,this.s0=this.s1,this.s1=this.s2,this.s2=M-this.c,this.s2},sow:function(M){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,!!M)for(var O=0,U;O<M.length&&null!=M[O];O++)U=M[O],this.s0-=this.hash(U),this.s0+=~~(0>this.s0),this.s1-=this.hash(U),this.s1+=~~(0>this.s1),this.s2-=this.hash(U),this.s2+=~~(0>this.s2)},hash:function(M){var O,U,W;for(W=4022871197,M=M.toString(),U=0;U<M.length;U++)W+=M.charCodeAt(U),O=0.02519603282416938*W,W=O>>>0,O-=W,O*=W,W=O>>>0,O-=W,W+=4294967296*O;return 2.3283064365386963e-10*(W>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(0|2097152*this.rnd.apply(this))},real:function(){return this.integer()+this.frac()},integerInRange:function(M,O){return Math.floor(this.realInRange(0,O-M+1)+M)},between:function(M,O){return this.integerInRange(M,O)},realInRange:function(M,O){return this.frac()*(O-M)+M},normal:function(){return 1-2*this.frac()},uuid:function(){var M="",O="";for(O=M="";36>M++;O+=~M%5|4&3*M?(15^M?8^this.frac()*(20^M?16:4):4).toString(16):"-");return O},pick:function(M){return M[this.integerInRange(0,M.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(M){return M[~~(Math.pow(this.frac(),2)*(M.length-1)+0.5)]},timestamp:function(M,O){return this.realInRange(M||9.466848e11,O||1.577862e12)},angle:function(){return this.integerInRange(-180,180)},state:function(M){return"string"==typeof M&&M.match(/^!rnd/)&&(M=M.split(","),this.c=parseFloat(M[1]),this.s0=parseFloat(M[2]),this.s1=parseFloat(M[3]),this.s2=parseFloat(M[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},C.RandomDataGenerator.prototype.constructor=C.RandomDataGenerator,C.QuadTree=function(M,O,U,W,X,V,H){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(M,O,U,W,X,V,H)},C.QuadTree.prototype={reset:function(M,O,U,W,X,V,H){this.maxObjects=X||10,this.maxLevels=V||4,this.level=H||0,this.bounds={x:Math.round(M),y:Math.round(O),width:U,height:W,subWidth:Math.floor(U/2),subHeight:Math.floor(W/2),right:Math.round(M)+Math.floor(U/2),bottom:Math.round(O)+Math.floor(W/2)},this.objects.length=0,this.nodes.length=0},populate:function(M){M.forEach(this.populateHandler,this,!0)},populateHandler:function(M){M.body&&M.exists&&this.insert(M.body)},split:function(){this.nodes[0]=new C.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new C.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new C.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new C.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(M){var O=0,U;if(null!=this.nodes[0]&&(U=this.getIndex(M),-1!==U))return void this.nodes[U].insert(M);if(this.objects.push(M),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();O<this.objects.length;)U=this.getIndex(this.objects[O]),-1===U?O++:this.nodes[U].insert(this.objects.splice(O,1)[0])},getIndex:function(M){var O=-1;return M.x<this.bounds.right&&M.right<this.bounds.right?M.y<this.bounds.bottom&&M.bottom<this.bounds.bottom?O=1:M.y>this.bounds.bottom&&(O=2):M.x>this.bounds.right&&(M.y<this.bounds.bottom&&M.bottom<this.bounds.bottom?O=0:M.y>this.bounds.bottom&&(O=3)),O},retrieve:function(M){if(M instanceof C.Rectangle)var O=this.objects,U=this.getIndex(M);else{if(!M.body)return this._empty;var O=this.objects,U=this.getIndex(M.body)}return this.nodes[0]&&(-1===U?(O=O.concat(this.nodes[0].retrieve(M)),O=O.concat(this.nodes[1].retrieve(M)),O=O.concat(this.nodes[2].retrieve(M)),O=O.concat(this.nodes[3].retrieve(M))):O=O.concat(this.nodes[U].retrieve(M))),O},clear:function(){this.objects.length=0;for(var M=this.nodes.length;M--;)this.nodes[M].clear(),this.nodes.splice(M,1);this.nodes.length=0}},C.QuadTree.prototype.constructor=C.QuadTree,C.Net=function(M){this.game=M},C.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(M){return-1!==window.location.hostname.indexOf(M)},updateQueryString:function(M,O,U,W){void 0===U&&(U=!1),(void 0===W||""===W)&&(W=window.location.href);var X="",V=new RegExp("([?|&])"+M+"=.*?(&|#|$)(.*)","gi");if(V.test(W))X="undefined"!=typeof O&&null!==O?W.replace(V,"$1"+M+"="+O+"$2$3"):W.replace(V,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof O&&null!==O){var H=-1===W.indexOf("?")?"?":"&",Y=W.split("#");W=Y[0]+H+M+"="+O,Y[1]&&(W+="#"+Y[1]),X=W}else X=W;return U?void(window.location.href=X):X},getQueryString:function(M){void 0===M&&(M="");var O={},U=location.search.substring(1).split("&");for(var W in U){var X=U[W].split("=");if(1<X.length){if(M&&M===this.decodeURI(X[0]))return this.decodeURI(X[1]);O[this.decodeURI(X[0])]=this.decodeURI(X[1])}}return O},decodeURI:function(M){return decodeURIComponent(M.replace(/\+/g," "))}},C.Net.prototype.constructor=C.Net,C.TweenManager=function(M){this.game=M,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:C.Easing.Power0,Power1:C.Easing.Power1,Power2:C.Easing.Power2,Power3:C.Easing.Power3,Power4:C.Easing.Power4,Linear:C.Easing.Linear.None,Quad:C.Easing.Quadratic.Out,Cubic:C.Easing.Cubic.Out,Quart:C.Easing.Quartic.Out,Quint:C.Easing.Quintic.Out,Sine:C.Easing.Sinusoidal.Out,Expo:C.Easing.Exponential.Out,Circ:C.Easing.Circular.Out,Elastic:C.Easing.Elastic.Out,Back:C.Easing.Back.Out,Bounce:C.Easing.Bounce.Out,"Quad.easeIn":C.Easing.Quadratic.In,"Cubic.easeIn":C.Easing.Cubic.In,"Quart.easeIn":C.Easing.Quartic.In,"Quint.easeIn":C.Easing.Quintic.In,"Sine.easeIn":C.Easing.Sinusoidal.In,"Expo.easeIn":C.Easing.Exponential.In,"Circ.easeIn":C.Easing.Circular.In,"Elastic.easeIn":C.Easing.Elastic.In,"Back.easeIn":C.Easing.Back.In,"Bounce.easeIn":C.Easing.Bounce.In,"Quad.easeOut":C.Easing.Quadratic.Out,"Cubic.easeOut":C.Easing.Cubic.Out,"Quart.easeOut":C.Easing.Quartic.Out,"Quint.easeOut":C.Easing.Quintic.Out,"Sine.easeOut":C.Easing.Sinusoidal.Out,"Expo.easeOut":C.Easing.Exponential.Out,"Circ.easeOut":C.Easing.Circular.Out,"Elastic.easeOut":C.Easing.Elastic.Out,"Back.easeOut":C.Easing.Back.Out,"Bounce.easeOut":C.Easing.Bounce.Out,"Quad.easeInOut":C.Easing.Quadratic.InOut,"Cubic.easeInOut":C.Easing.Cubic.InOut,"Quart.easeInOut":C.Easing.Quartic.InOut,"Quint.easeInOut":C.Easing.Quintic.InOut,"Sine.easeInOut":C.Easing.Sinusoidal.InOut,"Expo.easeInOut":C.Easing.Exponential.InOut,"Circ.easeInOut":C.Easing.Circular.InOut,"Elastic.easeInOut":C.Easing.Elastic.InOut,"Back.easeInOut":C.Easing.Back.InOut,"Bounce.easeInOut":C.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},C.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var M=0;M<this._tweens.length;M++)this._tweens[M].pendingDelete=!0;this._add=[]},removeFrom:function(M,O){void 0===O&&(O=!0);var U,W;if(Array.isArray(M))for(U=0,W=M.length;U<W;U++)this.removeFrom(M[U]);else if(M.type===C.GROUP&&O)for(var U=0,W=M.children.length;U<W;U++)this.removeFrom(M.children[U]);else{for(U=0,W=this._tweens.length;U<W;U++)M===this._tweens[U].target&&this.remove(this._tweens[U]);for(U=0,W=this._add.length;U<W;U++)M===this._add[U].target&&this.remove(this._add[U])}},add:function(M){M._manager=this,this._add.push(M)},create:function(M){return new C.Tween(M,this.game,this)},remove:function(M){var O=this._tweens.indexOf(M);-1===O?(O=this._add.indexOf(M),-1!=O&&(this._add[O].pendingDelete=!0)):this._tweens[O].pendingDelete=!0},update:function(){var M=this._add.length,O=this._tweens.length;if(0===O&&0===M)return!1;for(var U=0;U<O;)this._tweens[U].update(this.game.time.time)?U++:(this._tweens.splice(U,1),O--);return 0<M&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(M){return this._tweens.some(function(O){return O.target===M})},_pauseAll:function(){for(var M=this._tweens.length-1;0<=M;M--)this._tweens[M]._pause()},_resumeAll:function(){for(var M=this._tweens.length-1;0<=M;M--)this._tweens[M]._resume()},pauseAll:function(){for(var M=this._tweens.length-1;0<=M;M--)this._tweens[M].pause()},resumeAll:function(){for(var M=this._tweens.length-1;0<=M;M--)this._tweens[M].resume(!0)}},C.TweenManager.prototype.constructor=C.TweenManager,C.Tween=function(M,O,U){this.game=O,this.target=M,this.manager=U,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new C.Signal,this.onLoop=new C.Signal,this.onRepeat=new C.Signal,this.onChildComplete=new C.Signal,this.onComplete=new C.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=U.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},C.Tween.prototype={to:function(M,O,U,W,X,V,H){return((void 0===O||0>=O)&&(O=1e3),(void 0===U||null===U)&&(U=C.Easing.Default),void 0===W&&(W=!1),void 0===X&&(X=0),void 0===V&&(V=0),void 0===H&&(H=!1),"string"==typeof U&&this.manager.easeMap[U]&&(U=this.manager.easeMap[U]),this.isRunning)?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push(new C.TweenData(this).to(M,O,U,X,V,H)),W&&this.start(),this)},from:function(M,O,U,W,X,V,H){return(void 0===O&&(O=1e3),(void 0===U||null===U)&&(U=C.Easing.Default),void 0===W&&(W=!1),void 0===X&&(X=0),void 0===V&&(V=0),void 0===H&&(H=!1),"string"==typeof U&&this.manager.easeMap[U]&&(U=this.manager.easeMap[U]),this.isRunning)?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push(new C.TweenData(this).from(M,O,U,X,V,H)),W&&this.start(),this)},start:function(M){if(void 0===M&&(M=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var O=0;O<this.timeline.length;O++)for(var U in this.timeline[O].vEnd)this.properties[U]=this.target[U]||0,Array.isArray(this.properties[U])||(this.properties[U]*=1);for(var O=0;O<this.timeline.length;O++)this.timeline[O].loadValues();return this.manager.add(this),this.isRunning=!0,(0>M||M>this.timeline.length-1)&&(M=0),this.current=M,this.timeline[this.current].start(),this},stop:function(M){return void 0===M&&(M=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,M&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(M,O,U){if(0===this.timeline.length)return this;if(void 0===U&&(U=0),-1===U)for(var W=0;W<this.timeline.length;W++)this.timeline[W][M]=O;else this.timeline[U][M]=O;return this},delay:function(M,O){return this.updateTweenData("delay",M,O)},repeat:function(M,O,U){return void 0===O&&(O=0),this.updateTweenData("repeatCounter",M,U),this.updateTweenData("repeatDelay",O,U)},repeatDelay:function(M,O){return this.updateTweenData("repeatDelay",M,O)},yoyo:function(M,O,U){return void 0===O&&(O=0),this.updateTweenData("yoyo",M,U),this.updateTweenData("yoyoDelay",O,U)},yoyoDelay:function(M,O){return this.updateTweenData("yoyoDelay",M,O)},easing:function(M,O){return"string"==typeof M&&this.manager.easeMap[M]&&(M=this.manager.easeMap[M]),this.updateTweenData("easingFunction",M,O)},interpolation:function(M,O,U){return void 0===O&&(O=C.Math),this.updateTweenData("interpolationFunction",M,U),this.updateTweenData("interpolationContext",O,U)},repeatAll:function(M){return void 0===M&&(M=0),this.repeatCounter=M,this},chain:function(){for(var M=arguments.length;M--;)0<M?arguments[M-1].chainedTween=arguments[M]:this.chainedTween=arguments[M];return this},loop:function(M){return void 0===M&&(M=!0),this.repeatCounter=M?-1:0,this},onUpdateCallback:function(M,O){return this._onUpdateCallback=M,this._onUpdateCallbackContext=O,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var M=0;M<this.timeline.length;M++)this.timeline[M].isRunning||(this.timeline[M].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(M){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;var O=this.timeline[this.current].update(M);if(O===C.TweenData.PENDING)return!0;if(O===C.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(O===C.TweenData.LOOPED)return-1===this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(O===C.TweenData.COMPLETE){var U=!1;return this.reverse?(this.current--,0>this.current&&(this.current=this.timeline.length-1,U=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,U=!0)),U?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(M,O){if(null===this.game||null===this.target)return null;void 0===M&&(M=60),void 0===O&&(O=[]);for(var U=0;U<this.timeline.length;U++)for(var W in this.timeline[U].vEnd)this.properties[W]=this.target[W]||0,Array.isArray(this.properties[W])||(this.properties[W]*=1);for(var U=0;U<this.timeline.length;U++)this.timeline[U].loadValues();for(var U=0;U<this.timeline.length;U++)O=O.concat(this.timeline[U].generateData(M));return O}},Object.defineProperty(C.Tween.prototype,"totalDuration",{get:function(){for(var M=0,O=0;O<this.timeline.length;O++)M+=this.timeline[O].duration;return M}}),C.Tween.prototype.constructor=C.Tween,C.TweenData=function(M){this.parent=M,this.game=M.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=C.Easing.Default,this.interpolationFunction=C.Math.linearInterpolation,this.interpolationContext=C.Math,this.isRunning=!1,this.isFrom=!1},C.TweenData.PENDING=0,C.TweenData.RUNNING=1,C.TweenData.LOOPED=2,C.TweenData.COMPLETE=3,C.TweenData.prototype={to:function(M,O,U,W,X,V){return this.vEnd=M,this.duration=O,this.easingFunction=U,this.delay=W,this.repeatTotal=X,this.yoyo=V,this.isFrom=!1,this},from:function(M,O,U,W,X,V){return this.vEnd=M,this.duration=O,this.easingFunction=U,this.delay=W,this.repeatTotal=X,this.yoyo=V,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=!(0<this.delay),this.isFrom)for(var M in this.vStartCache)this.vStart[M]=this.vEndCache[M],this.vEnd[M]=this.vStartCache[M],this.parent.target[M]=this.vStart[M];return this.value=0,this.yoyoCounter=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var M in this.parent.properties){if(this.vStart[M]=this.parent.properties[M],Array.isArray(this.vEnd[M])){if(0===this.vEnd[M].length)continue;0===this.percent&&(this.vEnd[M]=[this.vStart[M]].concat(this.vEnd[M]))}"undefined"==typeof this.vEnd[M]?this.vEnd[M]=this.vStart[M]:("string"==typeof this.vEnd[M]&&(this.vEnd[M]=this.vStart[M]+parseFloat(this.vEnd[M],10)),this.parent.properties[M]=this.vEnd[M]),this.vStartCache[M]=this.vStart[M],this.vEndCache[M]=this.vEnd[M]}return this},update:function(M){if(!this.isRunning){if(M>=this.startTime)this.isRunning=!0;else return C.TweenData.PENDING;}else if(M<this.startTime)return C.TweenData.RUNNING;var O=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;for(var U in this.parent.reverse?(this.dt-=O*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=O*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),this.vEnd){var W=this.vStart[U],X=this.vEnd[U];this.parent.target[U]=Array.isArray(X)?this.interpolationFunction.call(this.interpolationContext,X,this.value):W+(X-W)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():C.TweenData.RUNNING},generateData:function(M){this.dt=this.parent.reverse?this.duration:0;var O=[],U=!1,W=1e3*(1/M);do{this.parent.reverse?(this.dt-=W,this.dt=Math.max(this.dt,0)):(this.dt+=W,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var X={};for(var V in this.vEnd){var H=this.vStart[V],Y=this.vEnd[V];X[V]=Array.isArray(Y)?this.interpolationFunction.call(this.interpolationContext,Y,this.value):H+(Y-H)*this.value}O.push(X),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(U=!0)}while(!U);if(this.yoyo){var z=O.slice();z.reverse(),O=O.concat(z)}return O},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var M in this.vStartCache)this.vStart[M]=this.vStartCache[M],this.vEnd[M]=this.vEndCache[M];return this.inReverse=!1,C.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return C.TweenData.COMPLETE;if(this.inReverse)for(var M in this.vStartCache)this.vStart[M]=this.vEndCache[M],this.vEnd[M]=this.vStartCache[M];else{for(var M in this.vStartCache)this.vStart[M]=this.vStartCache[M],this.vEnd[M]=this.vEndCache[M];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:!this.inReverse&&(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,C.TweenData.LOOPED}},C.TweenData.prototype.constructor=C.TweenData,C.Easing={Linear:{None:function(M){return M}},Quadratic:{In:function(M){return M*M},Out:function(M){return M*(2-M)},InOut:function(M){return 1>(M*=2)?0.5*M*M:-0.5*(--M*(M-2)-1)}},Cubic:{In:function(M){return M*M*M},Out:function(M){return--M*M*M+1},InOut:function(M){return 1>(M*=2)?0.5*M*M*M:0.5*((M-=2)*M*M+2)}},Quartic:{In:function(M){return M*M*M*M},Out:function(M){return 1- --M*M*M*M},InOut:function(M){return 1>(M*=2)?0.5*M*M*M*M:-0.5*((M-=2)*M*M*M-2)}},Quintic:{In:function(M){return M*M*M*M*M},Out:function(M){return--M*M*M*M*M+1},InOut:function(M){return 1>(M*=2)?0.5*M*M*M*M*M:0.5*((M-=2)*M*M*M*M+2)}},Sinusoidal:{In:function(M){return 0===M?0:1===M?1:1-Math.cos(M*Math.PI/2)},Out:function(M){return 0===M?0:1===M?1:Math.sin(M*Math.PI/2)},InOut:function(M){return 0===M?0:1===M?1:0.5*(1-Math.cos(Math.PI*M))}},Exponential:{In:function(M){return 0===M?0:Math.pow(1024,M-1)},Out:function(M){return 1===M?1:1-Math.pow(2,-10*M)},InOut:function(M){return 0===M?0:1===M?1:1>(M*=2)?0.5*Math.pow(1024,M-1):0.5*(-Math.pow(2,-10*(M-1))+2)}},Circular:{In:function(M){return 1-Math.sqrt(1-M*M)},Out:function(M){return Math.sqrt(1- --M*M)},InOut:function(M){return 1>(M*=2)?-0.5*(Math.sqrt(1-M*M)-1):0.5*(Math.sqrt(1-(M-=2)*M)+1)}},Elastic:{In:function(M){var U=0.1,W=0.4,O;return 0===M?0:1===M?1:(!U||1>U?(U=1,O=W/4):O=W*Math.asin(1/U)/(2*Math.PI),-(U*Math.pow(2,10*(M-=1))*Math.sin((M-O)*(2*Math.PI)/W)))},Out:function(M){var U=0.1,W=0.4,O;return 0===M?0:1===M?1:(!U||1>U?(U=1,O=W/4):O=W*Math.asin(1/U)/(2*Math.PI),U*Math.pow(2,-10*M)*Math.sin((M-O)*(2*Math.PI)/W)+1)},InOut:function(M){var U=0.1,W=0.4,O;return 0===M?0:1===M?1:(!U||1>U?(U=1,O=W/4):O=W*Math.asin(1/U)/(2*Math.PI),1>(M*=2)?-0.5*(U*Math.pow(2,10*(M-=1))*Math.sin((M-O)*(2*Math.PI)/W)):0.5*(U*Math.pow(2,-10*(M-=1))*Math.sin((M-O)*(2*Math.PI)/W))+1)}},Back:{In:function(M){var O=1.70158;return M*M*((O+1)*M-O)},Out:function(M){var O=1.70158;return--M*M*((O+1)*M+O)+1},InOut:function(M){var O=1.525*1.70158;return 1>(M*=2)?0.5*(M*M*((O+1)*M-O)):0.5*((M-=2)*M*((O+1)*M+O)+2)}},Bounce:{In:function(M){return 1-C.Easing.Bounce.Out(1-M)},Out:function(M){return M<1/2.75?7.5625*M*M:M<2/2.75?7.5625*(M-=1.5/2.75)*M+0.75:M<2.5/2.75?7.5625*(M-=2.25/2.75)*M+0.9375:7.5625*(M-=2.625/2.75)*M+0.984375},InOut:function(M){return 0.5>M?0.5*C.Easing.Bounce.In(2*M):0.5*C.Easing.Bounce.Out(2*M-1)+0.5}}},C.Easing.Default=C.Easing.Linear.None,C.Easing.Power0=C.Easing.Linear.None,C.Easing.Power1=C.Easing.Quadratic.Out,C.Easing.Power2=C.Easing.Cubic.Out,C.Easing.Power3=C.Easing.Quartic.Out,C.Easing.Power4=C.Easing.Quintic.Out,C.Time=function(M){this.game=M,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1e3*(1/60),this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new C.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},C.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(M){return this._timers.push(M),M},create:function(M){void 0===M&&(M=!0);var O=new C.Timer(this.game,M);return this._timers.push(O),O},removeAll:function(){for(var M=0;M<this._timers.length;M++)this._timers[M].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var M=this.time;this.time=Date.now(),this.elapsedMS=this.time-M},update:function(M){var O=this.time;this.time=Date.now(),this.elapsedMS=this.time-O,this.prevTime=this.now,this.now=M,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-M))),this.timeExpected=M+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var M=0,O=this._timers.length;M<O;)this._timers[M].update(this.time)?M++:(this._timers.splice(M,1),O--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var M=this._timers.length;M--;)this._timers[M]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var M=this._timers.length;M--;)this._timers[M]._resume()},totalElapsedSeconds:function(){return 1e-3*(this.time-this._started)},elapsedSince:function(M){return this.time-M},elapsedSecondsSince:function(M){return 1e-3*(this.time-M)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(C.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(M){this._desiredFps=M,this.physicsElapsed=1/M,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/M}}),C.Time.prototype.constructor=C.Time,C.Timer=function(M,O){void 0===O&&(O=!0),this.game=M,this.running=!1,this.autoDestroy=O,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new C.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},C.Timer.MINUTE=6e4,C.Timer.SECOND=1e3,C.Timer.HALF=500,C.Timer.QUARTER=250,C.Timer.prototype={create:function(M,O,U,W,X,V){M=Math.round(M);var H=M;H+=0===this._now?this.game.time.time:this._now;var Y=new C.TimerEvent(this,M,H,U,O,W,X,V);return this.events.push(Y),this.order(),this.expired=!1,Y},add:function(M,O,U){return this.create(M,!1,0,O,U,Array.prototype.slice.call(arguments,3))},repeat:function(M,O,U,W){return this.create(M,!1,O,U,W,Array.prototype.slice.call(arguments,4))},loop:function(M,O,U){return this.create(M,!0,0,O,U,Array.prototype.slice.call(arguments,3))},start:function(M){if(!this.running){this._started=this.game.time.time+(M||0),this.running=!0;for(var O=0;O<this.events.length;O++)this.events[O].tick=this.events[O].delay+this._started}},stop:function(M){this.running=!1,void 0===M&&(M=!0),M&&(this.events.length=0)},remove:function(M){for(var O=0;O<this.events.length;O++)if(this.events[O]===M)return this.events[O].pendingDelete=!0,!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(M,O){return M.tick<O.tick?-1:M.tick>O.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(M){if(this.paused)return!0;if(this.elapsed=M-this._now,this._now=M,this.elapsed>this.timeCap&&this.adjustEvents(M-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running;){var O=this.events[this._i];if(this._now>=O.tick&&!O.pendingDelete)this._newTick=this._now+O.delay-(this._now-O.tick),0>this._newTick&&(this._newTick=this._now+O.delay),!0===O.loop?(O.tick=this._newTick,O.callback.apply(O.callbackContext,O.args)):0<O.repeatCount?(O.repeatCount--,O.tick=this._newTick,O.callback.apply(O.callbackContext,O.args)):(this._marked++,O.pendingDelete=!0,O.callback.apply(O.callbackContext,O.args)),this._i++;else break}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){this.paused||!this.running||(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(M){for(var O=0;O<this.events.length;O++)if(!this.events[O].pendingDelete){var U=this.events[O].tick-M;0>U&&(U=0),this.events[O].tick=this._now+U}var W=this.nextTick-M;this.nextTick=0>W?this._now:this._now+W},resume:function(){if(this.paused){var M=this.game.time.time;this._pauseTotal+=M-this._now,this._now=M,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.expired=!0,this.events=[],this._len=0,this._i=0}},Object.defineProperty(C.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(C.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(C.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(C.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(C.Timer.prototype,"seconds",{get:function(){return this.running?1e-3*this.ms:0}}),C.Timer.prototype.constructor=C.Timer,C.TimerEvent=function(M,O,U,W,X,V,H,Y){this.timer=M,this.delay=O,this.tick=U,this.repeatCount=W-1,this.loop=X,this.callback=V,this.callbackContext=H,this.args=Y,this.pendingDelete=!1},C.TimerEvent.prototype.constructor=C.TimerEvent,C.AnimationManager=function(M){this.sprite=M,this.game=M.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},C.AnimationManager.prototype={loadFrameData:function(M,O){if(void 0===M)return!1;if(this.isLoaded)for(var U in this._anims)this._anims[U].updateFrameData(M);return this._frameData=M,void 0===O||null===O?this.frame=0:"string"==typeof O?this.frameName=O:this.frame=O,this.isLoaded=!0,!0},copyFrameData:function(M,O){if(this._frameData=M.clone(),this.isLoaded)for(var U in this._anims)this._anims[U].updateFrameData(this._frameData);return void 0===O||null===O?this.frame=0:"string"==typeof O?this.frameName=O:this.frame=O,this.isLoaded=!0,!0},add:function(M,O,U,W,X){return O=O||[],U=U||60,void 0===W&&(W=!1),void 0===X&&(O&&"number"==typeof O[0]?X=!0:X=!1),this._outputFrames=[],this._frameData.getFrameIndexes(O,X,this._outputFrames),this._anims[M]=new C.Animation(this.game,this.sprite,M,this._frameData,this._outputFrames,U,W),this.currentAnim=this._anims[M],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[M]},validateFrames:function(M,O){void 0===O&&(O=!0);for(var U=0;U<M.length;U++)if(!0===O){if(M[U]>this._frameData.total)return!1;}else if(!1===this._frameData.checkFrameName(M[U]))return!1;return!0},play:function(M,O,U,W){if(this._anims[M])return this.currentAnim===this._anims[M]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(O,U,W)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[M],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(O,U,W))},stop:function(M,O){void 0===O&&(O=!1),this.currentAnim&&("string"!=typeof M||M===this.currentAnim.name)&&this.currentAnim.stop(O)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()&&(this.currentFrame=this.currentAnim.currentFrame,!0)},next:function(M){this.currentAnim&&(this.currentAnim.next(M),this.currentFrame=this.currentAnim.currentFrame)},previous:function(M){this.currentAnim&&(this.currentAnim.previous(M),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(M){return"string"==typeof M&&this._anims[M]?this._anims[M]:null},refreshFrame:function(){},destroy:function(){var M=null;for(var M in this._anims)this._anims.hasOwnProperty(M)&&this._anims[M].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},C.AnimationManager.prototype.constructor=C.AnimationManager,Object.defineProperty(C.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(C.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(C.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(M){this.currentAnim.paused=M}}),Object.defineProperty(C.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(C.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(M){var O;"number"==typeof M&&this._frameData&&(O=this._frameData.getFrame(M))&&(this.currentFrame=O,this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(C.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(M){var O;"string"==typeof M&&this._frameData&&(O=this._frameData.getFrameByName(M))?(this.currentFrame=O,this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)):console.warn("Cannot set frameName: "+M)}}),C.Animation=function(M,O,U,W,X,V,H){void 0===H&&(H=!1),this.game=M,this._parent=O,this._frameData=W,this.name=U,this._frames=[],this._frames=this._frames.concat(X),this.delay=1e3/V,this.loop=H,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new C.Signal,this.onUpdate=null,this.onComplete=new C.Signal,this.onLoop=new C.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},C.Animation.prototype={play:function(M,O,U){return"number"==typeof M&&(this.delay=1e3/M),"boolean"==typeof O&&(this.loop=O),"undefined"!=typeof U&&(this.killOnComplete=U),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(M,O){var U;if(void 0===O&&(O=!1),"string"==typeof M)for(var W=0;W<this._frames.length;W++)this._frameData.getFrame(this._frames[W]).name===M&&(U=W);else if("number"==typeof M)if(O)U=M;else for(var W=0;W<this._frames.length;W++)this._frames[W]===M&&(U=W);if(U){var X=this.isReversed?-1:1;this._frameIndex=U-X,this._timeNextFrame=this.game.time.time,this.update()}},stop:function(M,O){void 0===M&&(M=!1),void 0===O&&(O=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,M&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),O&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&this.isPlaying&&this.game.time.time>=this._timeNextFrame&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay?(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay):this._frameDiff=0,this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&-1>=this._frameIndex?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(M,O){if(void 0===O&&(O=!1),!this._frameData)return!1;var U=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(O||!O&&U!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),this.onUpdate&&M?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0},next:function(M){void 0===M&&(M=1);var O=this._frameIndex+M;O>=this._frames.length&&(this.loop?O%=this._frames.length:O=this._frames.length-1),O!==this._frameIndex&&(this._frameIndex=O,this.updateCurrentFrame(!0))},previous:function(M){void 0===M&&(M=1);var O=this._frameIndex-M;0>O&&(this.loop?O=this._frames.length+O:O++),O!==this._frameIndex&&(this._frameIndex=O,this.updateCurrentFrame(!0))},updateFrameData:function(M){this._frameData=M,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},C.Animation.prototype.constructor=C.Animation,Object.defineProperty(C.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(M){this.isPaused=M,M?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(C.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(M){this.isReversed=M}}),Object.defineProperty(C.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(C.Animation.prototype,"frame",{get:function(){return null===this.currentFrame?this._frameIndex:this.currentFrame.index},set:function(M){this.currentFrame=this._frameData.getFrame(this._frames[M]),null!==this.currentFrame&&(this._frameIndex=M,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(C.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(M){0<M&&(this.delay=1e3/M)}}),Object.defineProperty(C.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(M){M&&null===this.onUpdate?this.onUpdate=new C.Signal:!M&&null!==this.onUpdate&&(this.onUpdate.dispose(),this.onUpdate=null)}}),C.Animation.generateFrameNames=function(M,O,U,W,X){void 0===W&&(W="");var V=[],H="";if(O<U)for(var Y=O;Y<=U;Y++)H="number"==typeof X?C.Utils.pad(Y.toString(),X,"0",1):Y.toString(),H=M+H+W,V.push(H);else for(var Y=O;Y>=U;Y--)H="number"==typeof X?C.Utils.pad(Y.toString(),X,"0",1):Y.toString(),H=M+H+W,V.push(H);return V},C.Frame=function(M,O,U,W,X,V){this.index=M,this.x=O,this.y=U,this.width=W,this.height=X,(0===this.width||0===this.height)&&console.warn("Phaser.Frame: Frame \""+this.name+"\" has a width or height of zero"),this.name=V,this.centerX=Math.floor(W/2),this.centerY=Math.floor(X/2),this.distance=C.Math.distance(0,0,W,X),this.rotated=!1,this.trimmed=!1,this.sourceSizeW=W,this.sourceSizeH=X,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},C.Frame.prototype={resize:function(M,O){this.width=M,this.height=O,this.centerX=Math.floor(M/2),this.centerY=Math.floor(O/2),this.distance=C.Math.distance(0,0,M,O),this.sourceSizeW=M,this.sourceSizeH=O,this.right=this.x+M,this.bottom=this.y+O},setTrim:function(M,O,U,W,X,V,H){this.trimmed=M,M&&(this.sourceSizeW=O,this.sourceSizeH=U,this.centerX=Math.floor(O/2),this.centerY=Math.floor(U/2),this.spriteSourceSizeX=W,this.spriteSourceSizeY=X,this.spriteSourceSizeW=V,this.spriteSourceSizeH=H)},clone:function(){var M=new C.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var O in this)this.hasOwnProperty(O)&&(M[O]=this[O]);return M},getRect:function(M){return void 0===M?M=new C.Rectangle(this.x,this.y,this.width,this.height):M.setTo(this.x,this.y,this.width,this.height),M}},C.Frame.prototype.constructor=C.Frame,C.FrameData=function(){this._frames=[],this._frameNames=[]},C.FrameData.prototype={addFrame:function(M){return M.index=this._frames.length,this._frames.push(M),""!==M.name&&(this._frameNames[M.name]=M.index),M},getFrame:function(M){return M>=this._frames.length&&(M=0),this._frames[M]},getFrameByName:function(M){return"number"==typeof this._frameNames[M]?this._frames[this._frameNames[M]]:null},checkFrameName:function(M){return null!=this._frameNames[M]},clone:function(){for(var M=new C.FrameData,O=0;O<this._frames.length;O++)M._frames.push(this._frames[O].clone());for(var U in this._frameNames)this._frameNames.hasOwnProperty(U)&&M._frameNames.push(this._frameNames[U]);return M},getFrameRange:function(M,O,U){void 0===U&&(U=[]);for(var W=M;W<=O;W++)U.push(this._frames[W]);return U},getFrames:function(M,O,U){if(void 0===O&&(O=!0),void 0===U&&(U=[]),void 0===M||0===M.length)for(var W=0;W<this._frames.length;W++)U.push(this._frames[W]);else for(var W=0;W<M.length;W++)O?U.push(this.getFrame(M[W])):U.push(this.getFrameByName(M[W]));return U},getFrameIndexes:function(M,O,U){if(void 0===O&&(O=!0),void 0===U&&(U=[]),void 0===M||0===M.length)for(var W=0;W<this._frames.length;W++)U.push(this._frames[W].index);else for(var W=0;W<M.length;W++)O&&this._frames[M[W]]?U.push(this._frames[M[W]].index):this.getFrameByName(M[W])&&U.push(this.getFrameByName(M[W]).index);return U},destroy:function(){this._frames=null,this._frameNames=null}},C.FrameData.prototype.constructor=C.FrameData,Object.defineProperty(C.FrameData.prototype,"total",{get:function(){return this._frames.length}}),C.AnimationParser={spriteSheet:function(M,O,U,W,X,V,H,Y){void 0===X&&(X=-1),void 0===V&&(V=0),void 0===H&&(H=0),void 0===Y&&(Y=0);var z=O;if("string"==typeof O&&(z=M.cache.getImage(O)),null===z)return null;var K=z.width,J=z.height;0>=U&&(U=Math.floor(-K/Math.min(-1,U))),0>=W&&(W=Math.floor(-J/Math.min(-1,W)));var Q=Math.floor((K-V)/(U+H)),Z=Math.floor((J-V)/(W+H)),$=Q*Z;if(Y>$||Y<-$)return console.warn("Phaser.AnimationParser.spriteSheet: skipFrames = "+Y.toString()+" is larger than total sprite number "+$.toString()),null;if(0>Y&&(Y=$+Y),-1!==X&&($=Y+X),0===K||0===J||K<U||J<W||0==$)return console.warn("Phaser.AnimationParser.spriteSheet: '"+O+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var ee=new C.FrameData,te=V,ae=V,oe=0;oe<$;oe++)ee.addFrame(new C.Frame(oe,te,ae,U,W,"")),te+=U+H,te+U>K&&(te=V,ae+=W+H);return ee},JSONData:function(M,O){if(!O.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(O);for(var U=new C.FrameData,W=O.frames,V=0,X;V<W.length;V++)X=U.addFrame(new C.Frame(V,W[V].frame.x,W[V].frame.y,W[V].frame.w,W[V].frame.h,W[V].filename)),W[V].trimmed&&X.setTrim(W[V].trimmed,W[V].sourceSize.w,W[V].sourceSize.h,W[V].spriteSourceSize.x,W[V].spriteSourceSize.y,W[V].spriteSourceSize.w,W[V].spriteSourceSize.h),W[V].rotated&&(X.rotated=!0);return U},JSONDataPyxel:function(M,O){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(K){if(!O[K])return console.warn("Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing \""+K+"\" key."),void console.log(O)}),1!==O.layers.length)return console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),void console.log(O);for(var W=new C.FrameData,X=O.tileheight,V=O.tilewidth,H=O.layers[0].tiles,z=0,Y;z<H.length;z++)Y=W.addFrame(new C.Frame(z,H[z].x,H[z].y,V,X,"frame_"+z)),Y.setTrim(!1);return W},JSONDataHash:function(M,O){if(!O.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(O);var U=new C.FrameData,W=O.frames,V=0,X;for(var H in W)X=U.addFrame(new C.Frame(V,W[H].frame.x,W[H].frame.y,W[H].frame.w,W[H].frame.h,H)),W[H].trimmed&&X.setTrim(W[H].trimmed,W[H].sourceSize.w,W[H].sourceSize.h,W[H].spriteSourceSize.x,W[H].spriteSourceSize.y,W[H].spriteSourceSize.w,W[H].spriteSourceSize.h),W[H].rotated&&(X.rotated=!0),V++;return U},XMLData:function(M,O){if(!O.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var U=new C.FrameData,W=O.getElementsByTagName("SubTexture"),te=0,X,V,H,Y,z,K,J,Q,Z,$,ee;te<W.length;te++)H=W[te].attributes,V=H.name.value,Y=parseInt(H.x.value,10),z=parseInt(H.y.value,10),K=parseInt(H.width.value,10),J=parseInt(H.height.value,10),Q=null,Z=null,H.frameX&&(Q=Math.abs(parseInt(H.frameX.value,10)),Z=Math.abs(parseInt(H.frameY.value,10)),$=parseInt(H.frameWidth.value,10),ee=parseInt(H.frameHeight.value,10)),X=U.addFrame(new C.Frame(te,Y,z,K,J,V)),(null!==Q||null!==Z)&&X.setTrim(!0,K,J,Q,Z,$,ee);return U}},C.Cache=function(M){this.game=M,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new C.Signal,this._cacheMap=[],this._cacheMap[C.Cache.CANVAS]=this._cache.canvas,this._cacheMap[C.Cache.IMAGE]=this._cache.image,this._cacheMap[C.Cache.TEXTURE]=this._cache.texture,this._cacheMap[C.Cache.SOUND]=this._cache.sound,this._cacheMap[C.Cache.TEXT]=this._cache.text,this._cacheMap[C.Cache.PHYSICS]=this._cache.physics,this._cacheMap[C.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[C.Cache.BINARY]=this._cache.binary,this._cacheMap[C.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[C.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[C.Cache.JSON]=this._cache.json,this._cacheMap[C.Cache.XML]=this._cache.xml,this._cacheMap[C.Cache.VIDEO]=this._cache.video,this._cacheMap[C.Cache.SHADER]=this._cache.shader,this._cacheMap[C.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this._pendingCount=0,this.onReady=new C.Signal,this._addImages()},C.Cache.CANVAS=1,C.Cache.IMAGE=2,C.Cache.TEXTURE=3,C.Cache.SOUND=4,C.Cache.TEXT=5,C.Cache.PHYSICS=6,C.Cache.TILEMAP=7,C.Cache.BINARY=8,C.Cache.BITMAPDATA=9,C.Cache.BITMAPFONT=10,C.Cache.JSON=11,C.Cache.XML=12,C.Cache.VIDEO=13,C.Cache.SHADER=14,C.Cache.RENDER_TEXTURE=15,C.Cache.DEFAULT=null,C.Cache.DEFAULT_KEY="__default",C.Cache.DEFAULT_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",C.Cache.MISSING=null,C.Cache.MISSING_KEY="__missing",C.Cache.MISSING_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",C.Cache.READY_TIMEOUT=1e3,C.Cache.prototype={addCompressedTextureMetaData:function(M,O,U,W){this.checkImageKey(M)&&this.removeImage(M);var X=U in C.LoaderParser?C.LoaderParser[U](W):W,V={key:M,url:O,data:X,base:new PIXI.BaseTexture(X,null,this.game.resolution),frame:new C.Frame(0,0,0,X.width,X.height,M),frameData:new C.FrameData,fileFormat:U};return V.frameData.addFrame(new C.Frame(0,0,0,X.width,X.height,O)),this._cache.image[M]=V,this._resolveURL(O,V),V},addCanvas:function(M,O,U){void 0===U&&(U=O.getContext("2d")),this._cache.canvas[M]={canvas:O,context:U}},addImage:function(M,O,U){this.checkImageKey(M)&&this.removeImage(M),!1===U.complete&&console.warn("Phaser.Cache.addImage: Image \""+M+"\" hasn't been retrieved yet");var W={key:M,url:O,data:U,base:new PIXI.BaseTexture(U,null,this.game.resolution),frame:new C.Frame(0,0,0,U.width,U.height,M),frameData:new C.FrameData};return W.frameData.addFrame(new C.Frame(0,0,0,U.width,U.height,O)),this._cache.image[M]=W,this._resolveURL(O,W),"__default"===M?C.Cache.DEFAULT=new PIXI.Texture(W.base):"__missing"==M&&(C.Cache.MISSING=new PIXI.Texture(W.base)),W},addImageAsync:function(M,O,U){var W=this,X=new Image;X.onload=function(){U.call(this,W.addImage(M,null,X)),W._removePending(),X.onload=null},this._addPending(),X.src=O},addDefaultImage:function(){this.addImageAsync(C.Cache.DEFAULT_KEY,C.Cache.DEFAULT_SRC,function(M){M.base.skipRender=!0,C.Cache.DEFAULT=new PIXI.Texture(M.base)})},addMissingImage:function(){this.addImageAsync(C.Cache.MISSING_KEY,C.Cache.MISSING_SRC,function(M){C.Cache.MISSING=new PIXI.Texture(M.base)})},addSound:function(M,O,U,W,X){void 0===W&&(W=!0,X=!1),void 0===X&&(W=!1,X=!0);var V=!1;X&&(V=!0),this._cache.sound[M]={url:O,data:U,isDecoding:!1,decoded:V,webAudio:W,audioTag:X,locked:this.game.sound.touchLocked},this._resolveURL(O,this._cache.sound[M])},addText:function(M,O,U){this._cache.text[M]={url:O,data:U},this._resolveURL(O,this._cache.text[M])},addPhysicsData:function(M,O,U,W){this._cache.physics[M]={url:O,data:U,format:W},this._resolveURL(O,this._cache.physics[M])},addTilemap:function(M,O,U,W){this._cache.tilemap[M]={url:O,data:U,format:W},this._resolveURL(O,this._cache.tilemap[M])},addBinary:function(M,O){this._cache.binary[M]=O},addBitmapData:function(M,O,U){return O.key=M,void 0===U&&(U=new C.FrameData,U.addFrame(O.textureFrame)),this._cache.bitmapData[M]={data:O,frameData:U},O},addBitmapFont:function(M,O,U,W,X,V,H){var Y={url:O,data:U,font:null,base:new PIXI.BaseTexture(U,null,this.game.resolution)};void 0===V&&(V=0),void 0===H&&(H=0),Y.font="json"===X?C.LoaderParser.jsonBitmapFont(W,Y.base,V,H,!1,this.game.resolution):C.LoaderParser.xmlBitmapFont(W,Y.base,V,H,!1,this.game.resolution),this._cache.bitmapFont[M]=Y,this._resolveURL(O,Y)},addBitmapFontFromAtlas:function(M,O,U,W,X,V,H){var Y=this.getFrameByName(O,U);if(Y){var z={font:null,base:this.getBaseTexture(O),frame:Y};void 0===V&&(V=0),void 0===H&&(H=0);var K;"json"===X?(K=this.getJSON(W),z.font=C.LoaderParser.jsonBitmapFont(K,z.base,V,H,Y,this.game.resolution)):(K=this.getXML(W),z.font=C.LoaderParser.xmlBitmapFont(K,z.base,V,H,Y,this.game.resolution)),this._cache.bitmapFont[M]=z}},addJSON:function(M,O,U){this._cache.json[M]={url:O,data:U},this._resolveURL(O,this._cache.json[M])},addXML:function(M,O,U){this._cache.xml[M]={url:O,data:U},this._resolveURL(O,this._cache.xml[M])},addVideo:function(M,O,U,W){this._cache.video[M]={url:O,data:U,isBlob:W,locked:!0},this._resolveURL(O,this._cache.video[M])},addShader:function(M,O,U){this._cache.shader[M]={url:O,data:U},this._resolveURL(O,this._cache.shader[M])},addRenderTexture:function(M,O){this._cache.renderTexture[M]={texture:O,frame:new C.Frame(0,0,0,O.width,O.height,"","")}},addSpriteSheet:function(M,O,U,W,X,V,H,Y,z){void 0===V&&(V=-1),void 0===H&&(H=0),void 0===Y&&(Y=0);var K={key:M,url:O,data:U,frameWidth:W,frameHeight:X,margin:H,spacing:Y,base:new PIXI.BaseTexture(U,null,this.game.resolution),frameData:C.AnimationParser.spriteSheet(this.game,U,W,X,V,H,Y,z)};this._cache.image[M]=K,this._resolveURL(O,K)},addTextureAtlas:function(M,O,U,W,X){var V={key:M,url:O,data:U,base:new PIXI.BaseTexture(U,null,this.game.resolution)};V.frameData=X===C.Loader.TEXTURE_ATLAS_XML_STARLING?C.AnimationParser.XMLData(this.game,W,M):X===C.Loader.TEXTURE_ATLAS_JSON_PYXEL?C.AnimationParser.JSONDataPyxel(this.game,W,M):Array.isArray(W.frames)?C.AnimationParser.JSONData(this.game,W,M):C.AnimationParser.JSONDataHash(this.game,W,M),this._cache.image[M]=V,this._resolveURL(O,V)},reloadSound:function(M){var O=this,U=this.getSound(M);U&&(U.data.src=U.url,U.data.addEventListener("canplaythrough",function(){return O.reloadSoundComplete(M)},!1),U.data.load())},reloadSoundComplete:function(M){var O=this.getSound(M);O&&(O.locked=!1,this.onSoundUnlock.dispatch(M))},updateSound:function(M,O,U){var W=this.getSound(M);W&&(W[O]=U)},decodedSound:function(M,O){var U=this.getSound(M);U.data=O,U.decoded=!0,U.isDecoding=!1},isSoundDecoded:function(M){var O=this.getItem(M,C.Cache.SOUND,"isSoundDecoded");if(O)return O.decoded},isSoundReady:function(M){var O=this.getItem(M,C.Cache.SOUND,"isSoundDecoded");if(O)return O.decoded&&!this.game.sound.touchLocked},checkKey:function(M,O){return!!this._cacheMap[M][O]},checkURL:function(M){return!!this._urlMap[this._resolveURL(M)]},checkCanvasKey:function(M){return this.checkKey(C.Cache.CANVAS,M)},checkImageKey:function(M){return this.checkKey(C.Cache.IMAGE,M)},checkTextureKey:function(M){return this.checkKey(C.Cache.TEXTURE,M)},checkSoundKey:function(M){return this.checkKey(C.Cache.SOUND,M)},checkTextKey:function(M){return this.checkKey(C.Cache.TEXT,M)},checkPhysicsKey:function(M){return this.checkKey(C.Cache.PHYSICS,M)},checkTilemapKey:function(M){return this.checkKey(C.Cache.TILEMAP,M)},checkBinaryKey:function(M){return this.checkKey(C.Cache.BINARY,M)},checkBitmapDataKey:function(M){return this.checkKey(C.Cache.BITMAPDATA,M)},checkBitmapFontKey:function(M){return this.checkKey(C.Cache.BITMAPFONT,M)},checkJSONKey:function(M){return this.checkKey(C.Cache.JSON,M)},checkXMLKey:function(M){return this.checkKey(C.Cache.XML,M)},checkVideoKey:function(M){return this.checkKey(C.Cache.VIDEO,M)},checkShaderKey:function(M){return this.checkKey(C.Cache.SHADER,M)},checkRenderTextureKey:function(M){return this.checkKey(C.Cache.RENDER_TEXTURE,M)},getItem:function(M,O,U,W){if(!this.checkKey(O,M))U&&console.warn("Phaser.Cache."+U+": Key \""+M+"\" not found in Cache.");else return void 0===W?this._cacheMap[O][M]:this._cacheMap[O][M][W];return null},getCanvas:function(M){return this.getItem(M,C.Cache.CANVAS,"getCanvas","canvas")},getImage:function(M,O){(void 0===M||null===M)&&(M="__default"),void 0===O&&(O=!1);var U=this.getItem(M,C.Cache.IMAGE,"getImage");return null===U&&(U=this.getItem("__missing",C.Cache.IMAGE,"getImage")),O?U:U.data},getTextureFrame:function(M){return this.getItem(M,C.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(M){return this.getItem(M,C.Cache.SOUND,"getSound")},getSoundData:function(M){return this.getItem(M,C.Cache.SOUND,"getSoundData","data")},getText:function(M){return this.getItem(M,C.Cache.TEXT,"getText","data")},getPhysicsData:function(M,O,U){var W=this.getItem(M,C.Cache.PHYSICS,"getPhysicsData","data");if(null===W||void 0===O||null===O)return W;if(W[O]){var X=W[O];if(X&&U){for(var V in X)if(V=X[V],V.fixtureKey===U)return V;console.warn("Phaser.Cache.getPhysicsData: Could not find given fixtureKey: \""+U+" in "+M+"\"")}else return X}else console.warn("Phaser.Cache.getPhysicsData: Invalid key/object: \""+M+" / "+O+"\"");return null},getTilemapData:function(M){return this.getItem(M,C.Cache.TILEMAP,"getTilemapData")},getBinary:function(M){return this.getItem(M,C.Cache.BINARY,"getBinary")},getBitmapData:function(M){return this.getItem(M,C.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(M){return this.getItem(M,C.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(M,O){var U=this.getItem(M,C.Cache.JSON,"getJSON","data");return U?O?C.Utils.extend(!0,Array.isArray(U)?[]:{},U):U:null},getXML:function(M){return this.getItem(M,C.Cache.XML,"getXML","data")},getVideo:function(M){return this.getItem(M,C.Cache.VIDEO,"getVideo")},getShader:function(M){return this.getItem(M,C.Cache.SHADER,"getShader","data")},getRenderTexture:function(M){return this.getItem(M,C.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(M,O){return void 0===O&&(O=C.Cache.IMAGE),this.getItem(M,O,"getBaseTexture","base")},getFrame:function(M,O){return void 0===O&&(O=C.Cache.IMAGE),this.getItem(M,O,"getFrame","frame")},getFrameCount:function(M,O){var U=this.getFrameData(M,O);return U?U.total:0},getFrameData:function(M,O){return void 0===O&&(O=C.Cache.IMAGE),this.getItem(M,O,"getFrameData","frameData")},hasFrameData:function(M,O){return void 0===O&&(O=C.Cache.IMAGE),null!==this.getItem(M,O,"","frameData")},updateFrameData:function(M,O,U){void 0===U&&(U=C.Cache.IMAGE),this._cacheMap[U][M]&&(this._cacheMap[U][M].frameData=O)},getFrameByIndex:function(M,O,U){var W=this.getFrameData(M,U);return W?W.getFrame(O):null},getFrameByName:function(M,O,U){var W=this.getFrameData(M,U);return W?W.getFrameByName(O):null},getURL:function(M){var M=this._resolveURL(M);return M?this._urlMap[M]:(console.warn("Phaser.Cache.getUrl: Invalid url: \""+M+"\" or Cache.autoResolveURL was false"),null)},getKeys:function(M){void 0===M&&(M=C.Cache.IMAGE);var O=[];if(this._cacheMap[M])for(var U in this._cacheMap[M])"__default"!==U&&"__missing"!==U&&O.push(U);return O},removeCanvas:function(M){delete this._cache.canvas[M]},removeImage:function(M,O){void 0===O&&(O=!0);var U=this.getImage(M,!0);O&&U.base&&U.base.destroy(),delete this._cache.image[M]},removeSound:function(M){delete this._cache.sound[M]},removeText:function(M){delete this._cache.text[M]},removePhysics:function(M){delete this._cache.physics[M]},removeTilemap:function(M){delete this._cache.tilemap[M]},removeBinary:function(M){delete this._cache.binary[M]},removeBitmapData:function(M){delete this._cache.bitmapData[M]},removeBitmapFont:function(M){delete this._cache.bitmapFont[M]},removeJSON:function(M){delete this._cache.json[M]},removeXML:function(M){delete this._cache.xml[M]},removeVideo:function(M){delete this._cache.video[M]},removeShader:function(M){delete this._cache.shader[M]},removeRenderTexture:function(M){delete this._cache.renderTexture[M]},removeSpriteSheet:function(M){delete this._cache.spriteSheet[M]},removeTextureAtlas:function(M){delete this._cache.image[M]},clearGLTextures:function(){for(var M in this._cache.image)this._cache.image[M].base._glTextures=[]},_resolveURL:function(M,O){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+M,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",O&&(this._urlMap[this._urlTemp]=O),this._urlTemp):null},destroy:function(){for(var M=0,O;M<this._cacheMap.length;M++)for(var U in O=this._cacheMap[M],O)"__default"!==U&&"__missing"!==U&&(this.destroyItem(O[U]),delete O[U]);this._urlMap=null,this._urlResolver=null,this._urlTemp=null},destroyItem:function(M){M.destroy?M.destroy():(M.base&&M.base.destroy&&M.base.destroy(),M.data&&M.data.destroy&&M.data.destroy(),M.frameData&&M.frameData.destroy&&M.frameData.destroy(),M.texture&&M.texture.destroy&&M.texture.destroy(!0))},_addImages:function(){this._pendingCount=0,this.addDefaultImage(),this.addMissingImage();var M=this,O=C.Cache.READY_TIMEOUT;0<C.Cache.READY_TIMEOUT?setTimeout(function(){M.isReady||(console.warn("Phaser.Cache: Still waiting for images after %s ms.",O),M._ready())},C.Cache.READY_TIMEOUT):this._ready()},_addPending:function(){this._pendingCount+=1},_removePending:function(){this._pendingCount-=1,this._checkReady()},_checkReady:function(){this.isReady&&this._ready()},_ready:function(){this._pendingCount=0,this.onReady.dispatch(this)}},C.Cache.prototype.constructor=C.Cache,Object.defineProperty(C.Cache.prototype,"isReady",{get:function(){return 0>=this._pendingCount}}),C.Loader=function(M){this.game=M,this.cache=M.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new C.Signal,this.onLoadComplete=new C.Signal,this.onPackComplete=new C.Signal,this.onFileStart=new C.Signal,this.onFileComplete=new C.Signal,this.onFileError=new C.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},C.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,C.Loader.TEXTURE_ATLAS_JSON_HASH=1,C.Loader.TEXTURE_ATLAS_XML_STARLING=2,C.Loader.PHYSICS_LIME_CORONA_JSON=3,C.Loader.PHYSICS_PHASER_JSON=4,C.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,C.Loader.prototype={setPreloadSprite:function(M,O){O=O||0,this.preloadSprite={sprite:M,direction:O,width:M.width,height:M.height,rect:null},this.preloadSprite.rect=0===O?new C.Rectangle(0,0,1,M.height):new C.Rectangle(0,0,M.width,1),M.crop(this.preloadSprite.rect),M.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(M,O){return-1<this.getAssetIndex(M,O)},getAssetIndex:function(M,O){for(var U=-1,W=0,X;W<this._fileList.length&&(X=this._fileList[W],!(X.type===M&&X.key===O&&(U=W,!X.loaded&&!X.loading)));W++);return U},getAsset:function(M,O){var U=this.getAssetIndex(M,O);return!!(-1<U)&&{index:U,file:this._fileList[U]}},reset:function(M,O){void 0===O&&(O=!1),this.resetLocked||(M&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,O&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(M,O,U,W,X,V){if(void 0===X&&(X=!1),void 0===O||""===O)return console.warn("Phaser.Loader: Invalid or no key given of type "+M),this;if(void 0===U||null===U)if(V)U=O+V;else return console.warn("Phaser.Loader: No URL given for file type: "+M+" key: "+O),this;var H={type:M,key:O,path:this.path,url:U,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(W)for(var Y in W)H[Y]=W[Y];var z=this.getAssetIndex(M,O);if(X&&-1<z){var K=this._fileList[z];K.loading||K.loaded?(this._fileList.push(H),this._totalFileCount++):this._fileList[z]=H}else-1===z&&(this._fileList.push(H),this._totalFileCount++);return this},replaceInFileList:function(M,O,U,W){return this.addToFileList(M,O,U,W,!0)},pack:function(M,O,U,W){if(void 0===O&&(O=null),void 0===U&&(U=null),void 0===W&&(W=null),!O&&!U)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var X={type:"packfile",key:M,url:O,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:W};U&&("string"==typeof U&&(U=JSON.parse(U)),X.data=U||{},X.loaded=!0);for(var V=0,H;V<this._fileList.length+1;V++)if(H=this._fileList[V],!H||!H.loaded&&!H.loading&&"packfile"!==H.type){this._fileList.splice(V,0,X),this._totalPackCount++;break}return this},image:function(M,O,U){return"object"==typeof O?this.texture(M,O,U):this.addToFileList("image",M,O,void 0,U,".png")},imageFromBitmapData:function(M,O,U){return this.image(M,O.canvas.toDataURL("image/png"),U)},texture:function(M,O,U){if(this.game.renderType===C.WEBGL){var W=this.game.renderer.extensions.compression,X;for(X in O)if(X.toUpperCase()in W)return this.addToFileList("texture",M,O[X],void 0,U,".pvr")}return O.truecolor&&this.addToFileList("image",M,O.truecolor,void 0,U,".png"),this},images:function(M,O){if(Array.isArray(O))for(var U=0;U<M.length;U++)this.image(M[U],O[U]);else for(var U=0;U<M.length;U++)this.image(M[U]);return this},text:function(M,O,U){return this.addToFileList("text",M,O,void 0,U,".txt")},json:function(M,O,U){return this.addToFileList("json",M,O,void 0,U,".json")},shader:function(M,O,U){return this.addToFileList("shader",M,O,void 0,U,".frag")},xml:function(M,O,U){return this.addToFileList("xml",M,O,void 0,U,".xml")},script:function(M,O,U,W){return void 0===U&&(U=!1),!1!==U&&void 0===W&&(W=this),this.addToFileList("script",M,O,{syncPoint:!0,callback:U,callbackContext:W},!1,".js")},binary:function(M,O,U,W){return void 0===U&&(U=!1),!1!==U&&void 0===W&&(W=U),this.addToFileList("binary",M,O,{callback:U,callbackContext:W},!1,".bin")},spritesheet:function(M,O,U,W,X,V,H,Y){return void 0===X&&(X=-1),void 0===V&&(V=0),void 0===H&&(H=0),void 0===Y&&(Y=0),this.addToFileList("spritesheet",M,O,{frameWidth:U,frameHeight:W,frameMax:X,margin:V,spacing:H,skipFrames:Y},!1,".png")},audio:function(M,O,U){return this.game.sound.noAudio?this:(void 0===U&&(U=!0),"string"==typeof O&&(O=[O]),this.addToFileList("audio",M,O,{buffer:null,autoDecode:U}))},audioSprite:function(M,O,U,W,X){return this.game.sound.noAudio?this:(void 0===U&&(U=null),void 0===W&&(W=null),void 0===X&&(X=!0),this.audio(M,O,X),U?this.json(M+"-audioatlas",U):W?("string"==typeof W&&(W=JSON.parse(W)),this.cache.addJSON(M+"-audioatlas","",W)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this)},audiosprite:function(M,O,U,W,X){return this.audioSprite(M,O,U,W,X)},video:function(M,O,U,W){return void 0===U&&(this.game.device.firefox?U="loadeddata":U="canplaythrough"),void 0===W&&(W=!1),"string"==typeof O&&(O=[O]),this.addToFileList("video",M,O,{buffer:null,asBlob:W,loadEvent:U})},tilemap:function(M,O,U,W){if(void 0===O&&(O=null),void 0===U&&(U=null),void 0===W&&(W=C.Tilemap.CSV),O||U||(W===C.Tilemap.CSV?O=M+".csv":O=M+".json"),U){switch(W){case C.Tilemap.CSV:break;case C.Tilemap.TILED_JSON:"string"==typeof U&&(U=JSON.parse(U));}this.cache.addTilemap(M,null,U,W)}else this.addToFileList("tilemap",M,O,{format:W});return this},physics:function(M,O,U,W){return void 0===O&&(O=null),void 0===U&&(U=null),void 0===W&&(W=C.Physics.LIME_CORONA_JSON),O||U||(O=M+".json"),U?("string"==typeof U&&(U=JSON.parse(U)),this.cache.addPhysicsData(M,null,U,W)):this.addToFileList("physics",M,O,{format:W}),this},bitmapFont:function(M,O,U,W,X,V){if((void 0===O||null===O)&&(O=M+".png"),void 0===U&&(U=null),void 0===W&&(W=null),null===U&&null===W&&(U=M+".xml"),void 0===X&&(X=0),void 0===V&&(V=0),U)this.addToFileList("bitmapfont",M,O,{atlasURL:U,xSpacing:X,ySpacing:V});else if("string"==typeof W){var H,Y;try{H=JSON.parse(W)}catch(z){Y=this.parseXml(W)}if(!Y&&!H)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",M,O,{atlasURL:null,atlasData:H||Y,atlasType:H?"json":"xml",xSpacing:X,ySpacing:V})}return this},atlasJSONArray:function(M,O,U,W){return this.atlas(M,O,U,W,C.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(M,O,U,W){return this.atlas(M,O,U,W,C.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(M,O,U,W){return void 0===U&&(U=null),void 0===W&&(W=null),U||W||(U=M+".xml"),this.atlas(M,O,U,W,C.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(M,O,U,W,X){if((void 0===O||null===O)&&(O=M+".png"),void 0===U&&(U=null),void 0===W&&(W=null),void 0===X&&(X=C.Loader.TEXTURE_ATLAS_JSON_ARRAY),U||W||(X===C.Loader.TEXTURE_ATLAS_XML_STARLING?U=M+".xml":U=M+".json"),U)this.addToFileList("textureatlas",M,O,{atlasURL:U,format:X});else{switch(X){case C.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof W&&(W=JSON.parse(W));break;case C.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof W){var V=this.parseXml(W);if(!V)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");W=V}}this.addToFileList("textureatlas",M,O,{atlasURL:null,atlasData:W,format:X})}return this},withSyncPoint:function(M,O){this._withSyncPointDepth++;try{M.call(O||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(M,O){var U=this.getAsset(M,O);return U&&(U.file.syncPoint=!0),this},removeFile:function(M,O){var U=this.getAsset(M,O);!U||U.loaded||U.loading||this._fileList.splice(U.index,1)},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var M=0,O;M<this._flightQueue.length;M++)O=this._flightQueue[M],(O.loaded||O.error)&&(this._flightQueue.splice(M,1),M--,O.loading=!1,O.requestUrl=null,O.requestObject=null,O.error&&this.onFileError.dispatch(O.key,O),"packfile"===O.type?"packfile"===O.type&&O.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(O.key,!O.error,this._loadedPackCount,this._totalPackCount)):(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,O.key,!O.error,this._loadedFileCount,this._totalFileCount)));for(var U=!1,W=this.enableParallel?Math.max(1,this.maxParallelDownloads):1,M=this._processingHead,O;M<this._fileList.length&&(O=this._fileList[M],"packfile"===O.type&&!O.error&&O.loaded&&M===this._processingHead&&(this.processPack(O),this._loadedPackCount++,this.onPackComplete.dispatch(O.key,!O.error,this._loadedPackCount,this._totalPackCount)),O.loaded||O.error?M===this._processingHead&&(this._processingHead=M+1):!O.loading&&this._flightQueue.length<W&&("packfile"!==O.type||O.data?!U&&(!this._fileLoadStarted&&(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(O),O.loading=!0,this.onFileStart.dispatch(this.progress,O.key,O.url),this.loadFile(O)):(this._flightQueue.push(O),O.loading=!0,this.loadFile(O))),!O.loaded&&O.syncPoint&&(U=!0),!(this._flightQueue.length>=W||U&&this._loadedPackCount===this._totalPackCount));M++);if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var X=this;setTimeout(function(){X.finishedLoading(!0)},2e3)}},finishedLoading:function(M){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,!M&&!this._fileLoadStarted&&(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.reset(),this.onLoadComplete.dispatch(),this.game.state.loadComplete())},asyncComplete:function(M,O){void 0===O&&(O=""),M.loaded=!0,M.error=!!O,O&&(M.errorMessage=O,console.warn("Phaser.Loader - "+M.type+"["+M.key+"]: "+O)),this.processLoadQueue()},processPack:function(M){var O=M.data[M.key];if(!O)return void console.warn("Phaser.Loader - "+M.key+": pack has data, but not for pack key");for(var U=0,W;U<O.length;U++)switch(W=O[U],W.type){case"image":this.image(W.key,W.url,W.overwrite);break;case"text":this.text(W.key,W.url,W.overwrite);break;case"json":this.json(W.key,W.url,W.overwrite);break;case"xml":this.xml(W.key,W.url,W.overwrite);break;case"script":this.script(W.key,W.url,W.callback,M.callbackContext||this);break;case"binary":this.binary(W.key,W.url,W.callback,M.callbackContext||this);break;case"spritesheet":this.spritesheet(W.key,W.url,W.frameWidth,W.frameHeight,W.frameMax,W.margin,W.spacing,W.skipFrames);break;case"video":this.video(W.key,W.urls);break;case"audio":this.audio(W.key,W.urls,W.autoDecode);break;case"audiosprite":this.audiosprite(W.key,W.urls,W.jsonURL,W.jsonData,W.autoDecode);break;case"tilemap":this.tilemap(W.key,W.url,W.data,C.Tilemap[W.format]);break;case"physics":this.physics(W.key,W.url,W.data,C.Loader[W.format]);break;case"bitmapFont":this.bitmapFont(W.key,W.textureURL,W.atlasURL,W.atlasData,W.xSpacing,W.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(W.key,W.textureURL,W.atlasURL,W.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(W.key,W.textureURL,W.atlasURL,W.atlasData);break;case"atlasXML":this.atlasXML(W.key,W.textureURL,W.atlasURL,W.atlasData);break;case"atlas":this.atlas(W.key,W.textureURL,W.atlasURL,W.atlasData,C.Loader[W.format]);break;case"shader":this.shader(W.key,W.url,W.overwrite);}},transformUrl:function(M,O){return!!M&&(M.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?M:this.baseURL+O.path+M)},loadFile:function(M){switch(M.type){case"packfile":this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(M);break;case"audio":M.url=this.getAudioURL(M.url),M.url?this.game.sound.usingWebAudio?this.xhrLoad(M,this.transformUrl(M.url,M),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(M):this.fileError(M,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":M.url=this.getVideoURL(M.url),M.url?M.asBlob?this.xhrLoad(M,this.transformUrl(M.url,M),"blob",this.fileComplete):this.loadVideoTag(M):this.fileError(M,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.xmlLoadComplete);break;case"tilemap":M.format===C.Tilemap.TILED_JSON?this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.jsonLoadComplete):M.format===C.Tilemap.CSV?this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.csvLoadComplete):this.asyncComplete(M,"invalid Tilemap format: "+M.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(M,this.transformUrl(M.url,M),"text",this.fileComplete);break;case"texture":"truecolor"===M.key.split("_").pop()?this.loadImageTag(M):this.xhrLoad(M,this.transformUrl(M.url,M),"arraybuffer",this.fileComplete);break;case"binary":this.xhrLoad(M,this.transformUrl(M.url,M),"arraybuffer",this.fileComplete);}},loadImageTag:function(M){var O=this;M.data=new Image,M.data.name=M.key,this.crossOrigin&&(M.data.crossOrigin=this.crossOrigin),M.data.onload=function(){M.data.onload&&(M.data.onload=null,M.data.onerror=null,O.fileComplete(M))},M.data.onerror=function(){M.data.onload&&(M.data.onload=null,M.data.onerror=null,O.fileError(M))},M.data.src=this.transformUrl(M.url,M),!this.game.device.firefox&&M.data.complete&&M.data.width&&M.data.height&&(M.data.onload=null,M.data.onerror=null,this.fileComplete(M))},loadVideoTag:function(M){var O=this;M.data=document.createElement("video"),M.data.name=M.key,M.data.controls=!1,M.data.autoplay=!1;var U=function(){M.data.removeEventListener(M.loadEvent,U,!1),M.data.onerror=null,M.data.canplay=!0,C.GAMES[O.game.id].load.fileComplete(M)};M.data.onerror=function(){M.data.removeEventListener(M.loadEvent,U,!1),M.data.onerror=null,M.data.canplay=!1,O.fileError(M)},M.data.addEventListener(M.loadEvent,U,!1),M.data.src=this.transformUrl(M.url,M),M.data.load()},loadAudioTag:function(M){var O=this;if(this.game.sound.touchLocked)M.data=new Audio,M.data.name=M.key,M.data.preload="auto",M.data.src=this.transformUrl(M.url,M),this.fileComplete(M);else{M.data=new Audio,M.data.name=M.key;var U=function(){M.data.removeEventListener("canplaythrough",U,!1),M.data.onerror=null,O.fileComplete(M)};M.data.onerror=function(){M.data.removeEventListener("canplaythrough",U,!1),M.data.onerror=null,O.fileError(M)},M.data.preload="auto",M.data.src=this.transformUrl(M.url,M),M.data.addEventListener("canplaythrough",U,!1),M.data.load()}},xhrLoad:function(M,O,U,W,X){if(this.useXDomainRequest&&window.XDomainRequest)return void this.xhrLoadWithXDR(M,O,U,W,X);var V=new XMLHttpRequest;V.open("GET",O,!0),V.responseType=U,!1!==this.headers.requestedWith&&V.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[M.type]&&V.setRequestHeader("Accept",this.headers[M.type]),X=X||this.fileError;var H=this;V.onload=function(){try{return 4===V.readyState&&400<=V.status&&599>=V.status?X.call(H,M,V):W.call(H,M,V)}catch(Y){H.hasLoaded?window.console&&console.error(Y):H.asyncComplete(M,Y.message||"Exception")}},V.onerror=function(){try{return X.call(H,M,V)}catch(Y){H.hasLoaded?window.console&&console.error(Y):H.asyncComplete(M,Y.message||"Exception")}},M.requestObject=V,M.requestUrl=O,V.send()},xhrLoadWithXDR:function(M,O,U,W,X){this._warnedAboutXDomainRequest||this.game.device.ie&&!(10<=this.game.device.ieVersion)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var V=new window.XDomainRequest;V.open("GET",O,!0),V.responseType=U,V.timeout=3e3,X=X||this.fileError;var H=this;V.onerror=function(){try{return X.call(H,M,V)}catch(Y){H.asyncComplete(M,Y.message||"Exception")}},V.ontimeout=function(){try{return X.call(H,M,V)}catch(Y){H.asyncComplete(M,Y.message||"Exception")}},V.onprogress=function(){},V.onload=function(){try{return 4===V.readyState&&400<=V.status&&599>=V.status?X.call(H,M,V):W.call(H,M,V)}catch(Y){H.asyncComplete(M,Y.message||"Exception")}},M.requestObject=V,M.requestUrl=O,setTimeout(function(){V.send()},0)},getVideoURL:function(M){for(var O=0;O<M.length;O++){var U=M[O],W;if(!U.uri){if(0===U.indexOf("blob:")||0===U.indexOf("data:"))return U;0<=U.indexOf("?")&&(U=U.substr(0,U.indexOf("?")));var X=U.substr((Math.max(0,U.lastIndexOf("."))||Infinity)+1);if(W=X.toLowerCase(),this.game.device.canPlayVideo(W))return M[O]}else if(W=U.type,U=U.uri,this.game.device.canPlayVideo(W))return U}return null},getAudioURL:function(M){if(this.game.sound.noAudio)return null;for(var O=0;O<M.length;O++){var U=M[O],W;if(!U.uri){if(0===U.indexOf("blob:")||0===U.indexOf("data:"))return U;0<=U.indexOf("?")&&(U=U.substr(0,U.indexOf("?")));var X=U.substr((Math.max(0,U.lastIndexOf("."))||Infinity)+1);if(W=X.toLowerCase(),this.game.device.canPlayAudio(W))return M[O]}else if(W=U.type,U=U.uri,this.game.device.canPlayAudio(W))return U}return null},fileError:function(M,O,U){var W=M.requestUrl||this.transformUrl(M.url,M),X="error loading asset from URL "+W;!U&&O&&(U=O.status),U&&(X=X+" ("+U+")"),this.asyncComplete(M,X)},fileComplete:function(M,O){var U=!0;switch(M.type){case"packfile":var W=JSON.parse(O.responseText);M.data=W||{};break;case"texture":var X=/\.([^.]+)$/.exec(M.url.split("?",1)[0])[1].toLowerCase();null===M.data?this.cache.addCompressedTextureMetaData(M.key,M.url,X,O.response):this.cache.addCompressedTextureMetaData(M.key,M.url,X,M.data);break;case"image":this.cache.addImage(M.key,M.url,M.data);break;case"spritesheet":this.cache.addSpriteSheet(M.key,M.url,M.data,M.frameWidth,M.frameHeight,M.frameMax,M.margin,M.spacing,M.skipFrames);break;case"textureatlas":if(null==M.atlasURL)this.cache.addTextureAtlas(M.key,M.url,M.data,M.atlasData,M.format);else if(U=!1,M.format===C.Loader.TEXTURE_ATLAS_JSON_ARRAY||M.format===C.Loader.TEXTURE_ATLAS_JSON_HASH||M.format===C.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(M,this.transformUrl(M.atlasURL,M),"text",this.jsonLoadComplete);else if(M.format===C.Loader.TEXTURE_ATLAS_XML_STARLING)this.xhrLoad(M,this.transformUrl(M.atlasURL,M),"text",this.xmlLoadComplete);else throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+M.format);break;case"bitmapfont":M.atlasURL?(U=!1,this.xhrLoad(M,this.transformUrl(M.atlasURL,M),"text",function(V,H){var Y;try{Y=JSON.parse(H.responseText)}catch(z){}Y?(V.atlasType="json",this.jsonLoadComplete(V,H)):(V.atlasType="xml",this.xmlLoadComplete(V,H))})):this.cache.addBitmapFont(M.key,M.url,M.data,M.atlasData,M.atlasType,M.xSpacing,M.ySpacing);break;case"video":if(M.asBlob)try{M.data=O.response}catch(V){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+M.key)}this.cache.addVideo(M.key,M.url,M.data,M.asBlob);break;case"audio":this.game.sound.usingWebAudio?(M.data=O.response,this.cache.addSound(M.key,M.url,M.data,!0,!1),M.autoDecode&&this.game.sound.decode(M.key)):this.cache.addSound(M.key,M.url,M.data,!1,!0);break;case"text":M.data=O.responseText,this.cache.addText(M.key,M.url,M.data);break;case"shader":M.data=O.responseText,this.cache.addShader(M.key,M.url,M.data);break;case"physics":var W=JSON.parse(O.responseText);this.cache.addPhysicsData(M.key,M.url,W,M.format);break;case"script":M.data=document.createElement("script"),M.data.language="javascript",M.data.type="text/javascript",M.data.defer=!1,M.data.text=O.responseText,document.head.appendChild(M.data),M.callback&&(M.data=M.callback.call(M.callbackContext,M.key,O.responseText));break;case"binary":M.data=M.callback?M.callback.call(M.callbackContext,M.key,O.response):O.response,this.cache.addBinary(M.key,M.data);}U&&this.asyncComplete(M)},jsonLoadComplete:function(M,O){var U=JSON.parse(O.responseText);"tilemap"===M.type?this.cache.addTilemap(M.key,M.url,U,M.format):"bitmapfont"===M.type?this.cache.addBitmapFont(M.key,M.url,M.data,U,M.atlasType,M.xSpacing,M.ySpacing):"json"===M.type?this.cache.addJSON(M.key,M.url,U):this.cache.addTextureAtlas(M.key,M.url,M.data,U,M.format),this.asyncComplete(M)},csvLoadComplete:function(M,O){var U=O.responseText;this.cache.addTilemap(M.key,M.url,U,M.format),this.asyncComplete(M)},xmlLoadComplete:function(M,O){var U=O.responseText,W=this.parseXml(U);if(!W){var X=O.responseType||O.contentType;return console.warn("Phaser.Loader - "+M.key+": invalid XML ("+X+")"),void this.asyncComplete(M,"invalid XML")}"bitmapfont"===M.type?this.cache.addBitmapFont(M.key,M.url,M.data,W,M.atlasType,M.xSpacing,M.ySpacing):"textureatlas"===M.type?this.cache.addTextureAtlas(M.key,M.url,M.data,W,M.format):"xml"===M.type&&this.cache.addXML(M.key,M.url,W),this.asyncComplete(M)},parseXml:function(M){var O;try{if(window.DOMParser){var U=new DOMParser;O=U.parseFromString(M,"text/xml")}else O=new ActiveXObject("Microsoft.XMLDOM"),O.async="false",O.loadXML(M)}catch(W){O=null}return O&&O.documentElement&&!O.getElementsByTagName("parsererror").length?O:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(C.Loader.prototype,"progressFloat",{get:function(){var M=100*(this._loadedFileCount/this._totalFileCount);return C.Math.clamp(M||0,0,100)}}),Object.defineProperty(C.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),C.Loader.prototype.constructor=C.Loader,C.LoaderParser={bitmapFont:function(M,O,U,W,X,V){return this.xmlBitmapFont(M,O,U,W,X,V)},xmlBitmapFont:function(M,O,U,W,X,V){null==V&&(V=1);var H={},Y=M.getElementsByTagName("info")[0],z=M.getElementsByTagName("common")[0];H.font=Y.getAttribute("face"),H.size=parseInt(Y.getAttribute("size"),10),H.lineHeight=parseInt(z.getAttribute("lineHeight"),10)+W,H.chars={};for(var K=M.getElementsByTagName("char"),J=X?X.x:0,Q=X?X.y:0,Z=0,$;Z<K.length;Z++)$=parseInt(K[Z].getAttribute("id"),10),H.chars[$]={x:J+parseInt(K[Z].getAttribute("x"),10),y:Q+parseInt(K[Z].getAttribute("y"),10),width:parseInt(K[Z].getAttribute("width"),10),height:parseInt(K[Z].getAttribute("height"),10),xOffset:parseInt(K[Z].getAttribute("xoffset"),10)/V,yOffset:parseInt(K[Z].getAttribute("yoffset"),10)/V,xAdvance:(parseInt(K[Z].getAttribute("xadvance"),10)+U)/V,kerning:{}};var ee=M.getElementsByTagName("kerning");for(Z=0;Z<ee.length;Z++){var te=parseInt(ee[Z].getAttribute("first"),10),ae=parseInt(ee[Z].getAttribute("second"),10),oe=parseInt(ee[Z].getAttribute("amount"),10)/V;H.chars[ae].kerning[te]=oe}return this.finalizeBitmapFont(O,H)},jsonBitmapFont:function(M,O,U,W,X,V){null==V&&(V=1);var H={font:M.font.info._face,size:parseInt(M.font.info._size,10),lineHeight:parseInt(M.font.common._lineHeight,10)+W,chars:{}},Y=X?X.x:0,z=X?X.y:0;return M.font.chars.char.forEach(function(J){var Q=parseInt(J._id,10);H.chars[Q]={x:Y+parseInt(J._x,10),y:z+parseInt(J._y,10),width:parseInt(J._width,10),height:parseInt(J._height,10),xOffset:parseInt(J._xoffset,10)/V,yOffset:parseInt(J._yoffset,10)/V,xAdvance:(parseInt(J._xadvance,10)+U)/V,kerning:{}}}),M.font.kernings&&M.font.kernings.kerning&&M.font.kernings.kerning.forEach(function(J){H.chars[J._second].kerning[J._first]=parseInt(J._amount,10)/V}),this.finalizeBitmapFont(O,H)},finalizeBitmapFont:function(M,O){return Object.keys(O.chars).forEach(function(W){var X=O.chars[W];X.texture=new PIXI.Texture(M,new C.Rectangle(X.x,X.y,X.width,X.height))}),O},pvr:function(M){var O=new Uint32Array(M.slice(0,52)),U=new Uint8Array(M),W=null,X=O[3]<<32|O[2],H=0,V;return 55727696===O[0]&&0<=[0,1,2,3,6,7,9,11].indexOf(X)&&(0<=X&&3>=X?V="PVRTC":7<=X&&11>=X?V="S3TC":6==X&&(V="ETC1"),H=0==X?35841:1==X?35843:2==X?35840:3==X?35842:6==X?36196:7==X?33777:9==X?33778:11==X?33779:-1,W={complete:!0,fileFormat:"PVR",compressionAlgorithm:V,flags:O[1],pixelFormat:X,colorSpace:O[4],channelType:O[5],height:O[6],width:O[7],depth:O[8],numberOfSurfaces:O[9],numberOfFaces:O[10],numberOfMipmaps:O[11],metaDataSize:O[12],textureData:U.subarray(52+O[12],U.byteLength),glExtensionFormat:H}),W},dds:function(M){var O=new Uint8Array(M),U=new Uint32Array(M),W=null;return 68===O[0]&&68===O[1]&&83===O[2]&&32===O[3]&&(W={complete:!0,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:U[1],flags:U[2],height:U[3],width:U[4],pitch:U[5],depth:U[6],mipmapCount:U[7],formatSize:U[19],formatFlag:U[19],formatFourCC:[String.fromCharCode(O[84]),String.fromCharCode(O[85]),String.fromCharCode(O[86]),String.fromCharCode(O[87])].join(""),formatBitCount:U[21],formatRBitMask:U[22],formatGBitMask:U[23],formatBBitMask:U[24],formatABitMask:U[25],caps1:U[26],caps2:U[27],caps3:U[28],caps4:U[29],reserved2:U[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:O.subarray(U[1]+4,O.byteLength)},"DX10"===W.formatFourCC&&(W.DXGIFormat=U[31],W.resourceDimension=U[32],W.miscFlag=U[33],W.arraySize=U[34],W.miscFlag=U[35])),W},ktx:function(M){var O=new Uint8Array(M),U=new Uint32Array(M),W=null,X=0|16+U[15]/4,V=U[X],H=U[7],Y=0;return 171===O[0]&&75===O[1]&&84===O[2]&&88===O[3]&&32===O[4]&&49===O[5]&&49===O[6]&&187===O[7]&&13===O[8]&&10===O[9]&&26===O[10]&&10===O[11]&&0<=[36196,35840,35841,35842,35843,33776,33777,33778,33779].indexOf(H)&&(36196===H?Y="ETC1":35840===H||35841===H||35842===H||35843===H?Y="PVRTC":33776===H||33777===H||33778===H||33779===H?Y="S3TC":void 0,W={complete:!0,fileFormat:"KTX",compressionAlgorithm:Y,endianness:U[3],glType:U[4],glTypeSize:U[5],glFormat:U[6],glInternalFormat:U[7],glBaseInternalFormat:U[8],width:U[9],height:U[10],pixelDepth:U[11],numberOfArrayElements:U[12],numberOfFaces:U[13],numberOfMipmapLevels:U[14],bytesOfKeyValueData:U[15],keyAndValueByteSize:U[16],imageSize:V,textureData:O.subarray(4*(X+1),V+100)}),W},pkm:function(M){var O=new Uint8Array(M),U=null;return 80===O[0]&&75===O[1]&&77===O[2]&&32===O[3]&&(U={complete:!0,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:65535&(O[6]<<8|O[7]),width:65535&(O[8]<<8|O[9]),height:65535&(O[10]<<8|O[11]),originalWidth:65535&(O[12]<<8|O[13]),originalHeight:65535&(O[14]<<8|O[15]),textureData:O.subarray(16,O.length)}),U}},C.AudioSprite=function(M,O){for(var U in this.game=M,this.key=O,this.config=this.game.cache.getJSON(O+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap){var W=this.config.spritemap[U],X=this.game.add.sound(this.key);X.addMarker(U,W.start,W.end-W.start,null,W.loop),this.sounds[U]=X}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},C.AudioSprite.prototype={play:function(M,O){return void 0===O&&(O=1),this.sounds[M].play(M,null,O)},stop:function(M){if(!M)for(var O in this.sounds)this.sounds[O].stop();else this.sounds[M].stop()},get:function(M){return this.sounds[M]}},C.AudioSprite.prototype.constructor=C.AudioSprite,C.Sound=function(M,O,U,W,X){void 0===U&&(U=1),void 0===W&&(W=!1),void 0===X&&(X=M.sound.connectToMaster),this.game=M,this.name=O,this.key=O,this.loop=W,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this._globalVolume=1,this._markedToDelete=!1,this._removeFromSoundManager=!1,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=U*this.game.sound.volume,X&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(O)&&this.game.cache.isSoundReady(O)?(this._sound=this.game.cache.getSoundData(O),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new C.Signal,this.onPlay=new C.Signal,this.onPause=new C.Signal,this.onResume=new C.Signal,this.onLoop=new C.Signal,this.onStop=new C.Signal,this.onMute=new C.Signal,this.onMarkerComplete=new C.Signal,this.onFadeComplete=new C.Signal,this._volume=U,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},C.Sound.prototype={soundHasUnlocked:function(M){M===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(M,O,U,W,X){(void 0===U||null===U)&&(U=1),(void 0===W||null===W)&&(W=1),void 0===X&&(X=!1),this.markers[M]={name:M,start:O,stop:O+U,volume:W,duration:U,durationMS:1e3*U,loop:X}},removeMarker:function(M){delete this.markers[M]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop(),this._markedToDelete&&(this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode),this._removeFromSoundManager?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose()))},update:function(){return this.game.cache.checkSoundKey(this.key)?void(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):void this.destroy()},loopFull:function(M){return this.play(null,0,M,!0)},play:function(M,O,U,W,X){if((void 0===M||!1===M||null===M)&&(M=""),void 0===X&&(X=!0),this.isPlaying&&!this.allowMultiple&&!X&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||X)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(V){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1}if(""===M&&0<Object.keys(this.markers).length)return this;if(""===M)O=O||0,void 0===U&&(U=this._volume),void 0===W&&(W=this.loop),this.position=Math.max(0,O),this.volume=U,this.loop=W,this.duration=0,this.durationMS=0,this._tempMarker=M,this._tempPosition=O,this._tempVolume=U,this._tempLoop=W;else if(this.markers[M])this.currentMarker=M,this.position=this.markers[M].start,this.volume=this.markers[M].volume,this.loop=this.markers[M].loop,this.duration=this.markers[M].duration,this.durationMS=this.markers[M].durationMS,"undefined"!=typeof U&&(this.volume=U),"undefined"!=typeof W&&(this.loop=W),this._tempMarker=M,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else return console.warn("Phaser.Sound.play: audio marker "+M+" doesn't exist"),this;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&""===M&&(this._sound.loop=!0),!this.loop&&""===M&&(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===M?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted||this.game.sound.mute?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(M,O,U,W){M=M||"",O=O||0,U=U||1,void 0===W&&(W=!1),this.play(M,O,U,W,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},seek:function(){},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var M=Math.max(0,this.position+this.pausedPosition/1e3);this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var O=this.duration-this.pausedPosition/1e3;void 0===this._sound.start?this._sound.noteGrainOn(0,M,O):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,M):this._sound.start(0,M,O)}else this._sound.currentTime=this._tempPause,this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(O){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var M=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,M)}},fadeIn:function(M,O,U){void 0===O&&(O=!1),void 0===U&&(U=this.currentMarker),this.paused||(this.play(U,0,0,O),this.fadeTo(M,1))},fadeOut:function(M){this.fadeTo(M,0)},fadeTo:function(M,O){if(this.isPlaying&&!this.paused&&O!==this.volume)return void 0===M&&(M=1e3),void 0===O?void console.warn("Phaser.Sound.fadeTo: No Volume Specified."):void(this.fadeTween=this.game.add.tween(this).to({volume:O},M,C.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(M){this.usingAudioTag&&this._sound&&(this._globalVolume=M,this._sound.volume=this._globalVolume*this._volume)},destroy:function(M){void 0===M&&(M=!0),this._markedToDelete=!0,this._removeFromSoundManager=M,this.stop(),M?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},C.Sound.prototype.constructor=C.Sound,Object.defineProperty(C.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(C.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(C.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(M){M=M||!1,M===this._muted||(M?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(C.Sound.prototype,"volume",{get:function(){return this._volume},set:function(M){return this.usingAudioTag&&(M=this.game.math.clamp(M,0,1)),this._muted?void(this._muteVolume=M):void(this._tempVolume=M,this._volume=M,this.usingWebAudio?this.gainNode.gain.value=M:this.usingAudioTag&&this._sound&&(this._sound.volume=this._globalVolume*M))}}),C.SoundManager=function(M){this.game=M,this.onSoundDecode=new C.Signal,this.onVolumeChange=new C.Signal,this.onMute=new C.Signal,this.onUnMute=new C.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new C.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},C.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(!!window.AudioContext)try{this.context=new window.AudioContext}catch(M){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}else if(!!window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(M){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,this.masterGain=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);!this.noAudio&&this.game.device.needsTouchUnlock()&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(8<this.game.device.iOSVersion||55<=this.game.device.chromeVersion?this.game.input.addTouchLockCallback(this.unlock,this,!0):this.game.input.addTouchLockCallback(this.unlock,this),this.touchLocked=!0)},unlock:function(){if(this.noAudio||!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.touchLocked=!1,this._unlockSource=null;else if(this.usingWebAudio){var M=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=M,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),"suspended"===this._unlockSource.context.state&&this._unlockSource.context.resume()}return!0},stopAll:function(){if(!this.noAudio)for(var M=0;M<this._sounds.length;M++)this._sounds[M]&&this._sounds[M].stop()},pauseAll:function(){if(!this.noAudio)for(var M=0;M<this._sounds.length;M++)this._sounds[M]&&this._sounds[M].pause()},resumeAll:function(){if(!this.noAudio)for(var M=0;M<this._sounds.length;M++)this._sounds[M]&&this._sounds[M].resume()},decode:function(M,O){O=O||null;var U=this.game.cache.getSoundData(M);if(U&&!1===this.game.cache.isSoundDecoded(M)){this.game.cache.updateSound(M,"isDecoding",!0);var W=this;try{this.context.decodeAudioData(U,function(X){X&&(W.game.cache.decodedSound(M,X),W.onSoundDecode.dispatch(M,O))})}catch(X){}}},setDecodedCallback:function(M,O,U){"string"==typeof M&&(M=[M]),this._watchList.reset();for(var W=0;W<M.length;W++)M[W]instanceof C.Sound?this.game.cache.isSoundDecoded(M[W].key)||this._watchList.add(M[W].key):this.game.cache.isSoundDecoded(M[W])||this._watchList.add(M[W]);0===this._watchList.total?(this._watching=!1,O.call(U)):(this._watching=!0,this._watchCallback=O,this._watchContext=U)},update:function(){if(!this.noAudio){this.touchLocked&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null);for(var M=0;M<this._sounds.length;M++)this._sounds[M].update();if(this._watching){for(var O=this._watchList.first;O;)this.game.cache.isSoundDecoded(O)&&this._watchList.remove(O),O=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(M,O,U,W){void 0===O&&(O=1),void 0===U&&(U=!1),void 0===W&&(W=this.connectToMaster);var X=new C.Sound(this.game,M,O,U,W);return this._sounds.push(X),X},addSprite:function(M){var O=new C.AudioSprite(this.game,M);return O},remove:function(M){for(var O=this._sounds.length;O--;)if(this._sounds[O]===M)return this._sounds[O].destroy(!1),this._sounds.splice(O,1),!0;return!1},removeByKey:function(M){for(var O=this._sounds.length,U=0;O--;)this._sounds[O].key===M&&(this._sounds[O].destroy(!1),this._sounds.splice(O,1),U++);return U},play:function(M,O,U){if(!this.noAudio){var W=this.add(M,O,U);return W.play(),W}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var M=0;M<this._sounds.length;M++)this._sounds[M].usingAudioTag&&(this._sounds[M].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var M=0;M<this._sounds.length;M++)this._sounds[M].usingAudioTag&&(this._sounds[M].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var M=0;M<this._sounds.length;M++)this._sounds[M]&&this._sounds[M].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())}},C.SoundManager.prototype.constructor=C.SoundManager,Object.defineProperty(C.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(M){if(M=M||!1,M){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(C.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(M){if(0>M?M=0:1<M&&(M=1),this._volume!==M){if(this._volume=M,this.usingWebAudio)this.masterGain.gain.value=M;else for(var O=0;O<this._sounds.length;O++)this._sounds[O].usingAudioTag&&this._sounds[O].updateGlobalVolume(M);this.onVolumeChange.dispatch(M)}}}),C.ScaleManager=function(M,O,U){this.game=M,this.dom=C.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new C.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new C.Signal,this.enterIncorrectOrientation=new C.Signal,this.leaveIncorrectOrientation=new C.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new C.Signal,this.onFullScreenChange=new C.Signal,this.onFullScreenError=new C.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new C.Point(1,1),this.scaleFactorInversed=new C.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new C.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=C.ScaleManager.NO_SCALE,this._fullScreenScaleMode=C.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new C.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new C.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new C.Rectangle,this._userScaleFactor=new C.Point(1,1),this._userScaleTrim=new C.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new C.Rectangle,this._tempBounds=new C.Rectangle,this._lastReportedCanvasSize=new C.Rectangle,this._lastReportedGameSize=new C.Rectangle,this._booted=!1,M.config&&this.parseConfig(M.config),this.setupScale(O,U)},C.ScaleManager.EXACT_FIT=0,C.ScaleManager.NO_SCALE=1,C.ScaleManager.SHOW_ALL=2,C.ScaleManager.RESIZE=3,C.ScaleManager.USER_SCALE=4,C.ScaleManager.prototype={boot:function(){var M=this.compatibility;M.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?M.scrollTo=new C.Point(0,1):M.scrollTo=new C.Point(0,0)),this.game.device.desktop?(M.orientationFallback="screen",M.clickTrampoline="when-not-mouse"):(M.orientationFallback="",M.clickTrampoline="");var O=this;this._orientationChange=function(U){return O.orientationChange(U)},this._windowResize=function(U){return O.windowResize(U)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(U){return O.fullScreenChange(U)},this._fullScreenError=function(U){return O.fullScreenError(U)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),C.FlexGrid&&(this.grid=new C.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(M){void 0!==M.scaleMode&&(this._booted?this.scaleMode=M.scaleMode:this._pendingScaleMode=M.scaleMode),void 0!==M.fullScreenScaleMode&&(this.fullScreenScaleMode=M.fullScreenScaleMode),M.fullScreenTarget&&(this.fullScreenTarget=M.fullScreenTarget)},setupScale:function(M,O){var W=new C.Rectangle,U;""!==this.game.parent&&("string"==typeof this.game.parent?U=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(U=this.game.parent)),U?(this.parentNode=U,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),W.width=this._parentBounds.width,W.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,W.width=this.dom.visualBounds.width,W.height=this.dom.visualBounds.height,this.offset.set(0,0));var X=0,V=0;"number"==typeof M?X=M:(this.parentScaleFactor.x=parseInt(M,10)/100,X=W.width*this.parentScaleFactor.x),"number"==typeof O?V=O:(this.parentScaleFactor.y=parseInt(O,10)/100,V=W.height*this.parentScaleFactor.y),X=Math.floor(X),V=Math.floor(V),this._gameSize.setTo(0,0,X,V),this.updateDimensions(X,V,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(M,O){this._gameSize.setTo(0,0,M,O),this.currentScaleMode!==C.ScaleManager.RESIZE&&this.updateDimensions(M,O,!0),this.queueUpdate(!0)},setUserScale:function(M,O,U,W,X,V){this._userScaleFactor.setTo(M,O),this._userScaleTrim.setTo(0|U,0|W),void 0===X&&(X=!0),void 0===V&&(V=!0),X&&this.queueUpdate(V)},setResizeCallback:function(M,O){this.onResize=M,this.onResizeContext=O},signalSizeChange:function(){if(!C.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!C.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var M=this.width,O=this.height;this._lastReportedCanvasSize.setTo(0,0,M,O),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(M,O),this.onSizeChange.dispatch(this,M,O),this.currentScaleMode===C.ScaleManager.RESIZE&&(this.game.state.resize(M,O),this.game.load.resize(M,O))}},setMinMax:function(M,O,U,W){this.minWidth=M,this.minHeight=O,"undefined"!=typeof U&&(this.maxWidth=U),"undefined"!=typeof W&&(this.maxHeight=W)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var M=this._updateThrottle;this._updateThrottleReset=400<=M?0:100,this.dom.getOffset(this.game.canvas,this.offset);var O=this._parentBounds.width,U=this._parentBounds.height,W=this.getParentBounds(this._parentBounds),X=W.width!==O||W.height!==U,V=this.updateOrientationState();(X||V)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,W),this.updateLayout(),this.signalSizeChange());var H=2*this._updateThrottle;this._updateThrottle<M&&(H=Math.min(M,this._updateThrottleReset)),this._updateThrottle=C.Math.clamp(H,25,this.trackParentInterval),this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(M,O,U){this.width=M*this.parentScaleFactor.x,this.height=O*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),U&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(M,O){return void 0===O&&(O=!1),!0===M&&!0===O?void console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true."):void(this.forceLandscape=M,this.forcePortrait=O,this.queueUpdate(!0))},classifyOrientation:function(M){return"portrait-primary"===M||"portrait-secondary"===M?"portrait":"landscape-primary"===M||"landscape-secondary"===M?"landscape":null},updateOrientationState:function(){var M=this.screenOrientation,O=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var U=M!==this.screenOrientation,W=O!==this.incorrectOrientation;return W&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(U||W)&&this.onOrientationChange.dispatch(this,M,O),U||W},orientationChange:function(M){this.event=M,this.queueUpdate(!0)},windowResize:function(M){this.event=M,this.queueUpdate(!0)},scrollTop:function(){var M=this.compatibility.scrollTo;M&&window.scrollTo(M.x,M.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var M=this.currentScaleMode;if(M===C.ScaleManager.RESIZE)return void this.reflowGame();if(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():M===C.ScaleManager.EXACT_FIT?this.setExactFit():M===C.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():M===C.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):M===C.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),!this.compatibility.canExpandParent&&(M===C.ScaleManager.SHOW_ALL||M===C.ScaleManager.USER_SCALE)){var O=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,O.width),this.height=Math.min(this.height,O.height)}this.width|=0,this.height|=0,this.reflowCanvas()},getParentBounds:function(M){var O=M||new C.Rectangle,U=this.boundingParent,W=this.dom.visualBounds,X=this.dom.layoutBounds;if(!U)O.setTo(0,0,W.width,W.height);else{var V=U.getBoundingClientRect(),H=U.offsetParent?U.offsetParent.getBoundingClientRect():U.getBoundingClientRect();O.setTo(V.left-H.left,V.top-H.top,V.width,V.height);var Y=this.windowConstraints;if(Y.right){var z="layout"===Y.right?X:W;O.right=Math.min(O.right,z.width)}if(Y.bottom){var z="layout"===Y.bottom?X:W;O.bottom=Math.min(O.bottom,z.height)}}return O.setTo(Math.round(O.x),Math.round(O.y),Math.round(O.width),Math.round(O.height)),O},alignCanvas:function(M,O){var U=this.getParentBounds(this._tempBounds),W=this.game.canvas,X=this.margin;if(M){X.left=X.right=0;var V=W.getBoundingClientRect();if(this.width<U.width&&!this.incorrectOrientation){var H=V.left-U.x,Y=U.width/2-this.width/2;Y=Math.max(Y,0);var z=Y-H;X.left=Math.round(z)}W.style.marginLeft=X.left+"px",0!==X.left&&(X.right=-(U.width-V.width-X.left),W.style.marginRight=X.right+"px")}if(O){X.top=X.bottom=0;var V=W.getBoundingClientRect();if(this.height<U.height&&!this.incorrectOrientation){var H=V.top-U.y,Y=U.height/2-this.height/2;Y=Math.max(Y,0);var z=Y-H;X.top=Math.round(z)}W.style.marginTop=X.top+"px",0!==X.top&&(X.bottom=-(U.height-V.height-X.top),W.style.marginBottom=X.bottom+"px")}X.x=X.left,X.y=X.top},reflowGame:function(){this.resetCanvas("","");var M=this.getParentBounds(this._tempBounds);this.updateDimensions(M.width,M.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=C.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=C.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(M,O){void 0===M&&(M=this.width+"px"),void 0===O&&(O=this.height+"px");var U=this.game.canvas;this.compatibility.noMargins||(U.style.marginLeft="",U.style.marginTop="",U.style.marginRight="",U.style.marginBottom=""),U.style.width=M,U.style.height=O},queueUpdate:function(M){M&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(M){M&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(M){var O=this.getParentBounds(this._tempBounds),U=O.width,W=O.height,X;X=M?Math.max(W/this.game.height,U/this.game.width):Math.min(W/this.game.height,U/this.game.width),this.width=Math.round(this.game.width*X),this.height=Math.round(this.game.height*X)},setExactFit:function(){var M=this.getParentBounds(this._tempBounds);this.width=M.width,this.height=M.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var M=document.createElement("div");return M.style.margin="0",M.style.padding="0",M.style.background="#000",M},startFullScreen:function(M,O){if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){var U=this;return void setTimeout(function(){U.fullScreenError()},10)}if("when-not-mouse"===this.compatibility.clickTrampoline){var W=this.game.input;if(W.activePointer&&W.activePointer!==W.mousePointer&&(O||!1!==O))return void W.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[M,!1])}void 0!==M&&this.game.renderType===C.CANVAS&&(this.game.stage.smoothed=M);var X=this.fullScreenTarget;X||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),X=this._createdFullScreenTarget);var V={targetElement:X};if(this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,V),this._createdFullScreenTarget){var H=this.game.canvas,Y=H.parentNode;Y.insertBefore(X,H),X.appendChild(H)}return this.game.device.fullscreenKeyboard?X[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):X[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return this.isFullScreen&&this.compatibility.supportsFullScreen&&(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var M=this._createdFullScreenTarget;if(M&&M.parentNode){var O=M.parentNode;O.insertBefore(this.game.canvas,M),O.removeChild(M)}this._createdFullScreenTarget=null},prepScreenMode:function(M){var O=!!this._createdFullScreenTarget,U=this._createdFullScreenTarget||this.fullScreenTarget;M?(O||this.fullScreenScaleMode===C.ScaleManager.EXACT_FIT)&&U!==this.game.canvas&&(this._fullScreenRestore={targetWidth:U.style.width,targetHeight:U.style.height},U.style.width="100%",U.style.height="100%"):(this._fullScreenRestore&&(U.style.width=this._fullScreenRestore.targetWidth,U.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(M){this.event=M,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0)),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(M){this.event=M,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(M,O,U,W){if(void 0===O&&(O=this.width),void 0===U&&(U=this.height),void 0===W&&(W=!1),!M||!M.scale)return M;if(M.scale.x=1,M.scale.y=1,0>=M.width||0>=M.height||0>=O||0>=U)return M;var X=O,V=M.height*O/M.width,H=M.width*U/M.height,Y=U,z=H>O;return z=z?W:!W,z?(M.width=Math.floor(X),M.height=Math.floor(V)):(M.width=Math.floor(H),M.height=Math.floor(Y)),M},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},C.ScaleManager.prototype.constructor=C.ScaleManager,Object.defineProperty(C.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)return null;var M=this.game.canvas&&this.game.canvas.parentNode;return M||null}}),Object.defineProperty(C.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(M){return M!==this._scaleMode&&(!this.isFullScreen&&(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=M),this._scaleMode}}),Object.defineProperty(C.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(M){return M!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=M,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=M),this._fullScreenScaleMode}}),Object.defineProperty(C.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(C.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(M){M!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=M,this.queueUpdate(!0))}}),Object.defineProperty(C.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(M){M!==this._pageAlignVertically&&(this._pageAlignVertically=M,this.queueUpdate(!0))}}),Object.defineProperty(C.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(C.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(C.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(C.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(C.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),C.Utils.Debug=function(M){this.game=M,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.lineWidth=1,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1,this.isDisabled=!1,this._line=null,this._rect=null},C.Utils.Debug.prototype={boot:function(){this.game.renderType===C.CANVAS?this.context=this.game.context:(this.bmd=new C.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=C.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d")),this._line=new C.Line,this._rect=new C.Rectangle},resize:function(){this.bmd.resize(this.game.width,this.game.height),this.canvas.width=this.game.width,this.canvas.height=this.game.height},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(M,O,U,W){"number"!=typeof M&&(M=0),"number"!=typeof O&&(O=0),U=U||"rgb(255,255,255)",void 0===W&&(W=0),this.currentX=M,this.currentY=O,this.currentColor=U,this.columnWidth=W,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=U,this.context.fillStyle=U,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var M=this.currentX,O=0;O<arguments.length;O++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[O],M+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[O],M,this.currentY),M+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(M,O,U,W){this.start(O,U,W),this.line("Sound: "+M.key+" Locked: "+M.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(M.key)+" Pending Playback: "+M.pendingPlayback),this.line("Decoded: "+M.isDecoded+" Decoding: "+M.isDecoding),this.line("Total Duration: "+M.totalDuration+" Playing: "+M.isPlaying),this.line("Time: "+M.currentTime),this.line("Volume: "+M.volume+" Muted: "+M.mute),this.line("WebAudio: "+M.usingWebAudio+" Audio: "+M.usingAudioTag),""!==M.currentMarker&&(this.line("Marker: "+M.currentMarker+" Duration: "+M.duration+" (ms: "+M.durationMS+")"),this.line("Start: "+M.markers[M.currentMarker].start+" Stop: "+M.markers[M.currentMarker].stop),this.line("Position: "+M.position)),this.stop()},camera:function(M,O,U){var W=M.deadzone,X=M.target,V=M.view;W&&(this._rect.setTo(V.x+W.x,V.y+W.y,W.width,W.height),this.rectangle(this._rect,O,U)),X&&(this._line.setTo(V.centerX,V.centerY,X.x,X.y),this.geom(this._line,O,U),this.geom(X,O,!1,3))},cameraInfo:function(M,O,U,W){var X=M.bounds,V=M.deadzone,H=M.target,Y=M.view;this.start(O,U,W),this.line("Camera ("+M.width+" x "+M.height+")"),this.line("x: "+M.x+" y: "+M.y),X&&this.line("Bounds x: "+X.x+" y: "+X.y+" w: "+X.width+" h: "+X.height),this.line("View x: "+Y.x+" y: "+Y.y+" w: "+Y.width+" h: "+Y.height),this.line("Deadzone: "+(V?"x: "+V.x+" y: "+V.y+" w: "+V.width+" h: "+V.height:V)),this.line("Total in view: "+M.totalInView),this.line("At limit: x: "+M.atLimit.x+" y: "+M.atLimit.y),this.line("Target: "+(H?H.name||H:H)),this.stop()},timer:function(M,O,U,W){this.start(O,U,W),this.line("Timer (running: "+M.running+" expired: "+M.expired+")"),this.line("Next Tick: "+M.next+" Duration: "+M.duration),this.line("Paused: "+M.paused+" Length: "+M.length),this.stop()},pointer:function(M,O,U,W,X){null!=M&&(void 0===O&&(O=!1),U=U||"rgba(0,255,0,0.5)",W=W||"rgba(255,0,0,0.5)",!0===O&&!0===M.isUp||(this.start(M.x,M.y-100,X),this.context.beginPath(),this.context.arc(M.x,M.y,M.circle.radius,0,2*Math.PI),this.context.fillStyle=M.active?U:W,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(M.positionDown.x,M.positionDown.y),this.context.lineTo(M.position.x,M.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+M.id+" Active: "+M.active),this.line("World X: "+M.worldX+" World Y: "+M.worldY),this.line("Screen X: "+M.x+" Screen Y: "+M.y+" In: "+M.withinGame),this.line("Duration: "+M.duration+" ms"),this.line("is Down: "+M.isDown+" is Up: "+M.isUp),this.stop()))},spriteInputInfo:function(M,O,U,W){this.start(O,U,W),this.line("Sprite Input: ("+M.width+" x "+M.height+")"),this.line("x: "+M.input.pointerX().toFixed(1)+" y: "+M.input.pointerY().toFixed(1)),this.line("over: "+M.input.pointerOver()+" duration: "+M.input.overDuration().toFixed(0)),this.line("down: "+M.input.pointerDown()+" duration: "+M.input.downDuration().toFixed(0)),this.line("just over: "+M.input.justOver()+" just out: "+M.input.justOut()),this.stop()},key:function(M,O,U,W){this.start(O,U,W,150),this.line("Key:",M.keyCode,"isDown:",M.isDown),this.line("justDown:",M.justDown,"justUp:",M.justUp),this.line("Time Down:",M.timeDown.toFixed(0),"duration:",M.duration.toFixed(0)),this.stop()},inputInfo:function(M,O,U){this.start(M,O,U),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(M,O,U){var W=M.getBounds();W.x+=this.game.camera.x,W.y+=this.game.camera.y,this.rectangle(W,O,U)},ropeSegments:function(M,O,U){var W=M.segments,X=this;W.forEach(function(V){X.rectangle(V,O,U)},this)},spriteInfo:function(M,O,U,W){this.start(O,U,W),this.line("Sprite:  ("+M.width+" x "+M.height+") anchor: "+M.anchor.x+" x "+M.anchor.y),this.line("x: "+M.x.toFixed(1)+" y: "+M.y.toFixed(1)),this.line("angle: "+M.angle.toFixed(1)+" rotation: "+M.rotation.toFixed(1)),this.line("visible: "+M.visible+" in camera: "+M.inCamera),this.line("bounds x: "+M._bounds.x.toFixed(1)+" y: "+M._bounds.y.toFixed(1)+" w: "+M._bounds.width.toFixed(1)+" h: "+M._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(M,O,U,W){this.start(O,U,W,100),M.name&&this.line(M.name),this.line("x:",M.x.toFixed(2),"y:",M.y.toFixed(2)),this.line("pos x:",M.position.x.toFixed(2),"pos y:",M.position.y.toFixed(2)),this.line("world x:",M.world.x.toFixed(2),"world y:",M.world.y.toFixed(2)),this.stop()},lineInfo:function(M,O,U,W){this.start(O,U,W,80),this.line("start.x:",M.start.x.toFixed(2),"start.y:",M.start.y.toFixed(2)),this.line("end.x:",M.end.x.toFixed(2),"end.y:",M.end.y.toFixed(2)),this.line("length:",M.length.toFixed(2),"angle:",M.angle),this.stop()},pixel:function(M,O,U,W){W=W||2,this.start(),this.context.fillStyle=U,this.context.fillRect(M,O,W,W),this.stop()},geom:function(M,O,U,W){void 0===U&&(U=!0),void 0===W&&(W=0),O=O||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=O,this.context.strokeStyle=O,this.context.lineWidth=this.lineWidth,M instanceof C.Rectangle||1===W?U?this.context.fillRect(M.x-this.game.camera.x,M.y-this.game.camera.y,M.width,M.height):this.context.strokeRect(M.x-this.game.camera.x,M.y-this.game.camera.y,M.width,M.height):M instanceof C.Circle||2===W?(this.context.beginPath(),this.context.arc(M.x-this.game.camera.x,M.y-this.game.camera.y,M.radius,0,2*Math.PI,!1),this.context.closePath(),U?this.context.fill():this.context.stroke()):M instanceof C.Point||3===W?this.context.fillRect(M.x-this.game.camera.x,M.y-this.game.camera.y,4,4):(M instanceof C.Line||4==W)&&(this.context.beginPath(),this.context.moveTo(M.start.x+0.5-this.game.camera.x,M.start.y+0.5-this.game.camera.y),this.context.lineTo(M.end.x+0.5-this.game.camera.x,M.end.y+0.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(M,O,U){void 0===U&&(U=!0),O=O||"rgba(0, 255, 0, 0.4)",this.start(),U?(this.context.fillStyle=O,this.context.fillRect(M.x-this.game.camera.x,M.y-this.game.camera.y,M.width,M.height)):(this.context.lineWidth=this.lineWidth,this.context.strokeStyle=O,this.context.strokeRect(M.x-this.game.camera.x,M.y-this.game.camera.y,M.width,M.height)),this.stop()},text:function(M,O,U,W,X){W=W||"rgb(255,255,255)",X=X||"16px Courier",this.start(),this.context.font=X,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(M,O+1,U+1)),this.context.fillStyle=W,this.context.fillText(M,O,U),this.stop()},quadTree:function(M,O){O=O||"rgba(255,0,0,0.3)",this.start();var U=M.bounds;if(0===M.nodes.length){this.context.strokeStyle=O,this.context.strokeRect(U.x,U.y,U.width,U.height),this.text("size: "+M.objects.length,U.x+4,U.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var W=0;W<M.objects.length;W++)this.context.strokeRect(M.objects[W].x,M.objects[W].y,M.objects[W].width,M.objects[W].height)}else for(var W=0;W<M.nodes.length;W++)this.quadTree(M.nodes[W]);this.stop()},body:function(M,O,U){M.body&&(this.start(),M.body.type===C.Physics.ARCADE?C.Physics.Arcade.Body.render(this.context,M.body,O,U,this.lineWidth):M.body.type===C.Physics.NINJA?C.Physics.Ninja.Body.render(this.context,M.body,O,U):M.body.type===C.Physics.BOX2D&&C.Physics.Box2D.renderBody(this.context,M.body,O),this.stop())},bodyInfo:function(M,O,U,W){M.body&&(this.start(O,U,W,210),M.body.type===C.Physics.ARCADE?C.Physics.Arcade.Body.renderBodyInfo(this,M.body):M.body.type===C.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,M.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(M,O){this.start(),C.Physics.Box2D.renderBody(this.context,M,O),this.stop()},displayList:function(M){if(void 0===M&&(M=this.game.world),M.hasOwnProperty("renderOrderID")?console.log("["+M.renderOrderID+"]",M):console.log("[]",M),M.children&&0<M.children.length)for(var O=0;O<M.children.length;O++)this.game.debug.displayList(M.children[O])},renderer:function(M,O,U){var W=this.game.renderer,X=W.renderSession;if(this.start(M,O,U),this.line((W.gl?"WebGL":"Canvas")+" Renderer ("+W.width+" x "+W.height+")"),this.line("autoResize: "+W.autoResize),this.line("clearBeforeRender: "+W.clearBeforeRender),this.line("resolution: "+W.resolution),this.line("transparent: "+W.transparent),this.line("renderSession:"),W.gl){this.line("  currentBatchedTextures: ("+W.currentBatchedTextures.length+")");for(var V=0;V<W.currentBatchedTextures.length;V++)this.line("    "+W.currentBatchedTextures[V]);this.line("  drawCount: "+X.drawCount),this.line("  maxTextures: "+W.maxTextures),this.line("  maxTextureSize: "+W.maxTextureSize),this.line("  maxTextureAvailableSpace: "+X.maxTextureAvailableSpace),this.line("  roundPixels: "+X.roundPixels)}else this.line("  roundPixels: "+X.roundPixels),this.line("  scaleMode: "+(0===X.scaleMode?"LINEAR":1===X.scaleMode?"NEAREST":X.scaleMode));this.stop()},destroy:function(){C.CanvasPool.remove(this)}},C.Utils.Debug.prototype.constructor=C.Utils.Debug,C.DOM={getOffset:function(M,O){O=O||new C.Point;var U=M.getBoundingClientRect(),W=C.DOM.scrollY,X=C.DOM.scrollX,V=document.documentElement.clientTop,H=document.documentElement.clientLeft;return O.x=U.left+X-H,O.y=U.top+W-V,O},getBounds:function(M,O){return void 0===O&&(O=0),M=M&&!M.nodeType?M[0]:M,M&&1===M.nodeType&&this.calibrate(M.getBoundingClientRect(),O)},calibrate:function(M,O){O=+O||0;var U={width:0,height:0,left:0,right:0,top:0,bottom:0};return U.width=(U.right=M.right+O)-(U.left=M.left-O),U.height=(U.bottom=M.bottom+O)-(U.top=M.top-O),U},getAspectRatio:function(M){M=null==M?this.visualBounds:1===M.nodeType?this.getBounds(M):M;var O=M.width,U=M.height;return"function"==typeof O&&(O=O.call(M)),"function"==typeof U&&(U=U.call(M)),O/U},inLayoutViewport:function(M,O){var U=this.getBounds(M,O);return!!U&&0<=U.bottom&&0<=U.right&&U.top<=this.layoutBounds.width&&U.left<=this.layoutBounds.height},getScreenOrientation:function(M){var O=window.screen,U=O.orientation||O.mozOrientation||O.msOrientation;if(U&&"string"==typeof U.type)return U.type;if("string"==typeof U)return U;var W="portrait-primary",X="landscape-primary";if("screen"===M)return O.height>O.width?W:X;if("viewport"===M)return this.visualBounds.height>this.visualBounds.width?W:X;if("window.orientation"===M&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?W:X;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return W;if(window.matchMedia("(orientation: landscape)").matches)return X}return this.visualBounds.height>this.visualBounds.width?W:X},visualBounds:new C.Rectangle,layoutBounds:new C.Rectangle,documentBounds:new C.Rectangle},C.Device.whenReady(function(M){var O=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},U=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(C.DOM,"scrollX",{get:O}),Object.defineProperty(C.DOM,"scrollY",{get:U}),Object.defineProperty(C.DOM.visualBounds,"x",{get:O}),Object.defineProperty(C.DOM.visualBounds,"y",{get:U}),Object.defineProperty(C.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(C.DOM.layoutBounds,"y",{value:0});var W=M.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(W){var X=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},V=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(C.DOM.visualBounds,"width",{get:X}),Object.defineProperty(C.DOM.visualBounds,"height",{get:V}),Object.defineProperty(C.DOM.layoutBounds,"width",{get:X}),Object.defineProperty(C.DOM.layoutBounds,"height",{get:V})}else Object.defineProperty(C.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(C.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(C.DOM.layoutBounds,"width",{get:function(){var H=document.documentElement.clientWidth,Y=window.innerWidth;return H<Y?Y:H}}),Object.defineProperty(C.DOM.layoutBounds,"height",{get:function(){var H=document.documentElement.clientHeight,Y=window.innerHeight;return H<Y?Y:H}});Object.defineProperty(C.DOM.documentBounds,"x",{value:0}),Object.defineProperty(C.DOM.documentBounds,"y",{value:0}),Object.defineProperty(C.DOM.documentBounds,"width",{get:function(){var H=document.documentElement;return Math.max(H.clientWidth,H.offsetWidth,H.scrollWidth)}}),Object.defineProperty(C.DOM.documentBounds,"height",{get:function(){var H=document.documentElement;return Math.max(H.clientHeight,H.offsetHeight,H.scrollHeight)}})},null,!0),C.ArraySet=function(M){this.position=0,this.list=M||[]},C.ArraySet.prototype={add:function(M){return this.exists(M)||this.list.push(M),M},getIndex:function(M){return this.list.indexOf(M)},getByKey:function(M,O){for(var U=this.list.length;U--;)if(this.list[U][M]===O)return this.list[U];return null},exists:function(M){return-1<this.list.indexOf(M)},reset:function(){this.list.length=0},remove:function(M){var O=this.list.indexOf(M);if(-1<O)return this.list.splice(O,1),M},setAll:function(M,O){for(var U=this.list.length;U--;)this.list[U]&&(this.list[U][M]=O)},callAll:function(M){for(var O=Array.prototype.slice.call(arguments,1),U=this.list.length;U--;)this.list[U]&&this.list[U][M]&&this.list[U][M].apply(this.list[U],O)},removeAll:function(M){void 0===M&&(M=!1);for(var O=this.list.length;O--;)if(this.list[O]){var U=this.remove(this.list[O]);M&&U.destroy()}this.position=0,this.list=[]}},Object.defineProperty(C.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(C.ArraySet.prototype,"first",{get:function(){return this.position=0,0<this.list.length?this.list[0]:null}}),Object.defineProperty(C.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),C.ArraySet.prototype.constructor=C.ArraySet,C.ArrayUtils={getRandomItem:function(M,O,U){if(null===M)return null;void 0===O&&(O=0),void 0===U&&(U=M.length);var W=O+Math.floor(Math.random()*U);return void 0===M[W]?null:M[W]},removeRandomItem:function(M,O,U){if(null==M)return null;void 0===O&&(O=0),void 0===U&&(U=M.length);var W=O+Math.floor(Math.random()*U);if(W<M.length){var X=M.splice(W,1);return void 0===X[0]?null:X[0]}return null},shuffle:function(M){for(var O=M.length-1;0<O;O--){var U=Math.floor(Math.random()*(O+1)),W=M[O];M[O]=M[U],M[U]=W}return M},transposeMatrix:function(M){for(var O=M.length,U=M[0].length,W=Array(U),X=0;X<U;X++){W[X]=Array(O);for(var V=O-1;-1<V;V--)W[X][V]=M[V][X]}return W},rotateMatrix:function(M,O){if("string"!=typeof O&&(O=(O%360+360)%360),90===O||-270===O||"rotateLeft"===O)M=C.ArrayUtils.transposeMatrix(M),M=M.reverse();else if(-90===O||270===O||"rotateRight"===O)M=M.reverse(),M=C.ArrayUtils.transposeMatrix(M);else if(180===Math.abs(O)||"rotate180"===O){for(var U=0;U<M.length;U++)M[U].reverse();M=M.reverse()}return M},findClosest:function(M,O){if(!O.length)return NaN;if(1===O.length||M<O[0])return O[0];for(var U=1;O[U]<M;)U++;var W=O[U-1],X=U<O.length?O[U]:Number.POSITIVE_INFINITY;return X-M<=M-W?X:W},rotateRight:function(M){var O=M.pop();return M.unshift(O),O},rotateLeft:function(M){var O=M.shift();return M.push(O),O},rotate:function(M){var O=M.shift();return M.push(O),O},numberArray:function(M,O){for(var U=[],W=M;W<=O;W++)U.push(W);return U},numberArrayStep:function(M,O,U){(void 0===M||null===M)&&(M=0),(void 0===O||null===O)&&(O=M,M=0),void 0===U&&(U=1);for(var W=[],X=Math.max(C.Math.roundAwayFromZero((O-M)/(U||1)),0),V=0;V<X;V++)W.push(M),M+=U;return W}},C.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},C.LinkedList.prototype={add:function(M){return 0===this.total&&null===this.first&&null===this.last?(this.first=M,this.last=M,this.next=M,M.prev=this,this.total++,M):(this.last.next=M,M.prev=this.last,this.last=M,this.total++,M)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(M){return 1===this.total?(this.reset(),void(M.next=M.prev=null)):void(M===this.first?this.first=this.first.next:M===this.last&&(this.last=this.last.prev),M.prev&&(M.prev.next=M.next),M.next&&(M.next.prev=M.prev),M.next=M.prev=null,null===this.first&&(this.last=null),this.total--)},callAll:function(M){if(this.first&&this.last){var O=this.first;do O&&O[M]&&O[M].call(O),O=O.next;while(O!==this.last.next)}}},C.LinkedList.prototype.constructor=C.LinkedList,C.Create=function(M){this.game=M,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},C.Create.PALETTE_ARNE=0,C.Create.PALETTE_JMP=1,C.Create.PALETTE_CGA=2,C.Create.PALETTE_C64=3,C.Create.PALETTE_JAPANESE_MACHINE=4,C.Create.prototype={texture:function(M,O,U,W,X,V,H,Y){void 0===U&&(U=8),void 0===W&&(W=U),void 0===X&&(X=0),void 0===V&&(V=!0);var z=O[0].length*U,K=O.length*W;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(z,K),this.bmd.clear();for(var J=0,Q;J<O.length;J++){Q=O[J];for(var Z=0,$;Z<Q.length;Z++)$=Q[Z],"."!==$&&" "!==$&&(this.ctx.fillStyle=this.palettes[X][$],this.ctx.fillRect(Z*U,J*W,U,W))}return V?this.bmd.generateTexture(M,H,Y):this.copy()},grid:function(M,O,U,W,X,V,H,Y,z){void 0===H&&(H=!0),null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(O,U),this.ctx.fillStyle=V;for(var K=0;K<U;K+=X)this.ctx.fillRect(0,K,O,1);for(var J=0;J<O;J+=W)this.ctx.fillRect(J,0,1,U);return H?this.bmd.generateTexture(M,Y,z):this.copy()},copy:function(M,O,U,W,X,V,H){return null==M&&(M=this.game.make.bitmapData()),M.resize(this.bmd.width,this.bmd.height),M.draw(this.bmd,O,U,W,X,V,H)}},C.Create.prototype.constructor=C.Create,C.FlexGrid=function(M,O,U){this.game=M.game,this.manager=M,this.width=O,this.height=U,this.boundsCustom=new C.Rectangle(0,0,O,U),this.boundsFluid=new C.Rectangle(0,0,O,U),this.boundsFull=new C.Rectangle(0,0,O,U),this.boundsNone=new C.Rectangle(0,0,O,U),this.positionCustom=new C.Point(0,0),this.positionFluid=new C.Point(0,0),this.positionFull=new C.Point(0,0),this.positionNone=new C.Point(0,0),this.scaleCustom=new C.Point(1,1),this.scaleFluid=new C.Point(1,1),this.scaleFluidInversed=new C.Point(1,1),this.scaleFull=new C.Point(1,1),this.scaleNone=new C.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=O/U,this.ratioV=U/O,this.multiplier=0,this.layers=[]},C.FlexGrid.prototype={setSize:function(M,O){this.width=M,this.height=O,this.ratioH=M/O,this.ratioV=O/M,this.scaleNone=new C.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(M,O,U,W){void 0===W&&(W=!0),this.customWidth=M,this.customHeight=O,this.boundsCustom.width=M,this.boundsCustom.height=O;var X=new C.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return W&&this.game.world.add(X),this.layers.push(X),"undefined"!=typeof U&&null!==typeof U&&X.addMultiple(U),X},createFluidLayer:function(M,O){void 0===O&&(O=!0);var U=new C.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return O&&this.game.world.add(U),this.layers.push(U),"undefined"!=typeof M&&null!==typeof M&&U.addMultiple(M),U},createFullLayer:function(M){var O=new C.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(O),this.layers.push(O),"undefined"!=typeof M&&O.addMultiple(M),O},createFixedLayer:function(M){var O=new C.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(O),this.layers.push(O),"undefined"!=typeof M&&O.addMultiple(M),O},reset:function(){for(var M=this.layers.length;M--;)this.layers[M].persist||(this.layers[M].position=null,this.layers[M].scale=null,this.layers.slice(M,1))},onResize:function(M,O){this.ratioH=M/O,this.ratioV=O/M,this.refresh(M,O)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(M){this.manager.scaleSprite(M),M.x=this.manager.bounds.centerX,M.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},C.FlexGrid.prototype.constructor=C.FlexGrid,C.FlexLayer=function(M,O,U,W){C.Group.call(this,M.game,null,"__flexLayer"+M.game.rnd.uuid(),!1),this.manager=M.manager,this.grid=M,this.persist=!1,this.position=O,this.bounds=U,this.scale=W,this.topLeft=U.topLeft,this.topMiddle=new C.Point(U.halfWidth,0),this.topRight=U.topRight,this.bottomLeft=U.bottomLeft,this.bottomMiddle=new C.Point(U.halfWidth,U.bottom),this.bottomRight=U.bottomRight},C.FlexLayer.prototype=Object.create(C.Group.prototype),C.FlexLayer.prototype.constructor=C.FlexLayer,C.FlexLayer.prototype.resize=function(){},C.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},C.Color={packPixel:function(M,O,U,W){return C.Device.LITTLE_ENDIAN?(W<<24|U<<16|O<<8|M)>>>0:(M<<24|O<<16|U<<8|W)>>>0},unpackPixel:function(M,O,U,W){return(void 0===O||null===O)&&(O=C.Color.createColor()),(void 0===U||null===U)&&(U=!1),(void 0===W||null===W)&&(W=!1),C.Device.LITTLE_ENDIAN?(O.a=(4278190080&M)>>>24,O.b=(16711680&M)>>>16,O.g=(65280&M)>>>8,O.r=255&M):(O.r=(4278190080&M)>>>24,O.g=(16711680&M)>>>16,O.b=(65280&M)>>>8,O.a=255&M),O.color=M,O.rgba="rgba("+O.r+","+O.g+","+O.b+","+O.a/255+")",U&&C.Color.RGBtoHSL(O.r,O.g,O.b,O),W&&C.Color.RGBtoHSV(O.r,O.g,O.b,O),O},fromRGBA:function(M,O){return O||(O=C.Color.createColor()),O.r=(4278190080&M)>>>24,O.g=(16711680&M)>>>16,O.b=(65280&M)>>>8,O.a=255&M,O.rgba="rgba("+O.r+","+O.g+","+O.b+","+O.a+")",O},toRGBA:function(M,O,U,W){return M<<24|O<<16|U<<8|W},toABGR:function(M,O,U,W){return(W<<24|U<<16|O<<8|M)>>>0},hexToRGBArray:function(M){return[(255&M>>16)/255,(255&M>>8)/255,(255&M)/255]},RGBArrayToHex:function(M){return(255*M[0]<<16)+(255*M[1]<<8)+255*M[2]},RGBtoHSL:function(M,O,U,W){W||(W=C.Color.createColor(M,O,U,1)),M/=255,O/=255,U/=255;var X=Math.min(M,O,U),V=Math.max(M,O,U);if(W.h=0,W.s=0,W.l=(V+X)/2,V!==X){var H=V-X;W.s=0.5<W.l?H/(2-V-X):H/(V+X),V===M?W.h=(O-U)/H+(O<U?6:0):V===O?W.h=(U-M)/H+2:V===U&&(W.h=(M-O)/H+4),W.h/=6}return W},HSLtoRGB:function(M,O,U,W){if(W?(W.r=U,W.g=U,W.b=U):W=C.Color.createColor(U,U,U),0!==O){var X=0.5>U?U*(1+O):U+O-U*O,V=2*U-X;W.r=C.Color.hueToColor(V,X,M+1/3),W.g=C.Color.hueToColor(V,X,M),W.b=C.Color.hueToColor(V,X,M-1/3)}return W.r=Math.floor(0|255*W.r),W.g=Math.floor(0|255*W.g),W.b=Math.floor(0|255*W.b),C.Color.updateColor(W),W},RGBtoHSV:function(M,O,U,W){W||(W=C.Color.createColor(M,O,U,255)),M/=255,O/=255,U/=255;var X=Math.min(M,O,U),V=Math.max(M,O,U),H=V-X;return W.h=0,W.s=0===V?0:H/V,W.v=V,V!==X&&(V===M?W.h=(O-U)/H+(O<U?6:0):V===O?W.h=(U-M)/H+2:V===U&&(W.h=(M-O)/H+4),W.h/=6),W},HSVtoRGB:function(M,O,U,W){void 0===W&&(W=C.Color.createColor(0,0,0,1,M,O,0,U));var Y=Math.floor(6*M),z=6*M-Y,K=U*(1-O),J=U*(1-z*O),Q=U*(1-(1-z)*O),X,V,H;switch(Y%6){case 0:X=U,V=Q,H=K;break;case 1:X=J,V=U,H=K;break;case 2:X=K,V=U,H=Q;break;case 3:X=K,V=J,H=U;break;case 4:X=Q,V=K,H=U;break;case 5:X=U,V=K,H=J;}return W.r=Math.floor(255*X),W.g=Math.floor(255*V),W.b=Math.floor(255*H),C.Color.updateColor(W),W},hueToColor:function(M,O,U){return 0>U&&(U+=1),1<U&&(U-=1),U<1/6?M+6*(O-M)*U:U<1/2?O:U<2/3?M+6*((O-M)*(2/3-U)):M},createColor:function(M,O,U,W,X,V,H,Y){return C.Color.updateColor({r:M||0,g:O||0,b:U||0,a:W||1,h:X||0,s:V||0,l:H||0,v:Y||0,color:0,color32:0,rgba:""})},updateColor:function(M){return M.rgba="rgba("+M.r.toFixed()+","+M.g.toFixed()+","+M.b.toFixed()+","+M.a.toString()+")",M.color=C.Color.getColor(M.r,M.g,M.b),M.color32=C.Color.getColor32(255*M.a,M.r,M.g,M.b),M},getColor32:function(M,O,U,W){return M<<24|O<<16|U<<8|W},getColor:function(M,O,U){return M<<16|O<<8|U},RGBtoString:function(M,O,U,W,X){return void 0===W&&(W=255),void 0===X&&(X="#"),"#"===X?"#"+(16777216+(M<<16)+(O<<8)+U).toString(16).slice(1):"0x"+C.Color.componentToHex(W)+C.Color.componentToHex(M)+C.Color.componentToHex(O)+C.Color.componentToHex(U)},hexToRGB:function(M){var O=C.Color.hexToColor(M);if(O)return C.Color.getColor32(O.a,O.r,O.g,O.b)},hexToColor:function(M,O){M=M.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(H,Y,z,K){return Y+Y+z+z+K+K});var U=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(M);if(U){var W=parseInt(U[1],16),X=parseInt(U[2],16),V=parseInt(U[3],16);O?(O.r=W,O.g=X,O.b=V):O=C.Color.createColor(W,X,V)}return O},webToColor:function(M,O){O||(O=C.Color.createColor());var U=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(M);return U&&(O.r=parseInt(U[1],10),O.g=parseInt(U[2],10),O.b=parseInt(U[3],10),O.a=void 0===U[4]?1:parseFloat(U[4]),C.Color.updateColor(O)),O},valueToColor:function(M,O){if(O||(O=C.Color.createColor()),"string"==typeof M)return 0===M.indexOf("rgb")?C.Color.webToColor(M,O):(O.a=1,C.Color.hexToColor(M,O));if("number"==typeof M){var U=C.Color.getRGB(M);return O.r=U.r,O.g=U.g,O.b=U.b,O.a=U.a/255,O}return O},componentToHex:function(M){var O=M.toString(16);return 1===O.length?"0"+O:O},HSVColorWheel:function(M,O){void 0===M&&(M=1),void 0===O&&(O=1);for(var U=[],W=0;359>=W;W++)U.push(C.Color.HSVtoRGB(W/359,M,O));return U},HSLColorWheel:function(M,O){void 0===M&&(M=0.5),void 0===O&&(O=0.5);for(var U=[],W=0;359>=W;W++)U.push(C.Color.HSLtoRGB(W/359,M,O));return U},interpolateColor:function(M,O,U,W,X){void 0===X&&(X=255);var V=C.Color.getRGB(M),H=C.Color.getRGB(O),Y=(H.red-V.red)*W/U+V.red,z=(H.green-V.green)*W/U+V.green,K=(H.blue-V.blue)*W/U+V.blue;return C.Color.getColor32(X,Y,z,K)},interpolateColorWithRGB:function(M,O,U,W,X,V){var H=C.Color.getRGB(M),Y=(O-H.red)*V/X+H.red,z=(U-H.green)*V/X+H.green,K=(W-H.blue)*V/X+H.blue;return C.Color.getColor(Y,z,K)},interpolateRGB:function(M,O,U,W,X,V,H,Y){return C.Color.getColor((W-M)*Y/H+M,(X-O)*Y/H+O,(V-U)*Y/H+U)},getRandomColor:function(M,O,U){if(void 0===M&&(M=0),void 0===O&&(O=255),void 0===U&&(U=255),255<O||M>O)return C.Color.getColor(255,255,255);var W=M+Math.round(Math.random()*(O-M)),X=M+Math.round(Math.random()*(O-M)),V=M+Math.round(Math.random()*(O-M));return C.Color.getColor32(U,W,X,V)},getRGB:function(M){return 16777215<M?{alpha:M>>>24,red:255&M>>16,green:255&M>>8,blue:255&M,a:M>>>24,r:255&M>>16,g:255&M>>8,b:255&M}:{alpha:255,red:255&M>>16,green:255&M>>8,blue:255&M,a:255,r:255&M>>16,g:255&M>>8,b:255&M}},getWebRGB:function(M){if("object"==typeof M)return"rgba("+M.r.toString()+","+M.g.toString()+","+M.b.toString()+","+(M.a/255).toString()+")";var O=C.Color.getRGB(M);return"rgba("+O.r.toString()+","+O.g.toString()+","+O.b.toString()+","+(O.a/255).toString()+")"},getAlpha:function(M){return M>>>24},getAlphaFloat:function(M){return(M>>>24)/255},getRed:function(M){return 255&M>>16},getGreen:function(M){return 255&M>>8},getBlue:function(M){return 255&M},blendNormal:function(M){return M},blendLighten:function(M,O){return O>M?O:M},blendDarken:function(M,O){return O>M?M:O},blendMultiply:function(M,O){return M*O/255},blendAverage:function(M,O){return(M+O)/2},blendAdd:function(M,O){return Math.min(255,M+O)},blendSubtract:function(M,O){return Math.max(0,M+O-255)},blendDifference:function(M,O){return Math.abs(M-O)},blendNegation:function(M,O){return 255-Math.abs(255-M-O)},blendScreen:function(M,O){return 255-((255-M)*(255-O)>>8)},blendExclusion:function(M,O){return M+O-2*M*O/255},blendOverlay:function(M,O){return 128>O?2*M*O/255:255-2*(255-M)*(255-O)/255},blendSoftLight:function(M,O){return 128>O?2*((M>>1)+64)*(O/255):255-2*(255-((M>>1)+64))*(255-O)/255},blendHardLight:function(M,O){return C.Color.blendOverlay(O,M)},blendColorDodge:function(M,O){return 255===O?O:Math.min(255,(M<<8)/(255-O))},blendColorBurn:function(M,O){return 0===O?O:Math.max(0,255-(255-M<<8)/O)},blendLinearDodge:function(M,O){return C.Color.blendAdd(M,O)},blendLinearBurn:function(M,O){return C.Color.blendSubtract(M,O)},blendLinearLight:function(M,O){return 128>O?C.Color.blendLinearBurn(M,2*O):C.Color.blendLinearDodge(M,2*(O-128))},blendVividLight:function(M,O){return 128>O?C.Color.blendColorBurn(M,2*O):C.Color.blendColorDodge(M,2*(O-128))},blendPinLight:function(M,O){return 128>O?C.Color.blendDarken(M,2*O):C.Color.blendLighten(M,2*(O-128))},blendHardMix:function(M,O){return 128>C.Color.blendVividLight(M,O)?0:255},blendReflect:function(M,O){return 255===O?O:Math.min(255,M*M/(255-O))},blendGlow:function(M,O){return C.Color.blendReflect(O,M)},blendPhoenix:function(M,O){return Math.min(M,O)-Math.max(M,O)+255}},C.Physics=function(M,O){O=O||{},this.game=M,this.config=O,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},C.Physics.ARCADE=0,C.Physics.P2JS=1,C.Physics.NINJA=2,C.Physics.BOX2D=3,C.Physics.CHIPMUNK=4,C.Physics.MATTERJS=5,C.Physics.prototype={parseConfig:function(){(!this.config.hasOwnProperty("arcade")||!0===this.config.arcade)&&C.Physics.hasOwnProperty("Arcade")&&(this.arcade=new C.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&C.Physics.hasOwnProperty("Ninja")&&(this.ninja=new C.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&C.Physics.hasOwnProperty("P2")&&(this.p2=new C.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&C.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new C.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&C.Physics.hasOwnProperty("Matter")&&(this.matter=new C.Physics.Matter(this.game,this.config))},startSystem:function(M){M===C.Physics.ARCADE?this.arcade=new C.Physics.Arcade(this.game):M===C.Physics.P2JS?null===this.p2?this.p2=new C.Physics.P2(this.game,this.config):this.p2.reset():M===C.Physics.NINJA?this.ninja=new C.Physics.Ninja(this.game):M===C.Physics.BOX2D?null===this.box2d?this.box2d=new C.Physics.Box2D(this.game,this.config):this.box2d.reset():M===C.Physics.MATTERJS&&(null===this.matter?this.matter=new C.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(M,O,U){void 0===O&&(O=C.Physics.ARCADE),void 0===U&&(U=!1),O===C.Physics.ARCADE?this.arcade.enable(M):O===C.Physics.P2JS&&this.p2?this.p2.enable(M,U):O===C.Physics.NINJA&&this.ninja?this.ninja.enableAABB(M):O===C.Physics.BOX2D&&this.box2d?this.box2d.enable(M):O===C.Physics.MATTERJS&&this.matter?this.matter.enable(M):console.warn(M.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},C.Physics.prototype.constructor=C.Physics,C.Physics.Arcade=function(M){this.game=M,this.gravity=new C.Point,this.bounds=new C.Rectangle(0,0,M.world.width,M.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=C.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new C.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},C.Physics.Arcade.prototype.constructor=C.Physics.Arcade,C.Physics.Arcade.SORT_NONE=0,C.Physics.Arcade.LEFT_RIGHT=1,C.Physics.Arcade.RIGHT_LEFT=2,C.Physics.Arcade.TOP_BOTTOM=3,C.Physics.Arcade.BOTTOM_TOP=4,C.Physics.Arcade.prototype={setBounds:function(M,O,U,W){this.bounds.setTo(M,O,U,W)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(M,O){void 0===O&&(O=!0);var U=1;if(Array.isArray(M))for(U=M.length;U--;)M[U]instanceof C.Group?this.enable(M[U].children,O):(this.enableBody(M[U]),O&&M[U].hasOwnProperty("children")&&0<M[U].children.length&&this.enable(M[U],!0));else M instanceof C.Group?this.enable(M.children,O):(this.enableBody(M),O&&M.hasOwnProperty("children")&&0<M.children.length&&this.enable(M.children,!0))},enableBody:function(M){M.hasOwnProperty("body")&&null===M.body&&(M.body=new C.Physics.Arcade.Body(M),M.parent&&M.parent instanceof C.Group&&M.parent.addToHash(M))},updateMotion:function(M){if(M.allowRotation){var O=this.computeVelocity(0,M,M.angularVelocity,M.angularAcceleration,M.angularDrag,M.maxAngular)-M.angularVelocity;M.angularVelocity+=O,M.rotation+=M.angularVelocity*this.game.time.physicsElapsed}M.velocity.x=this.computeVelocity(1,M,M.velocity.x,M.acceleration.x,M.drag.x,M.maxVelocity.x),M.velocity.y=this.computeVelocity(2,M,M.velocity.y,M.acceleration.y,M.drag.y,M.maxVelocity.y)},computeVelocity:function(M,O,U,W,X,V){return void 0===V&&(V=1e4),1===M&&O.allowGravity?U+=(this.gravity.x+O.gravity.x)*this.game.time.physicsElapsed:2==M&&O.allowGravity&&(U+=(this.gravity.y+O.gravity.y)*this.game.time.physicsElapsed),W?U+=W*this.game.time.physicsElapsed:X&&O.allowDrag&&(X*=this.game.time.physicsElapsed,0<U-X?U-=X:0>U+X?U+=X:U=0),U>V?U=V:U<-V&&(U=-V),U},overlap:function(M,O,U,W,X){return U=U||null,W=W||null,X=X||U,this._total=0,this.collideObjects(M,O,U,W,X,!0),0<this._total},collide:function(M,O,U,W,X){return U=U||null,W=W||null,X=X||U,this._total=0,this.collideObjects(M,O,U,W,X,!1),0<this._total},sortLeftRight:function(M,O){return M.body&&O.body?M.body.x-O.body.x:0},sortRightLeft:function(M,O){return M.body&&O.body?O.body.x-M.body.x:0},sortTopBottom:function(M,O){return M.body&&O.body?M.body.y-O.body.y:0},sortBottomTop:function(M,O){return M.body&&O.body?O.body.y-M.body.y:0},sort:function(M,O){null===M.physicsSortDirection?void 0===O&&(O=this.sortDirection):O=M.physicsSortDirection,O===C.Physics.Arcade.LEFT_RIGHT?M.hash.sort(this.sortLeftRight):O===C.Physics.Arcade.RIGHT_LEFT?M.hash.sort(this.sortRightLeft):O===C.Physics.Arcade.TOP_BOTTOM?M.hash.sort(this.sortTopBottom):O===C.Physics.Arcade.BOTTOM_TOP&&M.hash.sort(this.sortBottomTop)},collideObjects:function(M,O,U,W,X,V){if(!Array.isArray(M)&&Array.isArray(O))for(var H=0;H<O.length;H++)O[H]&&this.collideHandler(M,O[H],U,W,X,V);else if(Array.isArray(M)&&!Array.isArray(O))for(var H=0;H<M.length;H++)M[H]&&this.collideHandler(M[H],O,U,W,X,V);else if(Array.isArray(M)&&Array.isArray(O)){for(var H=0;H<M.length;H++)if(M[H])for(var Y=0;Y<O.length;Y++)O[Y]&&this.collideHandler(M[H],O[Y],U,W,X,V);}else this.collideHandler(M,O,U,W,X,V)},collideHandler:function(M,O,U,W,X,V){return void 0===O&&M.physicsType===C.GROUP?(this.sort(M),void this.collideGroupVsSelf(M,U,W,X,V)):void(!M||!O||!M.exists||!O.exists||(this.sortDirection!==C.Physics.Arcade.SORT_NONE&&(M.physicsType===C.GROUP&&this.sort(M),O.physicsType===C.GROUP&&this.sort(O)),M.physicsType===C.SPRITE?O.physicsType===C.SPRITE?this.collideSpriteVsSprite(M,O,U,W,X,V):O.physicsType===C.GROUP?this.collideSpriteVsGroup(M,O,U,W,X,V):O.physicsType===C.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(M,O,U,W,X,V):M.physicsType===C.GROUP?O.physicsType===C.SPRITE?this.collideSpriteVsGroup(O,M,U,W,X,V):O.physicsType===C.GROUP?this.collideGroupVsGroup(M,O,U,W,X,V):O.physicsType===C.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(M,O,U,W,X,V):M.physicsType===C.TILEMAPLAYER&&(O.physicsType===C.SPRITE?this.collideSpriteVsTilemapLayer(O,M,U,W,X,V):O.physicsType===C.GROUP&&this.collideGroupVsTilemapLayer(O,M,U,W,X,V))))},collideSpriteVsSprite:function(M,O,U,W,X,V){return M.body&&O.body&&(this.separate(M.body,O.body,W,X,V)&&(U&&U.call(X,M,O),this._total++),!0)},collideSpriteVsGroup:function(M,O,U,W,X,V){if(0!==O.length&&M.body)if(this.skipQuadTree||M.body.skipQuadTree){for(var H={},Y=0,z;Y<O.hash.length;Y++)if(z=O.hash[Y],z&&z.exists&&z.body){if(H=z.body.getBounds(H),this.sortDirection===C.Physics.Arcade.LEFT_RIGHT){if(M.body.right<H.x)break;else if(H.right<M.body.x)continue;}else if(this.sortDirection===C.Physics.Arcade.RIGHT_LEFT){if(M.body.x>H.right)break;else if(H.x>M.body.right)continue;}else if(this.sortDirection===C.Physics.Arcade.TOP_BOTTOM){if(M.body.bottom<H.y)break;else if(H.bottom<M.body.y)continue;}else if(this.sortDirection===C.Physics.Arcade.BOTTOM_TOP)if(M.body.y>H.bottom)break;else if(H.y>M.body.bottom)continue;this.collideSpriteVsSprite(M,z,U,W,X,V)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(O);for(var K=this.quadTree.retrieve(M),Y=0;Y<K.length;Y++)this.separate(M.body,K[Y],W,X,V)&&(U&&U.call(X,M,K[Y].sprite),this._total++)}},collideGroupVsSelf:function(M,O,U,W,X){if(0!==M.length)for(var V=0;V<M.hash.length;V++){var H={},Y=M.hash[V];if(Y&&Y.exists&&Y.body){H=Y.body.getBounds(H);for(var z=V+1;z<M.hash.length;z++){var K={},J=M.hash[z];if(J&&J.exists&&J.body){if(K=J.body.getBounds(K),this.sortDirection===C.Physics.Arcade.LEFT_RIGHT){if(H.right<K.x)break;else if(K.right<H.x)continue;}else if(this.sortDirection===C.Physics.Arcade.RIGHT_LEFT){if(H.x>K.right)continue;else if(K.x>H.right)break;}else if(this.sortDirection===C.Physics.Arcade.TOP_BOTTOM){if(H.bottom<K.y)continue;else if(K.bottom<H.y)break;}else if(this.sortDirection===C.Physics.Arcade.BOTTOM_TOP)if(H.y>K.bottom)continue;else if(K.y>Y.body.bottom)break;this.collideSpriteVsSprite(Y,J,O,U,W,X)}}}}},collideGroupVsGroup:function(M,O,U,W,X,V){if(0!==M.length&&0!==O.length)for(var H=0;H<M.children.length;H++)M.children[H].exists&&(M.children[H].physicsType===C.GROUP?this.collideGroupVsGroup(M.children[H],O,U,W,X,V):this.collideSpriteVsGroup(M.children[H],O,U,W,X,V))},separate:function(M,O,U,W,X){if(!M.enable||!O.enable||M.checkCollision.none||O.checkCollision.none||!this.intersects(M,O))return!1;if(U&&!1===U.call(W,M.sprite,O.sprite))return!1;if(M.isCircle&&O.isCircle)return this.separateCircle(M,O,X);if(M.isCircle!==O.isCircle){var V=M.isCircle?O:M,H=M.isCircle?M:O,Y={x:V.x,y:V.y,right:V.right,bottom:V.bottom},z=H.center;if((z.y<Y.y||z.y>Y.bottom)&&(z.x<Y.x||z.x>Y.right))return this.separateCircle(M,O,X)}var K=!1,J=!1;this.forceX||Math.abs(this.gravity.y+M.gravity.y)<Math.abs(this.gravity.x+M.gravity.x)?(K=this.separateX(M,O,X),this.intersects(M,O)&&(J=this.separateY(M,O,X))):(J=this.separateY(M,O,X),this.intersects(M,O)&&(K=this.separateX(M,O,X)));var Q=K||J;return Q&&(X?(M.onOverlap&&M.onOverlap.dispatch(M.sprite,O.sprite),O.onOverlap&&O.onOverlap.dispatch(O.sprite,M.sprite)):(M.onCollide&&M.onCollide.dispatch(M.sprite,O.sprite),O.onCollide&&O.onCollide.dispatch(O.sprite,M.sprite))),Q},intersects:function(M,O){return M!==O&&(M.isCircle?O.isCircle?C.Math.distance(M.center.x,M.center.y,O.center.x,O.center.y)<=M.halfWidth+O.halfWidth:this.circleBodyIntersects(M,O):O.isCircle?this.circleBodyIntersects(O,M):!(M.right<=O.position.x)&&!(M.bottom<=O.position.y)&&!(M.position.x>=O.right)&&!(M.position.y>=O.bottom))},circleBodyIntersects:function(M,O){var U=C.Math.clamp(M.center.x,O.left,O.right),W=C.Math.clamp(M.center.y,O.top,O.bottom),X=(M.center.x-U)*(M.center.x-U),V=(M.center.y-W)*(M.center.y-W);return X+V<=M.halfWidth*M.halfWidth},separateCircle:function(M,O,U){this.getOverlapX(M,O),this.getOverlapY(M,O);var W=O.center.x-M.center.x,X=O.center.y-M.center.y,V=Math.atan2(X,W),H=0;if(M.isCircle!==O.isCircle){var Y={x:O.isCircle?M.position.x:O.position.x,y:O.isCircle?M.position.y:O.position.y,right:O.isCircle?M.right:O.right,bottom:O.isCircle?M.bottom:O.bottom},z={x:M.isCircle?M.center.x:O.center.x,y:M.isCircle?M.center.y:O.center.y,radius:M.isCircle?M.halfWidth:O.halfWidth};z.y<Y.y?z.x<Y.x?H=C.Math.distance(z.x,z.y,Y.x,Y.y)-z.radius:z.x>Y.right&&(H=C.Math.distance(z.x,z.y,Y.right,Y.y)-z.radius):z.y>Y.bottom&&(z.x<Y.x?H=C.Math.distance(z.x,z.y,Y.x,Y.bottom)-z.radius:z.x>Y.right&&(H=C.Math.distance(z.x,z.y,Y.right,Y.bottom)-z.radius)),H*=-1}else H=M.halfWidth+O.halfWidth-C.Math.distance(M.center.x,M.center.y,O.center.x,O.center.y);if(U||0==H||M.immovable&&O.immovable||M.customSeparateX||O.customSeparateX)return 0!=H&&(M.onOverlap&&M.onOverlap.dispatch(M.sprite,O.sprite),O.onOverlap&&O.onOverlap.dispatch(O.sprite,M.sprite)),0!=H;var K={x:M.velocity.x*Math.cos(V)+M.velocity.y*Math.sin(V),y:M.velocity.x*Math.sin(V)-M.velocity.y*Math.cos(V)},J={x:O.velocity.x*Math.cos(V)+O.velocity.y*Math.sin(V),y:O.velocity.x*Math.sin(V)-O.velocity.y*Math.cos(V)},Q=((M.mass-O.mass)*K.x+2*O.mass*J.x)/(M.mass+O.mass),Z=(2*M.mass*K.x+(O.mass-M.mass)*J.x)/(M.mass+O.mass);return M.immovable||(M.velocity.x=(Q*Math.cos(V)-K.y*Math.sin(V))*M.bounce.x,M.velocity.y=(K.y*Math.cos(V)+Q*Math.sin(V))*M.bounce.y),O.immovable||(O.velocity.x=(Z*Math.cos(V)-J.y*Math.sin(V))*O.bounce.x,O.velocity.y=(J.y*Math.cos(V)+Z*Math.sin(V))*O.bounce.y),Math.abs(V)<Math.PI/2?0<M.velocity.x&&!M.immovable&&O.velocity.x>M.velocity.x?M.velocity.x*=-1:0>O.velocity.x&&!O.immovable&&M.velocity.x<O.velocity.x?O.velocity.x*=-1:0<M.velocity.y&&!M.immovable&&O.velocity.y>M.velocity.y?M.velocity.y*=-1:0>O.velocity.y&&!O.immovable&&M.velocity.y<O.velocity.y&&(O.velocity.y*=-1):Math.abs(V)>Math.PI/2&&(0>M.velocity.x&&!M.immovable&&O.velocity.x<M.velocity.x?M.velocity.x*=-1:0<O.velocity.x&&!O.immovable&&M.velocity.x>O.velocity.x?O.velocity.x*=-1:0>M.velocity.y&&!M.immovable&&O.velocity.y<M.velocity.y?M.velocity.y*=-1:0<O.velocity.y&&!O.immovable&&M.velocity.x>O.velocity.y&&(O.velocity.y*=-1)),M.immovable||(M.x+=M.velocity.x*this.game.time.physicsElapsed-H*Math.cos(V),M.y+=M.velocity.y*this.game.time.physicsElapsed-H*Math.sin(V)),O.immovable||(O.x+=O.velocity.x*this.game.time.physicsElapsed+H*Math.cos(V),O.y+=O.velocity.y*this.game.time.physicsElapsed+H*Math.sin(V)),M.onCollide&&M.onCollide.dispatch(M.sprite,O.sprite),O.onCollide&&O.onCollide.dispatch(O.sprite,M.sprite),!0},getOverlapX:function(M,O,U){var W=0,X=M.deltaAbsX()+O.deltaAbsX()+this.OVERLAP_BIAS;return 0===M.deltaX()&&0===O.deltaX()?(M.embedded=!0,O.embedded=!0):M.deltaX()>O.deltaX()?(W=M.right-O.x,W>X&&!U||!1===M.checkCollision.right||!1===O.checkCollision.left?W=0:(M.touching.none=!1,M.touching.right=!0,O.touching.none=!1,O.touching.left=!0)):M.deltaX()<O.deltaX()&&(W=M.x-O.width-O.x,-W>X&&!U||!1===M.checkCollision.left||!1===O.checkCollision.right?W=0:(M.touching.none=!1,M.touching.left=!0,O.touching.none=!1,O.touching.right=!0)),M.overlapX=W,O.overlapX=W,W},getOverlapY:function(M,O,U){var W=0,X=M.deltaAbsY()+O.deltaAbsY()+this.OVERLAP_BIAS;return 0===M.deltaY()&&0===O.deltaY()?(M.embedded=!0,O.embedded=!0):M.deltaY()>O.deltaY()?(W=M.bottom-O.y,W>X&&!U||!1===M.checkCollision.down||!1===O.checkCollision.up?W=0:(M.touching.none=!1,M.touching.down=!0,O.touching.none=!1,O.touching.up=!0)):M.deltaY()<O.deltaY()&&(W=M.y-O.bottom,-W>X&&!U||!1===M.checkCollision.up||!1===O.checkCollision.down?W=0:(M.touching.none=!1,M.touching.up=!0,O.touching.none=!1,O.touching.down=!0)),M.overlapY=W,O.overlapY=W,W},separateX:function(M,O,U){var W=this.getOverlapX(M,O,U);if(U||0===W||M.immovable&&O.immovable||M.customSeparateX||O.customSeparateX)return 0!=W||M.embedded&&O.embedded;var X=M.velocity.x,V=O.velocity.x;if(!M.immovable&&!O.immovable){W*=0.5,M.x-=W,O.x+=W;var H=Math.sqrt(V*V*O.mass/M.mass)*(0<V?1:-1),Y=Math.sqrt(X*X*M.mass/O.mass)*(0<X?1:-1),z=0.5*(H+Y);H-=z,Y-=z,M.velocity.x=z+H*M.bounce.x,O.velocity.x=z+Y*O.bounce.x}else M.immovable?(O.x+=W,O.velocity.x=X-V*O.bounce.x,M.moves&&(O.y+=(M.y-M.prev.y)*M.friction.y)):(M.x-=W,M.velocity.x=V-X*M.bounce.x,O.moves&&(M.y+=(O.y-O.prev.y)*O.friction.y));return!0},separateY:function(M,O,U){var W=this.getOverlapY(M,O,U);if(U||0===W||M.immovable&&O.immovable||M.customSeparateY||O.customSeparateY)return 0!=W||M.embedded&&O.embedded;var X=M.velocity.y,V=O.velocity.y;if(!M.immovable&&!O.immovable){W*=0.5,M.y-=W,O.y+=W;var H=Math.sqrt(V*V*O.mass/M.mass)*(0<V?1:-1),Y=Math.sqrt(X*X*M.mass/O.mass)*(0<X?1:-1),z=0.5*(H+Y);H-=z,Y-=z,M.velocity.y=z+H*M.bounce.y,O.velocity.y=z+Y*O.bounce.y}else M.immovable?(O.y+=W,O.velocity.y=X-V*O.bounce.y,M.moves&&(O.x+=(M.x-M.prev.x)*M.friction.x)):(M.y-=W,M.velocity.y=V-X*M.bounce.y,O.moves&&(M.x+=(O.x-O.prev.x)*O.friction.x));return!0},getObjectsUnderPointer:function(M,O,U,W){return 0!==O.length&&M.exists?this.getObjectsAtLocation(M.x,M.y,O,U,W,M):void 0},getObjectsAtLocation:function(M,O,U,W,X,V){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(U);for(var H=new C.Rectangle(M,O,1,1),Y=[],z=this.quadTree.retrieve(H),K=0;K<z.length;K++)z[K].hitTest(M,O)&&(W&&W.call(X,V,z[K].sprite),Y.push(z[K].sprite));return Y},moveToObject:function(M,O,U,W){void 0===U&&(U=60),void 0===W&&(W=0);var X=Math.atan2(O.y-M.y,O.x-M.x);return 0<W&&(U=this.distanceBetween(M,O)/(W/1e3)),M.body.velocity.setToPolar(X,U),X},moveToPointer:function(M,O,U,W){void 0===O&&(O=60),U=U||this.game.input.activePointer,void 0===W&&(W=0);var X=this.angleToPointer(M,U);return 0<W&&(O=this.distanceToPointer(M,U)/(W/1e3)),M.body.velocity.setToPolar(X,O),X},moveToXY:function(M,O,U,W,X){void 0===W&&(W=60),void 0===X&&(X=0);var V=Math.atan2(U-M.y,O-M.x);return 0<X&&(W=this.distanceToXY(M,O,U)/(X/1e3)),M.body.velocity.setToPolar(V,W),V},velocityFromAngle:function(M,O,U){return void 0===O&&(O=60),U=U||new C.Point,U.setToPolar(M,O,!0)},velocityFromRotation:function(M,O,U){return void 0===O&&(O=60),U=U||new C.Point,U.setToPolar(M,O)},accelerationFromRotation:function(M,O,U){return void 0===O&&(O=60),U=U||new C.Point,U.setToPolar(M,O)},accelerateToObject:function(M,O,U,W,X){void 0===U&&(U=60),void 0===W&&(W=1e3),void 0===X&&(X=1e3);var V=this.angleBetween(M,O);return M.body.acceleration.setToPolar(V,U),M.body.maxVelocity.setTo(W,X),V},accelerateToPointer:function(M,O,U,W,X){void 0===U&&(U=60),void 0===O&&(O=this.game.input.activePointer),void 0===W&&(W=1e3),void 0===X&&(X=1e3);var V=this.angleToPointer(M,O);return M.body.acceleration.setToPolar(V,U),M.body.maxVelocity.setTo(W,X),V},accelerateToXY:function(M,O,U,W,X,V){void 0===W&&(W=60),void 0===X&&(X=1e3),void 0===V&&(V=1e3);var H=this.angleToXY(M,O,U);return M.body.acceleration.setTo(H,W),M.body.maxVelocity.setTo(X,V),H},distanceBetween:function(M,O,U){void 0===U&&(U=!1);var W=U?M.world.x-O.world.x:M.x-O.x,X=U?M.world.y-O.world.y:M.y-O.y;return Math.sqrt(W*W+X*X)},distanceToXY:function(M,O,U,W){void 0===W&&(W=!1);var X=W?M.world.x-O:M.x-O,V=W?M.world.y-U:M.y-U;return Math.sqrt(X*X+V*V)},distanceToPointer:function(M,O,U){void 0===O&&(O=this.game.input.activePointer),void 0===U&&(U=!1);var W=U?M.world.x-O.worldX:M.x-O.worldX,X=U?M.world.y-O.worldY:M.y-O.worldY;return Math.sqrt(W*W+X*X)},angleBetween:function(M,O,U){return void 0===U&&(U=!1),U?Math.atan2(O.world.y-M.world.y,O.world.x-M.world.x):Math.atan2(O.y-M.y,O.x-M.x)},angleBetweenCenters:function(M,O){var U=O.centerX-M.centerX,W=O.centerY-M.centerY;return Math.atan2(W,U)},angleToXY:function(M,O,U,W){return void 0===W&&(W=!1),W?Math.atan2(U-M.world.y,O-M.world.x):Math.atan2(U-M.y,O-M.x)},angleToPointer:function(M,O,U){return void 0===O&&(O=this.game.input.activePointer),void 0===U&&(U=!1),U?Math.atan2(O.worldY-M.world.y,O.worldX-M.world.x):Math.atan2(O.worldY-M.y,O.worldX-M.x)},worldAngleToPointer:function(M,O){return this.angleToPointer(M,O,!0)}},C.Physics.Arcade.Body=function(M){this.sprite=M,this.game=M.game,this.type=C.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new C.Point,this.position=new C.Point(M.x,M.y),this.prev=new C.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=M.angle,this.preRotation=M.angle,this.width=M.width,this.height=M.height,this.sourceWidth=M.width,this.sourceHeight=M.height,M.texture&&(this.sourceWidth=M.texture.frame.width,this.sourceHeight=M.texture.frame.height),this.halfWidth=Math.abs(M.width/2),this.halfHeight=Math.abs(M.height/2),this.center=new C.Point(M.x+this.halfWidth,M.y+this.halfHeight),this.velocity=new C.Point,this.newVelocity=new C.Point,this.deltaMax=new C.Point,this.acceleration=new C.Point,this.allowDrag=!0,this.drag=new C.Point,this.allowGravity=!0,this.gravity=new C.Point,this.bounce=new C.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new C.Point(1e4,1e4),this.friction=new C.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=C.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1},this.tilePadding=new C.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new C.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=M.scale.x,this._sy=M.scale.y,this._dx=0,this._dy=0},C.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var M=this.sprite.getBounds();M.ceilAll(),(M.width!==this.width||M.height!==this.height)&&(this.width=M.width,this.height=M.height,this._reset=!0)}else{var O=Math.abs(this.sprite.scale.x),U=Math.abs(this.sprite.scale.y);(O!==this._sx||U!==this._sy)&&(this.width=this.sourceWidth*O,this.height=this.sourceHeight*U,this._sx=O,this._sy=U,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter())},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){!this.enable||this.game.physics.arcade.isPaused||(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.none=!0,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=0>this.sprite.scale.x?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=0>this.sprite.scale.y?this.height:0,this.updateCenter(),this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.updateCenter(),(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var M=0,O=0!==this.overlapX||0!==this.overlapY;if(0<this.moveDuration?(this.moveTimer+=this.game.time.elapsedMS,M=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),M=this.moveTarget.length/this.moveDistance),this.movementCallback)var U=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,M);return O||1<=M||void 0!==U&&!0!==U?(this.stopMovement(1<=M||this.stopVelocityOnCollide&&O),!1):!0},stopMovement:function(M){this.isMoving&&(this.isMoving=!1,M&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,0>this.deltaX()?this.facing=C.LEFT:0<this.deltaX()&&(this.facing=C.RIGHT),0>this.deltaY()?this.facing=C.UP:0<this.deltaY()&&(this.facing=C.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.updateCenter(),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var M=this.position,O=this.game.physics.arcade.bounds,U=this.game.physics.arcade.checkCollision,W=this.worldBounce?-this.worldBounce.x:-this.bounce.x,X=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return M.x<O.x&&U.left?(M.x=O.x,this.velocity.x*=W,this.blocked.left=!0,this.blocked.none=!1):this.right>O.right&&U.right&&(M.x=O.right-this.width,this.velocity.x*=W,this.blocked.right=!0,this.blocked.none=!1),M.y<O.y&&U.up?(M.y=O.y,this.velocity.y*=X,this.blocked.up=!0,this.blocked.none=!1):this.bottom>O.bottom&&U.down&&(M.y=O.bottom-this.height,this.velocity.y*=X,this.blocked.down=!0,this.blocked.none=!1),!this.blocked.none},moveFrom:function(M,O,U){if(void 0===O&&(O=this.speed),0===O)return!1;var W;return void 0===U?(W=this.angle,U=this.game.math.radToDeg(W)):W=this.game.math.degToRad(U),this.moveTimer=0,this.moveDuration=M,0===U||180===U?this.velocity.set(Math.cos(W)*O,0):90===U||270===U?this.velocity.set(0,Math.sin(W)*O):this.velocity.setToPolar(W,O),this.isMoving=!0,!0},moveTo:function(M,O,U){var W=O/(M/1e3);if(0==W)return!1;var X;return void 0===U?(X=this.angle,U=this.game.math.radToDeg(X)):X=this.game.math.degToRad(U),O=Math.abs(O),this.moveDuration=0,this.moveDistance=O,null===this.moveTarget&&(this.moveTarget=new C.Line,this.moveEnd=new C.Point),this.moveTarget.fromAngle(this.x,this.y,X,O),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===U||180===U?this.velocity.set(Math.cos(X)*W,0):90===U||270===U?this.velocity.set(0,Math.sin(X)*W):this.velocity.setToPolar(X,W),this.isMoving=!0,!0},setSize:function(M,O,U,W){void 0===U&&(U=this.offset.x),void 0===W&&(W=this.offset.y),this.sourceWidth=M,this.sourceHeight=O,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(U,W),this.updateCenter(),this.isCircle=!1,this.radius=0},setCircle:function(M,O,U){void 0===O&&(O=this.offset.x),void 0===U&&(U=this.offset.y),0<M?(this.isCircle=!0,this.radius=M,this.sourceWidth=2*M,this.sourceHeight=2*M,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(O,U),this.updateCenter()):this.isCircle=!1},reset:function(M,O){this.stop(),this.position.x=M-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=0>this.sprite.scale.x?this.width:0,this.position.y=O-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=0>this.sprite.scale.y?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this.updateBounds(),this.updateCenter()},stop:function(){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0},getBounds:function(M){return M.x=this.x,M.y=this.y,M.right=this.right,M.bottom=this.bottom,M},hitTest:function(M,O){return this.isCircle?C.Circle.contains(this,M,O):C.Rectangle.contains(this,M,O)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof C.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(C.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(C.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(C.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(C.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(C.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(M){this.position.x=M}}),Object.defineProperty(C.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(M){this.position.y=M}}),C.Physics.Arcade.Body.render=function(M,O,U,W,X){void 0===W&&(W=!0),U=U||"rgba(0,255,0,0.4)",M.fillStyle=U,M.strokeStyle=U,M.lineWidth=X||1,O.isCircle?(M.beginPath(),M.arc(O.center.x-O.game.camera.x,O.center.y-O.game.camera.y,O.halfWidth,0,2*Math.PI),W?M.fill():M.stroke()):W?M.fillRect(O.position.x-O.game.camera.x,O.position.y-O.game.camera.y,O.width,O.height):M.strokeRect(O.position.x-O.game.camera.x,O.position.y-O.game.camera.y,O.width,O.height)},C.Physics.Arcade.Body.renderBodyInfo=function(M,O){M.line("x: "+O.x.toFixed(2),"y: "+O.y.toFixed(2),"width: "+O.width,"height: "+O.height),M.line("velocity x: "+O.velocity.x.toFixed(2),"y: "+O.velocity.y.toFixed(2),"deltaX: "+O._dx.toFixed(2),"deltaY: "+O._dy.toFixed(2)),M.line("acceleration x: "+O.acceleration.x.toFixed(2),"y: "+O.acceleration.y.toFixed(2),"speed: "+O.speed.toFixed(2),"angle: "+O.angle.toFixed(2)),M.line("gravity x: "+O.gravity.x,"y: "+O.gravity.y,"bounce x: "+O.bounce.x.toFixed(2),"y: "+O.bounce.y.toFixed(2)),M.line("touching left: "+O.touching.left,"right: "+O.touching.right,"up: "+O.touching.up,"down: "+O.touching.down),M.line("blocked left: "+O.blocked.left,"right: "+O.blocked.right,"up: "+O.blocked.up,"down: "+O.blocked.down)},C.Physics.Arcade.Body.prototype.constructor=C.Physics.Arcade.Body,C.Physics.Arcade.TilemapCollision=function(){},C.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(M,O,U,W,X,V){if(M.body){var H=O.getTiles(M.body.position.x-M.body.tilePadding.x-O.getTileOffsetX(),M.body.position.y-M.body.tilePadding.y-O.getTileOffsetY(),M.body.width+M.body.tilePadding.x,M.body.height+M.body.tilePadding.y,!1,!1);if(0!==H.length)for(var Y=0;Y<H.length;Y++)W?W.call(X,M,H[Y])&&this.separateTile(Y,M.body,H[Y],O,V)&&(this._total++,U&&U.call(X,M,H[Y])):this.separateTile(Y,M.body,H[Y],O,V)&&(this._total++,U&&U.call(X,M,H[Y]))}},collideGroupVsTilemapLayer:function(M,O,U,W,X,V){if(0!==M.length)for(var H=0;H<M.children.length;H++)M.children[H].exists&&this.collideSpriteVsTilemapLayer(M.children[H],O,U,W,X,V)},separateTile:function(M,O,U,W,X){if(!O.enable)return!1;var V=W.getTileOffsetX(),H=W.getTileOffsetY();if(!U.intersects(O.position.x-V,O.position.y-H,O.right-V,O.bottom-H))return!1;if(X)return!0;if(U.collisionCallback&&!U.collisionCallback.call(U.collisionCallbackContext,O.sprite,U))return!1;if("undefined"!=typeof U.layer.callbacks&&U.layer.callbacks[U.index]&&!U.layer.callbacks[U.index].callback.call(U.layer.callbacks[U.index].callbackContext,O.sprite,U))return!1;if(!U.faceLeft&&!U.faceRight&&!U.faceTop&&!U.faceBottom)return!1;var Y=0,z=0,K=0,J=1;if(O.deltaAbsX()>O.deltaAbsY()?K=-1:O.deltaAbsX()<O.deltaAbsY()&&(J=-1),0!==O.deltaX()&&0!==O.deltaY()&&(U.faceLeft||U.faceRight)&&(U.faceTop||U.faceBottom)&&(K=Math.min(Math.abs(O.position.x-V-U.right),Math.abs(O.right-V-U.left)),J=Math.min(Math.abs(O.position.y-H-U.bottom),Math.abs(O.bottom-H-U.top))),K<J){if((U.faceLeft||U.faceRight)&&(Y=this.tileCheckX(O,U,W),0!=Y&&!U.intersects(O.position.x-V,O.position.y-H,O.right-V,O.bottom-H)))return!0;(U.faceTop||U.faceBottom)&&(z=this.tileCheckY(O,U,W))}else{if((U.faceTop||U.faceBottom)&&(z=this.tileCheckY(O,U,W),0!=z&&!U.intersects(O.position.x-V,O.position.y-H,O.right-V,O.bottom-H)))return!0;(U.faceLeft||U.faceRight)&&(Y=this.tileCheckX(O,U,W))}return 0!==Y||0!==z},tileCheckX:function(M,O,U){var W=0,X=U.getTileOffsetX();return 0>M.deltaX()&&!M.blocked.left&&O.collideRight&&M.checkCollision.left?O.faceRight&&M.x-X<O.right&&(W=M.x-X-O.right,W<-this.TILE_BIAS&&(W=0)):0<M.deltaX()&&!M.blocked.right&&O.collideLeft&&M.checkCollision.right&&O.faceLeft&&M.right-X>O.left&&(W=M.right-X-O.left,W>this.TILE_BIAS&&(W=0)),0!=W&&(M.customSeparateX?M.overlapX=W:this.processTileSeparationX(M,W)),W},tileCheckY:function(M,O,U){var W=0,X=U.getTileOffsetY();return 0>M.deltaY()&&!M.blocked.up&&O.collideDown&&M.checkCollision.up?O.faceBottom&&M.y-X<O.bottom&&(W=M.y-X-O.bottom,W<-this.TILE_BIAS&&(W=0)):0<M.deltaY()&&!M.blocked.down&&O.collideUp&&M.checkCollision.down&&O.faceTop&&M.bottom-X>O.top&&(W=M.bottom-X-O.top,W>this.TILE_BIAS&&(W=0)),0!=W&&(M.customSeparateY?M.overlapY=W:this.processTileSeparationY(M,W)),W},processTileSeparationX:function(M,O){0>O?(M.blocked.left=!0,M.blocked.none=!1):0<O&&(M.blocked.right=!0,M.blocked.none=!1),M.position.x-=O,M.velocity.x=0===M.bounce.x?0:-M.velocity.x*M.bounce.x},processTileSeparationY:function(M,O){0>O?(M.blocked.up=!0,M.blocked.none=!1):0<O&&(M.blocked.down=!0,M.blocked.none=!1),M.position.y-=O,M.velocity.y=0===M.bounce.y?0:-M.velocity.y*M.bounce.y}},C.Utils.mixinPrototype(C.Physics.Arcade.prototype,C.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,C.Physics.P2=function(M,O){this.game=M,void 0===O?O={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(!O.hasOwnProperty("gravity")&&(O.gravity=[0,0]),!O.hasOwnProperty("broadphase")&&(O.broadphase=new p2.SAPBroadphase)),this.config=O,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new C.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new C.Signal,this.onBodyRemoved=new C.Signal,this.onSpringAdded=new C.Signal,this.onSpringRemoved=new C.Signal,this.onConstraintAdded=new C.Signal,this.onConstraintRemoved=new C.Signal,this.onContactMaterialAdded=new C.Signal,this.onContactMaterialRemoved=new C.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new C.Signal,this.onEndContact=new C.Signal,O.hasOwnProperty("mpx")&&O.hasOwnProperty("pxm")&&O.hasOwnProperty("mpxi")&&O.hasOwnProperty("pxmi")&&(this.mpx=O.mpx,this.mpxi=O.mpxi,this.pxm=O.pxm,this.pxmi=O.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new C.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new C.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new C.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},C.Physics.P2.prototype={removeBodyNextStep:function(M){this._toRemove.push(M)},preUpdate:function(){for(var M=this._toRemove.length;M--;)this.removeBody(this._toRemove[M]);this._toRemove.length=0},enable:function(M,O,U){void 0===O&&(O=!1),void 0===U&&(U=!0);var W=1;if(Array.isArray(M))for(W=M.length;W--;)M[W]instanceof C.Group?this.enable(M[W].children,O,U):(this.enableBody(M[W],O),U&&M[W].hasOwnProperty("children")&&0<M[W].children.length&&this.enable(M[W],O,!0));else M instanceof C.Group?this.enable(M.children,O,U):(this.enableBody(M,O),U&&M.hasOwnProperty("children")&&0<M.children.length&&this.enable(M.children,O,!0))},enableBody:function(M,O){M.hasOwnProperty("body")&&null===M.body&&(M.body=new C.Physics.P2.Body(this.game,M,M.x,M.y,1),M.body.debug=O,"undefined"!=typeof M.anchor&&M.anchor.set(0.5))},setImpactEvents:function(M){M?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(M,O){this.postBroadphaseCallback=M,this.callbackContext=O,null===M?this.world.off("postBroadphase",this.postBroadphaseHandler,this):this.world.on("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(M){if(this.postBroadphaseCallback&&0!==M.pairs.length)for(var O=M.pairs.length-2;0<=O;O-=2)M.pairs[O].parent&&M.pairs[O+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,M.pairs[O].parent,M.pairs[O+1].parent)&&M.pairs.splice(O,2)},impactHandler:function(M){if(M.bodyA.parent&&M.bodyB.parent){var O=M.bodyA.parent,U=M.bodyB.parent;O._bodyCallbacks[M.bodyB.id]&&O._bodyCallbacks[M.bodyB.id].call(O._bodyCallbackContext[M.bodyB.id],O,U,M.shapeA,M.shapeB),U._bodyCallbacks[M.bodyA.id]&&U._bodyCallbacks[M.bodyA.id].call(U._bodyCallbackContext[M.bodyA.id],U,O,M.shapeB,M.shapeA),O._groupCallbacks[M.shapeB.collisionGroup]&&O._groupCallbacks[M.shapeB.collisionGroup].call(O._groupCallbackContext[M.shapeB.collisionGroup],O,U,M.shapeA,M.shapeB),U._groupCallbacks[M.shapeA.collisionGroup]&&U._groupCallbacks[M.shapeA.collisionGroup].call(U._groupCallbackContext[M.shapeA.collisionGroup],U,O,M.shapeB,M.shapeA)}},beginContactHandler:function(M){M.bodyA&&M.bodyB&&(this.onBeginContact.dispatch(M.bodyA,M.bodyB,M.shapeA,M.shapeB,M.contactEquations),M.bodyA.parent&&M.bodyA.parent.onBeginContact.dispatch(M.bodyB.parent,M.bodyB,M.shapeA,M.shapeB,M.contactEquations),M.bodyB.parent&&M.bodyB.parent.onBeginContact.dispatch(M.bodyA.parent,M.bodyA,M.shapeB,M.shapeA,M.contactEquations))},endContactHandler:function(M){M.bodyA&&M.bodyB&&(this.onEndContact.dispatch(M.bodyA,M.bodyB,M.shapeA,M.shapeB),M.bodyA.parent&&M.bodyA.parent.onEndContact.dispatch(M.bodyB.parent,M.bodyB,M.shapeA,M.shapeB),M.bodyB.parent&&M.bodyB.parent.onEndContact.dispatch(M.bodyA.parent,M.bodyA,M.shapeB,M.shapeA))},setBoundsToWorld:function(M,O,U,W,X){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,M,O,U,W,X)},setWorldMaterial:function(M,O,U,W,X){void 0===O&&(O=!0),void 0===U&&(U=!0),void 0===W&&(W=!0),void 0===X&&(X=!0),O&&this.walls.left&&(this.walls.left.shapes[0].material=M),U&&this.walls.right&&(this.walls.right.shapes[0].material=M),W&&this.walls.top&&(this.walls.top.shapes[0].material=M),X&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=M)},updateBoundsCollisionGroup:function(M){void 0===M&&(M=!0);var O=M?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=O),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=O),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=O),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=O),this._boundsOwnGroup=M},setBounds:function(M,O,U,W,X,V,H,Y,z){void 0===X&&(X=this._boundsLeft),void 0===V&&(V=this._boundsRight),void 0===H&&(H=this._boundsTop),void 0===Y&&(Y=this._boundsBottom),void 0===z&&(z=this._boundsOwnGroup),this.setupWall(X,"left",M,O,1.5707963267948966,z),this.setupWall(V,"right",M+U,O,-1.5707963267948966,z),this.setupWall(H,"top",M,O,-3.141592653589793,z),this.setupWall(Y,"bottom",M,O+W,0,z),this._boundsLeft=X,this._boundsRight=V,this._boundsTop=H,this._boundsBottom=Y,this._boundsOwnGroup=z},setupWall:function(M,O,U,W,X,V){M?(this.walls[O]?this.walls[O].position=[this.pxmi(U),this.pxmi(W)]:(this.walls[O]=new p2.Body({mass:0,position:[this.pxmi(U),this.pxmi(W)],angle:X}),this.walls[O].addShape(new p2.Plane),this.world.addBody(this.walls[O])),V&&(this.walls[O].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[O]&&(this.world.removeBody(this.walls[O]),this.walls[O]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new C.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new C.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new C.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var M=this.world.constraints,O=M.length-1;0<=O;O--)this.world.removeConstraint(M[O]);for(var U=this.world.bodies,O=U.length-1;0<=O;O--)this.world.removeBody(U[O]);for(var W=this.world.springs,O=W.length-1;0<=O;O--)this.world.removeSpring(W[O]);for(var X=this.world.contactMaterials,O=X.length-1;0<=O;O--)this.world.removeContactMaterial(X[O]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(M){return!M.data.world&&(this.world.addBody(M.data),this.onBodyAdded.dispatch(M),!0)},removeBody:function(M){return M.data.world===this.world&&(this.world.removeBody(M.data),this.onBodyRemoved.dispatch(M)),M},addSpring:function(M){return M instanceof C.Physics.P2.Spring||M instanceof C.Physics.P2.RotationalSpring?this.world.addSpring(M.data):this.world.addSpring(M),this.onSpringAdded.dispatch(M),M},removeSpring:function(M){return M instanceof C.Physics.P2.Spring||M instanceof C.Physics.P2.RotationalSpring?this.world.removeSpring(M.data):this.world.removeSpring(M),this.onSpringRemoved.dispatch(M),M},createDistanceConstraint:function(M,O,U,W,X,V){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addConstraint(new C.Physics.P2.DistanceConstraint(this,M,O,U,W,X,V)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(M,O,U,W){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addConstraint(new C.Physics.P2.GearConstraint(this,M,O,U,W)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(M,O,U,W,X,V){return M=this.getBody(M),U=this.getBody(U),M&&U?this.addConstraint(new C.Physics.P2.RevoluteConstraint(this,M,O,U,W,X,V)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(M,O,U,W,X){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addConstraint(new C.Physics.P2.LockConstraint(this,M,O,U,W,X)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(M,O,U,W,X,V,H){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addConstraint(new C.Physics.P2.PrismaticConstraint(this,M,O,U,W,X,V,H)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(M){return this.world.addConstraint(M),this.onConstraintAdded.dispatch(M),M},removeConstraint:function(M){return this.world.removeConstraint(M),this.onConstraintRemoved.dispatch(M),M},addContactMaterial:function(M){return this.world.addContactMaterial(M),this.onContactMaterialAdded.dispatch(M),M},removeContactMaterial:function(M){return this.world.removeContactMaterial(M),this.onContactMaterialRemoved.dispatch(M),M},getContactMaterial:function(M,O){return this.world.getContactMaterial(M,O)},setMaterial:function(M,O){for(var U=O.length;U--;)O[U].setMaterial(M)},createMaterial:function(M,O){M=M||"";var U=new C.Physics.P2.Material(M);return this.materials.push(U),"undefined"!=typeof O&&O.setMaterial(U),U},createContactMaterial:function(M,O,U){void 0===M&&(M=this.createMaterial()),void 0===O&&(O=this.createMaterial());var W=new C.Physics.P2.ContactMaterial(M,O,U);return this.addContactMaterial(W)},getBodies:function(){for(var M=[],O=this.world.bodies.length;O--;)M.push(this.world.bodies[O].parent);return M},getBody:function(M){return M instanceof p2.Body?M:M instanceof C.Physics.P2.Body?M.data:M.body&&M.body.type===C.Physics.P2JS?M.body.data:null},getSprings:function(){for(var M=[],O=this.world.springs.length;O--;)M.push(this.world.springs[O].parent);return M},getConstraints:function(){for(var M=[],O=this.world.constraints.length;O--;)M.push(this.world.constraints[O]);return M},hitTest:function(M,O,U,W){void 0===O&&(O=this.world.bodies),void 0===U&&(U=5),void 0===W&&(W=!1);for(var X=[this.pxmi(M.x),this.pxmi(M.y)],V=[],H=O.length;H--;)O[H]instanceof C.Physics.P2.Body&&!(W&&O[H].data.type===p2.Body.STATIC)?V.push(O[H].data):O[H]instanceof p2.Body&&O[H].parent&&!(W&&O[H].type===p2.Body.STATIC)?V.push(O[H]):O[H]instanceof C.Sprite&&O[H].hasOwnProperty("body")&&!(W&&O[H].body.data.type===p2.Body.STATIC)&&V.push(O[H].body.data);return this.world.hitTest(X,V,U)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(M){var O=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=O),this.walls.right&&(this.walls.right.shapes[0].collisionMask|=O),this.walls.top&&(this.walls.top.shapes[0].collisionMask|=O),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask|=O),this._collisionGroupID++;var U=new C.Physics.P2.CollisionGroup(O);return this.collisionGroups.push(U),M&&this.setCollisionGroup(M,U),U},setCollisionGroup:function(M,O){if(M instanceof C.Group)for(var U=0;U<M.total;U++)M.children[U].body&&M.children[U].body.type===C.Physics.P2JS&&M.children[U].body.setCollisionGroup(O);else M.body.setCollisionGroup(O)},createSpring:function(M,O,U,W,X,V,H,Y,z){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addSpring(new C.Physics.P2.Spring(this,M,O,U,W,X,V,H,Y,z)):void console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(M,O,U,W,X){return M=this.getBody(M),O=this.getBody(O),M&&O?this.addSpring(new C.Physics.P2.RotationalSpring(this,M,O,U,W,X)):void console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(M,O,U,W,X,V){void 0===W&&(W=!1);var H=new C.Physics.P2.Body(this.game,null,M,O,U);if(V){var Y=H.addPolygon(X,V);if(!Y)return!1}return W&&this.world.addBody(H.data),H},createParticle:function(M,O,U,W,X,V){void 0===W&&(W=!1);var H=new C.Physics.P2.Body(this.game,null,M,O,U);if(V){var Y=H.addPolygon(X,V);if(!Y)return!1}return W&&this.world.addBody(H.data),H},convertCollisionObjects:function(M,O,U){void 0===U&&(U=!0);for(var W=[],X=0,V=M.collision[O].length;X<V;X++){var H=M.collision[O][X],Y=this.createBody(H.x,H.y,0,U,{},H.polyline);Y&&W.push(Y)}return W},clearTilemapLayerBodies:function(M,O){O=M.getLayer(O);for(var U=M.layers[O].bodies.length;U--;)M.layers[O].bodies[U].destroy();M.layers[O].bodies.length=0},convertTilemap:function(M,O,U,W){O=M.getLayer(O),void 0===U&&(U=!0),void 0===W&&(W=!0),this.clearTilemapLayerBodies(M,O);for(var X=0,V=0,H=0,Y=0,z=M.layers[O].height;Y<z;Y++){X=0;for(var K=0,J=M.layers[O].width,Q;K<J;K++)if(Q=M.layers[O].data[Y][K],Q&&-1<Q.index&&Q.collides)if(W){var Z=M.getTileRight(O,K,Y);if(0==X&&(V=Q.x*Q.width,H=Q.y*Q.height,X=Q.width),Z&&Z.collides)X+=Q.width;else{var $=this.createBody(V,H,0,!1);$.addRectangle(X,Q.height,X/2,Q.height/2,0),U&&this.addBody($),M.layers[O].bodies.push($),X=0}}else{var $=this.createBody(Q.x*Q.width,Q.y*Q.height,0,!1);$.addRectangle(Q.width,Q.height,Q.width/2,Q.height/2,0),U&&this.addBody($),M.layers[O].bodies.push($)}}return M.layers[O].bodies},mpx:function(M){return M*=20},pxm:function(M){return 0.05*M},mpxi:function(M){return M*=-20},pxmi:function(M){return-0.05*M}},Object.defineProperty(C.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(M){this.world.defaultContactMaterial.friction=M}}),Object.defineProperty(C.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(M){this.world.defaultContactMaterial.restitution=M}}),Object.defineProperty(C.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(M){this.world.defaultContactMaterial=M}}),Object.defineProperty(C.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(M){this.world.applySpringForces=M}}),Object.defineProperty(C.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(M){this.world.applyDamping=M}}),Object.defineProperty(C.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(M){this.world.applyGravity=M}}),Object.defineProperty(C.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(M){this.world.solveConstraints=M}}),Object.defineProperty(C.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(C.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(M){this.world.emitImpactEvent=M}}),Object.defineProperty(C.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(M){this.world.sleepMode=M}}),Object.defineProperty(C.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),C.Physics.P2.FixtureList=function(M){Array.isArray(M)||(M=[M]),this.rawList=M,this.init(),this.parse(this.rawList)},C.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(M,O){this.getFixtures(O).forEach(function(W){W.collisionGroup=M})},setMask:function(M,O){this.getFixtures(O).forEach(function(W){W.collisionMask=M})},setSensor:function(M,O){this.getFixtures(O).forEach(function(W){W.sensor=M})},setMaterial:function(M,O){this.getFixtures(O).forEach(function(W){W.material=M})},getFixtures:function(M){var O=[];if(M){M instanceof Array||(M=[M]);var U=this;return M.forEach(function(W){U.namedFixtures[W]&&O.push(U.namedFixtures[W])}),this.flatten(O)}return this.allFixtures},getFixtureByKey:function(M){return this.namedFixtures[M]},getGroup:function(M){return this.groupedFixtures[M]},parse:function(){var M,O,U,W;for(M in U=this.rawList,W=[],U)O=U[M],isNaN(M-0)?this.namedFixtures[M]=this.flatten(O):(this.groupedFixtures[M]=this.groupedFixtures[M]||[],this.groupedFixtures[M]=this.groupedFixtures[M].concat(O)),W.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(M){var O,U;return O=[],U=arguments.callee,M.forEach(function(W){return Array.prototype.push.apply(O,Array.isArray(W)?U(W):[W])}),O}},C.Physics.P2.PointProxy=function(M,O){this.world=M,this.destination=O},C.Physics.P2.PointProxy.prototype.constructor=C.Physics.P2.PointProxy,Object.defineProperty(C.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(M){this.destination[0]=this.world.pxm(M)}}),Object.defineProperty(C.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(M){this.destination[1]=this.world.pxm(M)}}),Object.defineProperty(C.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(M){this.destination[0]=M}}),Object.defineProperty(C.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(M){this.destination[1]=M}}),C.Physics.P2.InversePointProxy=function(M,O){this.world=M,this.destination=O},C.Physics.P2.InversePointProxy.prototype.constructor=C.Physics.P2.InversePointProxy,Object.defineProperty(C.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(M){this.destination[0]=this.world.pxmi(M)}}),Object.defineProperty(C.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(M){this.destination[1]=this.world.pxmi(M)}}),Object.defineProperty(C.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(M){this.destination[0]=-M}}),Object.defineProperty(C.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(M){this.destination[1]=-M}}),C.Physics.P2.Body=function(M,O,U,W,X){O=O||null,U=U||0,W=W||0,void 0===X&&(X=1),this.game=M,this.world=M.physics.p2,this.sprite=O,this.type=C.Physics.P2JS,this.offset=new C.Point,this.data=new p2.Body({position:[this.world.pxmi(U),this.world.pxmi(W)],mass:X}),this.data.parent=this,this.velocity=new C.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new C.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new C.Point,this.onBeginContact=new C.Signal,this.onEndContact=new C.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,O&&(this.setRectangleFromSprite(O),O.exists&&this.game.physics.p2.addBody(this))},C.Physics.P2.Body.prototype={createBodyCallback:function(M,O,U){var W=-1;M.id?W=M.id:M.body&&(W=M.body.id),-1<W&&(null===O?(delete this._bodyCallbacks[W],delete this._bodyCallbackContext[W]):(this._bodyCallbacks[W]=O,this._bodyCallbackContext[W]=U))},createGroupCallback:function(M,O,U){null===O?(delete this._groupCallbacks[M.mask],delete this._groupCallbackContext[M.mask]):(this._groupCallbacks[M.mask]=O,this._groupCallbackContext[M.mask]=U)},getCollisionMask:function(){var M=0;this._collideWorldBounds&&(M=this.game.physics.p2.boundsCollisionGroup.mask);for(var O=0;O<this.collidesWith.length;O++)M|=this.collidesWith[O].mask;return M},updateCollisionMask:function(M){var O=this.getCollisionMask();if(void 0===M)for(var U=this.data.shapes.length-1;0<=U;U--)this.data.shapes[U].collisionMask=O;else M.collisionMask=O},setCollisionGroup:function(M,O){var U=this.getCollisionMask();if(void 0===O)for(var W=this.data.shapes.length-1;0<=W;W--)this.data.shapes[W].collisionGroup=M.mask,this.data.shapes[W].collisionMask=U;else O.collisionGroup=M.mask,O.collisionMask=U},clearCollision:function(M,O,U){if(void 0===M&&(M=!0),void 0===O&&(O=!0),void 0===U)for(var W=this.data.shapes.length-1;0<=W;W--)M&&(this.data.shapes[W].collisionGroup=null),O&&(this.data.shapes[W].collisionMask=null);else M&&(U.collisionGroup=null),O&&(U.collisionMask=null);M&&(this.collidesWith.length=0)},removeCollisionGroup:function(M,O,U){void 0===O&&(O=!0);var W;if(Array.isArray(M))for(var X=0;X<M.length;X++)W=this.collidesWith.indexOf(M[X]),-1<W&&(this.collidesWith.splice(W,1),O&&(delete this._groupCallbacks[M.mask],delete this._groupCallbackContext[M.mask]));else W=this.collidesWith.indexOf(M),-1<W&&(this.collidesWith.splice(W,1),O&&(delete this._groupCallbacks[M.mask],delete this._groupCallbackContext[M.mask]));var V=this.getCollisionMask();if(void 0===U)for(var X=this.data.shapes.length-1;0<=X;X--)this.data.shapes[X].collisionMask=V;else U.collisionMask=V},collides:function(M,O,U,W){if(Array.isArray(M))for(var X=0;X<M.length;X++)-1===this.collidesWith.indexOf(M[X])&&(this.collidesWith.push(M[X]),O&&this.createGroupCallback(M[X],O,U));else-1===this.collidesWith.indexOf(M)&&(this.collidesWith.push(M),O&&this.createGroupCallback(M,O,U));var V=this.getCollisionMask();if(void 0===W)for(var X=this.data.shapes.length-1;0<=X;X--)this.data.shapes[X].collisionMask=V;else W.collisionMask=V},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(M,O){return this.data.getVelocityAtPoint(M,O)},applyDamping:function(M){this.data.applyDamping(M)},applyImpulse:function(M,O,U){this.data.applyImpulse(M,[this.world.pxmi(O),this.world.pxmi(U)])},applyImpulseLocal:function(M,O,U){this.data.applyImpulseLocal(M,[this.world.pxmi(O),this.world.pxmi(U)])},applyForce:function(M,O,U){this.data.applyForce(M,[this.world.pxmi(O),this.world.pxmi(U)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(M,O){return this.data.toLocalFrame(M,O)},toWorldFrame:function(M,O){return this.data.toWorldFrame(M,O)},rotateLeft:function(M){this.data.angularVelocity=this.world.pxm(-M)},rotateRight:function(M){this.data.angularVelocity=this.world.pxm(M)},moveForward:function(M){var O=this.world.pxmi(-M),U=this.data.angle+Math.PI/2;this.data.velocity[0]=O*Math.cos(U),this.data.velocity[1]=O*Math.sin(U)},moveBackward:function(M){var O=this.world.pxmi(-M),U=this.data.angle+Math.PI/2;this.data.velocity[0]=-(O*Math.cos(U)),this.data.velocity[1]=-(O*Math.sin(U))},thrust:function(M){var O=this.world.pxmi(-M),U=this.data.angle+Math.PI/2;this.data.force[0]+=O*Math.cos(U),this.data.force[1]+=O*Math.sin(U)},thrustLeft:function(M){var O=this.world.pxmi(-M),U=this.data.angle;this.data.force[0]+=O*Math.cos(U),this.data.force[1]+=O*Math.sin(U)},thrustRight:function(M){var O=this.world.pxmi(-M),U=this.data.angle;this.data.force[0]-=O*Math.cos(U),this.data.force[1]-=O*Math.sin(U)},reverse:function(M){var O=this.world.pxmi(-M),U=this.data.angle+Math.PI/2;this.data.force[0]-=O*Math.cos(U),this.data.force[1]-=O*Math.sin(U)},moveLeft:function(M){this.data.velocity[0]=this.world.pxmi(-M)},moveRight:function(M){this.data.velocity[0]=this.world.pxmi(M)},moveUp:function(M){this.data.velocity[1]=this.world.pxmi(-M)},moveDown:function(M){this.data.velocity[1]=this.world.pxmi(M)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(M,O,U,W){void 0===U&&(U=!1),void 0===W&&(W=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),U&&this.setZeroDamping(),W&&(this.mass=1),this.x=M,this.y=O},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var M=0;M<this.game.physics.p2._toRemove.length;M++)this.game.physics.p2._toRemove[M]===this&&this.game.physics.p2._toRemove.splice(M,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var M=this.data.shapes.length;M--;)this.data.removeShape(this.data.shapes[M]);this.shapeChanged()},addShape:function(M,O,U,W){return void 0===O&&(O=0),void 0===U&&(U=0),void 0===W&&(W=0),this.data.addShape(M,[this.world.pxmi(O),this.world.pxmi(U)],W),this.shapeChanged(),M},addCircle:function(M,O,U,W){var X=new p2.Circle({radius:this.world.pxm(M)});return this.addShape(X,O,U,W)},addRectangle:function(M,O,U,W,X){var V=new p2.Box({width:this.world.pxm(M),height:this.world.pxm(O)});return this.addShape(V,U,W,X)},addPlane:function(M,O,U){var W=new p2.Plane;return this.addShape(W,M,O,U)},addParticle:function(M,O,U){var W=new p2.Particle;return this.addShape(W,M,O,U)},addLine:function(M,O,U,W){var X=new p2.Line({length:this.world.pxm(M)});return this.addShape(X,O,U,W)},addCapsule:function(M,O,U,W,X){var V=new p2.Capsule({length:this.world.pxm(M),radius:this.world.pxm(O)});return this.addShape(V,U,W,X)},addPolygon:function(M,O){M=M||{},Array.isArray(O)||(O=Array.prototype.slice.call(arguments,1));var U=[];if(1===O.length&&Array.isArray(O[0]))U=O[0].slice(0);else if(Array.isArray(O[0]))U=O.slice();else if("number"==typeof O[0])for(var W=0,X=O.length;W<X;W+=2)U.push([O[W],O[W+1]]);var V=U.length-1;U[V][0]===U[0][0]&&U[V][1]===U[0][1]&&U.pop();for(var H=0;H<U.length;H++)U[H][0]=this.world.pxmi(U[H][0]),U[H][1]=this.world.pxmi(U[H][1]);var Y=this.data.fromPolygon(U,M);return this.shapeChanged(),Y},removeShape:function(M){var O=this.data.removeShape(M);return this.shapeChanged(),O},setCircle:function(M,O,U,W){return this.clearShapes(),this.addCircle(M,O,U,W)},setRectangle:function(M,O,U,W,X){return void 0===M&&(M=16),void 0===O&&(O=16),this.clearShapes(),this.addRectangle(M,O,U,W,X)},setRectangleFromSprite:function(M){return void 0===M&&(M=this.sprite),this.clearShapes(),this.addRectangle(M.width,M.height,0,0,M.rotation)},setMaterial:function(M,O){if(void 0===O)for(var U=this.data.shapes.length-1;0<=U;U--)this.data.shapes[U].material=M;else O.material=M},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(M,O){for(var U=this.game.cache.getPhysicsData(M,O),W=[],X=0;X<U.length;X++){var V=U[X],H=this.addFixture(V);W[V.filter.group]=W[V.filter.group]||[],W[V.filter.group]=W[V.filter.group].concat(H),V.fixtureKey&&(W[V.fixtureKey]=H)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),W},addFixture:function(M){var O=[];if(M.circle){var U=new p2.Circle({radius:this.world.pxm(M.circle.radius)});U.collisionGroup=M.filter.categoryBits,U.collisionMask=M.filter.maskBits,U.sensor=M.isSensor;var W=p2.vec2.create();W[0]=this.world.pxmi(M.circle.position[0]-this.sprite.width/2),W[1]=this.world.pxmi(M.circle.position[1]-this.sprite.height/2),this.data.addShape(U,W),O.push(U)}else for(var X=M.polygons,V=p2.vec2.create(),H=0;H<X.length;H++){for(var Y=X[H],z=[],K=0;K<Y.length;K+=2)z.push([this.world.pxmi(Y[K]),this.world.pxmi(Y[K+1])]);for(var U=new p2.Convex({vertices:z}),J=0,Q;J!==U.vertices.length;J++)Q=U.vertices[J],p2.vec2.sub(Q,Q,U.centerOfMass);p2.vec2.scale(V,U.centerOfMass,1),V[0]-=this.world.pxmi(this.sprite.width/2),V[1]-=this.world.pxmi(this.sprite.height/2),U.updateTriangles(),U.updateCenterOfMass(),U.updateBoundingRadius(),U.collisionGroup=M.filter.categoryBits,U.collisionMask=M.filter.maskBits,U.sensor=M.isSensor,this.data.addShape(U,V),O.push(U)}return O},loadPolygon:function(M,O,U){if(null===M)var W=O;else var W=this.game.cache.getPhysicsData(M,O);"number"!=typeof U&&(U=1);for(var X=p2.vec2.create(),V=0,H;V<W.length;V++){H=[];for(var Y=0;Y<W[V].shape.length;Y+=2)H.push([this.world.pxmi(W[V].shape[Y]*U),this.world.pxmi(W[V].shape[Y+1]*U)]);for(var z=new p2.Convex({vertices:H}),K=0,J;K!==z.vertices.length;K++)J=z.vertices[K],p2.vec2.sub(J,J,z.centerOfMass);p2.vec2.scale(X,z.centerOfMass,1),X[0]-=this.world.pxmi(this.sprite.width/2),X[1]-=this.world.pxmi(this.sprite.height/2),z.updateTriangles(),z.updateCenterOfMass(),z.updateBoundingRadius(),this.data.addShape(z,X)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},C.Physics.P2.Body.prototype.constructor=C.Physics.P2.Body,C.Physics.P2.Body.DYNAMIC=1,C.Physics.P2.Body.STATIC=2,C.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(C.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===C.Physics.P2.Body.STATIC},set:function(M){M&&this.data.type!==C.Physics.P2.Body.STATIC?(this.data.type=C.Physics.P2.Body.STATIC,this.mass=0):!M&&this.data.type===C.Physics.P2.Body.STATIC&&(this.data.type=C.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===C.Physics.P2.Body.DYNAMIC},set:function(M){M&&this.data.type!==C.Physics.P2.Body.DYNAMIC?(this.data.type=C.Physics.P2.Body.DYNAMIC,this.mass=1):!M&&this.data.type===C.Physics.P2.Body.DYNAMIC&&(this.data.type=C.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===C.Physics.P2.Body.KINEMATIC},set:function(M){M&&this.data.type!==C.Physics.P2.Body.KINEMATIC?(this.data.type=C.Physics.P2.Body.KINEMATIC,this.mass=4):!M&&this.data.type===C.Physics.P2.Body.KINEMATIC&&(this.data.type=C.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(M){M!==this.data.allowSleep&&(this.data.allowSleep=M)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"angle",{get:function(){return C.Math.wrapAngle(C.Math.radToDeg(this.data.angle))},set:function(M){this.data.angle=C.Math.degToRad(C.Math.wrapAngle(M))}}),Object.defineProperty(C.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(M){this.data.angularDamping=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(M){this.data.angularForce=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(M){this.data.angularVelocity=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(M){this.data.damping=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(M){M!==this.data.fixedRotation&&(this.data.fixedRotation=M)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(M){this.data.inertia=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(M){M!==this.data.mass&&(this.data.mass=M,this.data.updateMassProperties())}}),Object.defineProperty(C.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(M){M!==this.data.type&&(this.data.type=M)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(M){this.data.angle=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(M){this.data.sleepSpeedLimit=M}}),Object.defineProperty(C.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(M){this.data.position[0]=this.world.pxmi(M)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(M){this.data.position[1]=this.world.pxmi(M)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(C.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(M){M&&!this.debugBody?this.debugBody=new C.Physics.P2.BodyDebug(this.game,this.data):!M&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(C.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(M){M&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!M&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),C.Physics.P2.BodyDebug=function(M,O,U){C.Group.call(this,M);var W={pixelsPerLengthUnit:M.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:0.5};this.settings=C.Utils.extend(W,U),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=O,this.canvas=new C.Graphics(M),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},C.Physics.P2.BodyDebug.prototype=Object.create(C.Group.prototype),C.Physics.P2.BodyDebug.prototype.constructor=C.Physics.P2.BodyDebug,C.Utils.extend(C.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var M,O,U,W,X,V,H,Y,z,K,J,Q,Z,$,ee;if(Y=this.body,K=this.canvas,K.clear(),U=parseInt(this.randomPastelHex(),16),V=16711680,H=this.lineWidth,Y instanceof p2.Body&&Y.shapes.length){var te=Y.shapes.length;for(W=0;W!==te;){if(O=Y.shapes[W],z=O.position||0,M=O.angle||0,O instanceof p2.Circle)this.drawCircle(K,z[0]*this.ppu,z[1]*this.ppu,M,O.radius*this.ppu,U,H);else if(O instanceof p2.Capsule)this.drawCapsule(K,z[0]*this.ppu,z[1]*this.ppu,M,O.length*this.ppu,O.radius*this.ppu,V,U,H);else if(O instanceof p2.Plane)this.drawPlane(K,z[0]*this.ppu,-z[1]*this.ppu,U,V,5*H,10*H,10*H,100*this.ppu,M);else if(O instanceof p2.Line)this.drawLine(K,O.length*this.ppu,V,H);else if(O instanceof p2.Box)this.drawRectangle(K,z[0]*this.ppu,z[1]*this.ppu,M,O.width*this.ppu,O.height*this.ppu,V,U,H);else if(O instanceof p2.Convex){for(Q=[],Z=p2.vec2.create(),(X=$=0,ee=O.vertices.length);0<=ee?$<ee:$>ee;X=0<=ee?++$:--$)J=O.vertices[X],p2.vec2.rotate(Z,J,M),Q.push([(Z[0]+z[0])*this.ppu,-(Z[1]+z[1])*this.ppu]);this.drawConvex(K,Q,O.triangles,V,U,H,this.settings.debugPolygons,[z[0]*this.ppu,-z[1]*this.ppu])}W++}}},drawRectangle:function(M,O,U,W,X,V,H,Y,z){void 0===z&&(z=1),void 0===H&&(H=0),M.lineStyle(z,H,1),M.beginFill(Y),M.drawRect(O-X/2,U-V/2,X,V)},drawCircle:function(M,O,U,W,X,V,H){void 0===H&&(H=1),void 0===V&&(V=16777215),M.lineStyle(H,0,1),M.beginFill(V,1),M.drawCircle(O,U,2*-X),M.endFill(),M.moveTo(O,U),M.lineTo(O+X*Math.cos(-W),U+X*Math.sin(-W))},drawLine:function(M,O,U,W){void 0===W&&(W=1),void 0===U&&(U=0),M.lineStyle(5*W,U,1),M.moveTo(-O/2,0),M.lineTo(O/2,0)},drawConvex:function(M,O,U,W,X,V,H,Y){var z,K,J,Q,Z,$,ee,te,ae,oe,ne;if(void 0===V&&(V=1),void 0===W&&(W=0),!H){for(M.lineStyle(V,W,1),M.beginFill(X),K=0;K!==O.length;)J=O[K],$=J[0],ae=J[1],0===K?M.moveTo($,-ae):M.lineTo($,-ae),K++;if(M.endFill(),2<O.length)return M.moveTo(O[O.length-1][0],-O[O.length-1][1]),M.lineTo(O[0][0],-O[0][1])}else{for(z=[16711680,65280,255],K=0;K!==O.length+1;)Q=O[K%O.length],Z=O[(K+1)%O.length],ee=Q[0],oe=Q[1],te=Z[0],ne=Z[1],M.lineStyle(V,z[K%z.length],1),M.moveTo(ee,-oe),M.lineTo(te,-ne),M.drawCircle(ee,-oe,2*V),K++;return M.lineStyle(V,0,1),M.drawCircle(Y[0],Y[1],2*V)}},drawPath:function(M,O,U,W,X){var V,H,Y,z,K,J,Q,Z,$,ee,te,ae,oe;for(void 0===X&&(X=1),void 0===U&&(U=0),M.lineStyle(X,U,1),"number"==typeof W&&M.beginFill(W),Y=null,z=null,H=0;H<O.length;)te=O[H],ae=te[0],oe=te[1],(ae!=Y||oe!=z)&&(0===H?M.moveTo(ae,oe):(K=Y,J=z,Q=ae,Z=oe,$=O[(H+1)%O.length][0],ee=O[(H+1)%O.length][1],V=(Q-K)*(ee-J)-($-K)*(Z-J),0!==V&&M.lineTo(ae,oe)),Y=ae,z=oe),H++;"number"==typeof W&&M.endFill(),2<O.length&&"number"==typeof W&&(M.moveTo(O[O.length-1][0],O[O.length-1][1]),M.lineTo(O[0][0],O[0][1]))},drawPlane:function(M,O,U,W,X,V,H,Y,z,K){var J,Q,Z;void 0===V&&(V=1),void 0===W&&(W=16777215),M.lineStyle(V,X,11),M.beginFill(W),J=z,M.moveTo(O,-U),Q=O+Math.cos(K)*this.game.width,Z=U+Math.sin(K)*this.game.height,M.lineTo(Q,-Z),M.moveTo(O,-U),Q=O+Math.cos(K)*-this.game.width,Z=U+Math.sin(K)*-this.game.height,M.lineTo(Q,-Z)},drawCapsule:function(M,O,U,W,X,V,H,Y,z){void 0===z&&(z=1),void 0===H&&(H=0),M.lineStyle(z,H,1);var K=Math.cos(W),J=Math.sin(W);M.beginFill(Y,1),M.drawCircle(-X/2*K+O,-X/2*J+U,2*-V),M.drawCircle(X/2*K+O,X/2*J+U,2*-V),M.endFill(),M.lineStyle(z,H,0),M.beginFill(Y,1),M.moveTo(-X/2*K+V*J+O,-X/2*J+V*K+U),M.lineTo(X/2*K+V*J+O,X/2*J+V*K+U),M.lineTo(X/2*K-V*J+O,X/2*J-V*K+U),M.lineTo(-X/2*K-V*J+O,-X/2*J-V*K+U),M.endFill(),M.lineStyle(z,H,1),M.moveTo(-X/2*K+V*J+O,-X/2*J+V*K+U),M.lineTo(X/2*K+V*J+O,X/2*J+V*K+U),M.moveTo(-X/2*K-V*J+O,-X/2*J-V*K+U),M.lineTo(X/2*K-V*J+O,X/2*J-V*K+U)},randomPastelHex:function(){var M,O,U,W;return U=[255,255,255],W=Math.floor(256*Math.random()),O=Math.floor(256*Math.random()),M=Math.floor(256*Math.random()),W=Math.floor((W+3*U[0])/4),O=Math.floor((O+3*U[1])/4),M=Math.floor((M+3*U[2])/4),this.rgbToHex(W,O,M)},rgbToHex:function(M,O,U){return this.componentToHex(M)+this.componentToHex(O)+this.componentToHex(U)},componentToHex:function(M){var O;return O=M.toString(16),2===O.length?O:O+"0"}}),C.Physics.P2.Spring=function(M,O,U,W,X,V,H,Y,z,K){this.game=M.game,this.world=M,void 0===W&&(W=1),void 0===X&&(X=100),void 0===V&&(V=1),W=M.pxm(W);var J={restLength:W,stiffness:X,damping:V};"undefined"!=typeof H&&null!==H&&(J.worldAnchorA=[M.pxm(H[0]),M.pxm(H[1])]),"undefined"!=typeof Y&&null!==Y&&(J.worldAnchorB=[M.pxm(Y[0]),M.pxm(Y[1])]),"undefined"!=typeof z&&null!==z&&(J.localAnchorA=[M.pxm(z[0]),M.pxm(z[1])]),"undefined"!=typeof K&&null!==K&&(J.localAnchorB=[M.pxm(K[0]),M.pxm(K[1])]),this.data=new p2.LinearSpring(O,U,J),this.data.parent=this},C.Physics.P2.Spring.prototype.constructor=C.Physics.P2.Spring,C.Physics.P2.RotationalSpring=function(M,O,U,W,X,V){this.game=M.game,this.world=M,void 0===W&&(W=null),void 0===X&&(X=100),void 0===V&&(V=1),W&&(W=M.pxm(W));var H={restAngle:W,stiffness:X,damping:V};this.data=new p2.RotationalSpring(O,U,H),this.data.parent=this},C.Physics.P2.Spring.prototype.constructor=C.Physics.P2.Spring,C.Physics.P2.Material=function(M){this.name=M,p2.Material.call(this)},C.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),C.Physics.P2.Material.prototype.constructor=C.Physics.P2.Material,C.Physics.P2.ContactMaterial=function(M,O,U){p2.ContactMaterial.call(this,M,O,U)},C.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),C.Physics.P2.ContactMaterial.prototype.constructor=C.Physics.P2.ContactMaterial,C.Physics.P2.CollisionGroup=function(M){this.mask=M},C.Physics.P2.DistanceConstraint=function(M,O,U,W,X,V,H){void 0===W&&(W=100),void 0===X&&(X=[0,0]),void 0===V&&(V=[0,0]),void 0===H&&(H=Number.MAX_VALUE),this.game=M.game,this.world=M,W=M.pxm(W),X=[M.pxmi(X[0]),M.pxmi(X[1])],V=[M.pxmi(V[0]),M.pxmi(V[1])];var Y={distance:W,localAnchorA:X,localAnchorB:V,maxForce:H};p2.DistanceConstraint.call(this,O,U,Y)},C.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),C.Physics.P2.DistanceConstraint.prototype.constructor=C.Physics.P2.DistanceConstraint,C.Physics.P2.GearConstraint=function(M,O,U,W,X){void 0===W&&(W=0),void 0===X&&(X=1),this.game=M.game,this.world=M;var V={angle:W,ratio:X};p2.GearConstraint.call(this,O,U,V)},C.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),C.Physics.P2.GearConstraint.prototype.constructor=C.Physics.P2.GearConstraint,C.Physics.P2.LockConstraint=function(M,O,U,W,X,V){void 0===W&&(W=[0,0]),void 0===X&&(X=0),void 0===V&&(V=Number.MAX_VALUE),this.game=M.game,this.world=M,W=[M.pxm(W[0]),M.pxm(W[1])];var H={localOffsetB:W,localAngleB:X,maxForce:V};p2.LockConstraint.call(this,O,U,H)},C.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),C.Physics.P2.LockConstraint.prototype.constructor=C.Physics.P2.LockConstraint,C.Physics.P2.PrismaticConstraint=function(M,O,U,W,X,V,H,Y){void 0===W&&(W=!0),void 0===X&&(X=[0,0]),void 0===V&&(V=[0,0]),void 0===H&&(H=[0,0]),void 0===Y&&(Y=Number.MAX_VALUE),this.game=M.game,this.world=M,X=[M.pxmi(X[0]),M.pxmi(X[1])],V=[M.pxmi(V[0]),M.pxmi(V[1])];var z={localAnchorA:X,localAnchorB:V,localAxisA:H,maxForce:Y,disableRotationalLock:!W};p2.PrismaticConstraint.call(this,O,U,z)},C.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),C.Physics.P2.PrismaticConstraint.prototype.constructor=C.Physics.P2.PrismaticConstraint,C.Physics.P2.RevoluteConstraint=function(M,O,U,W,X,V,H){void 0===V&&(V=Number.MAX_VALUE),void 0===H&&(H=null),this.game=M.game,this.world=M,U=[M.pxmi(U[0]),M.pxmi(U[1])],X=[M.pxmi(X[0]),M.pxmi(X[1])],H&&(H=[M.pxmi(H[0]),M.pxmi(H[1])]);var Y={worldPivot:H,localPivotA:U,localPivotB:X,maxForce:V};p2.RevoluteConstraint.call(this,O,W,Y)},C.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),C.Physics.P2.RevoluteConstraint.prototype.constructor=C.Physics.P2.RevoluteConstraint,C.ImageCollection=function(M,O,U,W,X,V,H){(void 0===U||0>=U)&&(U=32),(void 0===W||0>=W)&&(W=32),void 0===X&&(X=0),void 0===V&&(V=0),this.name=M,this.firstgid=0|O,this.imageWidth=0|U,this.imageHeight=0|W,this.imageMargin=0|X,this.imageSpacing=0|V,this.properties=H||{},this.images=[],this.total=0},C.ImageCollection.prototype={containsImageIndex:function(M){return M>=this.firstgid&&M<this.firstgid+this.total},addImage:function(M,O){this.images.push({gid:M,image:O}),this.total++}},C.ImageCollection.prototype.constructor=C.ImageCollection,C.Tile=function(M,O,U,W,X,V){this.layer=M,this.index=O,this.x=U,this.y=W,this.rotation=0,this.flipped=!1,this.worldX=U*X,this.worldY=W*V,this.width=X,this.height=V,this.centerX=Math.abs(X/2),this.centerY=Math.abs(V/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},C.Tile.prototype={containsPoint:function(M,O){return!(M<this.worldX||O<this.worldY||M>this.right||O>this.bottom)},intersects:function(M,O,U,W){return!(U<=this.worldX)&&!(W<=this.worldY)&&!(M>=this.worldX+this.width)&&!(O>=this.worldY+this.height)},setCollisionCallback:function(M,O){this.collisionCallback=M,this.collisionCallbackContext=O},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(M,O,U,W){this.collideLeft=M,this.collideRight=O,this.collideUp=U,this.collideDown=W,this.faceLeft=M,this.faceRight=O,this.faceTop=U,this.faceBottom=W},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(M,O){return M&&O?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:M?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!O&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(M){this.index=M.index,this.alpha=M.alpha,this.properties=M.properties,this.collideUp=M.collideUp,this.collideDown=M.collideDown,this.collideLeft=M.collideLeft,this.collideRight=M.collideRight,this.collisionCallback=M.collisionCallback,this.collisionCallbackContext=M.collisionCallbackContext}},C.Tile.prototype.constructor=C.Tile,Object.defineProperty(C.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(C.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(C.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(C.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(C.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(C.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),C.Tilemap=function(M,O,U,W,X,V){this.game=M,this.key=O;var H=C.TilemapParser.parse(this.game,O,U,W,X,V);null===H||(this.width=H.width,this.height=H.height,this.tileWidth=H.tileWidth,this.tileHeight=H.tileHeight,this.orientation=H.orientation,this.format=H.format,this.version=H.version,this.properties=H.properties,this.widthInPixels=H.widthInPixels,this.heightInPixels=H.heightInPixels,this.layers=H.layers,this.tilesets=H.tilesets,this.imagecollections=H.imagecollections,this.tiles=H.tiles,this.objects=H.objects,this.collideIndexes=[],this.collision=H.collision,this.images=H.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},C.Tilemap.CSV=0,C.Tilemap.TILED_JSON=1,C.Tilemap.NORTH=0,C.Tilemap.EAST=1,C.Tilemap.SOUTH=2,C.Tilemap.WEST=3,C.Tilemap.prototype={create:function(M,O,U,W,X,V){return void 0===V&&(V=this.game.world),this.width=O,this.height=U,this.setTileSize(W,X),this.layers.length=0,this.createBlankLayer(M,O,U,W,X,V)},setTileSize:function(M,O){this.tileWidth=M,this.tileHeight=O,this.widthInPixels=this.width*M,this.heightInPixels=this.height*O},addTilesetImage:function(M,O,U,W,X,V,H){if(void 0===M)return null;void 0===U&&(U=this.tileWidth),void 0===W&&(W=this.tileHeight),void 0===X&&(X=0),void 0===V&&(V=0),void 0===H&&(H=0),0===U&&(U=32),0===W&&(W=32);var Y=null;if((void 0===O||null===O)&&(O=M),O instanceof C.BitmapData)Y=O.canvas;else{if(!this.game.cache.checkImageKey(O))return console.warn("Phaser.Tilemap.addTilesetImage: Invalid image key given: \""+O+"\""),null;Y=this.game.cache.getImage(O)}var z=this.getTilesetIndex(M);if(null===z&&this.format===C.Tilemap.TILED_JSON)return console.warn("Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: \""+M+"\""),null;if(this.tilesets[z])return this.tilesets[z].setImage(Y),this.tilesets[z];var K=new C.Tileset(M,H,U,W,X,V,{});K.setImage(Y),this.tilesets.push(K);for(var J=this.tilesets.length-1,Q=X,Z=X,$=0,ee=0,te=0,ae=H;ae<H+K.total&&(this.tiles[ae]=[Q,Z,J],Q+=U+V,$++,$!==K.total)&&(ee++,!(ee===K.columns&&(Q=X,Z+=W+V,ee=0,te++,te===K.rows)));ae++);return K},createFromObjects:function(M,O,U,W,X,V,H,Y,z){if(void 0===X&&(X=!0),void 0===V&&(V=!1),void 0===H&&(H=this.game.world),void 0===Y&&(Y=C.Sprite),void 0===z&&(z=!0),!this.objects[M])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+M);for(var K=0;K<this.objects[M].length;K++){var J=!1,Q=this.objects[M][K];if(void 0!==Q.gid&&"number"==typeof O&&Q.gid===O?J=!0:void 0!==Q.id&&"number"==typeof O&&Q.id===O?J=!0:void 0!==Q.name&&"string"==typeof O&&Q.name===O&&(J=!0),J){var Z=new Y(this.game,parseFloat(Q.x,10),parseFloat(Q.y,10),U,W);for(var $ in Z.name=Q.name,Z.visible=Q.visible,Z.autoCull=V,Z.exists=X,Q.width&&(Z.width=Q.width),Q.height&&(Z.height=Q.height),Q.rotation&&(Z.angle=Q.rotation),z&&(Z.y-=Z.height),H.add(Z),Q.properties)H.set(Z,$,Q.properties[$],!1,!1,0,!0)}}},createFromTiles:function(M,O,U,W,X,V){"number"==typeof M&&(M=[M]),void 0===O||null===O?O=[]:"number"==typeof O&&(O=[O]),W=this.getLayer(W),void 0===X&&(X=this.game.world),void 0===V&&(V={}),void 0===V.customClass&&(V.customClass=C.Sprite),void 0===V.adjustY&&(V.adjustY=!0);var H=this.layers[W].width,Y=this.layers[W].height;if(this.copy(0,0,H,Y,W),2>this._results.length)return 0;for(var z=0,J=1,Q=this._results.length,K;J<Q;J++)if(-1!==M.indexOf(this._results[J].index)){for(var Z in K=new V.customClass(this.game,this._results[J].worldX,this._results[J].worldY,U),V)K[Z]=V[Z];X.add(K),z++}if(1===O.length)for(J=0;J<M.length;J++)this.replace(M[J],O[0],0,0,H,Y,W);else if(1<O.length)for(J=0;J<M.length;J++)this.replace(M[J],O[J],0,0,H,Y,W);return z},createLayer:function(M,O,U,W){void 0===O&&(O=this.game.width),void 0===U&&(U=this.game.height),void 0===W&&(W=this.game.world);var X=M;if("string"==typeof M&&(X=this.getLayerIndex(M)),null===X||X>this.layers.length)return void console.warn("Tilemap.createLayer: Invalid layer ID given: \""+M+"\"");void 0===O||0>=O?O=Math.min(this.game.width,this.layers[X].widthInPixels):O>this.game.width&&(O=this.game.width),void 0===U||0>=U?U=Math.min(this.game.height,this.layers[X].heightInPixels):U>this.game.height&&(U=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[X].name),console.log("Size:",O,"x",U),console.log("Tileset:",this.tilesets[0].name,"index:",X));var V=W.add(new C.TilemapLayer(this.game,this,X,O,U));return this.enableDebug&&console.groupEnd(),V},createBlankLayer:function(M,O,U,W,X,V){if(void 0===V&&(V=this.game.world),null!==this.getLayerIndex(M))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+M);for(var H={name:M,x:0,y:0,width:O,height:U,widthInPixels:O*W,heightInPixels:U*X,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},z=[],K=0,Y;K<U;K++){Y=[];for(var J=0;J<O;J++)Y.push(new C.Tile(H,-1,J,K,W,X));z.push(Y)}H.data=z,this.layers.push(H),this.currentLayer=this.layers.length-1;var Q=H.widthInPixels,Z=H.heightInPixels;Q>this.game.width&&(Q=this.game.width),Z>this.game.height&&(Z=this.game.height);var z=new C.TilemapLayer(this.game,this,this.layers.length-1,Q,Z);return z.name=M,V.add(z)},getIndex:function(M,O){for(var U=0;U<M.length;U++)if(M[U].name===O)return U;return null},getLayerIndex:function(M){return this.getIndex(this.layers,M)},getTilesetIndex:function(M){return this.getIndex(this.tilesets,M)},getImageIndex:function(M){return this.getIndex(this.images,M)},setTileIndexCallback:function(M,O,U,W){if(W=this.getLayer(W),"number"==typeof M)this.layers[W].callbacks[M]={callback:O,callbackContext:U};else for(var X=0,V=M.length;X<V;X++)this.layers[W].callbacks[M[X]]={callback:O,callbackContext:U}},setTileLocationCallback:function(M,O,U,W,X,V,H){if(H=this.getLayer(H),this.copy(M,O,U,W,H),!(2>this._results.length))for(var Y=1;Y<this._results.length;Y++)this._results[Y].setCollisionCallback(X,V)},setCollision:function(M,O,U,W){if(void 0===O&&(O=!0),void 0===W&&(W=!0),U=this.getLayer(U),"number"==typeof M)return this.setCollisionByIndex(M,O,U,!0);if(Array.isArray(M)){for(var X=0;X<M.length;X++)this.setCollisionByIndex(M[X],O,U,!1);W&&this.calculateFaces(U)}},setCollisionBetween:function(M,O,U,W,X){if(void 0===U&&(U=!0),void 0===X&&(X=!0),W=this.getLayer(W),!(M>O)){for(var V=M;V<=O;V++)this.setCollisionByIndex(V,U,W,!1);X&&this.calculateFaces(W)}},setCollisionByExclusion:function(M,O,U,W){void 0===O&&(O=!0),void 0===W&&(W=!0),U=this.getLayer(U);for(var X=0,V=this.tiles.length;X<V;X++)-1===M.indexOf(X)&&this.setCollisionByIndex(X,O,U,!1);W&&this.calculateFaces(U)},setCollisionByIndex:function(M,O,U,W){if(void 0===O&&(O=!0),void 0===U&&(U=this.currentLayer),void 0===W&&(W=!0),O)this.collideIndexes.push(M);else{var X=this.collideIndexes.indexOf(M);-1<X&&this.collideIndexes.splice(X,1)}for(var V=0;V<this.layers[U].height;V++)for(var H=0,Y;H<this.layers[U].width;H++)Y=this.layers[U].data[V][H],Y&&Y.index===M&&(O?Y.setCollision(!0,!0,!0,!0):Y.resetCollision(),Y.faceTop=O,Y.faceBottom=O,Y.faceLeft=O,Y.faceRight=O);return W&&this.calculateFaces(U),U},getLayer:function(M){return void 0===M?M=this.currentLayer:"string"==typeof M?M=this.getLayerIndex(M):M instanceof C.TilemapLayer&&(M=M.index),M},setPreventRecalculate:function(M){if(!0===M&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===M&&!0===this.preventingRecalculate){for(var O in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(O);this.needToRecalculate=!1}},calculateFaces:function(M){if(this.preventingRecalculate)return void(this.needToRecalculate[M]=!0);for(var O=null,U=null,W=null,X=null,V=0,H=this.layers[M].height;V<H;V++)for(var Y=0,z=this.layers[M].width,K;Y<z;Y++)K=this.layers[M].data[V][Y],K&&(O=this.getTileAbove(M,Y,V),U=this.getTileBelow(M,Y,V),W=this.getTileLeft(M,Y,V),X=this.getTileRight(M,Y,V),K.collides&&(K.faceTop=!0,K.faceBottom=!0,K.faceLeft=!0,K.faceRight=!0),O&&O.collides&&(K.faceTop=!1),U&&U.collides&&(K.faceBottom=!1),W&&W.collides&&(K.faceLeft=!1),X&&X.collides&&(K.faceRight=!1))},getTileAbove:function(M,O,U){return 0<U?this.layers[M].data[U-1][O]:null},getTileBelow:function(M,O,U){return U<this.layers[M].height-1?this.layers[M].data[U+1][O]:null},getTileLeft:function(M,O,U){return 0<O?this.layers[M].data[U][O-1]:null},getTileRight:function(M,O,U){return O<this.layers[M].width-1?this.layers[M].data[U][O+1]:null},setLayer:function(M){M=this.getLayer(M),this.layers[M]&&(this.currentLayer=M)},hasTile:function(M,O,U){return U=this.getLayer(U),void 0===this.layers[U].data[O]||void 0===this.layers[U].data[O][M]?!1:-1<this.layers[U].data[O][M].index},removeTile:function(M,O,U){if(U=this.getLayer(U),0<=M&&M<this.layers[U].width&&0<=O&&O<this.layers[U].height&&this.hasTile(M,O,U)){var W=this.layers[U].data[O][M];return this.layers[U].data[O][M]=new C.Tile(this.layers[U],-1,M,O,this.tileWidth,this.tileHeight),this.layers[U].dirty=!0,this.calculateFaces(U),W}},removeTileWorldXY:function(M,O,U,W,X){return X=this.getLayer(X),M=this.game.math.snapToFloor(M,U)/U,O=this.game.math.snapToFloor(O,W)/W,this.removeTile(M,O,X)},putTile:function(M,O,U,W){if(null===M)return this.removeTile(O,U,W);if(W=this.getLayer(W),0<=O&&O<this.layers[W].width&&0<=U&&U<this.layers[W].height){var X;return M instanceof C.Tile?(X=M.index,this.hasTile(O,U,W)?this.layers[W].data[U][O].copy(M):this.layers[W].data[U][O]=new C.Tile(W,X,O,U,M.width,M.height)):(X=M,this.hasTile(O,U,W)?this.layers[W].data[U][O].index=X:this.layers[W].data[U][O]=new C.Tile(this.layers[W],X,O,U,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(X)?this.layers[W].data[U][O].setCollision(!0,!0,!0,!0):this.layers[W].data[U][O].resetCollision(),this.layers[W].dirty=!0,this.calculateFaces(W),this.layers[W].data[U][O]}return null},putTileWorldXY:function(M,O,U,W,X,V){return V=this.getLayer(V),O=this.game.math.snapToFloor(O,W)/W,U=this.game.math.snapToFloor(U,X)/X,this.putTile(M,O,U,V)},searchTileIndex:function(M,O,U,W){void 0===O&&(O=0),void 0===U&&(U=!1),W=this.getLayer(W);var X=0;if(U){for(var V=this.layers[W].height-1;0<=V;V--)for(var H=this.layers[W].width-1;0<=H;H--)if(this.layers[W].data[V][H].index===M){if(X===O)return this.layers[W].data[V][H];X++}}else for(var V=0;V<this.layers[W].height;V++)for(var H=0;H<this.layers[W].width;H++)if(this.layers[W].data[V][H].index===M){if(X===O)return this.layers[W].data[V][H];X++}return null},getTile:function(M,O,U,W){return void 0===W&&(W=!1),U=this.getLayer(U),0<=M&&M<this.layers[U].width&&0<=O&&O<this.layers[U].height?-1===this.layers[U].data[O][M].index?W?this.layers[U].data[O][M]:null:this.layers[U].data[O][M]:null},getTileWorldXY:function(M,O,U,W,X,V){return void 0===U&&(U=this.tileWidth),void 0===W&&(W=this.tileHeight),X=this.getLayer(X),M=this.game.math.snapToFloor(M,U)/U,O=this.game.math.snapToFloor(O,W)/W,this.getTile(M,O,X,V)},copy:function(M,O,U,W,X){if(X=this.getLayer(X),!this.layers[X])return void(this._results.length=0);void 0===M&&(M=0),void 0===O&&(O=0),void 0===U&&(U=this.layers[X].width),void 0===W&&(W=this.layers[X].height),0>M&&(M=0),0>O&&(O=0),U>this.layers[X].width&&(U=this.layers[X].width),W>this.layers[X].height&&(W=this.layers[X].height),this._results.length=0,this._results.push({x:M,y:O,width:U,height:W,layer:X});for(var V=O;V<O+W;V++)for(var H=M;H<M+U;H++)this._results.push(this.layers[X].data[V][H]);return this._results},paste:function(M,O,U,W){if(void 0===M&&(M=0),void 0===O&&(O=0),W=this.getLayer(W),U&&!(2>U.length)){for(var X=M-U[1].x,V=O-U[1].y,H=1;H<U.length;H++)this.layers[W].data[V+U[H].y][X+U[H].x].copy(U[H]);this.layers[W].dirty=!0,this.calculateFaces(W)}},swap:function(M,O,U,W,X,V,H){H=this.getLayer(H),this.copy(U,W,X,V,H),2>this._results.length||(this._tempA=M,this._tempB=O,this._results.forEach(this.swapHandler,this),this.paste(U,W,this._results,H))},swapHandler:function(M){M.index===this._tempA?M.index=this._tempB:M.index===this._tempB&&(M.index=this._tempA)},forEach:function(M,O,U,W,X,V,H){H=this.getLayer(H),this.copy(U,W,X,V,H),2>this._results.length||(this._results.forEach(M,O),this.paste(U,W,this._results,H))},replace:function(M,O,U,W,X,V,H){if(H=this.getLayer(H),this.copy(U,W,X,V,H),!(2>this._results.length)){for(var Y=1;Y<this._results.length;Y++)this._results[Y].index===M&&(this._results[Y].index=O);this.paste(U,W,this._results,H)}},random:function(M,O,U,W,X){if(X=this.getLayer(X),this.copy(M,O,U,W,X),!(2>this._results.length)){for(var V=[],H=1;H<this._results.length;H++)if(this._results[H].index){var Y=this._results[H].index;-1===V.indexOf(Y)&&V.push(Y)}for(var z=1;z<this._results.length;z++)this._results[z].index=this.game.rnd.pick(V);this.paste(M,O,this._results,X)}},shuffle:function(M,O,U,W,X){if(X=this.getLayer(X),this.copy(M,O,U,W,X),!(2>this._results.length)){for(var V=[],H=1;H<this._results.length;H++)this._results[H].index&&V.push(this._results[H].index);C.ArrayUtils.shuffle(V);for(var Y=1;Y<this._results.length;Y++)this._results[Y].index=V[Y-1];this.paste(M,O,this._results,X)}},fill:function(M,O,U,W,X,V){if(V=this.getLayer(V),this.copy(O,U,W,X,V),!(2>this._results.length)){for(var H=1;H<this._results.length;H++)this._results[H].index=M;this.paste(O,U,this._results,V)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var M="",O=[""],U=0;U<this.layers[this.currentLayer].height;U++){for(var W=0;W<this.layers[this.currentLayer].width;W++)M+="%c  ",1<this.layers[this.currentLayer].data[U][W]?this.debugMap[this.layers[this.currentLayer].data[U][W]]?O.push("background: "+this.debugMap[this.layers[this.currentLayer].data[U][W]]):O.push("background: #ffffff"):O.push("background: rgb(0, 0, 0)");M+="\n"}O[0]=M,console.log.apply(console,O)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},C.Tilemap.prototype.constructor=C.Tilemap,Object.defineProperty(C.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(M){M!==this.currentLayer&&this.setLayer(M)}}),C.TilemapLayer=function(M,O,U,W,X){W|=0,X|=0,C.Sprite.call(this,M,0,0),this.map=O,this.index=U,this.layer=O.layers[U],this.canvas=C.CanvasPool.create(this,W,X),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution))),this.type=C.TILEMAPLAYER,this.physicsType=C.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!0,overdrawRatio:0.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:0.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:O.tileWidth,tileHeight:O.tileHeight,cw:O.tileWidth,ch:O.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this.tileOffset=new C.Point(this.layer.offsetX||0,this.layer.offsetY||0),this._results=[],M.device.canvasBitBltShift||(this.renderSettings.copyCanvas=C.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},C.TilemapLayer.prototype=Object.create(C.Sprite.prototype),C.TilemapLayer.prototype.constructor=C.TilemapLayer,C.TilemapLayer.prototype.preUpdateCore=C.Component.Core.preUpdate,C.TilemapLayer.sharedCopyCanvas=null,C.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=C.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},C.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},C.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y},C.TilemapLayer.prototype._renderCanvas=function(M){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,M)},C.TilemapLayer.prototype._renderWebGL=function(M){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,M)},C.TilemapLayer.prototype.destroy=function(){C.CanvasPool.remove(this),C.Component.Destroy.prototype.destroy.call(this)},C.TilemapLayer.prototype.resize=function(M,O){this.canvas.width=M,this.canvas.height=O,this.texture.frame.resize(M,O),this.texture.width=M,this.texture.height=O,this.texture.crop.width=M,this.texture.crop.height=O,this.texture.baseTexture.width=M,this.texture.baseTexture.height=O,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},C.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},C.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||(this.fixedToCamera?0:this.position.x)},C.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||(this.fixedToCamera?0:this.position.y)},C.TilemapLayer.prototype._fixX=function(M){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?M:0===this.scrollFactorX&&0!==this.position.x?M-this.position.x:this._scrollX+(M-this._scrollX/this.scrollFactorX)},C.TilemapLayer.prototype._unfixX=function(M){return 1===this.scrollFactorX?M:this._scrollX/this.scrollFactorX+(M-this._scrollX)},C.TilemapLayer.prototype._fixY=function(M){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?M:0===this.scrollFactorY&&0!==this.position.y?M-this.position.y:this._scrollY+(M-this._scrollY/this.scrollFactorY)},C.TilemapLayer.prototype._unfixY=function(M){return 1===this.scrollFactorY?M:this._scrollY/this.scrollFactorY+(M-this._scrollY)},C.TilemapLayer.prototype.getTileX=function(M){return Math.floor(this._fixX(M)/this._mc.tileWidth)},C.TilemapLayer.prototype.getTileY=function(M){return Math.floor(this._fixY(M)/this._mc.tileHeight)},C.TilemapLayer.prototype.getTileXY=function(M,O,U){return U.x=this.getTileX(M),U.y=this.getTileY(O),U},C.TilemapLayer.prototype.getRayCastTiles=function(M,O,U,W){O||(O=this.rayStepRate),void 0===U&&(U=!1),void 0===W&&(W=!1);var X=this.getTiles(M.x,M.y,M.width,M.height,U,W);if(0===X.length)return[];for(var V=M.coordinatesOnLine(O),H=[],Y=0;Y<X.length;Y++)for(var z=0;z<V.length;z++){var K=X[Y],J=V[z];if(K.containsPoint(J[0],J[1])){H.push(K);break}}return H},C.TilemapLayer.prototype.getTiles=function(M,O,U,W,X,V){void 0===X&&(X=!1),void 0===V&&(V=!1);var H=!(X||V);M=this._fixX(M),O=this._fixY(O);for(var Y=Math.floor(M/(this._mc.cw*this.scale.x)),z=Math.floor(O/(this._mc.ch*this.scale.y)),K=Math.ceil((M+U)/(this._mc.cw*this.scale.x))-Y,J=Math.ceil((O+W)/(this._mc.ch*this.scale.y))-z;this._results.length;)this._results.pop();for(var Q=z;Q<z+J;Q++)for(var Z=Y,$;Z<Y+K;Z++)$=this.layer.data[Q],$&&$[Z]&&(H||$[Z].isInteresting(X,V))&&this._results.push($[Z]);return this._results.slice()},C.TilemapLayer.prototype.resolveTileset=function(M){var O=this._mc.tilesets;if(2e3>M)for(;O.length<M;)O.push(void 0);var U=this.map.tiles[M]&&this.map.tiles[M][2];if(null!==U){var W=this.map.tilesets[U];if(W&&W.containsTileIndex(M))return O[M]=W}return O[M]=null},C.TilemapLayer.prototype.resetTilesetCache=function(){for(var M=this._mc.tilesets;M.length;)M.pop()},C.TilemapLayer.prototype.setScale=function(M,O){M=M||1,O=O||M;for(var U=0,W;U<this.layer.data.length;U++){W=this.layer.data[U];for(var X=0,V;X<W.length;X++)V=W[X],V.width=this.map.tileWidth*M,V.height=this.map.tileHeight*O,V.worldX=V.x*V.width,V.worldY=V.y*V.height}this.scale.setTo(M,O)},C.TilemapLayer.prototype.shiftCanvas=function(M,O,U){var W=M.canvas,X=W.width-Math.abs(O),V=W.height-Math.abs(U),H=0,Y=0,z=O,K=U;0>O&&(H=-O,z=0),0>U&&(Y=-U,K=0);var J=this.renderSettings.copyCanvas;if(J){(J.width<X||J.height<V)&&(J.width=X,J.height=V);var Q=J.getContext("2d");Q.clearRect(0,0,X,V),Q.drawImage(W,H,Y,X,V,0,0,X,V),M.clearRect(z,K,X,V),M.drawImage(J,0,0,X,V,z,K,X,V)}else M.save(),M.globalCompositeOperation="copy",M.drawImage(W,H,Y,X,V,z,K,X,V),M.restore()},C.TilemapLayer.prototype.renderRegion=function(M,O,U,W,X,V){var H=this.context,Y=this.layer.width,z=this.layer.height,K=this._mc.tileWidth,J=this._mc.tileHeight,Q=this._mc.tilesets,Z=NaN;this._wrap||(U<=X&&(U=Math.max(0,U),X=Math.min(Y-1,X)),W<=V&&(W=Math.max(0,W),V=Math.min(z-1,V)));var $=U*K-M,ee=W*J-O,te=(U+1048576*Y)%Y,ae=(W+1048576*z)%z,oe,ne,ie,se,le,de;for(se=ae,de=V-W,ne=ee;0<=de;se++,de--,ne+=J){se>=z&&(se-=z);var pe=this.layer.data[se];for(ie=te,le=X-U,oe=$;0<=le;ie++,le--,oe+=K){ie>=Y&&(ie-=Y);var ue=pe[ie];if(ue&&!(0>ue.index)){var he=ue.index,ge=Q[he];void 0===ge&&(ge=this.resolveTileset(he)),ue.alpha===Z||this.debug||(H.globalAlpha=ue.alpha,Z=ue.alpha),ge?ue.rotation||ue.flipped?(H.save(),H.translate(oe+ue.centerX,ne+ue.centerY),H.rotate(ue.rotation),ue.flipped&&H.scale(-1,1),ge.draw(H,-ue.centerX,-ue.centerY,he),H.restore()):ge.draw(H,oe,ne,he):this.debugSettings.missingImageFill&&(H.fillStyle=this.debugSettings.missingImageFill,H.fillRect(oe,ne,K,J)),ue.debug&&this.debugSettings.debuggedTileOverfill&&(H.fillStyle=this.debugSettings.debuggedTileOverfill,H.fillRect(oe,ne,K,J))}}}},C.TilemapLayer.prototype.renderDeltaScroll=function(M,O){var U=this._mc.scrollX,W=this._mc.scrollY,X=this.canvas.width,V=this.canvas.height,H=this._mc.tileWidth,Y=this._mc.tileHeight,z=0,K=-H,J=0,Q=-Y;if(0>M?(z=X+M,K=X-1):0<M&&(K=M),0>O?(J=V+O,Q=V-1):0<O&&(Q=O),this.shiftCanvas(this.context,M,O),z=Math.floor((z+U)/H),K=Math.floor((K+U)/H),J=Math.floor((J+W)/Y),Q=Math.floor((Q+W)/Y),z<=K){this.context.clearRect(z*H-U,0,(K-z+1)*H,V);var Z=Math.floor((0+W)/Y),$=Math.floor((V-1+W)/Y);this.renderRegion(U,W,z,Z,K,$)}if(J<=Q){this.context.clearRect(0,J*Y-W,X,(Q-J+1)*Y);var ee=Math.floor((0+U)/H),te=Math.floor((X-1+U)/H);this.renderRegion(U,W,ee,J,te,Q)}},C.TilemapLayer.prototype.renderFull=function(){var M=this._mc.scrollX,O=this._mc.scrollY,U=this.canvas.width,W=this.canvas.height,X=this._mc.tileWidth,V=this._mc.tileHeight,H=Math.floor(M/X),Y=Math.floor((U-1+M)/X),z=Math.floor(O/V),K=Math.floor((W-1+O)/V);this.context.clearRect(0,0,U,W),this.renderRegion(M,O,H,z,Y,K)},C.TilemapLayer.prototype.render=function(){var M=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,M=!0);var O=this.canvas.width,U=this.canvas.height,W=0|this._scrollX,X=0|this._scrollY,V=this._mc,H=V.scrollX-W,Y=V.scrollY-X;if(M||0!=H||0!=Y||V.renderWidth!==O||V.renderHeight!==U)return this.context.save(),V.scrollX=W,V.scrollY=X,(V.renderWidth!==O||V.renderHeight!==U)&&(V.renderWidth=O,V.renderHeight=U),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(M=!0)),!M&&this.renderSettings.enableScrollDelta&&Math.abs(H)+Math.abs(Y)<Math.min(O,U)?this.renderDeltaScroll(H,Y):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},C.TilemapLayer.prototype.renderDebug=function(){var M=this._mc.scrollX,O=this._mc.scrollY,U=this.context,W=this.canvas.width,X=this.canvas.height,V=this.layer.width,H=this.layer.height,Y=this._mc.tileWidth,z=this._mc.tileHeight,K=Math.floor(M/Y),J=Math.floor((W-1+M)/Y),Q=Math.floor(O/z),Z=Math.floor((X-1+O)/z),oe,ne,ie,se,le,de;for(U.strokeStyle=this.debugSettings.facingEdgeStroke,se=(Q+1048576*H)%H,de=Z-Q,ne=Q*z-O;0<=de;se++,de--,ne+=z){se>=H&&(se-=H);var pe=this.layer.data[se];for(ie=(K+1048576*V)%V,le=J-K,oe=K*Y-M;0<=le;ie++,le--,oe+=Y){ie>=V&&(ie-=V);var ue=pe[ie];ue&&!(0>ue.index)&&ue.collides&&(this.debugSettings.collidingTileOverfill&&(U.fillStyle=this.debugSettings.collidingTileOverfill,U.fillRect(oe,ne,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(U.beginPath(),ue.faceTop&&(U.moveTo(oe,ne),U.lineTo(oe+this._mc.cw,ne)),ue.faceBottom&&(U.moveTo(oe,ne+this._mc.ch),U.lineTo(oe+this._mc.cw,ne+this._mc.ch)),ue.faceLeft&&(U.moveTo(oe,ne),U.lineTo(oe,ne+this._mc.ch)),ue.faceRight&&(U.moveTo(oe+this._mc.cw,ne),U.lineTo(oe+this._mc.cw,ne+this._mc.ch)),U.closePath(),U.stroke()))}}},Object.defineProperty(C.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(M){this._wrap=M,this.dirty=!0}}),Object.defineProperty(C.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(M){this._scrollX=M}}),Object.defineProperty(C.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(M){this._scrollY=M}}),Object.defineProperty(C.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(M){this._mc.cw=0|M,this.dirty=!0}}),Object.defineProperty(C.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(M){this._mc.ch=0|M,this.dirty=!0}}),C.TilemapParser={INSERT_NULL:!1,parse:function(M,O,U,W,X,V){if(void 0===U&&(U=32),void 0===W&&(W=32),void 0===X&&(X=10),void 0===V&&(V=10),void 0===O)return this.getEmptyData();if(null===O)return this.getEmptyData(U,W,X,V);var H=M.cache.getTilemapData(O);if(H){if(H.format===C.Tilemap.CSV)return this.parseCSV(O,H.data,U,W);if(!H.format||H.format===C.Tilemap.TILED_JSON)return this.parseTiledJSON(H.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+O)},parseCSV:function(M,O,U,W){var X=this.getEmptyData();O=O.trim();for(var V=[],H=O.split("\n"),Y=H.length,z=0,K=0;K<H.length;K++){V[K]=[];for(var J=H[K].split(","),Q=0;Q<J.length;Q++)V[K][Q]=new C.Tile(X.layers[0],parseInt(J[Q],10),Q,K,U,W);0==z&&(z=J.length)}return X.format=C.Tilemap.CSV,X.name=M,X.width=z,X.height=Y,X.tileWidth=U,X.tileHeight=W,X.widthInPixels=z*U,X.heightInPixels=Y*W,X.layers[0].width=z,X.layers[0].height=Y,X.layers[0].widthInPixels=X.widthInPixels,X.layers[0].heightInPixels=X.heightInPixels,X.layers[0].data=V,X},getEmptyData:function(M,O,U,W){return{width:void 0!==U&&null!==U?U:0,height:void 0!==W&&null!==W?W:0,tileWidth:void 0!==M&&null!==M?M:0,tileHeight:void 0!==O&&null!==O?O:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(M){function O(Fe,De){var Ie={};for(var Me in De){var Oe=De[Me];"undefined"!=typeof Fe[Oe]&&(Ie[Oe]=Fe[Oe])}return Ie}if("orthogonal"!==M.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(var U={width:M.width,height:M.height,tileWidth:M.tilewidth,tileHeight:M.tileheight,orientation:M.orientation,format:C.Tilemap.TILED_JSON,version:M.version,properties:M.properties,widthInPixels:M.width*M.tilewidth,heightInPixels:M.height*M.tileheight},W=[],X=0;X<M.layers.length;X++)if("tilelayer"===M.layers[X].type){var V=M.layers[X];if(!V.compression&&V.encoding&&"base64"===V.encoding){for(var H=window.atob(V.data),Y=H.length,z=Array(Y),K=0;K<Y;K+=4)z[K/4]=(H.charCodeAt(K)|H.charCodeAt(K+1)<<8|H.charCodeAt(K+2)<<16|H.charCodeAt(K+3)<<24)>>>0;V.data=z,delete V.encoding}else if(V.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+V.name+"'");continue}var J={name:V.name,x:V.x,y:V.y,width:V.width,height:V.height,widthInPixels:V.width*M.tilewidth,heightInPixels:V.height*M.tileheight,alpha:V.opacity,offsetX:V.offsetx,offsetY:V.offsety,visible:V.visible,properties:{},indexes:[],callbacks:[],bodies:[]};V.properties&&(J.properties=V.properties);for(var Q=0,Z=[],$=[],ne=0,Y=V.data.length,ee,te,ae,oe;ne<Y;ne++){if(ee=0,te=!1,oe=V.data[ne],ae=0,(536870912<oe&&(2147483648<oe&&(oe-=2147483648,ae+=4),1073741824<oe&&(oe-=1073741824,ae+=2),536870912<oe&&(oe-=536870912,ae+=1),5===ae?ee=Math.PI/2:6===ae?ee=Math.PI:3===ae?ee=3*Math.PI/2:4===ae?(ee=0,te=!0):7===ae?(ee=Math.PI/2,te=!0):2===ae?(ee=Math.PI,te=!0):1===ae?(ee=3*Math.PI/2,te=!0):void 0),0<oe)){var ie=new C.Tile(J,oe,Q,$.length,M.tilewidth,M.tileheight);ie.rotation=ee,ie.flipped=te,0!==ae&&(ie.flippedVal=ae),Z.push(ie)}else C.TilemapParser.INSERT_NULL?Z.push(null):Z.push(new C.Tile(J,-1,Q,$.length,M.tilewidth,M.tileheight));Q++,Q===V.width&&($.push(Z),Q=0,Z=[])}J.data=$,W.push(J)}U.layers=W;for(var se=[],X=0;X<M.layers.length;X++)if("imagelayer"===M.layers[X].type){var le=M.layers[X],de={name:le.name,image:le.image,x:le.x,y:le.y,alpha:le.opacity,visible:le.visible,properties:{}};le.properties&&(de.properties=le.properties),se.push(de)}U.images=se;for(var pe=[],ue=[],he=null,X=0,ge;X<M.tilesets.length;X++){if(ge=M.tilesets[X],ge.source)console.warn("Phaser.TilemapParser - Phaser can't load external tilesets (%s). Use the Embed Tileset button and then export the map again.",ge.source);else if(ge.image){var me=new C.Tileset(ge.name,ge.firstgid,ge.tilewidth,ge.tileheight,ge.margin,ge.spacing,ge.properties);ge.tileproperties&&(me.tileProperties=ge.tileproperties),me.updateTileData(ge.imagewidth,ge.imageheight),pe.push(me)}else if(ge.tiles){var be=new C.ImageCollection(ge.name,ge.firstgid,ge.tilewidth,ge.tileheight,ge.margin,ge.spacing,ge.properties);for(var _e in ge.tiles){var de=ge.tiles[_e].image,oe=ge.firstgid+parseInt(_e,10);be.addImage(oe,de)}ue.push(be)}else throw new Error("Tileset "+ge.name+" has no `image` or `tiles` property.");he&&(he.lastgid=ge.firstgid-1),he=ge}if(0===pe.length&&0===ue.length)throw new Error("This tilemap has no tilesets.");U.tilesets=pe,U.imagecollections=ue;for(var ve={},Te={},X=0;X<M.layers.length;X++)if("objectgroup"===M.layers[X].type){var Ce=M.layers[X];ve[Ce.name]=[],Te[Ce.name]=[];for(var Pe=0,Y=Ce.objects.length;Pe<Y;Pe++)if(Ce.objects[Pe].gid){var Se={gid:Ce.objects[Pe].gid,name:Ce.objects[Pe].name,type:Ce.objects[Pe].hasOwnProperty("type")?Ce.objects[Pe].type:"",x:Ce.objects[Pe].x,y:Ce.objects[Pe].y,width:Ce.objects[Pe].width,height:Ce.objects[Pe].height,visible:Ce.objects[Pe].visible,properties:Ce.objects[Pe].properties};Ce.objects[Pe].rotation&&(Se.rotation=Ce.objects[Pe].rotation),ve[Ce.name].push(Se)}else if(Ce.objects[Pe].polyline){var Se={name:Ce.objects[Pe].name,type:Ce.objects[Pe].type,x:Ce.objects[Pe].x,y:Ce.objects[Pe].y,width:Ce.objects[Pe].width,height:Ce.objects[Pe].height,visible:Ce.objects[Pe].visible,properties:Ce.objects[Pe].properties};Ce.objects[Pe].rotation&&(Se.rotation=Ce.objects[Pe].rotation),Se.polyline=[];for(var we=0;we<Ce.objects[Pe].polyline.length;we++)Se.polyline.push([Ce.objects[Pe].polyline[we].x,Ce.objects[Pe].polyline[we].y]);Te[Ce.name].push(Se),ve[Ce.name].push(Se)}else if(Ce.objects[Pe].polygon){var Se=O(Ce.objects[Pe],["name","type","x","y","visible","rotation","properties"]);Se.polygon=[];for(var we=0;we<Ce.objects[Pe].polygon.length;we++)Se.polygon.push([Ce.objects[Pe].polygon[we].x,Ce.objects[Pe].polygon[we].y]);ve[Ce.name].push(Se)}else if(Ce.objects[Pe].ellipse){var Se=O(Ce.objects[Pe],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);ve[Ce.name].push(Se)}else{var Se=O(Ce.objects[Pe],["name","type","x","y","width","height","visible","rotation","properties"]);Se.rectangle=!0,ve[Ce.name].push(Se)}}U.objects=ve,U.collision=Te,U.tiles=[];for(var X=0;X<U.tilesets.length;X++)for(var ge=U.tilesets[X],Q=ge.tileMargin,Ae=ge.tileMargin,Ee=0,Re=0,Le=0,ne=ge.firstgid;ne<ge.firstgid+ge.total&&(U.tiles[ne]=[Q,Ae,X],Q+=ge.tileWidth+ge.tileSpacing,Ee++,Ee!==ge.total)&&(Re++,!(Re===ge.columns&&(Q=ge.tileMargin,Ae+=ge.tileHeight+ge.tileSpacing,Re=0,Le++,Le===ge.rows)));ne++);for(var X=0,J,ie,Be,ge;X<U.layers.length;X++){J=U.layers[X],ge=null;for(var K=0;K<J.data.length;K++){Z=J.data[K];for(var ke=0;ke<Z.length;ke++)(ie=Z[ke],!(null===ie||0>ie.index))&&(Be=U.tiles[ie.index][2],ge=U.tilesets[Be],ge.tileProperties&&ge.tileProperties[ie.index-ge.firstgid]&&(ie.properties=C.Utils.mixin(ge.tileProperties[ie.index-ge.firstgid],ie.properties)))}}return U}},C.Tileset=function(M,O,U,W,X,V,H){(void 0===U||0>=U)&&(U=32),(void 0===W||0>=W)&&(W=32),void 0===X&&(X=0),void 0===V&&(V=0),this.name=M,this.firstgid=0|O,this.tileWidth=0|U,this.tileHeight=0|W,this.tileMargin=0|X,this.tileSpacing=0|V,this.properties=H||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},C.Tileset.prototype={draw:function(M,O,U,W){var X=W-this.firstgid<<1;0<=X&&X+1<this.drawCoords.length&&M.drawImage(this.image,this.drawCoords[X],this.drawCoords[X+1],this.tileWidth,this.tileHeight,O,U,this.tileWidth,this.tileHeight)},containsTileIndex:function(M){return M>=this.firstgid&&M<this.firstgid+this.total},setImage:function(M){this.image=M,this.updateTileData(M.width,M.height)},setSpacing:function(M,O){this.tileMargin=0|M,this.tileSpacing=0|O,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(M,O){var U=(O-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),W=(M-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);(0!=U%1||0!=W%1)&&console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size"),U=Math.floor(U),W=Math.floor(W),(this.rows&&this.rows!==U||this.columns&&this.columns!==W)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=U,this.columns=W,this.total=U*W,this.drawCoords.length=0;for(var X=this.tileMargin,V=this.tileMargin,H=0;H<this.rows;H++){for(var Y=0;Y<this.columns;Y++)this.drawCoords.push(X),this.drawCoords.push(V),X+=this.tileWidth+this.tileSpacing;X=this.tileMargin,V+=this.tileHeight+this.tileSpacing}}},C.Tileset.prototype.constructor=C.Tileset,C.Particle=function(M,O,U,W,X){C.Sprite.call(this,M,O,U,W,X),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},C.Particle.prototype=Object.create(C.Sprite.prototype),C.Particle.prototype.constructor=C.Particle,C.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},C.Particle.prototype.onEmit=function(){},C.Particle.prototype.setAlphaData=function(M){this.alphaData=M,this._a=M.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},C.Particle.prototype.setScaleData=function(M){this.scaleData=M,this._s=M.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},C.Particle.prototype.reset=function(M,O,U){return C.Component.Reset.prototype.reset.call(this,M,O,U),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},C.Particles=function(M){this.game=M,this.emitters={},this.ID=0},C.Particles.prototype={add:function(M){return this.emitters[M.id]=M,M},remove:function(M){delete this.emitters[M.id]},update:function(){for(var M in this.emitters)this.emitters[M].exists&&this.emitters[M].update()}},C.Particles.prototype.constructor=C.Particles,C.Particles.Arcade={},C.Particles.Arcade.Emitter=function(M,O,U,W){this.maxParticles=W||50,C.Group.call(this,M),this._id=this.game.particles.ID++,this.name="emitter"+this.id,this.type=C.EMITTER,this.physicsType=C.GROUP,this.area=new C.Rectangle(O,U,1,1),this.minAngle=null,this.maxAngle=null,this.minSpeed=0,this.maxSpeed=100,this.minParticleSpeed=new C.Point(-100,-100),this.maxParticleSpeed=new C.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.particleClass=C.Particle,this.particleDrag=new C.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new C.Point,this.on=!1,this.particleAnchor=new C.Point(0.5,0.5),this.blendMode=C.blendModes.NORMAL,this.emitX=O,this.emitY=U,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0},this.count=this.counts,this._gravity=new C.Point(0,100),this._minParticleScale=new C.Point(1,1),this._maxParticleScale=new C.Point(1,1),this._total=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},C.Particles.Arcade.Emitter.prototype=Object.create(C.Group.prototype),C.Particles.Arcade.Emitter.prototype.constructor=C.Particles.Arcade.Emitter,C.Particles.Arcade.Emitter.prototype.update=function(){if(this.count.emitted=0,this.count.failed=0,this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0===this._flowTotal)this.emitParticle()&&(this._counter++,0<this._total&&this._counter>=this._total&&(this.on=!1));else if(0<this._flowQuantity){for(var M=0;M<this._flowQuantity;M++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));for(var M=this.children.length;M--;)this.children[M].exists&&this.children[M].update()},C.Particles.Arcade.Emitter.prototype.makeParticles=function(M,O,U,W,X,V){void 0===O&&(O=0),void 0===U&&(U=this.maxParticles),void 0===W&&(W=!1),void 0===X&&(X=!1),void 0===V&&(V=null);var Y=0,z=M,K=O,H;for(this._frames=O,U>this.maxParticles&&(this.maxParticles=U);Y<U;)Array.isArray(M)&&(z=this.game.rnd.pick(M)),Array.isArray(O)&&(K=this.game.rnd.pick(O)),H=new this.particleClass(this.game,0,0,z,K,V),this.game.physics.arcade.enable(H,!1),H.body.checkCollision.none=!W,H.body.collideWorldBounds=X,H.body.skipQuadTree=!0,H.exists=!1,H.visible=!1,H.anchor.copyFrom(this.particleAnchor),this.add(H),Y++;return this},C.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},C.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},C.Particles.Arcade.Emitter.prototype.explode=function(M,O){return void 0===O&&(O=this.maxParticles),this._flowTotal=0,this.start(!0,M,0,O,!1),this},C.Particles.Arcade.Emitter.prototype.flow=function(M,O,U,W,X){return(void 0===O||null===O)&&(O=250),(void 0===U||0===U)&&(U=1),void 0===W&&(W=-1),void 0===X&&(X=!0),U>this.maxParticles&&(U=this.maxParticles),this._counter=0,this._flowQuantity=U,this._flowTotal=W,X?(this.start(!0,M,O,U),this._counter+=U,this.on=!0,this._timer=this.game.time.time+O*this.game.time.slowMotion):this.start(!1,M,O,U),this},C.Particles.Arcade.Emitter.prototype.start=function(M,O,U,W,X){if(void 0===M&&(M=!0),void 0===O&&(O=0),(void 0===U||null===U)&&(U=250),void 0===W&&(W=0),void 0===X&&(X=!1),W>this.maxParticles&&(W=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=O,this.frequency=U,M||X)for(var V=0;V<W;V++)this.emitParticle();else this.on=!0,this._total=W,this._counter=0,this._timer=this.game.time.time+U*this.game.time.slowMotion;return this},C.Particles.Arcade.Emitter.prototype.emitParticle=function(M,O,U,W){void 0===M&&(M=null),void 0===O&&(O=null);var X=this.getFirstExists(!1);if(null===X)return this.count.failed++,this.count.totalFailed++,!1;this.count.emitted++,this.count.totalEmitted++;var V=this.game.rnd;void 0!==U&&void 0!==W?X.loadTexture(U,W):void 0!==U&&(X.loadTexture(U),X.frame=Array.isArray(this._frames)?V.pick(this._frames):this._frames);var H=this.emitX,Y=this.emitY;return null===M?1<this.width&&(H=V.between(this.left,this.right)):H=M,null===O?1<this.height&&(Y=V.between(this.top,this.bottom)):Y=O,this.resetParticle(X,H,Y),!0},C.Particles.Arcade.Emitter.prototype.resetParticle=function(M,O,U){var W=this.game.rnd;M.reset(O,U),M.angle=0,M.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(M):this.particleSendToBack&&this.sendToBack(M),this.autoScale?M.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?M.scale.set(W.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?M.scale.set(W.realInRange(this._minParticleScale.x,this._maxParticleScale.x),W.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):M.scale.set(this._minParticleScale.x,this._minParticleScale.y),this.autoAlpha?M.setAlphaData(this.alphaData):M.alpha=W.realInRange(this.minParticleAlpha,this.maxParticleAlpha),M.blendMode=this.blendMode;var X=M.body;X.updateBounds(),X.bounce.copyFrom(this.bounce),X.drag.copyFrom(this.particleDrag),null!=this.minAngle&&null!=this.maxAngle?this.game.physics.arcade.velocityFromAngle(this.minAngle===this.maxAngle?this.minAngle:W.between(this.minAngle,this.maxAngle),this.minSpeed===this.maxSpeed?this.minSpeed:W.between(this.minSpeed,this.maxSpeed),X.velocity):(X.velocity.x=W.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),X.velocity.y=W.between(this.minParticleSpeed.y,this.maxParticleSpeed.y)),X.angularVelocity=W.between(this.minRotation,this.maxRotation),X.gravity.copyFrom(this.gravity),X.angularDrag=this.angularDrag,M.onEmit()},C.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),C.Group.prototype.destroy.call(this,!0,!1)},C.Particles.Arcade.Emitter.prototype.setSize=function(M,O){return this.area.width=M,this.area.height=O,this},C.Particles.Arcade.Emitter.prototype.setXSpeed=function(M,O){return M=M||0,O=O||0,this.minParticleSpeed.x=M,this.maxParticleSpeed.x=O,this},C.Particles.Arcade.Emitter.prototype.setYSpeed=function(M,O){return M=M||0,O=O||0,this.minParticleSpeed.y=M,this.maxParticleSpeed.y=O,this},C.Particles.Arcade.Emitter.prototype.setRotation=function(M,O){return M=M||0,O=O||0,this.minRotation=M,this.maxRotation=O,this},C.Particles.Arcade.Emitter.prototype.setAlpha=function(M,O,U,W,X){if(void 0===M&&(M=1),void 0===O&&(O=1),void 0===U&&(U=0),void 0===W&&(W=C.Easing.Linear.None),void 0===X&&(X=!1),this.minParticleAlpha=M,this.maxParticleAlpha=O,this.autoAlpha=!1,0<U&&M!==O){var V={v:M},H=this.game.make.tween(V).to({v:O},U,W);H.yoyo(X),this.alphaData=H.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}return this},C.Particles.Arcade.Emitter.prototype.setScale=function(M,O,U,W,X,V,H){if(void 0===M&&(M=1),void 0===O&&(O=1),void 0===U&&(U=1),void 0===W&&(W=1),void 0===X&&(X=0),void 0===V&&(V=C.Easing.Linear.None),void 0===H&&(H=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(M,U),this._maxParticleScale.set(O,W),this.autoScale=!1,0<X&&(M!==O||U!==W)){var Y={x:M,y:U},z=this.game.make.tween(Y).to({x:O,y:W},X,V);z.yoyo(H),this.scaleData=z.generateData(60),this.scaleData.reverse(),this.autoScale=!0}return this},C.Particles.Arcade.Emitter.prototype.setAngle=function(M,O,U,W){return this.minAngle=M,this.maxAngle=O,null!=U&&(this.minSpeed=U),null!=W&&(this.maxSpeed=W),this},C.Particles.Arcade.Emitter.prototype.at=function(M){return M.center?(this.emitX=M.center.x,this.emitY=M.center.y):(this.emitX=M.world.x+M.anchor.x*M.width,this.emitY=M.world.y+M.anchor.y*M.height),this},Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(M){"number"==typeof M?this._gravity.y=M:this._gravity=M}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(M){this.area.width=M}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(M){this.area.height=M}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(M){this.emitX=M}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(M){this.emitY=M}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1e3*this._flowQuantity/this.frequency}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"lifespanOutput",{get:function(){return(0===this.lifespan?Infinity:this.lifespan)*this._flowQuantity/this.frequency}}),Object.defineProperty(C.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}}),C.Weapon=function(M,O){C.Plugin.call(this,M,O),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new C.Rectangle(0,0,1,1),this.fireAngle=C.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new C.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=C.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=C.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new C.Rectangle,this.bulletBounds=M.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new C.Signal,this.onKill=new C.Signal,this.onFireLimit=new C.Signal,this.trackedSprite=null,this.trackedPointer=null,this.multiFire=!1,this._hasFired=!1,this.trackRotation=!1,this.trackOffset=new C.Point,this._nextFire=0,this._tempNextFire=0,this._rotatedPoint=new C.Point},C.Weapon.prototype=Object.create(C.Plugin.prototype),C.Weapon.prototype.constructor=C.Weapon,C.Weapon.KILL_NEVER=0,C.Weapon.KILL_LIFESPAN=1,C.Weapon.KILL_DISTANCE=2,C.Weapon.KILL_WEAPON_BOUNDS=3,C.Weapon.KILL_CAMERA_BOUNDS=4,C.Weapon.KILL_WORLD_BOUNDS=5,C.Weapon.KILL_STATIC_BOUNDS=6,C.Weapon.prototype.createBullets=function(M,O,U,W){return void 0===M&&(M=1),void 0===W&&(W=this.game.world),this.bullets||(this.bullets=this.game.add.physicsGroup(C.Physics.ARCADE,W),this.bullets.classType=this._bulletClass),0!==M&&(-1===M&&(this.autoExpandBulletsGroup=!0,M=1),this.bullets.createMultiple(M,O,U),this.bullets.setAll("data.bulletManager",this),this.bulletKey=O,this.bulletFrame=U),this},C.Weapon.prototype.forEach=function(M,O){return this.bullets.forEachExists(M,O,arguments),this},C.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},C.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},C.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},C.Weapon.prototype.resetShots=function(M){return this.shots=0,void 0!==M&&(this.fireLimit=M),this},C.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},C.Weapon.prototype.update=function(){this._bulletKillType===C.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},C.Weapon.prototype.postRender=function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)},C.Weapon.prototype.trackSprite=function(M,O,U,W){return void 0===O&&(O=0),void 0===U&&(U=0),void 0===W&&(W=!1),this.trackedPointer=null,this.trackedSprite=M,this.trackRotation=W,this.trackOffset.set(O,U),this},C.Weapon.prototype.trackPointer=function(M,O,U){return void 0===M&&(M=this.game.input.activePointer),void 0===O&&(O=0),void 0===U&&(U=0),this.trackedPointer=M,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(O,U),this},C.Weapon.prototype.fireMany=function(M,O){this.multiFire=!0;var U=[],W=this;return O||this.trackedSprite||this.trackedPointer?M.forEach(function(X){U.push(W.fire(O,null,null,X.x,X.y))}):M.forEach(function(X){U.push(W.fire(X))}),U},C.Weapon.prototype.fireOffset=function(M,O){return void 0===M&&(M=0),void 0===O&&(O=0),this.fire(null,null,null,M,O)},C.Weapon.prototype.fire=function(M,O,U,W,X){if(void 0===O&&(O=null),void 0===U&&(U=null),this.game.time.now<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return null;var V=this.bulletSpeed;0!==this.bulletSpeedVariance&&(V+=C.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),M?1<this.fireFrom.width?this.fireFrom.centerOn(M.x,M.y):(this.fireFrom.x=M.x,this.fireFrom.y=M.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(V+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y)),void 0!==W&&(this.fireFrom.x+=W),void 0!==X&&(this.fireFrom.y+=X);var H=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x,Y=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y,z=this.trackRotation?this.trackedSprite.angle:this.fireAngle;null!==O&&null!==U&&(z=this.game.math.radToDeg(Math.atan2(U-Y,O-H))),0!==this.bulletAngleVariance&&(z+=C.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var K=0,J=0;0===z||180===z?K=Math.cos(this.game.math.degToRad(z))*V:90===z||270===z?J=Math.sin(this.game.math.degToRad(z))*V:(K=Math.cos(this.game.math.degToRad(z))*V,J=Math.sin(this.game.math.degToRad(z))*V);var Q=null;if(this.autoExpandBulletsGroup?(Q=this.bullets.getFirstExists(!1,!0,H,Y,this.bulletKey,this.bulletFrame),Q.data.bulletManager=this):Q=this.bullets.getFirstExists(!1),Q){if(Q.reset(H,Y),Q.data.fromX=H,Q.data.fromY=Y,Q.data.killType=this.bulletKillType,Q.data.killDistance=this.bulletKillDistance,Q.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===C.Weapon.KILL_LIFESPAN&&(Q.lifespan=this.bulletLifespan),Q.angle=z+this.bulletAngleOffset,""!==this.bulletAnimation){if(null===Q.animations.getAnimation(this.bulletAnimation)){var Z=this.anims[this.bulletAnimation];Q.animations.add(Z.name,Z.frames,Z.frameRate,Z.loop,Z.useNumericIndex)}Q.animations.play(this.bulletAnimation)}else this.bulletFrameCycle?(Q.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(Q.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]);Q.data.bodyDirty&&(this._data.customBody&&Q.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),Q.body.collideWorldBounds=this.bulletCollideWorldBounds,Q.data.bodyDirty=!1),Q.body.velocity.set(K,J),Q.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);var $=0;if(0!==this.bulletSpeedVariance){var ee=this.fireRate;ee+=C.Math.between(-this.fireRateVariance,this.fireRateVariance),0>ee&&(ee=0),$=this.game.time.now+ee}else $=this.game.time.now+this.fireRate;this.multiFire?!this._hasFired&&(this._hasFired=!0,this._tempNextFire=$,this.shots++):(this._nextFire=$,this.shots++),this.onFire.dispatch(Q,this,V),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)}return Q},C.Weapon.prototype.fireAtPointer=function(M){return void 0===M&&(M=this.game.input.activePointer),this.fire(null,M.worldX,M.worldY)},C.Weapon.prototype.fireAtSprite=function(M){return this.fire(null,M.world.x,M.world.y)},C.Weapon.prototype.fireAtXY=function(M,O){return this.fire(null,M,O)},C.Weapon.prototype.setBulletBodyOffset=function(M,O,U,W){return void 0===U&&(U=0),void 0===W&&(W=0),this._data.customBody=!0,this._data.width=M,this._data.height=O,this._data.offsetX=U,this._data.offsetY=W,this.bullets.callAll("body.setSize","body",M,O,U,W),this.bullets.setAll("data.bodyDirty",!1),this},C.Weapon.prototype.setBulletFrames=function(M,O,U,W){return void 0===U&&(U=!0),void 0===W&&(W=!1),this.bulletFrames=C.ArrayUtils.numberArray(M,O),this.bulletFrameIndex=0,this.bulletFrameCycle=U,this.bulletFrameRandom=W,this},C.Weapon.prototype.addBulletAnimation=function(M,O,U,W,X){return this.anims[M]={name:M,frames:O,frameRate:U,loop:W,useNumericIndex:X},this.bullets.callAll("animations.add","animations",M,O,U,W,X),this.bulletAnimation=M,this},C.Weapon.prototype.debug=function(M,O,U){void 0===M&&(M=16),void 0===O&&(O=32),void 0===U&&(U=!1),this.game.debug.text("Weapon Plugin",M,O),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,M,O+24),U&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(C.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(M){this._bulletClass=M,this.bullets&&(this.bullets.classType=this._bulletClass)}}),Object.defineProperty(C.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(M){M===C.Weapon.KILL_STATIC_BOUNDS||M===C.Weapon.KILL_WEAPON_BOUNDS?this.bulletBounds=this.bounds:M===C.Weapon.KILL_CAMERA_BOUNDS?this.bulletBounds=this.game.camera.view:M===C.Weapon.KILL_WORLD_BOUNDS?this.bulletBounds=this.game.world.bounds:void 0,this._bulletKillType=M}}),Object.defineProperty(C.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(M){this._bulletCollideWorldBounds=M,this.bullets.setAll("body.collideWorldBounds",M),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(C.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(M){this.fireFrom.x=M}}),Object.defineProperty(C.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(M){this.fireFrom.y=M}}),C.Bullet=function(M,O,U,W,X){C.Sprite.call(this,M,O,U,W,X),this.anchor.set(0.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},C.Bullet.prototype=Object.create(C.Sprite.prototype),C.Bullet.prototype.constructor=C.Bullet,C.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},C.Bullet.prototype.update=function(){this.exists&&(this.data.killType>C.Weapon.KILL_LIFESPAN&&(this.data.killType===C.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():!this.data.bulletManager.bulletBounds.intersects(this)&&this.kill()),this.data.rotateToVelocity&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},C.Video=function(M,O,U){if(void 0===O&&(O=null),void 0===U&&(U=null),this.game=M,this.key=O,this.width=0,this.height=0,this.type=C.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new C.Signal,this.onChangeSource=new C.Signal,this.onComplete=new C.Signal,this.onAccess=new C.Signal,this.onError=new C.Signal,this.onTimeout=new C.Signal,this.timeout=15000,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._pendingChangeSource=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,O&&this.game.cache.checkVideoKey(O)){var W=this.game.cache.getVideo(O);W.isBlob?this.createVideoFromBlob(W.data):this.video=W.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight}else U&&this.createVideoFromURL(U,!1);this.video&&!U?(this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(C.Cache.DEFAULT.baseTexture.source,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new C.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==O&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,C.BitmapData&&(this.snapshot=new C.BitmapData(this.game,"",this.width,this.height)),this.game.device.needsTouchUnlock()?this.setTouchLock():W&&(W.locked=!1)},C.Video.prototype={connectToMediaStream:function(M,O){return M&&O&&(this.video=M,this.videoStream=O,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(M,O,U){if(void 0===M&&(M=!1),void 0===O&&(O=null),void 0===U&&(U=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==O&&(this.video.width=O),null!==U&&(this.video.height=U),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:M,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(W){this.getUserMediaError(W)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(M){clearTimeout(this._timeOutID),this.onError.dispatch(this,M)},getUserMediaSuccess:function(M){clearTimeout(this._timeOutID),this.videoStream=M,void 0===this.video.mozSrcObject?this.video.src=window.URL&&window.URL.createObjectURL(M)||M:this.video.mozSrcObject=M;var O=this;this.video.onloadeddata=function(){function U(){if(!(0<W))console.warn("Unable to connect to video stream. Webcam error?");else if(0<O.video.videoWidth){var X=O.video.videoWidth,V=O.video.videoHeight;isNaN(O.video.videoHeight)&&(V=X/(4/3)),O.video.play(),O.isStreaming=!0,O.baseTexture.source=O.video,O.updateTexture(null,X,V),O.onAccess.dispatch(O)}else window.setTimeout(U,500);W--}var W=10;U()}},createVideoFromBlob:function(M){var O=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(U){O.updateTexture(U)},!0),this.video.src=window.URL.createObjectURL(M),this.video.canplay=!0,this},createVideoFromURL:function(M,O){return void 0===O&&(O=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,O&&this.video.setAttribute("autoplay","autoplay"),this.video.src=M,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=M,this},updateTexture:function(M,O,U){var W=!1;(void 0===O||null===O)&&(O=this.video.videoWidth,W=!0),(void 0===U||null===U)&&(U=this.video.videoHeight),this.width=O,this.height=U,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(O,U),this.texture.frame.resize(O,U),this.texture.width=O,this.texture.height=U,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(O,U),W&&null!==this.key&&(this.onChangeSource.dispatch(this,O,U),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(M,O){return this._pendingChangeSource?this:(void 0===M&&(M=!1),void 0===O&&(O=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=M?"loop":"",this.video.playbackRate=O,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4===this.video.readyState?(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0)):(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval))),this.video.play(),this.onPlay.dispatch(this,M,O)),this)},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(M){M.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(M){if(Array.isArray(M))for(var O=0;O<M.length;O++)M[O].loadTexture&&M[O].loadTexture(this);else M.loadTexture(this);return this},addToWorld:function(M,O,U,W,X,V){X=X||1,V=V||1;var H=this.game.add.image(M,O,this);return H.anchor.set(U,W),H.scale.set(X,V),H},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){!this._muted||this._codeMuted||(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,!this.video.ended&&this.video.play())},changeSource:function(M,O){return void 0===O&&(O=!0),this.texture.valid=!1,this.video.pause(),this._pendingChangeSource=!0,this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=M,this.video.load(),this._autoplay=O,O||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?(this._pendingChangeSource=!1,this.updateTexture()):(this.retry--,0<this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate),this.key){var M=this.game.cache.getVideo(this.key);M&&!M.isBlob&&(M.locked=!1)}return!0},grab:function(M,O,U){return(void 0===M&&(M=!1),void 0===O&&(O=1),void 0===U&&(U=null),null===this.snapshot)?void console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable"):(M&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,O,U),this.snapshot)},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(C.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(M){this.video.currentTime=M}}),Object.defineProperty(C.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(C.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(C.Video.prototype,"mute",{get:function(){return this._muted},set:function(M){if(M=M||null,M){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(C.Video.prototype,"paused",{get:function(){return this._paused},set:function(M){if(M=M||null,!this.touchLocked)if(M){if(this._paused)return;this._codePaused=!0,this.setPause()}else{if(!this._paused)return;this._codePaused=!1,this.setResume()}}}),Object.defineProperty(C.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(M){0>M?M=0:1<M&&(M=1),this.video&&(this.video.volume=M)}}),Object.defineProperty(C.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(M){this.video&&(this.video.playbackRate=M)}}),Object.defineProperty(C.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(M){M&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(C.Video.prototype,"playing",{get:function(){return!!this.video&&!(this.video.paused&&this.video.ended)}}),C.Video.prototype.constructor=C.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=C.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=C.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new C.Matrix),PIXI.TextureSilentFail=!0,PIXI.canUseNewCanvasBlendModes=function(){return C.Device.canUseMultiply},"undefined"==typeof exports?"undefined"!=typeof define&&define.amd?define("Phaser",function(){return T.Phaser=C}()):T.Phaser=C:("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports.Phaser=C),C}.call(this),Phaser.Filter.Gray=class extends Phaser.Filter{constructor(_){super(_),this.uniforms.gray={type:"1f",value:1},this.fragmentSrc=["precision mediump float;","varying vec2       vTextureCoord;","varying vec4       vColor;","uniform sampler2D  uSampler;","uniform float      gray;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord);","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126 * gl_FragColor.r + 0.7152 * gl_FragColor.g + 0.0722 * gl_FragColor.b), gray);","}"]}get gray(){return this.uniforms.gray.value}set gray(_){this.uniforms.gray.value=_}};class Bullet extends Phaser.Sprite{constructor(_,T){super(_,0,0,T),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(0.5),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.tracking=!1,this.scaleSpeed=0,this.updateHooks=[]}hookUpdate(_){this.updateHooks.push(_)}fire(_,T,C,P,S,A,E){S=S||0,A=A||0,this.reset(_,T),this.game.physics.arcade.velocityFromAngle(C,P,this.body.velocity),this.body.gravity.set(S,A),this.homing=!!E&&"boss",this.speed=P,this._angle=C}update(){if(!game.rewinding&&game.state.states.Game.player.alive&&this.exists){var _=this.game.time.physicsElapsed,T=game.state.states.Game.boss;if(this.homing){var C=T.body.x+T.body.width/2,P=this.body.x+this.body.width/2,S=T.body.y+T.body.height/2,A=this.body.y+this.body.height/2,E=Math.atan2(S-A,C-P);E=180*(E/Math.PI);var R=Math.sqrt((C-P)**2+(S-A)**2),L=E-this._angle;180<L&&(L-=360),-180>L&&(L+=360),L/=1e3*_*(R/game.height),this._angle+=L,this.game.physics.arcade.velocityFromAngle(this._angle,this.speed,this.body.velocity)}game.physics.arcade.overlap(this,T)&&(T.damage(),this.kill()),this.tracking&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),0<this.scaleSpeed&&(this.scale.x+=this.scaleSpeed,this.scale.y+=this.scaleSpeed),this.angle-=140*_}}}class BossBullet extends Bullet{constructor(_,T){super(_,T)}static get Color(){return{Red:0,Yellow:1,Green:2,Purple:3}}fire(_,T,C,P,S,A,E,R,L){this.scale.setTo(R),this.frame=L,super.fire(_,T,C,P,S,A,E),this.homing&&(this.homing="player")}update(){var _=game.state.states.Game.player,T=game.state.states.Game.hitbox;if(this.exists&&!game.rewinding&&_.alive&&_.alive&&("player"===this.homing,!game.rewinding)){var C=this.body.x+this.body.width/2,P=this.body.y+this.body.height/2,S=_.body.x+_.body.width/2,A=_.body.y+_.body.height/2,E=Math.max(this.body.width/2,this.body.height/2),R=Math.sqrt((S-C)**2+(A-P)**2);R-=2;R<=E*(7/8)&&game.physics.arcade.overlap(this,T)?(_.die(),window.k=this):R<=E*(8/7)&&_.graze();for(var M=0;M<this.updateHooks.length;M++)this.updateHooks[M].call(this)}}}var BulletOptions={ReimuA:class extends Phaser.Group{constructor(_){super(_,_.world,"playerBullet",!1,!0,Phaser.Physics.ARCADE),this.nextFire=0,this.bulletSpeed=600,this.fireRate=100;for(var T=0;170>T;T++){let C=new Bullet(_,"playerBullet");C.alpha=0.4,this.add(C,!0)}}fire(_){var T=this.game.state.states.Game.player;if(!(this.game.time.time<this.nextFire)){game.state.states.Game.sounds.shot.play();var C=_.body.x+2,P=_.body.y-16,S=this.getFirstExists(!1);S.tint=16764108,S.fire(C,P,270,this.bulletSpeed,0,0);var A=0;A=8>T.power?0:16>T.power?1:~~(T.power/16)+1;for(var E=0;E<A;E++)if(0==(1&E)){let L=this.getFirstExists(!1);L.tint=16777215,L.fire(C+5*(E/2+1),P,330+5*(E/2+1),this.bulletSpeed,0,0,!0);let D=this.getFirstExists(!1);D.tint=16777215,D.fire(C-5*(E/2+1),P,210-5*(E/2+1),this.bulletSpeed,0,0,!0)}else{var R=game.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?1:6;let L=this.getFirstExists(!1);L.tint=16764108,L.fire(C+5*((E+1)/2),P,270+R*((E+1)/2),this.bulletSpeed,0,0);let D=this.getFirstExists(!1);D.tint=16764108,D.fire(C-5*((E+1)/2),P,270-R*((E+1)/2),this.bulletSpeed,0,0)}this.nextFire=this.game.time.time+this.fireRate}}},FlandreA:class extends Phaser.Group{constructor(_){super(_,_.world,"FlandreA",!1,!0,Phaser.Physics.ARCADE);for(var T=0;500>T;T++){let P=new BossBullet(_,"bossBullet");P.alpha=1,this.add(P,!0)}var C=this;this.fire={circle:function(P,S,A,E,R){S===void 0&&(S=200),A===void 0&&(A=1),E===void 0&&(E=0),R===void 0&&(R=0);for(var L=C.game.state.states.Game.player,D=P.body.x+P.body.width/2,M=P.body.y+P.body.height/2,O=0;18>O;O++)C.getFirstExists(!1).fire(D,M,20*O+E,S,0,0,!1,A,R)},couplet:function(P,S,A,E,R){S===void 0&&(S=200),A===void 0&&(A=1),E===void 0&&(E=0),R===void 0&&(R=0);var L=P.body.x+P.body.width/2,D=P.body.y+P.body.height/2;C.getFirstExists(!1).fire(L,D,90-E,S,0,0,!1,A,R),C.getFirstExists(!1).fire(L,D,90+E,S,0,0,!1,A,R)},single:function(P,S,A,E,R,L,D,M){void 0===S&&(S=200),void 0===A&&(A=1),void 0===E&&(E=1),void 0===R&&(R=0),void 0===L&&(L=0),void 0===D&&(D=0),void 0===M&&(M=0);var O,U;P.body?(O=P.body.x+P.body.width/2,U=P.body.y+P.body.height/2):(O=P.x,U=P.y);var W=C.getFirstExists(!1);return W.fire(O,U,R,S,D,M,!1,A,L),W.scale.y=E,W},laser:function(P,S,A,E){void 0===S&&(S=50),void 0===A&&(A=0),void 0===E&&(E=0);var R,L;P.body?(R=P.body.x+P.body.width/2,L=P.body.y+P.body.height/2):(R=P.x,L=P.y);var D=C.getFirstExists(!1);return D.fire(R,L,A,0,0,0,!1,4,E),D.angle=A,D.scale.y=4,D.hookUpdate(function(){this.scale.y<_.height/16?this.scale.y+=32*_.time.physicsElapsed:this.angle+=S*_.time.physicsElapsed}),D.anchor.y=0,D}}}}};class Rect extends Phaser.Sprite{constructor(_,T){super(_,0,0,T),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(0),this.checkWorldBounds=!1,this.outOfBoundsKill=!1,_.physics.arcade.enable(this),this.reset(0,0),this.z=900}}class TimeRect extends Rect{constructor(_,T){super(_,T),this.scale.y=16,this.x=0,this.y=_.height-this.scale.y,this.alpha=0.4}update(){this.scale.x=game.width*(game.remainingTime/game.maxTime),this.x=(game.width-this.scale.x)/2,this.tint=game.type===GameType.A?16777215:11184895}}class CutoffRect extends Rect{constructor(_,T){super(_,T),this.scale.y=16,this.scale.x=_.width*(_.cutoffTime/_.maxTime),this.x=(_.width-this.scale.x)/2,this.y=_.height-this.scale.y,this.alpha=0.25,this.tint=16711680}}class BossHealthRect extends Rect{constructor(_,T){super(_,T),this.scale.y=16,this.y=0,this.alpha=0.4,this.tint=16777045}update(){var _=game.state.states.Game.boss;_.ready?(this.scale.x=game.width*(_.health/_.maxHealth),this.x=(game.width-this.scale.x)/2):(this.scale.x=game.width*(game.remainingTime/game.maxTime),this.x=(game.width-this.scale.x)/2)}}class FlashRect extends Rect{constructor(_,T){super(_,T),this.scale.y=_.height,this.scale.x=_.width,this.x=0,this.y=0,this.alpha=0,this.tint=16777215,this.visible=!1}flash(_,T,C){this.alpha=_,this.visible=!0,game.world.bringToTop(this),setTimeout(()=>{this.alpha=0,this.visible=!1,C&&C()},T)}update(){this.visible&&game.world.bringToTop(this)}}class Boss extends Phaser.Sprite{constructor(_,T){super(_,0,0,T),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(0.5),this.checkWorldBounds=!1,this.outOfBoundsKill=!1,_.physics.arcade.enable(this),this.reset(0-this.width,0-this.height),this.state=0,this.power=0,this.animations.add("idle"),this.animations.play("idle",2,!0),this.body.setSize(22,30,4,26),this.options=[],this.options.push(new BulletOptions.FlandreA(_)),this.counter=0,this.metaCounter=0,this.metaState=0,this.peepee=0,this.ready=!1,this.maxHealth=100,this.health=this.maxHealth,this.invincible=!1,this.currentSpell=0,this.spells=[0,1,6,5,7,8],this.cache={}}get cx(){return this.body.x+this.body.width/2}set cx(_){this.body.x=_-this.body.width/2}get cy(){return this.body.y+this.body.height/2}set cy(_){this.body.y=_-this.body.height/2}spawnPowers(){game.state.states.Game.powerGroup.spawn(this)}damage(){if(!this.invincible&&(this.health-=1,this.tint=16755370,this.power=0,0>=this.health)){if(this.invincible=!0,this.destroyAllBullets(),this.currentSpell++,this.state=3,this.counter=0,this.metaState=0,this.peepee=0,this.body.velocity.set(0),this.currentSpell>=this.spells.length)return void win();this.spawnPowers()}}destroyAllBullets(){for(var _=game.state.states.Game.boss.options[0].children,T=0;T<_.length;T++)_[T].kill();var C=game.state.states.Game.flashRect;C.flash(1,100,function(){game.state.states.Game.sounds.effect1.play(),setTimeout(function(){C.flash(1,100),game.state.states.Game.sounds.effect1.play()},100)})}update(){var _=game.state.states.Game.player,T=game.state.states.Game.flashRect,C=1e3*game.time.physicsElapsed;if(!game.rewinding&&_.alive)switch(16777215!==this.tint&&(this.power+=C,20<=this.power&&(this.tint=16777215,this.power=0)),game.physics.arcade.overlap(this,_)&&_.die(),this.state){case 0:{if((game.remainingTime===game.maxTime||1===this.metaState)&&(0===this.metaState&&(this.body.velocity.x=120,this.body.velocity.y=240,this.metaState=1,this.ready=!0,this.invincible=!0),this.body.velocity.y-=150*game.time.physicsElapsed,this.cx>=game.width/2))return this.state=4,this.body.velocity.y=0,this.body.velocity.x=0,this.cx=game.width/2,this.counter=0,this.invincible=!1,this.metaState=0,this.counter=0,this.metaCounter=0,void(this.peepee=0);break}case 1:{if(0===this.peepee)if(this.body.velocity.y=-30,128>this.cy)this.cy=128,this.body.velocity.set(0),this.peepee=1;else return;this.counter+=C,50<this.counter&&(this.options[0].fire.circle(this,20*(this.metaState+1),1.5,5*this.metaState,BossBullet.Color.Red),game.state.states.Game.sounds.bossShot.play(),this.counter=0,this.metaState++,10===this.metaState&&(this.state=2,this.metaState=0,this.counter=-500));break}case 2:{if(this.counter+=C,500<this.counter){var P=this.body.x+this.body.width/2,S=_.body.x+_.body.width/2,A=this.body.y+this.body.height/2,E=_.body.y+_.body.height/2,R=Math.atan2(E-A,S-P);R=180*(R/Math.PI),this.options[0].fire.circle(this,100,1.5,R,BossBullet.Color.Yellow),this.counter=0,this.metaState++,game.state.states.Game.sounds.bossShot.play(),10===this.metaState&&(this.state=1,this.metaState=0,this.counter=0)}break}case 3:{this.health+=this.maxHealth/2e3*C,this.health>=this.maxHealth&&(this.maxHealth+=200,this.health=this.maxHealth,this.state=this.spells[this.currentSpell],this.invincible=!1,this.counter=0,this.metaState=0,this.peepee=0,this.metaCounter=0);break}case 4:{switch(this.counter+=C,this.metaState){case 0:{120<this.y?this.body.velocity.y=-20:(this.y=120,this.body.velocity.y=-5,this.metaState=1,this.counter=0,this.cache.last=void 0);break}case 1:{if(500>this.counter)this.body.velocity.y-=0.1*C;else if(1500>this.counter){0===this.peepee&&(0>this.body.velocity.y&&(this.body.velocity.y*=-0.5),this.body.velocity.y+=0.1*C);var L=~~(this.counter/50);(!this.cache.last||this.cache.last<L)&&(this.cache.last=L,this.options[0].fire.couplet(this,50,1,(L-15)*(30/(this.peepee+1)),BossBullet.Color.Green),game.state.states.Game.sounds.bossShot.play())}else this.body.velocity.y=0,2<this.peepee?3<this.peepee?(this.metaState=2,this.peepee=0,this.counter=0):(this.body.velocity.y=-10,3e3<this.counter&&this.peepee++):(this.counter=500,this.cache.last=void 0,this.peepee++,this.body.velocity.y=-10,this.metaCounter=0);break}case 2:{if(this.metaCounter+=C,0===this.peepee){this.cache.a_delta=2/5*Math.PI,this.cache.a_0=1/2*Math.PI,this.cache.pts=[];for(var D=0;5>D;D++)this.cache.pts.push({x:Math.cos(this.cache.a_0),y:Math.sin(this.cache.a_0)}),this.cache.a_0+=this.cache.a_delta;this.peepee=1,this.cache.currentPt=0,this.cache.updateVelocity=!0,this.cache.bullets=[]}switch(this.cache.currentPt){case 0:this.cache.nextPt=2;break;case 2:this.cache.nextPt=4;break;case 4:this.cache.nextPt=1;break;case 1:this.cache.nextPt=3;break;case 3:this.cache.nextPt=0;}if(this.cache.updateVelocity){var R=Math.atan2(this.cache.pts[this.cache.nextPt].y-this.cache.pts[this.cache.currentPt].y,this.cache.pts[this.cache.nextPt].x-this.cache.pts[this.cache.currentPt].x);R=180*(R/Math.PI),game.physics.arcade.velocityFromAngle(R,200,this.body.velocity),this.cache.updateVelocity=!1}if(50<this.metaCounter){var M=this.options[0].fire.single(this,0,1,1,0,BossBullet.Color.Red,0,0);this.metaCounter=0,this.cache.bullets.push(M.z)}if(500<=this.counter){if(T.flash(0.2,50),game.state.states.Game.sounds.effect1.play(),this.peepee++,this.cache.updateVelocity=!0,this.cache.currentPt=this.cache.nextPt,5<this.peepee){this.metaState=3,this.counter=0,this.metaCounter=0,this.peepee=0,this.body.velocity.set(0);for(var D=0;D<this.cache.bullets.length;D++){let K=this.options[0].children[this.cache.bullets[D]];K.body.gravity.y=K.body.y}this.cache.bullets.length=0}this.counter=0}break}case 3:{if(this.metaCounter+=C,!(3e3>this.counter))this.metaState=0,this.counter=0,this.metaCounter=0,this.peepee=0;else if(10<this.metaCounter){this.metaCounter=0;this.options[0].fire.couplet(this,150,1,this.counter/2%60+15,BossBullet.Color.Green),game.state.states.Game.sounds.bossShot.play()}break}}break}case 5:{this.counter+=C;var U=70;switch(this.metaState){case 0:{this.cx>-U?(this.body.velocity.x-=0.1*C,this.body.velocity.y=-50):(this.metaState=1,this.cy=50,this.body.velocity.y=0);break}case 1:{if(this.metaCounter+=C,this.cx<game.width+U&&0<=this.body.velocity.x?this.body.velocity.x=400:(this.body.velocity.x=-400,this.cx<-U&&(this.body.velocity.x=100)),100<this.metaCounter){for(var D=0;5>D;D++)this.options[0].fire.single(this,0,0.4,1.5,0,BossBullet.Color.Red,0,25*(D+1));this.metaCounter=0,0<this.x+this.width&&this.x<game.width&&game.state.states.Game.sounds.bossShot.play()}break}}break}case 6:{switch(this.counter+=C,this.metaState){case 0:{this.cx<game.width+100&&(this.body.velocity.x=200,this.body.velocity.y=-10),(this.cx>=game.width+100||-64>=this.cy)&&(this.cx=game.width/2,this.cy=-64,this.metaState=1,this.body.velocity.y=20,this.body.velocity.x=0);break}case 1:{if(this.metaCounter+=C,100<=this.counter&&(this.options[0].fire.single(this,200,3,3,this.peepee,BossBullet.Color.Red,0,0),this.peepee+=2,this.counter=0,game.state.states.Game.sounds.bossShot.play()),this.cy>game.height+this.height/2&&(this.cy=-64,this.peepee=0),2e3<=this.metaCounter){this.metaCounter=0;for(var W=game.height/9,X=game.width/5,D=0;8>D;D++)this.options[0].fire.single({x:1&D?game.width+7.5:-7.5,y:W*(D+1)},40,1,1,180*(1&D),BossBullet.Color.Green,0,0);for(var D=0;4>D;D++)this.options[0].fire.single({x:X*(D+1),y:1&D?game.height+7.5:-7.5},50,1,1,1&D?270:90,BossBullet.Color.Yellow,0,0)}break}}break}case 8:if(0===this.metaState){this.metaState=1;var R=Math.atan2(_.cy-this.cy,_.cx-this.cx);R=180*(R/Math.PI),this.options[0].fire.single(this,80,3,3,R,BossBullet.Color.Yellow,0,0)}else if(1e3<=this.peepee&&!this.cache.switch){var R=Math.atan2(_.cy-this.cy,_.cx-this.cx);R=180*(R/Math.PI),this.options[0].fire.single(this,80,3,3,R,BossBullet.Color.Yellow,0,0),this.cache.switch=!0}case 7:{if(0!==this.metaState){this.counter+=C,this.metaCounter+=C,this.peepee+=C;var Y=200<=this.counter;if(Y){this.counter=0;for(var V=3,D=0;D<V;D++)this.options[0].fire.couplet(this,200,2,90+180/(V+1)*D,BossBullet.Color.Yellow);game.state.states.Game.sounds.bossShot.play()}var z=1500<=this.metaCounter;z&&(this.metaCounter=0),2e3<=this.peepee&&(this.peepee=0,this.cache.switch=!1,this.options[0].fire.single({x:0,y:game.state.states.Game.player.cy},100,1,1,0,BossBullet.Color.Green,0,0),this.options[0].fire.single({x:game.width,y:game.state.states.Game.player.cy},100,1,1,180,BossBullet.Color.Green,0,0));for(var D=0;D<this.cache.spawners.length;D++)z&&(this.cache.spawners[D].y-=this.cache.spawners[D].speed,0>this.cache.spawners[D].y&&(this.cache.spawners[D].y+=game.height)),Y&&this.options[0].fire.single(this.cache.spawners[D],100,1,1,0===this.cache.spawners[D].x?45:135,BossBullet.Color.Red,0,0)}else if(0===this.peepee&&(this.cache.right=this.cx>game.width/2,this.cache.sx=!1,this.peepee=1),this.cache.sx||(this.cache.right?(this.body.velocity.x=-50,this.cx<game.width/2&&(this.cx=game.width/2,this.sx=!0,this.body.velocity.x=0)):(this.body.velocity.x=50,this.cx>game.width/2&&(this.cx=game.width/2,this.sx=!0,this.body.velocity.x=0))),60>this.cy?this.body.velocity.y+=0.01*C:(this.cy=60,this.body.velocity.y=0),0===this.body.velocity.y&0===this.body.velocity.x){this.metaState=1,this.cache={spawners:[]};for(var V=3,H=game.height/(V+1),D=0;D<V+1;D++)this.cache.spawners.push({x:0,y:H*D,speed:60}),this.cache.spawners.push({x:game.width,y:H*D,speed:60});this.cache.switch=!1,this.peepee=0}break}}}}class Player extends Phaser.Sprite{constructor(_,T){super(_,0,0,T),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(0.5),this.checkWorldBounds=!1,this.outOfBoundsKill=!1,this.speed=240,_.physics.arcade.enable(this),this.reset(_.width/2,_.height-64),this.power=0,this.animations.add("idle"),this.animations.play("idle",2,!0),this.body.setSize(4,4,this.width/2-2,42),this.body.collideWorldBounds=!0,this.options=[],this.currentOption=0,this.options.push(new BulletOptions.ReimuA(this.game)),this.alive=!0,this.deathCounter=0,this.cx=_.width/2,this.won=!1}get cx(){return this.body.x+this.body.width/2}set cx(_){this.body.x=_-this.body.width/2}get cy(){return this.body.y+this.body.height/2}set cy(_){this.body.y=_-this.body.height/2}update(){if(game.input.keyboard.isDown(Phaser.Keyboard.X)?game.rewinding?0>=game.remainingTime&&stopRewind():game.remainingTime>game.cutoffTime&&startRewind():game.rewinding&&stopRewind(),(!game.rewinding||game.type===GameType.B)&&this.alive||game.rewinding&&!this.alive&&game.type===GameType.B){var _=game.state.states.Game;this.body.velocity.set(0);var T=_.input.keyboard.isDown(Phaser.Keyboard.SHIFT),C=T?2:1;game.input.keyboard.isDown(Phaser.Keyboard.LEFT)?this.body.x-=this.speed*game.time.physicsElapsed/C:game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)&&(this.body.x+=this.speed*game.time.physicsElapsed/C),game.input.keyboard.isDown(Phaser.Keyboard.UP)?this.body.y-=this.speed*game.time.physicsElapsed/C:game.input.keyboard.isDown(Phaser.Keyboard.DOWN)&&(this.body.y+=this.speed*game.time.physicsElapsed/C),this.body.x=Math.min(this.body.x,game.width-9),this.body.x=Math.max(this.body.x,5),this.body.y=Math.min(this.body.y,game.height-9),this.body.y=Math.max(this.body.y,11),_.input.keyboard.isDown(Phaser.Keyboard.Z)&&!game.rewinding&&this.options[this.currentOption].fire(this),_.hitbox.x=this.body.x-1,_.hitbox.y=this.body.y-1,T?(_.hitbox.alpha=1,game.world.bringToTop(_.hitbox)):_.hitbox.alpha=0}}die(){if(this.alive=!1,game.state.states.Game.sounds.die.play(),game.remainingTime>game.cutoffTime)game.remainingTime/=2,game.remainingTime<game.cutoffTime&&(game.remainingTime=game.cutoffTime+1);else{var _=game.state.states.Game.flashRect;_.flash(0,500,function(){_.flash(0.25,500,function(){_.flash(0.5,500,function(){_.flash(0.75,500,function(){_.flash(1,500,function(){restart()})})})})})}}graze(){this.grazing=!0}}class PowerItem extends Phaser.Sprite{constructor(_,T,C,P,S){super(_,0,0,T),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(0.5),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,_.physics.arcade.enable(this),this.value=S?8:1,this.scale.set(S?1.5:1),this.exists=!1}spawn(_,T){this.reset(_,T),this.body.velocity.x=40*Math.random()-20,this.body.velocity.y=-50*Math.random(),this.body.gravity.y=10*Math.random()+45}update(){var _=game.state.states.Game.player;if(_.alive&&!game.rewinding&&this.exists){0<this.body.velocity.y&&(this.body.velocity.x=0);var T=this.body.x+this.body.width/2,C=this.body.y+this.body.height/2,P=_.body.x+_.body.width/2,S=_.body.y+_.body.height/2,A=Math.sqrt((T-P)**2+(C-S)**2);if(A<50){var L=Math.atan2(S-C,P-T);L=180*(L/Math.PI),this.game.physics.arcade.velocityFromAngle(L,300,this.body.velocity)}game.physics.arcade.overlap(this,_)&&(_.power+=this.value,128<_.power&&(_.power=128),this.kill())}}}class PowerGroup extends Phaser.Group{constructor(_){super(_,_.world,"PowerGroup",!1,!1,Phaser.Physics.ARCADE);for(var T=0;5>T;T++){let C=new PowerItem(_,"power",this.cx,this.cy,0===T);this.add(C,!0)}}spawn(_){var T,C;_.body?(T=_.body.x+_.body.width/2,C=_.body.y+_.body.height/2):(T=_.x,C=_.y);for(var P=0;P<this.children.length;P++)this.children[P].spawn(T,C)}}var game=new Phaser.Game(384,448,Phaser.AUTO,"game");game.packs=[],game.maxTime=2500,game.cutoffTime=500,game.remainingTime=0,game.timeRegain=4,game.rewinding=!1,game.rewindSpeed=1,game.rewindCounter=0,game.rewindSwitch=!1,game.firstFrame=null,game.restarting=!1;var GameType={A:0,B:1};game.type=GameType.A;function startRewind(){game.state.states.Game.player.won||(game.rewinding=!0,game.rewindCounter=0,game.rewindSpeed=1,game.rewindSwitch=!1)}function win(){game.state.states.Game.player.alive=!1,game.state.states.Game.player.won=!0;var _=game.state.states.Game.flashRect;_.flash(0,500,function(){_.flash(0.25,500,function(){game.sound.volume=0.75,_.flash(0.5,500,function(){game.sound.volume=0.5,_.flash(0.75,500,function(){game.sound.volume=0.25,_.flash(1,500,function(){game.sound.volume=0,game.state.states.Game.winImage.visible=!0})})})})})}function stopRewind(){game.rewinding=!1,game.state.states.Game.player.alive=!0}function lastPacked(_){return void 0===_&&(_=0),game.packs[game.packs.length-1-_]}function packSprite(_){var T={x:_.x,y:_.y,vx:_.body?_.body.velocity.x:0,vy:_.body?_.body.velocity.y:0,gx:_.body?_.body.gravity.x:0,gy:_.body?_.body.gravity.y:0,angle:_.angle,visible:_.visible,exists:_.exists,power:_.power||0,health:_.health||100,maxHealth:_.maxHealth||100,frame:_.frame||0,sx:_.scale.x||1,sy:_.scale.y||1,tint:_.tint,alpha:_.alpha,homing:_.homing||!1,ready:_.ready||!1,invincible:_.invincible||!1,counter:_.counter||0,metaCounter:_.metaCounter||0,state:_.state||0,currentSpell:_.currentSpell||0,metaState:_.metaState||0,cache:_.cache?JSON.parse(JSON.stringify(_.cache)):{},peepee:_.peepee||0};return T}function unpackSprite(_,T){T.x=_.x,T.y=_.y,T.body&&(T.body.velocity.x=_.vx),T.body&&(T.body.velocity.y=_.vy),T.body&&(T.body.gravity.x=_.gx),T.body&&(T.body.gravity.y=_.gy),T.angle=_.angle,T.exists=_.exists,T.power=_.power,T.health=_.health,T.maxHealth=_.maxHealth,T.frame=_.frame,T.scale.x=_.sx,T.scale.y=_.sy,T.tint=_.tint,T.alpha=_.alpha,T.homing=_.homing,T.ready=_.ready,T.invincible=_.invincible,T.counter=_.counter,T.metaCounter=_.metaCounter,T.state=_.state,T.currentSpell=_.currentSpell,T.metaState=_.metaState,T.cache=_.cache,T.peepee=_.peepee,T.visible=_.visible}function packCurrentFrame(){for(var _=game.state.states.Game,T={player:packSprite(_.player),hitbox:packSprite(_.hitbox),boss:packSprite(_.boss),playerBullets:[],bossBullets:[],powerItems:[],flashRect:packSprite(_.flashRect)},C=_.player.options[0].children,P=0;P<C.length;P++)T.playerBullets.push(packSprite(C[P]));for(var S=_.boss.options[0].children,P=0;P<S.length;P++)T.bossBullets.push(packSprite(S[P]));for(var A=_.powerGroup.children,P=0;P<A.length;P++)T.powerItems.push(packSprite(A[P]));T.timestamp=Date.now(),game.packs.push(T);for(var P=0;P<game.packs.length&&T.timestamp-game.packs[P].timestamp>game.maxTime;P++)game.packs.shift(),P--;null===game.firstFrame&&(game.firstFrame=T)}function unpackCurrentFrame(_,T){if(0!==game.packs.length){void 0===T&&(T=!0);var C=Date.now(),P=lastPacked();_||game.packs.pop();var S=0<game.packs.length?P.timestamp-lastPacked().timestamp:0,A=game.state.states.Game;(game.type===GameType.A||game.restarting)&&(unpackSprite(P.player,A.player),unpackSprite(P.hitbox,A.hitbox)),unpackSprite(P.boss,A.boss),T&&unpackSprite(P.flashRect,A.flashRect);for(var E=A.player.options[0].children,R=0;R<E.length;R++)unpackSprite(P.playerBullets[R],E[R]);for(var L=A.boss.options[0].children,R=0;R<L.length;R++)unpackSprite(P.bossBullets[R],L[R]);for(var D=A.powerGroup.children,R=0;R<D.length;R++)unpackSprite(P.powerItems[R],D[R]);return 100<S&&console.log(S),S}}function restart(){game.restarting=!0,game.packs=[game.firstFrame],unpackCurrentFrame(),game.restarting=!1}class PhaserGame{constructor(){this.background=null,this.foreground=null,this.player=null,this.cursors=null}init(){this.game.renderer.renderSession.roundPixels=!0,Phaser.Canvas.setImageRenderingCrisp(this.game.canvas),this.physics.startSystem(Phaser.Physics.ARCADE)}preload(){this.load.image("background","assets/black.png"),this.load.image("win","assets/win.png"),this.load.image("hitbox","assets/hitbox.png"),this.load.image("hurt","assets/hurt.png"),this.load.spritesheet("player","assets/ship.png",32,64),this.load.spritesheet("boss","assets/boss.png",32,64),this.load.spritesheet("bossBullet","assets/bullet2.png",16,16),this.load.image("playerBullet","assets/bullet1.png"),this.load.image("power","assets/power.png"),this.load.image("rect","assets/rect.png"),this.load.audio("shot","assets/sound/shot.mp3"),this.load.audio("bossShot","assets/sound/bossShot.mp3"),this.load.audio("die","assets/sound/die.mp3"),this.load.audio("hit","assets/sound/hit.mp3"),this.load.audio("hit2","assets/sound/die.mp3"),this.load.audio("effect1","assets/sound/effect1.mp3"),this.load.audio("bg","assets/sound/bg.mp3"),this.load.audio("bgr","assets/sound/bgr.mp3")}create(){for(var _ in this.winImage=this.add.sprite(0,0,"win"),this.winImage.visible=!1,game.stage.setBackgroundColor(""),this.flashRect=this.add.existing(new FlashRect(game,"rect")),this.timeRect=this.add.existing(new TimeRect(game,"rect")),this.cutoffRect=this.add.existing(new CutoffRect(game,"rect")),this.bossHealthRect=this.add.existing(new BossHealthRect(game,"rect")),this.hitbox=this.add.sprite(0,0,"hitbox"),this.hitbox.alpha=0,game.physics.arcade.enable(this.hitbox),this.hitbox.body.setSize(4,4,1,1),this.hurt=this.add.sprite(0,0,"hurt"),this.hurt.visible=!1,this.player=this.add.existing(new Player(game,"player")),this.powerGroup=new PowerGroup(game),this.sounds={shot:game.add.audio("shot"),bossShot:game.add.audio("bossShot"),die:game.add.audio("die"),hit:game.add.audio("hit"),hit2:game.add.audio("hit2"),effect1:game.add.audio("effect1"),bg:game.add.audio("bg"),bgr:game.add.audio("bgr")},this.sounds)this.sounds[_].allowMultiple=!0;this.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.SHIFT,Phaser.Keyboard.Z,Phaser.Keyboard.X,Phaser.Keyboard.C]),this.boss=this.add.existing(new Boss(game,"boss")),this.grayFilter=game.add.filter("Gray"),this.grayFilter.gray=0.7,this.sounds.bg.loopFull(0.5),this.muteButton=game.input.keyboard.addKey(Phaser.Keyboard.S),this.muteButton.onDown.add(this.mute,this),this.typeButton=game.input.keyboard.addKey(Phaser.Keyboard.Q),this.typeButton.onDown.add(this.toggleType,this),game.sound.muteOnPause=!1}mute(){game.sound.mute=!game.sound.mute}toggleType(){game.type++,game.type>GameType.B&&(game.type=0)}update(){var _=1e3*game.time.physicsElapsed,T=game.state.states.Game.player,C=game.state.states.Game.boss;if(T.won)return void(this.winImage.visible&&game.world.bringToTop(this.winImage));if(this.hurt.visible&&(game.world.bringToTop(this.hurt),this.hurt.counter+=_,100<this.hurt.counter&&(this.hurt.visible=!1)),game.rewinding)game.remainingTime-=unpackCurrentFrame(game.rewindSwitch);else if(T.alive){var P=C.ready?game.timeRegain:1;game.remainingTime+=_/P,this.player.grazing&&(game.remainingTime+=_/P,this.player.grazing=!1),game.remainingTime>game.maxTime&&(game.remainingTime=game.maxTime)}else unpackCurrentFrame(!T.alive,!1)}render(){game.paused||game.rewinding||!this.player.alive||packCurrentFrame();var _=Date.now();if(1===game.packs.length)game.packs[0].timestamp=_;else if(0<game.packs.length)for(var T=game.packs.length-1;0<=T;T--)T===game.packs.length-1?(game.packs[T].delta=game.packs[T].timestamp-game.packs[T-1].timestamp,game.packs[T].timestamp=_):0<T?(game.packs[T].delta=game.packs[T].timestamp-game.packs[T-1].timestamp,game.packs[T].timestamp=game.packs[T+1].timestamp-game.packs[T+1].delta):game.packs[T].timestamp=game.packs[T+1].timestamp-game.packs[T+1].delta;(0>=game.remainingTime||0===game.packs.length)&&(stopRewind(),this.player.alive=!0),game.world.filters=!game.rewinding&&this.player.alive||this.player.won?void 0:[this.grayFilter]}}game.state.add("Game",PhaserGame,!0);